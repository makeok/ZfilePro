var xa=Object.defineProperty,Ta=Object.defineProperties;var ba=Object.getOwnPropertyDescriptors;var hs=Object.getOwnPropertySymbols;var Aa=Object.prototype.hasOwnProperty,La=Object.prototype.propertyIsEnumerable;var ps=Math.pow,fs=(d,t,e)=>t in d?xa(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e,$t=(d,t)=>{for(var e in t||(t={}))Aa.call(t,e)&&fs(d,e,t[e]);if(hs)for(var e of hs(t))La.call(t,e)&&fs(d,e,t[e]);return d},Kt=(d,t)=>Ta(d,ba(t));var se=(d,t,e)=>new Promise((i,s)=>{var r=l=>{try{a(e.next(l))}catch(o){s(o)}},n=l=>{try{a(e.throw(l))}catch(o){s(o)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(r,n);a((e=e.apply(d,t)).next())});import{x as Ia}from"./base.9447ff7a.js";import"./tooltip.afcd3f9d.js";import{E as wa}from"./popper.34e4046d.js";/* empty css               */import{cQ as ms,ah as gs,ab as gn,a as pi,f as mi,y as Ht,aa as Ra,a8 as Da,r as Ca,o as ka,u as Fe,j as _e,e as Xt,z as ve,l as ys,O as Ma,g as _s,af as Pa,ag as Oa}from"./index.a81894c3.js";import{a as Na,u as Fa,v as Ba,h as Ua}from"./useFileRepeat.09ef18bd.js";import{u as ja,a as rr}from"./useCommon.373cb8ed.js";import{_ as Ga}from"./plugin-vue_export-helper.21dcd24c.js";import"./request.88c6336a.js";import"./focus-trap.c21bbfc6.js";import"./common.d1611fb2.js";import"./index.9f034646.js";import"./index.9dce3cd8.js";import"./event.807e9a54.js";import"./index.1d04ede7.js";import"./scroll.c1d55f52.js";import"./validator.4f1297a1.js";import"./use-outside-click.86ba09c6.js";import"./directive.8a34351b.js";import"./checkbox.adc9a1be.js";import"./index.3b295ed4.js";import"./_Uint8Array.25475a91.js";/* empty css              */import"./index.b1a3ab43.js";import"./XCircleIcon.609d2c30.js";import"./index.9b197a07.js";var Va="/assets/video-download.3a226681.png",$a="/assets/video-thunder.5e7f4cec.png",za="/assets/video-motrix.95ef7e61.png",Ha="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAOeUlEQVR4Xu3dy5EjuRWF4TMGyA550ibIgPZirJjFODIeaDVOaDMvSREKRdRKGy0UVF1mZTV5yGS+ACSA/G/EV1F1p7unu4pA4nEB6nK5fIeG/UN/vvyuL5df9fXyi75///zHq9/00+UP/fye+9vVr3q7cZnw7deMvy/+jPiz4s+MPz/+PyH+v//Wnx7+PmiKPIEKRUMbG/nYuIdG7Q34GPF3GTuJ4e/4hc6hDfIEDjY29njaRqN6/cSu29gxDCMTOoUKyRMoLIbS8dSs7ameS/wbx5FC/Nv9+4Gi5AlkNj7hhzl1/w1+ztghMEI4hDyBDOJJF8PgWFDzBoB745SB0UER8gQSGRs9T/nthl0MOoOM5AnswJM+n7EzYJqQlDyBDWL+OqzYP75wkd6w5fjl4eeA1eQJLDQU4MRqdrvbdK0bipWYIuwgT2AGT/s6xc+EjmA1eQITYt+auX394mfE9GAxeQI3YsGJlfw2DT+zrywaviZP4MNw8IX5fevoCF6SJ04tXiTDqTqe+L0ZOwL/mZ+cPHFaNPxzGEqPWSP4IE+cTrwYWNw7H3YNruSJ0/i2j//44sB5xGvgxOsD8sQpsMCHe/FaOOX6gDzRNYb7eCVeGyebFsgTXRrO4DPcxzIxQvTXUKfkie4M12uxuo91TrJbIE90g6c+Uuh8NCBPdGE4l89TH2l0vDYgTzRvuLf+8YcI7NfdToE80awY8nNMF7nFa6yjugF5okkM+VFSvNY6mRLIE81hyI9jdFE8JE80g1V+1CBeg/7abIg80YRo/FT0oRYNrwvIE9Vjvo8aNbouIE9UbXiHXA7xoFZvrXUC8kS1WOxDG95aKiGWJ6pE40d7mtghkCeqM5zd928uUL8GzhHIE1Vhmw+tq7wTkCeqQeNHLyruBOSJKtD40ZtKC4bkicPR+NGrCkcC8sShaPzoXWWdgDxxGFb7cRYVdQLyxCHY58f5VFEnIE8UN5T3+jcH6F8FFYPyRFHU9uPcDi8blieKiUMTNH7g0ANE8kQRcXaaI73AINrCQfcJyBNFcJkHcC8uFfF2UoA8kR17/cBzB2wPyhNZsd0HvFZ4UVCeyIZFP2CJoouC8kQWLPoByxVcFJQnsuAde4B1Ci0KyhPJMe8HtspeLixPJDXM+/0fBWCZ7OsB8kQyzPuB/aJmxttWQvJEMuz3A2lkrA+QJ5LghB+QVqapgDyRBEN/IK1oU97OEpAnduNmHyCPDFMBeWIXVv2BvBJPBeSJXTjlB+SVeFdAntiMgh+glGQFQvLEJrHnz0EfoJS3VGcF5IlN2PMHykr0TkPyxGos/AHHSLAgKE+sxsIfcIwEC4LyxCpU/AHH2nmDkDyxChV/wLF2VgjKE4ux7QfUYvO2oDyxGE9/oA47rhCTJxbh6b/Pv969/WXw9yf/HVhv0yhAnpjFRR/7/Pevl4f4zw90BNhn4yhAnpjF03+7eOJPxf/+Ofx3/z3AcqtHAfLELJ7+2z17+nvEr2E0gC027AjIEy+x77/Pmohpgf9+YN6qUYA88RJVf/usjZgWxIKh/znAlJXVgfLEJJ7++20NpgVYY0V1oDwxiXf32W9vsEiIJVa8q5A88RQn/tJIEUwLsMTCk4LyxFNc9JlGyqB2AK8svEBUnniK237SSB3UDmDa28Xb8RPyxAMW/9LJFbFIyLQAbsFioDzxgMW/dHIHtQO4tWAxUJ64M1z2+fgHY5sSwbQAt2bOB8gTd1j8S6tkUDuAMLMYKE/cofIvrSOC0cC5zVQGyhOf2PtP76igduDcXtQEyBOfGP6nd3RQO3BOL6YB8sQnhv/p1RJMC87lxTRAnrhi+J9HTUHtwLlMTAPkiSuG/3nUGNQOnMPENECeuKL4J49ag9qB/k0UBckTFP9kVHtQO9C3J0VB8gS1/xm1EkwL+vTkbIA8wVt9Z9RSUDvQnydvKS5PcOtvRi0G04J+PLk1WHcJtv/yajVYJOyHbQfq9osLb/qRV+tB7UAP7q4N1+0XzP8z6yUoKW6XrQPo9gvKfzPrKZgWtMnKgvX5Bfv/+fUYLBK256YeQOMn7P8X0HNQO9COm3oAjZ9Q/19A70HtQBtuzgVo/IT6/wLOEkwL6nZzLkDjJxQAFXC2YJGwTjcFQbp+wgJgGWcMpgV1+lgIVHygArCQMwe1A3X5WAhUfLhQAVjG2YPagZpcKwIVH6gALIQYgkXC431UBCo+sANQCHEf1A4c52MnQPGBEuBCiMdgkfAYHzsBig8X3v67DGI6mBaUd+0A2AIsh5gPFgnLeW/7YguwIGJZMC0o43d9EYeACiLWBbUDeV07AGoAyiHWB7UD+fyi78UpwIKI7cEiYXrXDoAioHKI/UHtQDrvbZ8OoCQiTbBImMZv+klUARZEpA2mBfv8oZ9FFWBBRJ5gkXCbawfARSDlEPmCacF6722fDqAkIn9QO7DGW9QBcA6gFKJMUDuw1LUD8CRyIcoGb2U2iw6gJOKYoHZgEh1AScRxEaMB/3mADqAo4thgXeABHUBJxLERi4P+Mzk5OoCSiOPDfyYnRwdQEnFssA7wgA6gJOLYYEvwAYVAJRHHBQuAz1AJWBRRPjgx+MobZwFKIsoF5cDzroeBOA5cDlEmOBC0zLUD4EKQcoi8Qe3/Otf7AOgAyiHyBMP9ba5XgnEnYDlE+mC4v931UlCuBS+HSBfcALTftQPgjUHKIdIEw/00Pt4XgLcGK4XYF+zpp/aVNwctidgWDPfzuL43IG8PXg6xPhju5/P+8H//ePnuQjlwGcTyYLif33vbj4/fUQ5cCDEfDPfLiDb/2QFQDFQG8Tq4vLOcaPOfHQDFQGUQz4PhfnnR5j87AGoByiDugxLeI3293IwAqAUogfgWDPePFW3+swNgK7AMguF+LaLNf3YA7ASUceZguF+Tt8tHu9f4CTsBBZw1OLFXl48dgKDxE04FFnC24IKOOkVbf+gAWAjM7yzBcL9uHwuAQeMnLAQWcIZguF+/jwXAoPGTKxYC8+o5GO634aMEeKTbL6gIzKzHYLjflo8KwJFuv7hQEZhXb8Fwv0XXCsCRbr/gcpDMeglO7LUr2vhkBxBYB8inh2C43y6b/wd5gnWAjFoOSnjbZ/P/IE9QD5BRi8Fwvx83+/8jeYJ6gIxaC4b7fbnZ/x/JE1e8YWgerQTD/f5Em/Z2PtkBcC4gj9qD4X6/bur/b8kTV2wH5lFzcEFH32z7byRPfGI7ML0ag+F+/55s/43kiU9MA9KrKSjhPY+J4X+QJz4xDUivlmC4fy4Tw/8gT9xhGpDW0cFw/3xeDP+DPHGHaUBaRwXD/fN6MfwP8sQdpgFpHRGc2Du3F8P/IE884LLQdEoGF3Tg5vLPKfLEA84GpFMiGO5j9KT238kTD4azAbx9eAq5g+E+vvm8+/8VeeIpjginkSsY7sM9Ofr7jDzxFIuBaaQOhvuYMrP4N5InJrEYuF/KYLiPKQsW/0byxCQWA/dLEZzYw5wFi38jeeIl7gnYZ28w3Mecmco/J0+8xLXh+2wNSnix3N2133PkiZdiS5DzAdutDYb7WCPa5pNrv16RJ2ZxPmC7NcFwH2vN1P0/I0/MojBouxjKzwXDfWzztvbpH+SJRRgFbBNP9alguI89Njz9gzyxCKOA7WL/3oPhPvbZ9PQP8sRi7AhsF0P8aPQ88ZHGqpX/W/LEYuwIAMfbsPJ/S55YhVEAcLTNT/8gT6xGdSBwjIl3+1lDnliNMwLAMVbU/E+RJzbhpCBQ1ooTf6/IE5sM9wWwLQiU8bb0vP8ceWIzioOAMjYW/TwjT2zGtiCQ38rjvnPkiV1YEATySrDwd0ue2I0LRIE8Fl70uYY8sRtTASC9nRV/U+SJJJgKAGklHvqP5IlkmAoAaWQY+o/kiWSYCgD7ZRr6j+SJpJgKAPskKviZIk8kR4EQsE3Cgp8p8kQWnBgE1klU6z9HnsiC9QBguczz/lvyRDasBwBLJDvos4Q8kRU3CAFzdt3ws5Y8kR31AcBzGff7p8gT2cXchkVB4F6C6722kCeKYFEQ+Kbgop+TJ4qIfyy3CAGh6KKfkyeKYmcA5/aW65DPUvJEcewM4KwObvxBnjgE5cI4n6LbfVPkicOwPYizKFDjv5Q8cSg6AfTugL3+V+SJw9EJoFeVNf4gT1SBdxpCbyps/EGeqAYjAfSi0sYf5Imq0AmgdRU3/iBPVIdOAK2qaLV/ijxRJeoE0J4q9vnnyBPVomIQbTi8vHcNeaJqw9kBDhChVoce7NlCnqhefIM5SozaxGuyscYf5IkmcKkIahJ1Kwed599LnmhGfMPZIcDRKt/mmyNPNIfFQRyjqcW+KfJEk1gXQEmNzvefkSeaFVMCzhAgt4bn+8/IE82jaAh5xPZzE8U9a8gTXWBKgJRix6mTIb+TJ7rBLgFSaKCefw95ojuxUstoAGvFa6aDVf458kSXGA1gjXjqd7TQ94o80TXWBvBKx3P9KfLEKQw7BRwqwqjLFf4l5InTYFqAEK+Bkwz3n5EnTmP8oceQj4NF5xMFPScb7j8jT5xWDAFZH+jfSVb3l5InTi1GBcPhItYHejN07qec578iT+AydAQsFPaBhv+SPAETHQFTg/bQ8BeRJzCBNYI2xIIuc/zF5AnMiBcXx47rw6r+JvIEFhqqClknOFKMyE5UtpuDPIENGBWU9Hb9XjPMT0KewA7jqIDCovSG7+lXnvZpyRNIZOwMWDjcLhp9fA+Z22cjTyADRgZLDcP7eNLT6IuQJ5DZcAjpy/UQCqODsTT3x+v3hOF9cfIECosnXTzxztIhDPv0NPhKyBM42DhCiClDDIdb7hTi7z78G76nwddJnkCFouHcjhSiUQ3rCTXUILxd/y5jQx/n7zT2JsgTaMzYOQxvnR7lyvG0jSH2t45iKJiJkUR0GKPHhjwaf/3YsIfpSexoDA08/l808i78HzPcPJXn8KhQAAAAAElFTkSuQmCC",Ya="/assets/video-iina.1db26170.png",Ka="/assets/video-vlc.54e63a7e.png",Wa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAK2UlEQVR4Xu2dC3BUZxXHD4g4VlukLRTEIKhYochjeBRaCoggpQaqBSrQWFuCwLbFDpRhQIs4Y8YRO1Lr4JSWJkCJVihgy0PerxapUhqaQrCFIkUghM1rs7sJVCYcz3d3v+Tuud+9e/dFdpPvP/OfwAzs3j0//v9zv2x2ANDS0tLS0tLS0tLS0tLS0tLS0tJqEHrhi1gJM+jrOqyAf2A5vEFeSr8exP+sVopFg59C9pJR6UrYRu7F/55WCkQJWGABoPY1Ss9K+tqZP4ZWkkQwRtGAryuG7+QAgfmFqDj+eFoJiob7nmLgbl1KNTYdEVrzx9WKQ1gFvRVDjt2VcIx8P398rRhFdfWoZbiJ2AvbCcxd/Hm0XIqAeCxDTdz19Lj5qBd/7EoREOkApWWJXvwxKMVADFdXQmkRLX7Qiz+6UgHkagXgyWrAzTWAvw0APh1s8Im5Qb34HZUMINfJ5yoBd/sAl/sB5zYCUHpOELaT+/Jr0YL4gVwmAIcpBQUEYKFi6C5cPy8I+TNr9eKPkFsgAQLwPgFYTzX0K+tw43ctBH4WgLwlevGHZAfkGu2BjwjAVgLwXOQeSJrnRLqU4OSORGjDr7FFSQIRe+A8pWAfQXiRaugZxQCTaQajwU8FoeSJlrz4j1SBZw2lYJFiaKk0BxGGYZiA4Owg7JpdC/359TZ7zQuAhw8rleYQzCBMMKTr6ff5U2rhy/y6m61uJBAnEAoYODPsWQGom9FSFv+NAhIPDAKBPyXnkh8nT/dD6fQAzG7Wiz/VQDgIFQwzCDMMAULCkP4xOccPJVOb6+JPJRAOgsPgqZAwZCrMMH4ShvEIeSr5R+TJftg3obkt/lQA4RDcwFBVlDkVAoSwAYI8iW7Nf0B3hxNqoH68Dwqyq6Arf20ZqWQC4QDcgrCDoUrFw/5GGNnkB8hjyCN8UDe8BvImZ/riTxYQDoGDsNsV5oqyS4WAIVPxkN9IhQFiLHmUgEG+hzzEBwjVUAYXBzwB+5dk5uJPFAiHoAJhB0O1uM2pUFWUTIWAIUAMEhAudUU4PQeheBfCOz6Ew36EQ/4SeNufzV9v2iteIByCHQwVCGEOQqbCXFEShLBIhYAhQEA5+VwOQsk6hCNlCP8MEogAgRAmGG+HfZD8ln8/HKzOnMWfTCBOu8IpFbyieCp6VxKAiw8ifLQC4djHCO8SgH+F3QDD3whDgBDeXxPy3pp62Fv9KuyuS//FHw8QDiIWGHxfqCpqXLWoodEI/1mKcPwownvBEAThIyYYAoSEYU7FwTCIfQYMhN1UY7vIO6vrYIcvD/5eeQufQ9ooViDxgHBa3MJTKAntL/emGlqEcHIvpYCGVxQMgVDBcKqoAyYYe3xmGAjbydsMl8OW6sf5LNJCsQCxA+EEwy4VA6taIVzw0DLeRMvYSxDqCIJwbSOIoyYQFhh+sbitFSVTIWBIEDsEDF8Ixpaw36xCeKPqZUBsxWfSpHIDxCkV0hyEeV8ICA+Ku6GL06iGChBOnCEINPz360IgGmC4SIWqosyp2OuLhCFSIZMhQGw2QCBsqgz5b1WL+EyaVNGAcBgcCE+GhDGNauhm71iET36P8CHtgeJgCIJ0BIjaRhgyFSoY5oqyLm5TRclUmEA0pCIMYiN5A/n1iquwtjZ93te3A8IhcBAcxgzy3RX9qIZ+iXCK9sBxGswHtZEQLKkQIEwVxUEYMEypiKgotridKmpzdSgVEoYBgrxOuBzhLxUL+FyaTBwIh6ACISsqu0rcDT1FNbSRaqgsBECagzDD4KlQwVClQsKQqZAVpV7c1lREwKhA+KuAIVy5jc+lySSBcAgqGI/QmaBVGR3IzuVTDZ0mCDTYD65EglDBsOwKxeK2gxHv4hapUFXUegajkPzn8nf5XJpMAgiHIEGIu6O+5fcjnF9GNUR74EQwBEH4eIww3KTC6WzBFzdPRcTiDleUJRXhinpNwqC7u7XkV737+FyaTHNMQASEMVV0HihdjHBmD0KJrxGA2W5ACMebCleL2xe5uLc6VJQqFRLGGgPI83wuTaaJPvAYe+CTDQj/LrUO3+xYU6GCwUHEe7YwUuGwuEVFOaVCwlgtvl4eyufSdDp51WMZvMoGiBhg8IqKNRXRKsq8uI2zBUuFZXFHVFQIhHDBpfRZ6IbcAHEDIu6K8lthSBDy2x92i5tXVMPZIkpFGSDIq8pOQUGgAx9J08oJiNuKkiAaYIRBqCrK6cTNzxY8FU6L21xRAgSvKJEKM4z8SzvgT95OfBxNLzsgqoriIOJOhaKilItbpsIEgqfCrqJUqRBeVVYKr5RN42NIH6mAcBDxwrA7catguF3cvKKUi7vcurgLvNdglfcP8MfT6futd0MSiKgntxVlt7hVFSXPFqoTd6oXt4SRX3YI8i9nyAeEJJBYQDilQllRNqmwragYFrdTKlZ7vbQrHku7b7E7SgBJFAYHwSvKdnErUqFa3KqKclrcKz6sh8cWvzhs2LD2/OWmv4oFEAcQsVaUanFLGDIVzu/mWVMRraJWX0CY9xL2HTsa87vdcQQBBvKXmTkqDjQCsQOhSkXK381jqTC+/WFKRd4W7PDQw/jz/t3xU6BSAqC/BLPIGf7RawGEg7CkQjjOVERb3KqKsqSC/NIxhNz5mDNiIJ6F1gKA9HVyAfl2/tIyU8W1ViDRUhENhtPibkiFCYQqFYXnEBa+gNnjx+CBrDvMAMwmSnAPf0mZLQ7EDgYHwRe307t5blKxkXbB0k1497SpuGbAN/nguenB4GlyZv64qKMkEA4iGRUVbXGvPIRZT87F34wZhFegLR+6yqKeCsnp8x540iWAcBiuKoqnIlxRTot73SmEZ5ehZ9I4PNPtK3zY0VxCHskvv/lJAnGbiljOFlvLEJa9hlOnP4pvDfk2H7Bb0xPCAnJbfunNU0UExHUqoi1uSsLqA/jdZ+bj+ux7ETu348ON1a+Ts/glN28JIBxGxOKWMGwqatNx7J23DJfnjMcrfboj3vYZxC+0QmxtGW4sPk3+Hr/UlqEiOofYpULcRfHFvfMCtl1eiM8+mYtnRw5A7EYp6HIzpeEmxHZtENtahhuLqTthMflz/DJbjo4SEBUMWVEH6ZZ07U6ctXghvjNxNGKfLog9b0P8xi2IXQlEFwLRke6Q2iWcis3k7vzyWp4EEH62eLMIf/jc87hlxkTE+76F2K8zgaDDWc+OiHfeHoIhU5F4RZ0lj+eX1XIlgOw5i/e9XIj582fhlQcGIw7thjj4q4iDskIwenUKpeLO9o0VJVMRf0V9Sv41+fP8klq0/pszzoPf6YE4/OuI9xKIIWEQ/ama+lEqeplSISsq8VTsJPfg16JFwlFf8+Dw7qFUSBgRFRVOhYDRWaRCLO64YZwnT+bXoGUSjiAgsqKMVIQrykjFreFUJFxR/yP/jpzZnyG/EcIhWZ5QRYVTwSsq8cV9gKz/iwu3olR4lBWV+NmilJxDzqD3s9NA2Kejx5IKubjjO1tcI79A/hJ/Li0Xwrs6TYpc3OFUxFdRh8n9+HNoxSDs2aFHEs4W5eRc1PWUHGGnmw7HubjrySvIt/LH1EpA2AaGUirEyZkP3MlHyYP5Y2klSTTcmRj6F88Hz11N9mDG/7hNBoiG/H3yxwoIwuJw9wo5zT5P0cyFMOCzNPQJGLp13UBeSZ5HTsPPUmhpaWlpaWlpaWlpaWlpaWlpaWlpaWklqv8Da8GBU4g36CAAAAAASUVORK5CYII=",qa="/assets/video-mxplayer.5dfa69aa.png",Qa="/assets/video-mxplayer-pro.10406916.png",yn={exports:{}};/*!
 * artplayer.js v4.6.2
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(d,t){(function(e,i,s,r,n){var a=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof gs!="undefined"?gs:{},l=typeof a[r]=="function"&&a[r],o=l.cache||{},c=typeof ms=="function"&&ms.bind(d);function u(m,v){if(!o[m]){if(!e[m]){var E=typeof a[r]=="function"&&a[r];if(!v&&E)return E(m,!0);if(l)return l(m,!0);if(c&&typeof m=="string")return c(m);var C=new Error("Cannot find module '"+m+"'");throw C.code="MODULE_NOT_FOUND",C}R.resolve=function(x){var P=e[m][1][x];return P!=null?P:x},R.cache={};var N=o[m]=new u.Module(m);e[m][0].call(N.exports,R,N,N.exports,this)}return o[m].exports;function R(x){var P=R.resolve(x);return P===!1?{}:u(P)}}u.isParcelRequire=!0,u.Module=function(m){this.id=m,this.bundle=u,this.exports={}},u.modules=e,u.cache=o,u.parent=l,u.register=function(m,v){e[m]=[function(E,C){C.exports=v},{}]},Object.defineProperty(u,"root",{get:function(){return a[r]}}),a[r]=u;for(var h=0;h<i.length;h++)u(i[h]);if(s){var p=u(s);d.exports=p}})({"5lTcX":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("bundle-text:./style/index.less"),a=r.interopDefault(n),l=e("option-validator"),o=r.interopDefault(l),c=e("./utils/emitter"),u=r.interopDefault(c),h=e("./utils"),p=e("./scheme"),m=r.interopDefault(p),v=e("./config"),E=r.interopDefault(v),C=e("./whitelist"),N=r.interopDefault(C),R=e("./template"),x=r.interopDefault(R),P=e("./i18n"),M=r.interopDefault(P),b=e("./player"),T=r.interopDefault(b),I=e("./control"),A=r.interopDefault(I),U=e("./contextmenu"),B=r.interopDefault(U),$=e("./info"),X=r.interopDefault($),nt=e("./subtitle"),ot=r.interopDefault(nt),z=e("./events"),k=r.interopDefault(z),F=e("./hotkey"),G=r.interopDefault(F),Z=e("./layer"),rt=r.interopDefault(Z),ut=e("./loading"),gt=r.interopDefault(ut),It=e("./notice"),Dt=r.interopDefault(It),et=e("./mask"),at=r.interopDefault(et),ft=e("./icons"),yt=r.interopDefault(ft),_t=e("./setting"),wt=r.interopDefault(_t),Vt=e("./storage"),Ft=r.interopDefault(Vt),Jt=e("./plugins"),Qt=r.interopDefault(Jt),Re=e("./mobile"),De=r.interopDefault(Re);let Ce=0;const fe=[];class Et extends u.default{constructor(Me,Ge){super(),this.id=++Ce;const qe=h.mergeDeep(Et.option,Me);if(this.option=(0,o.default)(qe,m.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.whitelist=new N.default(this),this.template=new x.default(this),this.events=new k.default(this),this.whitelist.state?(this.storage=new Ft.default(this),this.icons=new yt.default(this),this.i18n=new M.default(this),this.notice=new Dt.default(this),this.player=new T.default(this),this.layers=new rt.default(this),this.controls=new A.default(this),this.contextmenu=new B.default(this),this.subtitle=new ot.default(this),this.info=new X.default(this),this.loading=new gt.default(this),this.hotkey=new G.default(this),this.mask=new at.default(this),this.setting=new wt.default(this),this.plugins=new Qt.default(this)):this.mobile=new De.default(this),typeof Ge=="function"&&this.on("ready",()=>Ge.call(this,this)),Et.DEBUG){const ye=he=>console.log(`[ART.${this.id}] -> ${he}`);ye("Version@"+Et.version),ye("Env@"+Et.env),ye("Build@"+Et.build);for(let he=0;he<E.default.events.length;he++)this.on("video:"+E.default.events[he],Te=>ye("Event@"+Te.type))}fe.push(this)}static get instances(){return fe}static get version(){return"4.6.2"}static get env(){return"production"}static get build(){return"2023-01-26 15:26:58"}static get config(){return E.default}static get utils(){return h}static get scheme(){return m.default}static get Emitter(){return u.default}static get validator(){return o.default}static get kindOf(){return o.default.kindOf}static get html(){return x.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},escape:!0,encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:h.isSafari?"auto":"metadata"},i18n:{},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(Me=!0){this.events.destroy(),this.template.destroy(Me),fe.splice(fe.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(s.default=Et,Et.DEBUG=!1,Et.CONTEXTMENU=!0,Et.NOTICE_TIME=2e3,Et.SETTING_WIDTH=250,Et.SETTING_ITEM_WIDTH=200,Et.SETTING_ITEM_HEIGHT=35,Et.INDICATOR_SIZE=14,Et.INDICATOR_SIZE_ICON=16,Et.INDICATOR_SIZE_MOBILE=18,Et.INDICATOR_SIZE_MOBILE_ICON=20,Et.VOLUME_PANEL_WIDTH=60,Et.VOLUME_HANDLE_WIDTH=12,Et.RESIZE_TIME=500,Et.SCROLL_TIME=200,Et.SCROLL_GAP=50,Et.AUTO_PLAYBACK_MAX=10,Et.AUTO_PLAYBACK_MIN=5,Et.AUTO_PLAYBACK_TIMEOUT=3e3,Et.RECONNECT_TIME_MAX=5,Et.RECONNECT_SLEEP_TIME=1e3,Et.CONTROL_HIDE_TIME=3e3,Et.DB_CLICE_TIME=300,Et.MOBILE_AUTO_PLAYBACKRATE=3,Et.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,Et.MOBILE_AUTO_ORIENTATION_TIME=200,Et.INFO_LOOP_TIME=1e3,Et.FAST_FORWARD_VALUE=3,Et.FAST_FORWARD_TIME=1e3,Et.TOUCH_MOVE_RATIO=.5,Et.VOLUME_STEP=.1,Et.SEEK_STEP=5,Et.PROGRESS_HEIGHT=6,Et.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],Et.ASPECT_RATIO=["default","4:3","16:9"],Et.FLIP=["normal","horizontal","vertical"],Et.FULLSCREEN_WEB_IN_BODY=!1,typeof document!="undefined"&&!document.getElementById("artplayer-style")){const ke=h.createElement("style");ke.id="artplayer-style",ke.textContent=a.default,document.head.appendChild(ke)}typeof window!="undefined"&&(window.Artplayer=Et),console.log(`%c ArtPlayer %c ${Et.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./whitelist":"9L0ao","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","./mobile":"7mil2","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(e,i,s){i.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;transition:bottom .2s;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:auto;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;transition:all .2s;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#ffffff80;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;border-radius:3px;display:none;position:absolute;bottom:10px;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.75;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;transition:opacity .1s ease-in-out;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;transition:transform .2s ease-in-out;display:flex;transform:scale(1)}.art-video-player .art-bottom .art-controls .art-control .art-icon:active{transform:scale(.85)}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{height:105px;padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:60px;left:0;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:var(--theme)}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:var(--theme);cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--theme)}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],bAWi2:[function(e,i,s){i.exports=function(){function r(h){return(r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(h)}var n=Object.prototype.toString,a=function(h){if(h===void 0)return"undefined";if(h===null)return"null";var p=r(h);if(p==="boolean")return"boolean";if(p==="string")return"string";if(p==="number")return"number";if(p==="symbol")return"symbol";if(p==="function")return function(m){return l(m)==="GeneratorFunction"}(h)?"generatorfunction":"function";if(function(m){return Array.isArray?Array.isArray(m):m instanceof Array}(h))return"array";if(function(m){return!(!m.constructor||typeof m.constructor.isBuffer!="function")&&m.constructor.isBuffer(m)}(h))return"buffer";if(function(m){try{if(typeof m.length=="number"&&typeof m.callee=="function")return!0}catch(v){if(v.message.indexOf("callee")!==-1)return!0}return!1}(h))return"arguments";if(function(m){return m instanceof Date||typeof m.toDateString=="function"&&typeof m.getDate=="function"&&typeof m.setDate=="function"}(h))return"date";if(function(m){return m instanceof Error||typeof m.message=="string"&&m.constructor&&typeof m.constructor.stackTraceLimit=="number"}(h))return"error";if(function(m){return m instanceof RegExp||typeof m.flags=="string"&&typeof m.ignoreCase=="boolean"&&typeof m.multiline=="boolean"&&typeof m.global=="boolean"}(h))return"regexp";switch(l(h)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(m){return typeof m.throw=="function"&&typeof m.return=="function"&&typeof m.next=="function"}(h))return"generator";switch(p=n.call(h)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return p.slice(8,-1).toLowerCase().replace(/\s/g,"")};function l(h){return h.constructor?h.constructor.name:null}function o(h,p){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return c(h,p,m),u(h,p,m),function(v,E,C){var N=a(E),R=a(v);if(N==="object"){if(R!=="object")throw new Error("[Type Error]: '".concat(C.join("."),"' require 'object' type, but got '").concat(R,"'"));Object.keys(E).forEach(function(x){var P=v[x],M=E[x],b=C.slice();b.push(x),c(P,M,b),u(P,M,b),o(P,M,b)})}if(N==="array"){if(R!=="array")throw new Error("[Type Error]: '".concat(C.join("."),"' require 'array' type, but got '").concat(R,"'"));v.forEach(function(x,P){var M=v[P],b=E[P]||E[0],T=C.slice();T.push(P),c(M,b,T),u(M,b,T),o(M,b,T)})}}(h,p,m),h}function c(h,p,m){if(a(p)==="string"){var v=a(h);if(p[0]==="?"&&(p=p.slice(1)+"|undefined"),!(-1<p.indexOf("|")?p.split("|").map(function(E){return E.toLowerCase().trim()}).filter(Boolean).some(function(E){return v===E}):p.toLowerCase().trim()===v))throw new Error("[Type Error]: '".concat(m.join("."),"' require '").concat(p,"' type, but got '").concat(v,"'"))}}function u(h,p,m){if(a(p)==="function"){var v=p(h,a(h),m);if(v!==!0){var E=a(v);throw E==="string"?new Error(v):E==="error"?v:new Error("[Validator Error]: The scheme for '".concat(m.join("."),"' validator require return true, but got '").concat(v,"'"))}}}return o.kindOf=a,o}()},{}],"66mFZ":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=class{on(r,n,a){const l=this.e||(this.e={});return(l[r]||(l[r]=[])).push({fn:n,ctx:a}),this}once(r,n,a){const l=this;function o(...c){l.off(r,o),n.apply(a,c)}return o._=n,this.on(r,o,a)}emit(r,...n){const a=((this.e||(this.e={}))[r]||[]).slice();for(let l=0;l<a.length;l+=1)a[l].fn.apply(a[l].ctx,n);return this}off(r,n){const a=this.e||(this.e={}),l=a[r],o=[];if(l&&n)for(let c=0,u=l.length;c<u;c+=1)l[c].fn!==n&&l[c].fn._!==n&&o.push(l[c]);return o.length?a[r]=o:delete a[r],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(e,i,s){s.interopDefault=function(r){return r&&r.__esModule?r:{default:r}},s.defineInteropFlag=function(r){Object.defineProperty(r,"__esModule",{value:!0})},s.exportAll=function(r,n){return Object.keys(r).forEach(function(a){a==="default"||a==="__esModule"||n.hasOwnProperty(a)||Object.defineProperty(n,a,{enumerable:!0,get:function(){return r[a]}})}),n},s.export=function(r,n,a){Object.defineProperty(r,n,{enumerable:!0,get:a})}},{}],"71aH7":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./dom");r.exportAll(n,s);var a=e("./error");r.exportAll(a,s);var l=e("./subtitle");r.exportAll(l,s);var o=e("./file");r.exportAll(o,s);var c=e("./property");r.exportAll(c,s);var u=e("./time");r.exportAll(u,s);var h=e("./format");r.exportAll(h,s);var p=e("./compatibility");r.exportAll(p,s)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"query",()=>a),r.export(s,"queryAll",()=>l),r.export(s,"addClass",()=>o),r.export(s,"removeClass",()=>c),r.export(s,"hasClass",()=>u),r.export(s,"append",()=>h),r.export(s,"remove",()=>p),r.export(s,"setStyle",()=>m),r.export(s,"setStyles",()=>v),r.export(s,"getStyle",()=>E),r.export(s,"sublings",()=>C),r.export(s,"inverseClass",()=>N),r.export(s,"tooltip",()=>R),r.export(s,"isInViewport",()=>x),r.export(s,"includeFromEvent",()=>P),r.export(s,"replaceElement",()=>M),r.export(s,"createElement",()=>b);var n=e("./compatibility");function a(T,I=document){return I.querySelector(T)}function l(T,I=document){return Array.from(I.querySelectorAll(T))}function o(T,I){return T.classList.add(I)}function c(T,I){return T.classList.remove(I)}function u(T,I){return T.classList.contains(I)}function h(T,I){return I instanceof Element?T.appendChild(I):T.insertAdjacentHTML("beforeend",String(I)),T.lastElementChild||T.lastChild}function p(T){return T.parentNode.removeChild(T)}function m(T,I,A){return T.style[I]=A,T}function v(T,I){return Object.keys(I).forEach(A=>{m(T,A,I[A])}),T}function E(T,I,A=!0){const U=window.getComputedStyle(T,null).getPropertyValue(I);return A?parseFloat(U):U}function C(T){return Array.from(T.parentElement.children).filter(I=>I!==T)}function N(T,I){C(T).forEach(A=>c(A,I)),o(T,I)}function R(T,I,A="top"){n.isMobile||(T.setAttribute("aria-label",I),o(T,"hint--rounded"),o(T,`hint--${A}`))}function x(T,I=0){const A=T.getBoundingClientRect(),U=window.innerHeight||document.documentElement.clientHeight,B=window.innerWidth||document.documentElement.clientWidth,$=A.top-I<=U&&A.top+A.height+I>=0,X=A.left-I<=B+I&&A.left+A.width+I>=0;return $&&X}function P(T,I){return T.composedPath&&T.composedPath().indexOf(I)>-1}function M(T,I){return I.parentNode.replaceChild(T,I),T}function b(T){return document.createElement(T)}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"userAgent",()=>n),r.export(s,"isMobile",()=>a),r.export(s,"isSafari",()=>l),r.export(s,"isWechat",()=>o),r.export(s,"isIE",()=>c),r.export(s,"isAndroid",()=>u),r.export(s,"isIOS",()=>h);const n=typeof window!="undefined"?window.navigator.userAgent:"",a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(n),l=/^((?!chrome|android).)*safari/i.test(n),o=/MicroMessenger/i.test(n),c=/MSIE|Trident/i.test(n),u=/android/i.test(n),h=/iPad|iPhone|iPod/i.test(n)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"ArtPlayerError",()=>n),r.export(s,"errorHandle",()=>a);class n extends Error{constructor(o,c){super(o),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,c||this.constructor),this.name="ArtPlayerError"}}function a(l,o){if(!l)throw new n(o);return l}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return`WEBVTT \r
\r
`.concat((c=o,c.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(u,h,p)=>{let m=p.slice(0,3);return p.length===1&&(m=p+"00"),p.length===2&&(m=p+"0"),`${h},${m}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var c}function a(o){return URL.createObjectURL(new Blob([o],{type:"text/vtt"}))}function l(o){const c=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function u(h=""){return h.split(/[:.]/).map((p,m,v)=>{if(m===v.length-1){if(p.length===1)return`.${p}00`;if(p.length===2)return`.${p}0`}else if(p.length===1)return(m===0?"0":":0")+p;return m===0?p:m===v.length-1?`.${p}`:`:${p}`}).join("")}return`WEBVTT

${o.split(/\r?\n/).map(h=>{const p=h.match(c);return p?{start:u(p[1].trim()),end:u(p[2].trim()),text:p[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(m=>m.trim()).join(`
`)}:null}).filter(h=>h).map((h,p)=>h?`${p+1}
${h.start} --> ${h.end}
${h.text}`:"").filter(h=>h.trim()).join(`

`)}`}r.defineInteropFlag(s),r.export(s,"srtToVtt",()=>n),r.export(s,"vttToBlob",()=>a),r.export(s,"assToVtt",()=>l)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(l){return l.includes("?")?n(l.split("?")[0]):l.includes("#")?n(l.split("#")[0]):l.trim().toLowerCase().split(".").pop()}function a(l,o){const c=document.createElement("a");c.style.display="none",c.href=l,c.download=o,document.body.appendChild(c),c.click(),document.body.removeChild(c)}r.defineInteropFlag(s),r.export(s,"getExt",()=>n),r.export(s,"download",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"def",()=>n),r.export(s,"has",()=>l),r.export(s,"get",()=>o),r.export(s,"mergeDeep",()=>c);const n=Object.defineProperty,{hasOwnProperty:a}=Object.prototype;function l(u,h){return a.call(u,h)}function o(u,h){return Object.getOwnPropertyDescriptor(u,h)}function c(...u){const h=p=>p&&typeof p=="object"&&!Array.isArray(p);return u.reduce((p,m)=>(Object.keys(m).forEach(v=>{const E=p[v],C=m[v];Array.isArray(E)&&Array.isArray(C)?p[v]=E.concat(...C):!h(E)||!h(C)||C instanceof Element?p[v]=C:p[v]=c(E,C)}),p),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o=0){return new Promise(c=>setTimeout(c,o))}function a(o,c,u){let h;function p(...m){clearTimeout(h),h=setTimeout(function(){h=null,o.apply(u,m)},c)}return p.clearTimeout=function(){clearTimeout(h)},p}function l(o,c){let u,h,p=!1;return function m(...v){if(p)return u=v,void(h=this);p=!0,o.apply(this,v),setTimeout(()=>{p=!1,u&&(m.apply(h,u),u=null,h=null)},c)}}r.defineInteropFlag(s),r.export(s,"sleep",()=>n),r.export(s,"debounce",()=>a),r.export(s,"throttle",()=>l)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(u,h,p){return Math.max(Math.min(u,Math.max(h,p)),Math.min(h,p))}function a(u){return u.charAt(0).toUpperCase()+u.slice(1)}function l(u){return["string","number"].includes(typeof u)}function o(u){const h=Math.floor(u/3600),p=Math.floor((u-3600*h)/60),m=Math.floor(u-3600*h-60*p);return(h>0?[h,p,m]:[p,m]).map(v=>v<10?`0${v}`:String(v)).join(":")}function c(u){return u.replace(/[&<>'"]/g,h=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[h]||h)}r.defineInteropFlag(s),r.export(s,"clamp",()=>n),r.export(s,"capitalize",()=>a),r.export(s,"isStringOrNumber",()=>l),r.export(s,"secondToTime",()=>o),r.export(s,"escape",()=>c)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"ComponentOption",()=>m);var n=e("../utils");const a="array",l="boolean",o="string",c="number",u="object",h="function";function p(v,E,C){return(0,n.errorHandle)(E===o||E===c||v instanceof Element,`${C.join(".")} require '${o}' or 'Element' type`)}const m={html:p,disable:`?${l}`,name:`?${o}`,index:`?${c}`,style:`?${u}`,click:`?${h}`,mounted:`?${h}`,tooltip:`?${o}|${c}`,width:`?${c}`,selector:`?${a}`,onSelect:`?${h}`,switch:`?${l}`,onSwitch:`?${h}`,range:`?${a}`,onRange:`?${h}`,onChange:`?${h}`};s.default={id:o,container:p,url:o,poster:o,title:o,type:o,theme:o,lang:o,volume:c,isLive:l,muted:l,autoplay:l,autoSize:l,autoMini:l,loop:l,flip:l,playbackRate:l,aspectRatio:l,screenshot:l,setting:l,hotkey:l,pip:l,mutex:l,backdrop:l,fullscreen:l,fullscreenWeb:l,subtitleOffset:l,miniProgressBar:l,useSSR:l,playsInline:l,lock:l,fastForward:l,autoPlayback:l,autoOrientation:l,airplay:l,plugins:[h],whitelist:[`${o}|${h}|regexp`],layers:[m],contextmenu:[m],settings:[m],controls:[Kt($t({},m),{position:(v,E,C)=>{const N=["top","left","right"];return(0,n.errorHandle)(N.includes(v),`${C.join(".")} only accept ${N.toString()} as parameters`)}})],quality:[{default:`?${l}`,html:o,url:o}],highlight:[{time:c,text:o}],thumbnails:{url:o,number:c,column:c,width:c,height:c},subtitle:{url:o,type:o,style:u,escape:l,encoding:o},moreVideoAttr:u,i18n:u,icons:u,customType:u}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9L0ao":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");s.default=class{constructor(n){this.art=n}get state(){const{option:n,constructor:{kindOf:a}}=this.art;return!r.isMobile||!n.whitelist.length||n.whitelist.some(l=>{switch(a(l)){case"string":return l==="*"||r.userAgent.indexOf(l)>-1;case"function":return l(r.userAgent);case"regexp":return l.test(r.userAgent);default:return!1}})}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");class n{constructor(l){this.art=l;const{option:o,constructor:c,whitelist:u}=l;o.container instanceof Element?this.$container=o.container:(this.$container=(0,r.query)(o.container),(0,r.errorHandle)(this.$container,`No container element found by ${o.container}`));const h=this.$container.tagName.toLowerCase();(0,r.errorHandle)(h==="div",`Unsupported container element type, only support 'div' but got '${h}'`),(0,r.errorHandle)(c.instances.every(p=>p.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=l.id,this.$original=this.$container.cloneNode(!0),u.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.6.2</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(l){return(0,r.query)(l,this.$container)}desktop(){const{option:l}=this.art;l.useSSR||(this.$container.innerHTML=n.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),l.backdrop&&((0,r.addClass)(this.$setting,"art-backdrop-filter"),(0,r.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,r.addClass)(this.$info,"art-backdrop-filter")),r.isMobile&&(0,r.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(l){l?(0,r.replaceElement)(this.$original,this.$container):(0,r.addClass)(this.$player,"art-destroy")}}s.default=n},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("./zh-cn.json"),l=r.interopDefault(a),o=e("./zh-tw.json"),c=r.interopDefault(o),u=e("./pl.json"),h=r.interopDefault(u),p=e("./cs.json"),m=r.interopDefault(p),v=e("./es.json"),E=r.interopDefault(v),C=e("./fa.json"),N=r.interopDefault(C);s.default=class{constructor(R){this.art=R,this.languages={"zh-cn":l.default,"zh-tw":c.default,pl:h.default,cs:m.default,es:E.default,fa:N.default},this.update(R.option.i18n)}init(){const R=this.art.option.lang.toLowerCase();this.language=this.languages[R]||{}}get(R){return this.language[R]||R}update(R){this.languages=(0,n.mergeDeep)(this.languages,R),this.init()}}},{"../utils":"71aH7","./zh-cn.json":"lNQi5","./zh-tw.json":"eRpom","./pl.json":"iEpPa","./cs.json":"dBgp3","./es.json":"dNIrL","./fa.json":"7Plhe","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lNQi5:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],eRpom:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],iEpPa:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],dBgp3:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],dNIrL:[function(e,i,s){i.exports=JSON.parse('{"Video Info":"Informaci\xF3n del video","Close":"Cerrar","Video Load Failed":"Fall\xF3 carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducci\xF3n","Aspect Ratio":"Relaci\xF3n de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subt\xEDtulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subt\xEDtulo","Last Seen":"Visto \xFAltima vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],"7Plhe":[function(e,i,s){i.exports=JSON.parse('{"Video Info":"\u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0648\u06CC\u062F\u06CC\u0648","Close":"\u0628\u0633\u062A\u0646","Video Load Failed":"\u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0646\u0627\u0645\u0648\u0641\u0642","Play":"\u067E\u062E\u0634","Volume":"\u0645\u06CC\u0632\u0627\u0646 \u0635\u062F\u0627","Pause":"\u062A\u0648\u0642\u0641","Rate":"\u0646\u0631\u062E","Mute":"\u0633\u06A9\u0648\u062A","Video Flip":"\u0686\u0631\u062E\u0634 \u062A\u0635\u0648\u06CC\u0631","Horizontal":"\u0627\u0641\u0642\u06CC","Vertical":"\u0639\u0645\u0648\u062F\u06CC","Reconnect":"\u0627\u062A\u0635\u0627\u0644 \u0645\u062C\u062F\u062F","Show Setting":"\u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Hide Setting":"\u0628\u0633\u062A\u0646 \u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Screenshot":"\u0639\u06A9\u0633 \u0627\u0632 \u0635\u0641\u062D\u0647","Play Speed":"\u0633\u0631\u0639\u062A \u067E\u062E\u0634","Aspect Ratio":"\u0646\u0633\u0628\u062A \u062A\u0635\u0648\u06CC\u0631","Default":"\u062D\u0627\u0644\u062A \u067E\u06CC\u0634\u0641\u0631\u0636","Normal":" \u062D\u0627\u0644\u062A \u0639\u0627\u062F\u06CC","Open":"\u0628\u0627\u0632\u06A9\u0631\u062F\u0646","Switch Video":"\u062A\u063A\u06CC\u06CC\u0631 \u0648\u06CC\u062F\u06CC\u0648","Switch Subtitle":"\u0646\u063A\u06CC\u06CC\u0631 \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Fullscreen":"\u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Exit Fullscreen":"\u06A9\u0648\u0686\u06A9 \u06A9\u0631\u062F\u0646","Web Fullscreen":"\u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Exit Web Fullscreen":"\u062E\u0631\u0648\u062C \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Mini Player":"\u062D\u0627\u0644\u062A \u067E\u062E\u0634 \u06A9\u0648\u0686\u06A9","PIP Mode":" \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Exit PIP Mode":"\u062E\u0631\u0648\u062C \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","PIP Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Fullscreen Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Subtitle Offset":"\u0627\u0641\u0633\u062A \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Last Seen":"\u0622\u062E\u0631\u06CC\u0646 \u0628\u0627\u0632\u062F\u06CC\u062F","Jump Play":"\u062C\u0627\u0645\u067E \u067E\u0644\u06CC","AirPlay":"\u0627\u06CC\u0631 \u067E\u0644\u06CC","AirPlay Not Available":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0627\u06CC\u0631\u067E\u0644\u06CC"}')},{}],a90nx:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./urlMix"),a=r.interopDefault(n),l=e("./attrMix"),o=r.interopDefault(l),c=e("./playMix"),u=r.interopDefault(c),h=e("./pauseMix"),p=r.interopDefault(h),m=e("./toggleMix"),v=r.interopDefault(m),E=e("./seekMix"),C=r.interopDefault(E),N=e("./volumeMix"),R=r.interopDefault(N),x=e("./currentTimeMix"),P=r.interopDefault(x),M=e("./durationMix"),b=r.interopDefault(M),T=e("./switchMix"),I=r.interopDefault(T),A=e("./playbackRateMix"),U=r.interopDefault(A),B=e("./aspectRatioMix"),$=r.interopDefault(B),X=e("./screenshotMix"),nt=r.interopDefault(X),ot=e("./fullscreenMix"),z=r.interopDefault(ot),k=e("./fullscreenWebMix"),F=r.interopDefault(k),G=e("./pipMix"),Z=r.interopDefault(G),rt=e("./loadedMix"),ut=r.interopDefault(rt),gt=e("./playedMix"),It=r.interopDefault(gt),Dt=e("./playingMix"),et=r.interopDefault(Dt),at=e("./autoSizeMix"),ft=r.interopDefault(at),yt=e("./rectMix"),_t=r.interopDefault(yt),wt=e("./flipMix"),Vt=r.interopDefault(wt),Ft=e("./miniMix"),Jt=r.interopDefault(Ft),Qt=e("./loopMix"),Re=r.interopDefault(Qt),De=e("./posterMix"),Ce=r.interopDefault(De),fe=e("./autoHeightMix"),Et=r.interopDefault(fe),ke=e("./themeMix"),Me=r.interopDefault(ke),Ge=e("./titleMix"),qe=r.interopDefault(Ge),ye=e("./typeMix"),he=r.interopDefault(ye),Te=e("./normalSizeMix"),$i=r.interopDefault(Te),zi=e("./subtitleOffsetMix"),Hi=r.interopDefault(zi),Yi=e("./airplayMix"),Ki=r.interopDefault(Yi),Wi=e("./optionInit"),qi=r.interopDefault(Wi),Qi=e("./eventInit"),Xi=r.interopDefault(Qi);s.default=class{constructor(Mt){(0,a.default)(Mt),(0,o.default)(Mt),(0,u.default)(Mt),(0,p.default)(Mt),(0,v.default)(Mt),(0,C.default)(Mt),(0,R.default)(Mt),(0,P.default)(Mt),(0,b.default)(Mt),(0,I.default)(Mt),(0,U.default)(Mt),(0,$.default)(Mt),(0,nt.default)(Mt),(0,z.default)(Mt),(0,F.default)(Mt),(0,Z.default)(Mt),(0,ut.default)(Mt),(0,It.default)(Mt),(0,et.default)(Mt),(0,ft.default)(Mt),(0,_t.default)(Mt),(0,Vt.default)(Mt),(0,Jt.default)(Mt),(0,Re.default)(Mt),(0,Ce.default)(Mt),(0,Et.default)(Mt),(0,Me.default)(Mt),(0,qe.default)(Mt),(0,he.default)(Mt),(0,$i.default)(Mt),(0,Hi.default)(Mt),(0,Ki.default)(Mt),(0,Xi.default)(Mt),(0,qi.default)(Mt)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./loopMix":"f1hVG","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./themeMix":"2FqhO","./titleMix":"7Am53","./typeMix":"1fQQs","./normalSizeMix":"ePkBr","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$video:l}}=n;(0,r.def)(n,"url",{get:()=>l.currentSrc,set(c){return se(this,null,function*(){if(c){const u=a.type||(0,r.getExt)(c),h=a.customType[u];u&&h?(yield(0,r.sleep)(),n.loading.show=!0,h.call(n,l,c,n)):(n.url&&n.url!==c&&n.once("video:canplay",()=>{n.isReady&&n.emit("restart")}),l.src=c,n.option.url=c,n.emit("url",c))}else yield(0,r.sleep)(),n.loading.show=!0})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a}}=n;(0,r.def)(n,"attr",{value(l,o){if(o===void 0)return a[l];a[l]=o}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,notice:l,option:o,constructor:{instances:c},template:{$video:u}}=n;(0,r.def)(n,"play",{value:function(){return se(this,null,function*(){const h=yield u.play();if(l.show=a.get("Play"),n.emit("play"),o.mutex)for(let p=0;p<c.length;p++){const m=c[p];m!==n&&m.pause()}return h})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a},i18n:l,notice:o}=n;(0,r.def)(n,"pause",{value(){const c=a.pause();return o.show=l.get("Pause"),n.emit("pause"),c}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"toggle",{value:()=>n.playing?n.pause():n.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{notice:a}=n;(0,r.def)(n,"seek",{set(l){n.currentTime=l,n.emit("seek",n.currentTime),n.duration&&(a.show=`${(0,r.secondToTime)(n.currentTime)} / ${(0,r.secondToTime)(n.duration)}`)}}),(0,r.def)(n,"forward",{set(l){n.seek=n.currentTime+l}}),(0,r.def)(n,"backward",{set(l){n.seek=n.currentTime-l}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a},i18n:l,notice:o,storage:c}=n;(0,r.def)(n,"volume",{get:()=>a.volume||0,set:u=>{a.volume=(0,r.clamp)(u,0,1),o.show=`${l.get("Volume")}: ${parseInt(100*a.volume,10)}`,a.volume!==0&&c.set("volume",a.volume)}}),(0,r.def)(n,"muted",{get:()=>a.muted,set:u=>{a.muted=u}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$video:a}=n.template;(0,r.def)(n,"currentTime",{get:()=>a.currentTime||0,set:l=>{l=parseFloat(l),Number.isNaN(l)||(a.currentTime=(0,r.clamp)(l,0,n.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"duration",{get:()=>{const{duration:a}=n.template.$video;return a===1/0?0:a||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,option:l,notice:o}=n;function c(u,h,p){return new Promise(m=>{if(u===n.url)return m(u);const{playing:v}=n;n.pause(),URL.revokeObjectURL(n.url),n.url=u,n.once("video:canplay",()=>{n.playbackRate=!1,n.aspectRatio=!1,n.flip="normal",n.autoSize=l.autoSize,n.currentTime=p,n.notice.show="",v&&n.play(),h&&(o.show=`${a.get("Switch Video")}: ${h}`),m(u)})})}(0,r.def)(n,"switchQuality",{value:(u,h)=>c(u,h,n.currentTime)}),(0,r.def)(n,"switchUrl",{value:(u,h)=>c(u,h,0)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a},i18n:l,notice:o}=n;(0,r.def)(n,"playbackRate",{get:()=>a.playbackRate,set(c){if(c){if(c===a.playbackRate)return;a.playbackRate=c,o.show=`${l.get("Rate")}: ${c===1?l.get("Normal"):`${c}x`}`}else n.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$video:a,$player:l},i18n:o,notice:c}=n;(0,r.def)(n,"aspectRatio",{get:()=>l.dataset.aspectRatio||"default",set(u){if(u||(u="default"),u==="default")(0,r.setStyle)(a,"width",null),(0,r.setStyle)(a,"height",null),(0,r.setStyle)(a,"padding",null),delete l.dataset.aspectRatio;else{const h=u.split(":").map(Number),{videoWidth:p,videoHeight:m}=a,{clientWidth:v,clientHeight:E}=l,C=p/m,N=h[0]/h[1];if(C>N){const R=N*m/p;(0,r.setStyle)(a,"width",100*R+"%"),(0,r.setStyle)(a,"height","100%"),(0,r.setStyle)(a,"padding",`0 ${(v-v*R)/2}px`)}else{const R=p/N/m;(0,r.setStyle)(a,"width","100%"),(0,r.setStyle)(a,"height",100*R+"%"),(0,r.setStyle)(a,"padding",(E-E*R)/2+"px 0")}l.dataset.aspectRatio=u}c.show=`${o.get("Aspect Ratio")}: ${u==="default"?o.get("Default"):u}`,n.emit("aspectRatio",u)}}),(0,r.def)(n,"aspectRatioReset",{set(u){if(u){const{aspectRatio:h}=n;n.aspectRatio=h}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,notice:l,template:{$video:o}}=n,c=(0,r.createElement)("canvas");(0,r.def)(n,"getDataURL",{value:()=>new Promise((u,h)=>{try{c.width=o.videoWidth,c.height=o.videoHeight,c.getContext("2d").drawImage(o,0,0),u(c.toDataURL("image/png"))}catch(p){l.show=p,h(p)}})}),(0,r.def)(n,"getBlobUrl",{value:()=>new Promise((u,h)=>{try{c.width=o.videoWidth,c.height=o.videoHeight,c.getContext("2d").drawImage(o,0,0),c.toBlob(p=>{u(URL.createObjectURL(p))})}catch(p){l.show=p,h(p)}})}),(0,r.def)(n,"screenshot",{value:()=>se(this,null,function*(){const u=yield n.getDataURL();return(0,r.download)(u,`${a.title||"artplayer"}_${(0,r.secondToTime)(o.currentTime)}.png`),n.emit("screenshot",u),u})})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../libs/screenfull"),a=r.interopDefault(n),l=e("../utils");s.default=function(o){const{i18n:c,notice:u,template:{$video:h,$player:p}}=o;o.once("video:loadedmetadata",()=>{a.default.isEnabled?(m=>{a.default.on("change",()=>{m.emit("fullscreen",a.default.isFullscreen)}),(0,l.def)(m,"fullscreen",{get:()=>a.default.isFullscreen,set(E){return se(this,null,function*(){E?(m.normalSize="fullscreen",m.aspectRatioReset=!0,m.autoSize=!1,yield a.default.request(p),(0,l.addClass)(p,"art-fullscreen"),m.emit("resize"),u.show=""):(m.aspectRatioReset=!0,m.autoSize=m.option.autoSize,yield a.default.exit(),(0,l.removeClass)(p,"art-fullscreen"),m.emit("resize"),u.show="")})}})})(o):document.fullscreenEnabled||h.webkitSupportsFullscreen?(m=>{(0,l.def)(m,"fullscreen",{get:()=>h.webkitDisplayingFullscreen,set(v){v?(m.normalSize="fullscreen",h.webkitEnterFullscreen(),m.emit("fullscreen",!0),u.show=""):(h.webkitExitFullscreen(),m.emit("fullscreen",!1),u.show="")}})})(o):(0,l.def)(o,"fullscreen",{get:()=>!1,set(){u.show=c.get("Fullscreen Not Supported")}}),(0,l.def)(o,"fullscreen",(0,l.get)(o,"fullscreen"))})}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);const r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=(()=>{if(typeof document=="undefined")return!1;const o=r[0],c={};for(const u of r)if(u[1]in document){for(const[h,p]of u.entries())c[o[h]]=p;return c}return!1})(),a={change:n.fullscreenchange,error:n.fullscreenerror};let l={request:(o=document.documentElement,c)=>new Promise((u,h)=>{const p=()=>{l.off("change",p),u()};l.on("change",p);const m=o[n.requestFullscreen](c);m instanceof Promise&&m.then(p).catch(h)}),exit:()=>new Promise((o,c)=>{if(!l.isFullscreen)return void o();const u=()=>{l.off("change",u),o()};l.on("change",u);const h=document[n.exitFullscreen]();h instanceof Promise&&h.then(u).catch(c)}),toggle:(o,c)=>l.isFullscreen?l.exit():l.request(o,c),onchange(o){l.on("change",o)},onerror(o){l.on("error",o)},on(o,c){const u=a[o];u&&document.addEventListener(u,c,!1)},off(o,c){const u=a[o];u&&document.removeEventListener(u,c,!1)},raw:n};Object.defineProperties(l,{isFullscreen:{get:()=>Boolean(document[n.fullscreenElement])},element:{enumerable:!0,get:()=>document[n.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[n.fullscreenEnabled])}}),n||(l={isEnabled:!1}),s.default=l},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{notice:a,constructor:l,template:{$container:o,$player:c}}=n;(0,r.def)(n,"fullscreenWeb",{get:()=>(0,r.hasClass)(c,"art-fullscreen-web"),set(u){u?(l.FULLSCREEN_WEB_IN_BODY&&(0,r.append)(document.body,c),n.normalSize="fullscreenWeb",(0,r.addClass)(c,"art-fullscreen-web"),n.aspectRatioReset=!0,n.autoSize=!1,n.emit("resize"),n.emit("fullscreenWeb",!0),a.show=""):(l.FULLSCREEN_WEB_IN_BODY&&(0,r.append)(o,c),(0,r.removeClass)(c,"art-fullscreen-web"),n.aspectRatioReset=!0,n.autoSize=n.option.autoSize,n.emit("resize"),n.emit("fullscreenWeb",!1),a.show="")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,notice:l,template:{$video:o}}=n;document.pictureInPictureEnabled?function(c){const{template:{$video:u},proxy:h,notice:p}=c;u.disablePictureInPicture=!1,(0,r.def)(c,"pip",{get:()=>document.pictureInPictureElement,set(m){m?(c.normalSize="pip",u.requestPictureInPicture().catch(v=>{throw p.show=v,v})):document.exitPictureInPicture().catch(v=>{throw p.show=v,v})}}),h(u,"enterpictureinpicture",()=>{c.emit("pip",!0)}),h(u,"leavepictureinpicture",()=>{c.emit("pip",!1)})}(n):o.webkitSupportsPresentationMode?function(c){const{$video:u}=c.template;u.webkitSetPresentationMode("inline"),(0,r.def)(c,"pip",{get:()=>u.webkitPresentationMode==="picture-in-picture",set(h){h?(c.normalSize="pip",u.webkitSetPresentationMode("picture-in-picture"),c.emit("pip",!0)):(u.webkitSetPresentationMode("inline"),c.emit("pip",!1))}})}(n):(0,r.def)(n,"pip",{get:()=>!1,set(){l.show=a.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$video:a}=n.template;(0,r.def)(n,"loaded",{get:()=>n.loadedTime/a.duration}),(0,r.def)(n,"loadedTime",{get:()=>a.buffered.length?a.buffered.end(a.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"played",{get:()=>n.currentTime/n.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$video:a}=n.template;(0,r.def)(n,"playing",{get:()=>a.currentTime>0&&!a.paused&&!a.ended&&a.readyState>2})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{$container:a,$player:l,$video:o}=n.template;(0,r.def)(n,"autoSize",{get:()=>(0,r.hasClass)(a,"art-auto-size"),set(c){if(c){const{videoWidth:u,videoHeight:h}=o,{width:p,height:m}=a.getBoundingClientRect(),v=u/h,E=p/m;if((0,r.addClass)(a,"art-auto-size"),E>v){const C=m*v/p*100;(0,r.setStyle)(l,"width",`${C}%`),(0,r.setStyle)(l,"height","100%")}else{const C=p/v/m*100;(0,r.setStyle)(l,"width","100%"),(0,r.setStyle)(l,"height",`${C}%`)}n.emit("autoSize",{width:n.width,height:n.height})}else(0,r.removeClass)(a,"art-auto-size"),(0,r.setStyle)(l,"width",null),(0,r.setStyle)(l,"height",null),n.emit("autoSize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"rect",{get:()=>n.template.$player.getBoundingClientRect()});const a=["bottom","height","left","right","top","width"];for(let l=0;l<a.length;l++){const o=a[l];(0,r.def)(n,o,{get:()=>n.rect[o]})}(0,r.def)(n,"x",{get:()=>n.left+window.pageXOffset}),(0,r.def)(n,"y",{get:()=>n.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{template:{$player:a},i18n:l,notice:o}=n;(0,r.def)(n,"flip",{get:()=>a.dataset.flip||"normal",set(c){c||(c="normal"),c==="normal"?delete a.dataset.flip:a.dataset.flip=c,o.show=`${l.get("Video Flip")}: ${l.get((0,r.capitalize)(c))}`,n.emit("flip",c)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,option:l,storage:o,proxy:c,template:{$player:u,$miniClose:h,$miniTitle:p,$miniHeader:m}}=n;let v=!1,E=0,C=0,N=0,R=0;c(m,"mousedown",x=>{v=!0,E=x.pageX,C=x.pageY,N=n.left,R=n.top}),c(document,"mousemove",x=>{if(v){(0,r.addClass)(u,"art-is-dragging");const P=R+x.pageY-C,M=N+x.pageX-E;(0,r.setStyle)(u,"top",`${P}px`),(0,r.setStyle)(u,"left",`${M}px`),o.set("top",P),o.set("left",M)}}),c(document,"mouseup",()=>{v=!1,(0,r.removeClass)(u,"art-is-dragging")}),c(h,"click",()=>{n.mini=!1,v=!1,(0,r.removeClass)(u,"art-is-dragging")}),(0,r.append)(p,l.title||a.get("Mini Player")),(0,r.def)(n,"mini",{get:()=>(0,r.hasClass)(u,"art-mini"),set(x){if(x){n.normalSize="mini",n.autoSize=!1,(0,r.addClass)(u,"art-mini");const P=o.get("top"),M=o.get("left");if(P&&M)(0,r.setStyle)(u,"top",`${P}px`),(0,r.setStyle)(u,"left",`${M}px`),(0,r.isInViewport)(m)||(o.del("top"),o.del("left"),n.mini=!0);else{const b=window.innerHeight-n.height-50,T=window.innerWidth-n.width-50;o.set("top",b),o.set("left",T),(0,r.setStyle)(u,"top",`${b}px`),(0,r.setStyle)(u,"left",`${T}px`)}n.aspectRatio=!1,n.playbackRate=!1,n.notice.show="",n.emit("mini",!0)}else(0,r.removeClass)(u,"art-mini"),(0,r.setStyle)(u,"top",null),(0,r.setStyle)(u,"left",null),n.aspectRatio=!1,n.playbackRate=!1,n.autoSize=l.autoSize,n.notice.show="",n.emit("mini",!1)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f1hVG:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){let a=[];(0,r.def)(n,"loop",{get:()=>a,set:l=>{if(Array.isArray(l)&&typeof l[0]=="number"&&typeof l[1]=="number"){const o=(0,r.clamp)(l[0],0,Math.min(l[1],n.duration)),c=(0,r.clamp)(l[1],o,n.duration);a=c-o>=1?[o,c]:[]}else a=[]}}),n.on("video:timeupdate",()=>{a.length&&(n.currentTime<a[0]||n.currentTime>a[1])&&(n.seek=a[0])})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$poster:l}}=n;(0,r.def)(n,"poster",{get:()=>a.poster,set(o){a.poster=o,(0,r.setStyle)(l,"backgroundImage",`url(${o})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$container:l,$video:o}}=n,c=l.style.height;(0,r.def)(n,"autoHeight",{get:()=>(0,r.hasClass)(l,"art-auto-height"),set(u){if(u){const{clientWidth:h}=l,{videoHeight:p,videoWidth:m}=o,v=p*(h/m);(0,r.setStyle)(l,"height",v+"px"),(0,r.addClass)(l,"art-auto-height"),n.autoSize=a.autoSize,n.emit("autoHeight",v)}else(0,r.setStyle)(l,"height",c),(0,r.removeClass)(l,"art-auto-height"),n.autoSize=a.autoSize,n.emit("autoHeight")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,template:{$player:l}}=n;(0,r.def)(n,"theme",{get:()=>getComputedStyle(l).getPropertyValue("--theme"),set(o){a.theme=o,l.style.setProperty("--theme",o)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7Am53":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"title",{get:()=>n.option.title,set(a){n.option.title=a}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){(0,r.def)(n,"type",{get:()=>n.option.type,set(a){n.option.type=a}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePkBr:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const a=["mini","pip","fullscreen","fullscreenWeb"];(0,r.def)(n,"normalSize",{get:()=>a.every(l=>!n[l]),set(l){a.filter(o=>o!==l).forEach(o=>{n[o]&&(n[o]=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{clamp:a}=n.constructor.utils,{notice:l,template:o,i18n:c}=n;let u=0,h=[];n.on("subtitle:switch",()=>{h=[]}),(0,r.def)(n,"subtitleOffset",{get:()=>u,set(p){if(o.$track&&o.$track.track){const m=Array.from(o.$track.track.cues);u=a(p,-5,5);for(let v=0;v<m.length;v++){const E=m[v];h[v]||(h[v]={startTime:E.startTime,endTime:E.endTime}),E.startTime=a(h[v].startTime+u,0,n.duration),E.endTime=a(h[v].endTime+u,0,n.duration)}n.subtitle.update(),l.show=`${c.get("Subtitle Offset")}: ${p}s`,n.emit("subtitleOffset",p)}else n.emit("subtitleOffset",0)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,notice:l,proxy:o,template:{$video:c}}=n;let u=!0;window.WebKitPlaybackTargetAvailabilityEvent&&c.webkitShowPlaybackTargetPicker?o(c,"webkitplaybacktargetavailabilitychanged",h=>{switch(h.availability){case"available":u=!0;break;case"not-available":u=!1}}):u=!1,(0,r.def)(n,"airplay",{value(){u?(c.webkitShowPlaybackTargetPicker(),n.emit("airplay")):l.show=a.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,storage:l,template:{$video:o,$poster:c}}=n;Object.keys(a.moreVideoAttr).forEach(h=>{n.attr(h,a.moreVideoAttr[h])}),a.muted&&(n.muted=a.muted),a.volume&&(o.volume=(0,r.clamp)(a.volume,0,1));const u=l.get("volume");typeof u=="number"&&(o.volume=(0,r.clamp)(u,0,1)),a.poster&&(0,r.setStyle)(c,"backgroundImage",`url(${a.poster})`),a.autoplay&&(o.autoplay=a.autoplay),a.playsInline&&(o.playsInline=!0,o["webkit-playsinline"]=!0),a.theme&&(n.theme=a.theme),n.url=a.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../config"),a=r.interopDefault(n),l=e("../utils");s.default=function(o){const{i18n:c,notice:u,option:h,constructor:p,proxy:m,template:{$player:v,$video:E,$poster:C}}=o;let N=0;for(let R=0;R<a.default.events.length;R++)m(E,a.default.events[R],x=>{o.emit(`video:${x.type}`,x)});o.on("video:canplay",()=>{N=0,o.loading.show=!1}),o.once("video:canplay",()=>{o.loading.show=!1,o.controls.show=!0,o.mask.show=!0,o.isReady=!0,o.emit("ready")}),o.on("video:ended",()=>{h.loop?(o.seek=0,o.play(),o.controls.show=!1,o.mask.show=!1):(o.controls.show=!0,o.mask.show=!0)}),o.on("video:error",R=>se(this,null,function*(){N<p.RECONNECT_TIME_MAX?(yield(0,l.sleep)(p.RECONNECT_SLEEP_TIME),N+=1,o.url=h.url,u.show=`${c.get("Reconnect")}: ${N}`,o.emit("error",R,N)):(o.mask.show=!0,o.loading.show=!1,o.controls.show=!0,(0,l.addClass)(v,"art-error"),yield(0,l.sleep)(p.RECONNECT_SLEEP_TIME),u.show=c.get("Video Load Failed"),o.destroy(!1))})),o.on("video:loadedmetadata",()=>{o.autoSize=h.autoSize,l.isMobile&&(o.loading.show=!1,o.controls.show=!0,o.mask.show=!0)}),o.on("video:loadstart",()=>{o.loading.show=!0,o.mask.show=!1,o.controls.show=!0}),o.on("video:pause",()=>{o.controls.show=!0,o.mask.show=!0}),o.on("video:play",()=>{o.mask.show=!1,(0,l.setStyle)(C,"display","none")}),o.on("video:playing",()=>{o.mask.show=!1}),o.on("video:seeked",()=>{o.loading.show=!1}),o.on("video:seeking",()=>{o.loading.show=!0,o.mask.show=!1}),o.on("video:timeupdate",()=>{o.mask.show=!1}),o.on("video:waiting",()=>{o.loading.show=!0,o.mask.show=!1})}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("../utils/component"),l=r.interopDefault(a),o=e("./fullscreen"),c=r.interopDefault(o),u=e("./fullscreenWeb"),h=r.interopDefault(u),p=e("./pip"),m=r.interopDefault(p),v=e("./playAndPause"),E=r.interopDefault(v),C=e("./progress"),N=r.interopDefault(C),R=e("./time"),x=r.interopDefault(R),P=e("./volume"),M=r.interopDefault(P),b=e("./setting"),T=r.interopDefault(b),I=e("./thumbnails"),A=r.interopDefault(I),U=e("./screenshot"),B=r.interopDefault(U),$=e("./quality"),X=r.interopDefault($),nt=e("./loop"),ot=r.interopDefault(nt),z=e("./airplay"),k=r.interopDefault(z);class F extends l.default{constructor(Z){super(Z),this.name="control";const{proxy:rt,constructor:ut,template:{$player:gt}}=Z;let It=Date.now();rt(gt,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,n.removeClass)(gt,"art-hide-cursor"),(0,n.addClass)(gt,"art-hover"),It=Date.now()}),Z.on("video:timeupdate",()=>{!Z.isInput&&Z.playing&&this.show&&Date.now()-It>=ut.CONTROL_HIDE_TIME&&(this.show=!1,(0,n.addClass)(gt,"art-hide-cursor"),(0,n.removeClass)(gt,"art-hover"))}),this.init()}init(){const{option:Z}=this.art;Z.isLive||this.add((0,N.default)({name:"progress",position:"top",index:10})),!Z.thumbnails.url||Z.isLive||n.isMobile||this.add((0,A.default)({name:"thumbnails",position:"top",index:20})),this.add((0,ot.default)({name:"loop",position:"top",index:30})),this.add((0,E.default)({name:"playAndPause",position:"left",index:10})),this.add((0,M.default)({name:"volume",position:"left",index:20})),Z.isLive||this.add((0,x.default)({name:"time",position:"left",index:30})),Z.quality.length&&this.add((0,X.default)({name:"quality",position:"right",index:10})),Z.screenshot&&!n.isMobile&&this.add((0,B.default)({name:"screenshot",position:"right",index:20})),Z.setting&&this.add((0,T.default)({name:"setting",position:"right",index:30})),Z.pip&&this.add((0,m.default)({name:"pip",position:"right",index:40})),Z.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,k.default)({name:"airplay",position:"right",index:50})),Z.fullscreenWeb&&this.add((0,h.default)({name:"fullscreenWeb",position:"right",index:60})),Z.fullscreen&&this.add((0,c.default)({name:"fullscreen",position:"right",index:70}));for(let rt=0;rt<Z.controls.length;rt++)this.add(Z.controls[rt])}add(Z){const rt=typeof Z=="function"?Z(this.art):Z,{$progress:ut,$controlsLeft:gt,$controlsRight:It}=this.art.template;switch(rt.position){case"top":this.$parent=ut;break;case"left":this.$parent=gt;break;case"right":this.$parent=It;break;default:(0,n.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(rt)}}s.default=F},{"../utils":"71aH7","../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./thumbnails":"eCVx2","./screenshot":"4KCF5","./quality":"efgTY","./loop":"2hIff","./airplay":"4IS2d","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./dom"),a=e("option-validator"),l=r.interopDefault(a),o=e("../scheme"),c=e("./property"),u=e("./error");s.default=class{constructor(h){this.id=0,this.art=h,this.add=this.add.bind(this)}get show(){return(0,n.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(h){const{$player:p}=this.art.template,m=`art-${this.name}-show`;h?(0,n.addClass)(p,m):(0,n.removeClass)(p,m),this.art.emit(this.name,h)}set toggle(h){h&&(this.show=!this.show)}add(h){const p=typeof h=="function"?h(this.art):h;if(p.html=p.html||"",(0,l.default)(p,o.ComponentOption),!this.$parent||!this.name||p.disable)return;const m=p.name||`${this.name}${this.id}`;(0,u.errorHandle)(!(0,c.has)(this,m),`Cannot add an existing name [${m}] to the [${this.name}]`),this.id+=1;const v=(0,n.createElement)("div");(0,n.addClass)(v,`art-${this.name}`),(0,n.addClass)(v,`art-${this.name}-${m}`);const E=Array.from(this.$parent.children);v.dataset.index=p.index||this.id;const C=E.find(N=>Number(N.dataset.index)>=Number(v.dataset.index));return C?C.insertAdjacentElement("beforebegin",v):(0,n.append)(this.$parent,v),p.html&&(0,n.append)(v,p.html),p.style&&(0,n.setStyles)(v,p.style),p.tooltip&&(0,n.tooltip)(v,p.tooltip),p.click&&this.art.events.proxy(v,"click",N=>{N.preventDefault(),p.click.call(this.art,this,N)}),p.selector&&["left","right"].includes(p.position)&&this.selector(p,v),p.mounted&&p.mounted.call(this.art,v),(0,c.def)(this,m,{value:v}),v}selector(h,p){const{hover:m,proxy:v}=this.art.events;(0,n.addClass)(p,"art-control-selector");const E=(0,n.createElement)("div");(0,n.addClass)(E,"art-selector-value"),(0,n.append)(E,h.html),p.innerText="",(0,n.append)(p,E);const C=h.selector.map((x,P)=>`<div class="art-selector-item ${x.default?"art-current":""}" data-index="${P}">${x.html}</div>`).join(""),N=(0,n.createElement)("div");(0,n.addClass)(N,"art-selector-list"),(0,n.append)(N,C),(0,n.append)(p,N),this.art.option.backdrop&&(0,n.addClass)(N,"art-backdrop-filter");const R=()=>{const x=(0,n.getStyle)(p,"width")/2-(0,n.getStyle)(N,"width")/2;N.style.left=`${x}px`};m(p,R),v(N,"click",x=>se(this,null,function*(){const P=(x.composedPath()||[]).find(T=>(0,n.hasClass)(T,"art-selector-item"));if(!P)return;(0,n.inverseClass)(P,"art-current");const M=Number(P.dataset.index),b=h.selector[M]||{};if(E.innerText=P.innerText,h.onSelect){const T=yield h.onSelect.call(this.art,b,P,x);typeof T!="string"&&typeof T!="number"||(E.innerHTML=T)}R()}))}}},{"./dom":"bSNiV","option-validator":"bAWi2","../scheme":"AKEiO","./property":"5NSdr","./error":"hwmZz","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{tooltip:a.i18n.get("Fullscreen"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a,h=(0,r.append)(l,c.fullscreenOn),p=(0,r.append)(l,c.fullscreenOff);(0,r.setStyle)(p,"display","none"),o(l,"click",()=>{a.fullscreen=!a.fullscreen}),a.on("fullscreen",m=>{m?((0,r.tooltip)(l,u.get("Exit Fullscreen")),(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(p,"display","inline-flex")):((0,r.tooltip)(l,u.get("Fullscreen")),(0,r.setStyle)(h,"display","inline-flex"),(0,r.setStyle)(p,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{tooltip:a.i18n.get("Web Fullscreen"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a,h=(0,r.append)(l,c.fullscreenWebOn),p=(0,r.append)(l,c.fullscreenWebOff);(0,r.setStyle)(p,"display","none"),o(l,"click",()=>{a.fullscreenWeb=!a.fullscreenWeb}),a.on("fullscreenWeb",m=>{m?((0,r.tooltip)(l,u.get("Exit Web Fullscreen")),(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(p,"display","inline-flex")):((0,r.tooltip)(l,u.get("Web Fullscreen")),(0,r.setStyle)(h,"display","inline-flex"),(0,r.setStyle)(p,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{tooltip:a.i18n.get("PIP Mode"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a;(0,r.append)(l,c.pip),o(l,"click",()=>{a.pip=!a.pip}),a.on("pip",h=>{(0,r.tooltip)(l,u.get(h?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{mounted:l=>{const{proxy:o,icons:c,i18n:u}=a,h=(0,r.append)(l,c.play),p=(0,r.append)(l,c.pause);function m(){(0,r.setStyle)(h,"display","flex"),(0,r.setStyle)(p,"display","none")}function v(){(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(p,"display","flex")}(0,r.tooltip)(h,u.get("Play")),(0,r.tooltip)(p,u.get("Pause")),o(h,"click",()=>{a.play()}),o(p,"click",()=>{a.pause()}),a.playing?v():m(),a.on("video:playing",()=>{v()}),a.on("video:pause",()=>{m()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"getPosFromEvent",()=>a),r.export(s,"setCurrentTime",()=>l);var n=e("../utils");function a(o,c){const{$progress:u}=o.template,{left:h}=u.getBoundingClientRect(),p=n.isMobile?c.touches[0].clientX:c.pageX,m=(0,n.clamp)(p-h,0,u.clientWidth),v=m/u.clientWidth*o.duration;return{second:v,time:(0,n.secondToTime)(v),width:m,percentage:(0,n.clamp)(m/u.clientWidth,0,1)}}function l(o,c){if(o.isRotate){const u=c.touches[0].clientY/o.height,h=u*o.duration;o.emit("setBar","played",u),o.seek=h}else{const{second:u,percentage:h}=a(o,c);o.emit("setBar","played",h),o.seek=u}}s.default=function(o){return c=>{const{icons:u,option:h,proxy:p}=c;return Kt($t({},o),{html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:m=>{let v=!1;const E=(0,n.query)(".art-progress-loaded",m),C=(0,n.query)(".art-progress-played",m),N=(0,n.query)(".art-progress-highlight",m),R=(0,n.query)(".art-progress-indicator",m),x=(0,n.query)(".art-progress-tip",m),{PROGRESS_HEIGHT:P,INDICATOR_SIZE:M,INDICATOR_SIZE_ICON:b,INDICATOR_SIZE_MOBILE:T,INDICATOR_SIZE_MOBILE_ICON:I}=c.constructor;(0,n.setStyle)(m,"height",`${P}px`),(0,n.setStyle)(C,"backgroundColor","var(--theme)");let A=M;function U(B,$){B==="loaded"&&(0,n.setStyle)(E,"width",100*$+"%"),B==="played"&&((0,n.setStyle)(C,"width",100*$+"%"),(0,n.setStyle)(R,"left",`calc(${100*$}% - ${A/2}px)`))}u.indicator?(A=b,(0,n.append)(R,u.indicator)):(0,n.setStyles)(R,{backgroundColor:"var(--theme)"}),n.isMobile&&(A=T,u.indicator&&(A=I)),(0,n.setStyles)(R,{left:`-${A/2}px`,width:`${A}px`,height:`${A}px`}),c.on("video:loadedmetadata",()=>{for(let B=0;B<h.highlight.length;B++){const $=h.highlight[B],X=(0,n.clamp)($.time,0,c.duration)/c.duration*100;(0,n.append)(N,`<span data-text="${$.text}" data-time="${$.time}" style="left: ${X}%"></span>`)}}),U("loaded",c.loaded),c.on("setBar",(B,$)=>{U(B,$)}),c.on("video:progress",()=>{U("loaded",c.loaded)}),c.on("video:timeupdate",()=>{U("played",c.played)}),c.on("video:ended",()=>{U("played",1)}),n.isMobile||(p(m,"click",B=>{B.target!==R&&l(c,B)}),p(m,"mousemove",B=>{(0,n.setStyle)(x,"display","block"),(0,n.includeFromEvent)(B,N)?function($){const{width:X}=a(c,$),{text:nt}=$.target.dataset;x.innerHTML=nt;const ot=x.clientWidth;X<=ot/2?(0,n.setStyle)(x,"left",0):X>m.clientWidth-ot/2?(0,n.setStyle)(x,"left",m.clientWidth-ot+"px"):(0,n.setStyle)(x,"left",X-ot/2+"px")}(B):function($){const{width:X,time:nt}=a(c,$);x.innerHTML=nt;const ot=x.clientWidth;X<=ot/2?(0,n.setStyle)(x,"left",0):X>m.clientWidth-ot/2?(0,n.setStyle)(x,"left",m.clientWidth-ot+"px"):(0,n.setStyle)(x,"left",X-ot/2+"px")}(B)}),p(m,"mouseleave",()=>{(0,n.setStyle)(x,"display","none")}),p(m,"mousedown",()=>{v=!0}),p(document,"mousemove",B=>{if(v){const{second:$,percentage:X}=a(c,B);U("played",X),c.seek=$}}),p(document,"mouseup",()=>{v&&(v=!1)}))}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{style:{cursor:"auto",marginLeft:"10px"},mounted:l=>{function o(){const u=`${(0,r.secondToTime)(a.currentTime)} / ${(0,r.secondToTime)(a.duration)}`;u!==l.innerText&&(l.innerText=u)}o();const c=["video:loadedmetadata","video:timeupdate","video:progress"];for(let u=0;u<c.length;u++)a.on(c[u],o)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{mounted:l=>{const{proxy:o,icons:c,i18n:u}=a;let h=!1;const p=a.constructor.VOLUME_PANEL_WIDTH,m=a.constructor.VOLUME_HANDLE_WIDTH,v=(0,r.append)(l,c.volume),E=(0,r.append)(l,c.volumeClose),C=(0,r.append)(l,'<div class="art-volume-panel"></div>'),N=(0,r.append)(C,'<div class="art-volume-slider-handle"></div>');function R(P){const{left:M}=C.getBoundingClientRect();return(0,r.clamp)(P.pageX-M-m/2,0,p-m/2)/(p-m)}function x(P=.7){if(a.muted||P===0)(0,r.setStyle)(v,"display","none"),(0,r.setStyle)(E,"display","flex"),(0,r.setStyle)(N,"left","0");else{const M=(p-m)*P;(0,r.setStyle)(v,"display","flex"),(0,r.setStyle)(E,"display","none"),(0,r.setStyle)(N,"left",`${M}px`)}}(0,r.tooltip)(v,u.get("Mute")),(0,r.setStyle)(E,"display","none"),r.isMobile&&(0,r.setStyle)(C,"display","none"),x(a.volume),a.on("video:volumechange",()=>{x(a.volume)}),o(v,"click",()=>{a.muted=!0}),o(E,"click",()=>{a.muted=!1}),o(C,"click",P=>{a.muted=!1,a.volume=R(P)}),o(N,"mousedown",()=>{h=!0}),o(l,"mousemove",P=>{h&&(a.muted=!1,a.volume=R(P))}),o(document,"mouseup",()=>{h&&(h=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{tooltip:a.i18n.get("Show Setting"),mounted:l=>{const{proxy:o,icons:c,i18n:u}=a;(0,r.append)(l,c.setting),o(l,"click",()=>{a.setting.toggle=!0,a.setting.updateStyle()}),a.on("setting",h=>{(0,r.tooltip)(l,u.get(h?"Hide Setting":"Show Setting"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eCVx2:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils"),n=e("./progress");s.default=function(a){return l=>Kt($t({},a),{mounted:o=>{const{option:c,template:{$progress:u,$video:h},events:{proxy:p,loadImg:m}}=l;let v=null,E=!1,C=!1;p(u,"mousemove",N=>se(this,null,function*(){E||(E=!0,v=yield m(c.thumbnails.url),C=!0),C&&((0,r.setStyle)(o,"display","block"),function(R){const{width:x}=(0,n.getPosFromEvent)(l,R),{url:P,number:M,column:b,width:T,height:I}=c.thumbnails,A=T||v.naturalWidth/b,U=I||A/(h.videoWidth/h.videoHeight),B=u.clientWidth/M,$=Math.floor(x/B),X=Math.ceil($/b)-1,nt=$%b||b-1;(0,r.setStyle)(o,"backgroundImage",`url(${P})`),(0,r.setStyle)(o,"height",`${U}px`),(0,r.setStyle)(o,"width",`${A}px`),(0,r.setStyle)(o,"backgroundPosition",`-${nt*A}px -${X*U}px`),x<=A/2?(0,r.setStyle)(o,"left",0):x>u.clientWidth-A/2?(0,r.setStyle)(o,"left",u.clientWidth-A+"px"):(0,r.setStyle)(o,"left",x-A/2+"px")}(N))})),p(u,"mouseleave",()=>{(0,r.setStyle)(o,"display","none")}),l.on("hover",N=>{N||(0,r.setStyle)(o,"display","none")})}})}},{"../utils":"71aH7","./progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{tooltip:a.i18n.get("Screenshot"),mounted:l=>{const{proxy:o,icons:c}=a;(0,r.append)(l,c.screenshot),o(l,"click",()=>{a.screenshot()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],efgTY:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return n=>{const a=n.option.quality,l=a.find(o=>o.default)||a[0];return Kt($t({},r),{style:{marginRight:"10px"},html:l?l.html:"",selector:a,onSelect(o){n.switchQuality(o.url,o.html)}})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2hIff":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{mounted:l=>{const o=(0,r.append)(l,'<span class="art-loop-point"></span>'),c=(0,r.append)(l,'<span class="art-loop-point"></span>');a.on("loop",u=>{u&&u.length?((0,r.setStyle)(l,"display","block"),(0,r.setStyle)(o,"left",`calc(${u[0]/a.duration*100}% - ${o.clientWidth}px)`),(0,r.setStyle)(c,"left",u[1]/a.duration*100+"%")):(0,r.setStyle)(l,"display","none")})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>Kt($t({},n),{tooltip:a.i18n.get("AirPlay"),mounted:l=>{const{proxy:o,icons:c}=a;(0,r.append)(l,c.airplay),o(l,"click",()=>a.airplay())}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("../utils/component"),l=r.interopDefault(a),o=e("./playbackRate"),c=r.interopDefault(o),u=e("./aspectRatio"),h=r.interopDefault(u),p=e("./flip"),m=r.interopDefault(p),v=e("./info"),E=r.interopDefault(v),C=e("./version"),N=r.interopDefault(C),R=e("./close"),x=r.interopDefault(R);class P extends l.default{constructor(b){super(b),this.name="contextmenu",this.$parent=b.template.$contextmenu,n.isMobile||this.init()}init(){const{option:b,proxy:T,template:{$player:I,$contextmenu:A}}=this.art;b.playbackRate&&this.add((0,c.default)({name:"playbackRate",index:10})),b.aspectRatio&&this.add((0,h.default)({name:"aspectRatio",index:20})),b.flip&&this.add((0,m.default)({name:"flip",index:30})),this.add((0,E.default)({name:"info",index:40})),this.add((0,N.default)({name:"version",index:50})),this.add((0,x.default)({name:"close",index:60}));for(let U=0;U<b.contextmenu.length;U++)this.add(b.contextmenu[U]);T(I,"contextmenu",U=>{if(U.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;const B=U.clientX,$=U.clientY,{height:X,width:nt,left:ot,top:z}=I.getBoundingClientRect(),{height:k,width:F}=A.getBoundingClientRect();let G=B-ot,Z=$-z;B+F>ot+nt&&(G=nt-F),$+k>z+X&&(Z=X-k),(0,n.setStyles)(A,{top:`${Z}px`,left:`${G}px`})}),T(I,"click",U=>{(0,n.includeFromEvent)(U,A)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}s.default=P},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>{const{i18n:l,constructor:{PLAYBACK_RATE:o}}=a;return Kt($t({},n),{html:`${l.get("Play Speed")}:
                ${o.map(c=>`<span data-value="${c}">${c===1?l.get("Normal"):c}</span>`).join("")}
            `,click:(c,u)=>{const{value:h}=u.target.dataset;h&&(a.playbackRate=Number(h),c.show=!1)},mounted:c=>{const u=(0,r.query)('[data-value="1"]',c);u&&(0,r.inverseClass)(u,"art-current"),a.on("video:ratechange",()=>{const h=(0,r.queryAll)("span",c).find(p=>Number(p.dataset.value)===a.playbackRate);h&&(0,r.inverseClass)(h,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>{const{i18n:l,constructor:{ASPECT_RATIO:o}}=a;return Kt($t({},n),{html:`${l.get("Aspect Ratio")}:
                ${o.map(c=>`<span data-value="${c}">${c==="default"?l.get("Default"):c}</span>`).join("")}
            `,click:(c,u)=>{const{value:h}=u.target.dataset;h&&(a.aspectRatio=h,c.show=!1)},mounted:c=>{const u=(0,r.query)('[data-value="default"]',c);u&&(0,r.inverseClass)(u,"art-current"),a.on("aspectRatio",h=>{const p=(0,r.queryAll)("span",c).find(m=>m.dataset.value===h);p&&(0,r.inverseClass)(p,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){return a=>{const{i18n:l,constructor:{FLIP:o}}=a;return Kt($t({},n),{html:`${l.get("Video Flip")}:
                ${o.map(c=>`<span data-value="${c}">${l.get((0,r.capitalize)(c))}</span>`).join("")}
            `,click:(c,u)=>{const{value:h}=u.target.dataset;h&&(a.flip=h.toLowerCase(),c.show=!1)},mounted:c=>{const u=(0,r.query)('[data-value="normal"]',c);u&&(0,r.inverseClass)(u,"art-current"),a.on("flip",h=>{const p=(0,r.queryAll)("span",c).find(m=>m.dataset.value===h);p&&(0,r.inverseClass)(p,"art-current")})}})}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return n=>Kt($t({},r),{html:n.i18n.get("Video Info"),click:a=>{n.info.show=!0,a.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return Kt($t({},r),{html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.6.2</a>'})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return n=>Kt($t({},r),{html:n.i18n.get("Close"),click:a=>{a.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a);class o extends l.default{constructor(u){super(u),this.name="info",n.isMobile||this.init()}init(){const{proxy:u,constructor:h,template:{$infoPanel:p,$infoClose:m,$video:v}}=this.art;u(m,"click",()=>{this.show=!1});let E=null;const C=(0,n.queryAll)("[data-video]",p)||[];this.art.on("destroy",()=>{clearTimeout(E)}),function N(){for(let R=0;R<C.length;R++){const x=C[R],P=v[x.dataset.video],M=typeof P=="number"?P.toFixed(2):P;x.innerText!==M&&(x.innerText=M)}E=setTimeout(N,h.INFO_LOOP_TIME)}()}}s.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a),o=e("option-validator"),c=r.interopDefault(o),u=e("./scheme"),h=r.interopDefault(u);class p extends l.default{constructor(v){super(v),this.name="subtitle",this.eventDestroy=()=>null,this.init(v.option.subtitle);let E=!1;v.on("video:timeupdate",()=>{if(!this.url)return;const C=this.art.template.$video.webkitDisplayingFullscreen;typeof C=="boolean"&&C!==E&&(E=C,this.createTrack(C?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(v){this.switch(v)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(v,E){const{$subtitle:C}=this.art.template;return typeof v=="object"?(0,n.setStyles)(C,v):(0,n.setStyle)(C,v,E)}update(){const{$subtitle:v}=this.art.template;v.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?v.innerHTML=this.activeCue.text.split(/\r?\n/).map(E=>`<p>${(0,n.escape)(E)}</p>`).join(""):v.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}switch(C){return se(this,arguments,function*(v,E={}){const{i18n:N,notice:R,option:x}=this.art,P=Kt($t($t({},x.subtitle),E),{url:v}),M=yield this.init(P);return E.name&&(R.show=`${N.get("Switch Subtitle")}: ${E.name}`),M})}createTrack(v,E){const{template:C,proxy:N}=this.art,{$video:R,$track:x}=C,P=(0,n.createElement)("track");P.default=!0,P.kind=v,P.src=E,P.track.mode="hidden",this.eventDestroy(),(0,n.remove)(x),(0,n.append)(R,P),C.$track=P,this.eventDestroy=N(this.textTrack,"cuechange",()=>this.update())}init(v){return se(this,null,function*(){const{notice:E,template:{$subtitle:C}}=this.art;if((0,c.default)(v,h.default.subtitle),v.url)return this.style(v.style),fetch(v.url).then(N=>N.arrayBuffer()).then(N=>{const R=new TextDecoder(v.encoding).decode(N);switch(this.art.emit("subtitleLoad",v.url),v.type||(0,n.getExt)(v.url)){case"srt":return(0,n.vttToBlob)((0,n.srtToVtt)(R));case"ass":return(0,n.vttToBlob)((0,n.assToVtt)(R));case"vtt":return(0,n.vttToBlob)(R);default:return v.url}}).then(N=>(C.innerHTML="",this.url===N||(URL.revokeObjectURL(this.url),this.createTrack("metadata",N),this.art.emit("subtitleSwitch",N)),N)).catch(N=>{throw E.show=N,N})})}}s.default=p},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils/error"),a=e("./clickInit"),l=r.interopDefault(a),o=e("./hoverInit"),c=r.interopDefault(o),u=e("./mousemoveInit"),h=r.interopDefault(u),p=e("./resizeInit"),m=r.interopDefault(p),v=e("./gestureInit"),E=r.interopDefault(v),C=e("./viewInit"),N=r.interopDefault(C);s.default=class{constructor(R){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),R.whitelist.state&&((0,l.default)(R,this),(0,c.default)(R,this),(0,h.default)(R,this),(0,m.default)(R,this),(0,E.default)(R,this),(0,N.default)(R,this))}proxy(R,x,P,M={}){if(Array.isArray(x))return x.map(T=>this.proxy(R,T,P,M));R.addEventListener(x,P,M);const b=()=>R.removeEventListener(x,P,M);return this.destroyEvents.push(b),b}hover(R,x,P){x&&this.proxy(R,"mouseenter",x),P&&this.proxy(R,"mouseleave",P)}loadImg(R){return new Promise((x,P)=>{let M;if(R instanceof HTMLImageElement)M=R;else{if(typeof R!="string")return P(new n.ArtPlayerError("Unable to get Image"));M=new Image,M.src=R}if(M.complete)return x(M);this.proxy(M,"load",()=>x(M)),this.proxy(M,"error",()=>P(new n.ArtPlayerError(`Failed to load Image: ${M.src}`)))})}destroy(){for(let R=0;R<this.destroyEvents.length;R++)this.destroyEvents[R]()}}},{"../utils/error":"hwmZz","./clickInit":"6UrCm","./hoverInit":"4jWHi","./mousemoveInit":"bMF9b","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{constructor:l,template:{$player:o,$video:c}}=n;a.proxy(document,["click","contextmenu"],h=>{(0,r.includeFromEvent)(h,o)?(n.isInput=h.target.tagName==="INPUT",n.isFocus=!0,n.emit("focus")):(n.isInput=!1,n.isFocus=!1,n.emit("blur"))});let u=0;a.proxy(c,"click",()=>{const h=Date.now();h-u<=l.DB_CLICE_TIME?(n.emit("dblclick"),r.isMobile?n.isLock||n.toggle():n.fullscreen=!n.fullscreen):(n.emit("click"),r.isMobile||n.toggle()),u=h})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{$player:l}=n.template;a.hover(l,o=>{(0,r.addClass)(l,"art-hover"),n.emit("hover",!0,o)},o=>{(0,r.removeClass)(l,"art-hover"),n.emit("hover",!1,o)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bMF9b:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r,n){const{$player:a}=r.template;n.proxy(a,"mousemove",l=>{r.emit("mousemove",l)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{option:l}=n,o=(0,r.throttle)(()=>{n.normalSize&&(n.autoSize=l.autoSize),n.aspectRatioReset=!0,n.notice.show="",n.emit("resize")},n.constructor.RESIZE_TIME);a.proxy(window,["orientationchange","resize"],()=>{o()}),screen&&screen.orientation&&screen.orientation.onchange&&a.proxy(screen.orientation,"change",()=>{o()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils"),n=e("../control/progress");s.default=function(a,l){if(r.isMobile&&!a.option.isLive){const{$video:o,$progress:c}=a.template;let u=null,h=!1,p=0,m=0,v=0;const E=R=>{if(R.touches.length===1&&!a.isLock){u===c&&(0,n.setCurrentTime)(a,R),h=!0;const{clientX:x,clientY:P}=R.touches[0];p=x,m=P,v=a.currentTime}},C=R=>{if(R.touches.length===1&&h&&a.duration){const{clientX:x,clientY:P}=R.touches[0],M=(0,r.clamp)((x-p)/a.width,-1,1),b=(0,r.clamp)((P-m)/a.height,-1,1),T=a.isRotate?b:M,I=u===o?a.constructor.TOUCH_MOVE_RATIO:1,A=(0,r.clamp)(v+a.duration*T*I,0,a.duration);a.seek=A,a.emit("setBar","played",(0,r.clamp)(A/a.duration,0,1)),a.notice.show=`${(0,r.secondToTime)(A)} / ${(0,r.secondToTime)(a.duration)}`}},N=()=>{h&&(p=0,m=0,v=0,h=!1,u=null)};l.proxy(c,"touchstart",R=>{u=c,E(R)}),l.proxy(o,"touchstart",R=>{u=o,E(R)}),l.proxy(o,"touchmove",C),l.proxy(c,"touchmove",C),l.proxy(document,"touchend",N)}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n,a){const{option:l,constructor:o,template:{$container:c}}=n,u=(0,r.throttle)(()=>{n.emit("view",(0,r.isInViewport)(c,o.SCROLL_GAP))},o.SCROLL_TIME);a.proxy(window,"scroll",()=>{u()}),n.on("view",h=>{l.autoMini&&(n.mini=!h)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");s.default=class{constructor(n){this.art=n,this.keys={},n.option.hotkey&&!r.isMobile&&this.init()}init(){const{proxy:n,constructor:a}=this.art;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=a.SEEK_STEP}),this.add(38,()=>{this.art.volume+=a.VOLUME_STEP}),this.add(39,()=>{this.art.forward=a.SEEK_STEP}),this.add(40,()=>{this.art.volume-=a.VOLUME_STEP}),n(window,"keydown",l=>{if(this.art.isFocus){const o=document.activeElement.tagName.toUpperCase(),c=document.activeElement.getAttribute("contenteditable");if(o!=="INPUT"&&o!=="TEXTAREA"&&c!==""&&c!=="true"){const u=this.keys[l.keyCode];if(u){l.preventDefault();for(let h=0;h<u.length;h++)u[h].call(this.art,l);this.art.emit("hotkey",l)}}}})}add(n,a){return this.keys[n]?this.keys[n].push(a):this.keys[n]=[a],this}remove(n,a){if(this.keys[n]){const l=this.keys[n].indexOf(a);l!==-1&&this.keys[n].splice(l,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils/component"),a=r.interopDefault(n);class l extends a.default{constructor(c){super(c);const{option:u,template:{$layer:h}}=c;this.name="layer",this.$parent=h;for(let p=0;p<u.layers.length;p++)this.add(u.layers[p])}}s.default=l},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a);class o extends l.default{constructor(u){super(u),this.name="loading",(0,n.append)(u.template.$loading,u.icons.loading)}}s.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("./utils");s.default=class{constructor(n){this.art=n,this.timer=null}set show(n){const{constructor:a,template:{$player:l,$noticeInner:o}}=this.art;n?(o.innerText=n instanceof Error?n.message.trim():n,(0,r.addClass)(l,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{o.innerText="",(0,r.removeClass)(l,"art-notice-show")},a.NOTICE_TIME)):(0,r.removeClass)(l,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./utils"),a=e("./utils/component"),l=r.interopDefault(a);class o extends l.default{constructor(u){super(u),this.name="mask";const{template:h,icons:p,events:m}=u,v=(0,n.append)(h.$state,p.state),E=(0,n.append)(h.$state,p.error);(0,n.setStyle)(E,"display","none"),u.on("destroy",()=>{(0,n.setStyle)(v,"display","none"),(0,n.setStyle)(E,"display",null)}),m.proxy(h.$state,"click",()=>u.play())}}s.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("bundle-text:./loading.svg"),l=r.interopDefault(a),o=e("bundle-text:./state.svg"),c=r.interopDefault(o),u=e("bundle-text:./check.svg"),h=r.interopDefault(u),p=e("bundle-text:./play.svg"),m=r.interopDefault(p),v=e("bundle-text:./pause.svg"),E=r.interopDefault(v),C=e("bundle-text:./volume.svg"),N=r.interopDefault(C),R=e("bundle-text:./volume-close.svg"),x=r.interopDefault(R),P=e("bundle-text:./screenshot.svg"),M=r.interopDefault(P),b=e("bundle-text:./setting.svg"),T=r.interopDefault(b),I=e("bundle-text:./arrow-left.svg"),A=r.interopDefault(I),U=e("bundle-text:./arrow-right.svg"),B=r.interopDefault(U),$=e("bundle-text:./playback-rate.svg"),X=r.interopDefault($),nt=e("bundle-text:./aspect-ratio.svg"),ot=r.interopDefault(nt),z=e("bundle-text:./config.svg"),k=r.interopDefault(z),F=e("bundle-text:./pip.svg"),G=r.interopDefault(F),Z=e("bundle-text:./lock.svg"),rt=r.interopDefault(Z),ut=e("bundle-text:./unlock.svg"),gt=r.interopDefault(ut),It=e("bundle-text:./fullscreen-off.svg"),Dt=r.interopDefault(It),et=e("bundle-text:./fullscreen-on.svg"),at=r.interopDefault(et),ft=e("bundle-text:./fullscreen-web-off.svg"),yt=r.interopDefault(ft),_t=e("bundle-text:./fullscreen-web-on.svg"),wt=r.interopDefault(_t),Vt=e("bundle-text:./switch-on.svg"),Ft=r.interopDefault(Vt),Jt=e("bundle-text:./switch-off.svg"),Qt=r.interopDefault(Jt),Re=e("bundle-text:./flip.svg"),De=r.interopDefault(Re),Ce=e("bundle-text:./error.svg"),fe=r.interopDefault(Ce),Et=e("bundle-text:./close.svg"),ke=r.interopDefault(Et),Me=e("bundle-text:./airplay.svg"),Ge=r.interopDefault(Me);s.default=class{constructor(qe){const ye=$t({loading:l.default,state:c.default,play:m.default,pause:E.default,check:h.default,volume:N.default,volumeClose:x.default,screenshot:M.default,setting:T.default,pip:G.default,arrowLeft:A.default,arrowRight:B.default,playbackRate:X.default,aspectRatio:ot.default,config:k.default,lock:rt.default,flip:De.default,unlock:gt.default,fullscreenOff:Dt.default,fullscreenOn:at.default,fullscreenWebOff:yt.default,fullscreenWebOn:wt.default,switchOn:Ft.default,switchOff:Qt.default,error:fe.default,close:ke.default,airplay:Ge.default},qe.option.icons);Object.keys(ye).forEach(he=>{(0,n.def)(this,he,{get:()=>{const Te=(0,n.createElement)("i");return(0,n.addClass)(Te,"art-icon"),(0,n.addClass)(Te,`art-icon-${he}`),(0,n.append)(Te,ye[he]),Te}})})}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],lmgoP:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(e,i,s){i.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(e,i,s){i.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],fQTgE:[function(e,i,s){i.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(e,i,s){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(e,i,s){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(e,i,s){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(e,i,s){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(e,i,s){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(e,i,s){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(e,i,s){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(e,i,s){i.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(e,i,s){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(e,i,s){i.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./flip"),a=r.interopDefault(n),l=e("./aspectRatio"),o=r.interopDefault(l),c=e("./playbackRate"),u=r.interopDefault(c),h=e("./subtitleOffset"),p=r.interopDefault(h),m=e("../utils/component"),v=r.interopDefault(m),E=e("../utils");class C extends v.default{constructor(R){super(R);const{option:x,proxy:P,template:{$setting:M,$player:b}}=R;if(this.name="setting",this.$parent=M,this.option=[],this.events=[],this.cache=new Map,x.setting){x.playbackRate&&this.option.push((0,u.default)(R)),x.aspectRatio&&this.option.push((0,o.default)(R)),x.flip&&this.option.push((0,a.default)(R)),x.subtitleOffset&&this.option.push((0,p.default)(R));for(let T=0;T<x.settings.length;T++)this.option.push(x.settings[T]);this.update(),R.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),P(b,"click",T=>{!this.show||(0,E.includeFromEvent)(T,R.controls.setting)||(0,E.includeFromEvent)(T,this.$parent)||(this.show=!1,this.init(this.option))})}}static makeRecursion(R,x,P){for(let M=0;M<R.length;M++){const b=R[M];b.$parentItem=x,b.$parentList=P,b.selector&&C.makeRecursion(b.selector,b,R)}return R}update(){return this.cache=new Map,this.events.forEach(R=>R()),this.events=[],this.$parent.innerHTML="",this.option=C.makeRecursion(this.option),this.init(this.option),this.option}add(R){return this.option.push(R),this.update(),R}creatHeader(R){const{icons:x,proxy:P}=this.art,M=(0,E.createElement)("div");(0,E.addClass)(M,"art-setting-item"),(0,E.addClass)(M,"art-setting-item-back");const b=(0,E.append)(M,'<div class="art-setting-item-left"></div>'),T=(0,E.createElement)("div");(0,E.addClass)(T,"art-setting-item-left-icon"),(0,E.append)(T,x.arrowLeft),(0,E.append)(b,T),(0,E.append)(b,R.$parentItem.html);const I=P(M,"click",()=>this.init(R.$parentList));return this.events.push(I),M}creatItem(R,x){const{icons:P,proxy:M}=this.art,b=(0,E.createElement)("div");(0,E.addClass)(b,"art-setting-item"),(0,E.isStringOrNumber)(x.name)&&(b.dataset.name=x.name),(0,E.isStringOrNumber)(x.value)&&(b.dataset.value=x.value);const T=(0,E.append)(b,'<div class="art-setting-item-left"></div>'),I=(0,E.append)(b,'<div class="art-setting-item-right"></div>'),A=(0,E.createElement)("div");switch((0,E.addClass)(A,"art-setting-item-left-icon"),R){case"switch":case"range":(0,E.append)(A,(0,E.isStringOrNumber)(x.icon)||x.icon instanceof Element?x.icon:P.config);break;case"selector":x.selector&&x.selector.length?(0,E.append)(A,(0,E.isStringOrNumber)(x.icon)||x.icon instanceof Element?x.icon:P.config):(0,E.append)(A,P.check)}(0,E.append)(T,A),x.$icon=A,(0,E.def)(x,"icon",{configurable:!0,get:()=>A.innerHTML,set($){(0,E.isStringOrNumber)($)&&(A.innerHTML=$)}});const U=(0,E.createElement)("div");(0,E.addClass)(U,"art-setting-item-left-text"),(0,E.append)(U,x.html||""),(0,E.append)(T,U),x.$html=U,(0,E.def)(x,"html",{configurable:!0,get:()=>U.innerHTML,set($){(0,E.isStringOrNumber)($)&&(U.innerHTML=$)}});const B=(0,E.createElement)("div");switch((0,E.addClass)(B,"art-setting-item-right-tooltip"),(0,E.append)(B,x.tooltip||""),(0,E.append)(I,B),x.$tooltip=B,(0,E.def)(x,"tooltip",{configurable:!0,get:()=>B.innerHTML,set($){(0,E.isStringOrNumber)($)&&(B.innerHTML=$)}}),R){case"switch":{const $=(0,E.createElement)("div");(0,E.addClass)($,"art-setting-item-right-icon");const X=(0,E.append)($,P.switchOn),nt=(0,E.append)($,P.switchOff);(0,E.setStyle)(x.switch?nt:X,"display","none"),(0,E.append)(I,$),x.$switch=x.switch,(0,E.def)(x,"switch",{configurable:!0,get:()=>x.$switch,set(ot){x.$switch=ot,ot?((0,E.setStyle)(nt,"display","none"),(0,E.setStyle)(X,"display",null)):((0,E.setStyle)(nt,"display",null),(0,E.setStyle)(X,"display","none"))}});break}case"range":{const $=(0,E.createElement)("div");(0,E.addClass)($,"art-setting-item-right-icon");const X=(0,E.append)($,'<input type="range">');X.value=x.range[0]||0,X.min=x.range[1]||0,X.max=x.range[2]||10,X.step=x.range[3]||1,(0,E.addClass)(X,"art-setting-range"),(0,E.append)(I,$),x.$range=X,(0,E.def)(x,"range",{configurable:!0,get:()=>X.valueAsNumber,set(nt){X.value=Number(nt)}})}break;case"selector":if(x.selector&&x.selector.length){const $=(0,E.createElement)("div");(0,E.addClass)($,"art-setting-item-right-icon"),(0,E.append)($,P.arrowRight),(0,E.append)(I,$)}}switch(R){case"switch":if(x.onSwitch){const $=M(b,"click",X=>se(this,null,function*(){x.switch=yield x.onSwitch.call(this.art,x,b,X)}));this.events.push($)}break;case"range":if(x.$range){if(x.onRange){const $=M(x.$range,"change",X=>se(this,null,function*(){x.tooltip=yield x.onRange.call(this.art,x,b,X)}));this.events.push($)}if(x.onChange){const $=M(x.$range,"input",X=>se(this,null,function*(){x.tooltip=yield x.onChange.call(this.art,x,b,X)}));this.events.push($)}}break;case"selector":{const $=M(b,"click",X=>se(this,null,function*(){if(x.selector&&x.selector.length)this.init(x.selector,x.width);else{(0,E.inverseClass)(b,"art-current");for(let nt=0;nt<x.$parentItem.selector.length;nt++){const ot=x.$parentItem.selector[nt];ot.default=ot===x}if(x.$parentList&&this.init(x.$parentList),x.$parentItem&&x.$parentItem.onSelect){const nt=yield x.$parentItem.onSelect.call(this.art,x,b,X);x.$parentItem.$tooltip&&(0,E.isStringOrNumber)(nt)&&(x.$parentItem.$tooltip.innerHTML=nt)}}}));this.events.push($),x.default&&(0,E.addClass)(b,"art-current")}}return b}updateStyle(R){const{controls:x,constructor:P,template:{$player:M,$setting:b}}=this.art;if(x.setting){const T=R||P.SETTING_WIDTH,{left:I,width:A}=x.setting.getBoundingClientRect(),{left:U,width:B}=M.getBoundingClientRect(),$=I-U+A/2-T/2;$+T>B?((0,E.setStyle)(b,"left","auto"),(0,E.setStyle)(b,"right","10px")):((0,E.setStyle)(b,"left",`${$}px`),(0,E.setStyle)(b,"right","auto"))}else(0,E.setStyle)(b,"left","auto"),(0,E.setStyle)(b,"right","10px")}init(R,x){const{constructor:P}=this.art;if(this.cache.has(R)){const M=this.cache.get(R);(0,E.inverseClass)(M,"art-current"),(0,E.setStyle)(this.$parent,"width",`${M.dataset.width}px`),(0,E.setStyle)(this.$parent,"height",`${M.dataset.height}px`),this.updateStyle(Number(M.dataset.width))}else{const M=(0,E.createElement)("div");(0,E.addClass)(M,"art-setting-panel"),M.dataset.width=x||P.SETTING_WIDTH,M.dataset.height=R.length*P.SETTING_ITEM_HEIGHT,R[0]&&R[0].$parentItem&&((0,E.append)(M,this.creatHeader(R[0])),M.dataset.height=Number(M.dataset.height)+P.SETTING_ITEM_HEIGHT);for(let b=0;b<R.length;b++){const T=R[b];(0,E.has)(T,"switch")?(0,E.append)(M,this.creatItem("switch",T)):(0,E.has)(T,"range")?(0,E.append)(M,this.creatItem("range",T)):(0,E.append)(M,this.creatItem("selector",T))}(0,E.append)(this.$parent,M),this.cache.set(R,M),(0,E.inverseClass)(M,"art-current"),(0,E.setStyle)(this.$parent,"width",`${M.dataset.width}px`),(0,E.setStyle)(this.$parent,"height",`${M.dataset.height}px`),this.updateStyle(Number(M.dataset.width)),R[0]&&R[0].$parentItem&&R[0].$parentItem.mounted&&R[0].$parentItem.mounted.call(this.art,M,R[0].$parentItem)}}}s.default=C},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:o,FLIP:c}}=n;function u(h,p,m){p&&(p.innerText=a.get((0,r.capitalize)(m)));const v=(0,r.queryAll)(".art-setting-item",h).find(E=>E.dataset.value===m);v&&(0,r.inverseClass)(v,"art-current")}return{width:o,html:a.get("Video Flip"),tooltip:a.get((0,r.capitalize)(n.flip)),icon:l.flip,selector:c.map(h=>({value:h,default:h===n.flip,html:a.get((0,r.capitalize)(h))})),onSelect:h=>(n.flip=h.value,h.value),mounted:(h,p)=>{u(h,p.$tooltip,n.flip),n.on("flip",()=>{u(h,p.$tooltip,n.flip)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:o,ASPECT_RATIO:c}}=n;function u(p){return p==="default"?a.get("Default"):p}function h(p,m,v){m&&(m.innerText=u(v));const E=(0,r.queryAll)(".art-setting-item",p).find(C=>C.dataset.value===v);E&&(0,r.inverseClass)(E,"art-current")}return{width:o,html:a.get("Aspect Ratio"),icon:l.aspectRatio,tooltip:u(n.aspectRatio),selector:c.map(p=>({value:p,default:p===n.aspectRatio,html:u(p)})),onSelect:p=>(n.aspectRatio=p.value,p.value),mounted:(p,m)=>{h(p,m.$tooltip,n.aspectRatio),n.on("aspectRatio",()=>{h(p,m.$tooltip,n.aspectRatio)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:o,PLAYBACK_RATE:c}}=n;function u(p){return p===1?a.get("Normal"):p}function h(p,m,v){m&&(m.innerText=u(v));const E=(0,r.queryAll)(".art-setting-item",p).find(C=>Number(C.dataset.value)===v);E&&(0,r.inverseClass)(E,"art-current")}return{width:o,html:a.get("Play Speed"),tooltip:u(n.playbackRate),icon:l.playbackRate,selector:c.map(p=>({value:p,default:p===n.playbackRate,html:u(p)})),onSelect:p=>(n.playbackRate=p.value,p.value),mounted:(p,m)=>{h(p,m.$tooltip,n.playbackRate),n.on("video:ratechange",()=>{h(p,m.$tooltip,n.playbackRate)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){const{i18n:n,icons:a,constructor:l}=r;return{width:l.SETTING_ITEM_WIDTH,html:n.get("Subtitle Offset"),icon:a.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:o=>(r.subtitleOffset=o.range,o.range+"s")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(r){try{const n=JSON.parse(window.localStorage.getItem(this.name))||{};return r?n[r]:n}catch(n){return r?this.settings[r]:this.settings}}set(r,n){try{const a=Object.assign({},this.get(),{[r]:n});window.localStorage.setItem(this.name,JSON.stringify(a))}catch(a){this.settings[r]=n}}del(r){try{const n=this.get();delete n[r],window.localStorage.setItem(this.name,JSON.stringify(n))}catch(n){delete this.settings[r]}}clear(){try{window.localStorage.removeItem(this.name)}catch(r){this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("../utils"),a=e("./miniProgressBar"),l=r.interopDefault(a),o=e("./autoOrientation"),c=r.interopDefault(o),u=e("./autoPlayback"),h=r.interopDefault(u),p=e("./fastForward"),m=r.interopDefault(p),v=e("./lock"),E=r.interopDefault(v);s.default=class{constructor(C){this.art=C,this.id=0;const{option:N}=C;N.miniProgressBar&&!N.isLive&&this.add(l.default),N.lock&&n.isMobile&&this.add(E.default),N.autoPlayback&&!N.isLive&&this.add(h.default),N.autoOrientation&&n.isMobile&&this.add(c.default),N.fastForward&&n.isMobile&&!N.isLive&&this.add(m.default);for(let R=0;R<N.plugins.length;R++)this.add(N.plugins[R])}add(C){this.id+=1;const N=C.call(this.art,this.art),R=N&&N.name||C.name||`plugin${this.id}`;return(0,n.errorHandle)(!(0,n.has)(this,R),`Cannot add a plugin that already has the same name: ${R}`),(0,n.def)(this,R,{value:N}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(r){return r.on("ready",()=>{r.layers.add({name:"miniProgressBar",mounted(n){r.on("destroy",()=>{n.style.display="none"}),r.on("video:timeupdate",()=>{n.style.width=100*r.played+"%"}),r.on("setBar",(a,l)=>{a==="played"&&(n.style.width=100*l+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{option:a,constructor:l,template:{$player:o,$video:c}}=n;return n.on("fullscreenWeb",u=>{if(u){const{videoWidth:h,videoHeight:p}=c,{clientWidth:m,clientHeight:v}=document.documentElement;(h>p&&m<v||h<p&&m>v)&&setTimeout(()=>{(0,r.setStyle)(o,"width",`${v}px`),(0,r.setStyle)(o,"height",`${m}px`),(0,r.setStyle)(o,"transform-origin","0 0"),(0,r.setStyle)(o,"transform",`rotate(90deg) translate(0, -${m}px)`),(0,r.addClass)(o,"art-auto-orientation"),n.isRotate=!0,n.emit("resize")},l.MOBILE_AUTO_ORIENTATION_TIME)}else(0,r.hasClass)(o,"art-auto-orientation")&&((0,r.setStyle)(o,"width",null),(0,r.setStyle)(o,"height",null),(0,r.setStyle)(o,"transform",null),(0,r.setStyle)(o,"transform-origin",null),(0,r.removeClass)(o,"art-auto-orientation"),n.isRotate=!1,n.aspectRatioReset=!0,n.autoSize=a.autoSize,n.notice.show="",n.emit("resize"))}),n.on("fullscreen",u=>se(this,null,function*(){const h=screen.orientation.type;if(u){const{videoWidth:p,videoHeight:m}=c,{clientWidth:v,clientHeight:E}=document.documentElement;if(p>m&&v<E||p<m&&v>E){const C=h.startsWith("portrait")?"landscape":"portrait";yield screen.orientation.lock(C),(0,r.addClass)(o,"art-auto-orientation-fullscreen")}}else(0,r.hasClass)(o,"art-auto-orientation-fullscreen")&&(yield screen.orientation.lock(h),(0,r.removeClass)(o,"art-auto-orientation-fullscreen"))})),{name:"autoOrientation",get state(){return(0,r.hasClass)(o,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{i18n:a,icons:l,storage:o,constructor:c,proxy:u,template:{$poster:h}}=n,p=n.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),m=(0,r.query)(".art-autoPlayback-last",p),v=(0,r.query)(".art-autoPlayback-jump",p),E=(0,r.query)(".art-autoPlayback-close",p);return n.on("video:timeupdate",()=>{const C=o.get("times")||{},N=Object.keys(C);N.length>c.AUTO_PLAYBACK_MAX&&delete C[N[0]],C[n.option.id||n.option.url]=n.currentTime,o.set("times",C)}),n.on("ready",()=>{const C=(o.get("times")||{})[n.option.id||n.option.url];C&&C>=c.AUTO_PLAYBACK_MIN&&((0,r.append)(E,l.close),(0,r.setStyle)(p,"display","flex"),m.innerText=`${a.get("Last Seen")} ${(0,r.secondToTime)(C)}`,v.innerText=a.get("Jump Play"),u(E,"click",()=>{(0,r.setStyle)(p,"display","none")}),u(v,"click",()=>{n.seek=C,n.play(),(0,r.setStyle)(h,"display","none"),(0,r.setStyle)(p,"display","none")}),n.once("video:timeupdate",()=>{setTimeout(()=>{(0,r.setStyle)(p,"display","none")},c.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return o.get("times")||{}},clear:()=>o.del("times"),delete(C){const N=o.get("times")||{};return delete N[C],o.set("times",N),N}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{constructor:a,proxy:l,template:{$player:o,$video:c}}=n;let u=null,h=!1,p=1;const m=()=>{clearTimeout(u),h&&(h=!1,n.playbackRate=p,(0,r.removeClass)(o,"art-fast-forward"))};return l(c,"touchstart",v=>{v.touches.length===1&&n.playing&&!n.isLock&&(u=setTimeout(()=>{h=!0,p=n.playbackRate,n.playbackRate=a.FAST_FORWARD_VALUE,(0,r.addClass)(o,"art-fast-forward")},a.FAST_FORWARD_TIME))}),l(document,"touchmove",m),l(document,"touchend",m),{name:"fastForward",get state(){return(0,r.hasClass)(o,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(e,i,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s);var r=e("../utils");s.default=function(n){const{layers:a,icons:l,template:{$player:o}}=n;return a.add({name:"lock",mounted(c){const u=(0,r.append)(c,l.lock),h=(0,r.append)(c,l.unlock);(0,r.setStyle)(u,"display","none"),n.on("lock",p=>{p?((0,r.setStyle)(u,"display","inline-flex"),(0,r.setStyle)(h,"display","none")):((0,r.setStyle)(u,"display","none"),(0,r.setStyle)(h,"display","inline-flex"))})},click(){(0,r.hasClass)(o,"art-lock")?((0,r.removeClass)(o,"art-lock"),this.isLock=!1):((0,r.addClass)(o,"art-lock"),this.isLock=!0)}}),{name:"lock",get state(){return(0,r.hasClass)(o,"art-lock")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7mil2":[function(e,i,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s);var n=e("./config"),a=r.interopDefault(n),l=e("./utils");s.default=class{constructor(o){const{option:c,proxy:u,template:{$video:h}}=o;for(let v=0;v<a.default.events.length;v++)u(h,a.default.events[v],E=>{o.emit(`video:${E.type}`,E)});Object.keys(c.moreVideoAttr).forEach(v=>{h[v]=c.moreVideoAttr[v]}),h.controls=!0,c.muted&&(h.muted=c.muted),c.volume&&(h.volume=(0,l.clamp)(c.volume,0,1)),c.poster&&(h.poster=c.poster),c.autoplay&&(h.autoplay=c.autoplay),c.playsInline&&(h.playsInline=!0,h["webkit-playsinline"]=!0);const p=c.type||(0,l.getExt)(c.url),m=c.customType[p];p&&m?m(h,c.url,o):(h.src=c.url,o.emit("url",h.src))}}},{"./config":"lyjeQ","./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],"5lTcX","parcelRequire4dc0")})(yn);var Xa=gn(yn.exports);const Za={style:{transform:"scale(-1,1)"},height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},Ja=Ht("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),to=[Ja];function eo(d,t){return pi(),mi("svg",Za,[...to])}var io={name:"custom-prev",render:eo};const ro={height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},so=Ht("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),no=[so];function ao(d,t){return pi(),mi("svg",ro,[...no])}var oo={name:"custom-next",render:ao},_n={exports:{}};(function(d,t){(function(e,i){d.exports=i()})(window,function(){return function(e){var i={};function s(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=i,s.d=function(r,n,a){s.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:a})},s.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s.t=function(r,n){if(1&n&&(r=s(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var l in r)s.d(a,l,function(o){return r[o]}.bind(null,l));return a},s.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return s.d(n,"a",n),n},s.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},s.p="",s(s.s=14)}([function(e,i,s){var r=s(6),n=s.n(r),a=function(){function l(){}return l.e=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","error",u),l.ENABLE_ERROR&&(console.error?console.error(u):console.warn?console.warn(u):console.log(u))},l.i=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","info",u),l.ENABLE_INFO&&(console.info?console.info(u):console.log(u))},l.w=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","warn",u),l.ENABLE_WARN&&(console.warn?console.warn(u):console.log(u))},l.d=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","debug",u),l.ENABLE_DEBUG&&(console.debug?console.debug(u):console.log(u))},l.v=function(o,c){o&&!l.FORCE_GLOBAL_TAG||(o=l.GLOBAL_TAG);var u="["+o+"] > "+c;l.ENABLE_CALLBACK&&l.emitter.emit("log","verbose",u),l.ENABLE_VERBOSE&&console.log(u)},l}();a.GLOBAL_TAG="mpegts.js",a.FORCE_GLOBAL_TAG=!1,a.ENABLE_ERROR=!0,a.ENABLE_INFO=!0,a.ENABLE_WARN=!0,a.ENABLE_DEBUG=!0,a.ENABLE_VERBOSE=!0,a.ENABLE_CALLBACK=!1,a.emitter=new n.a,i.a=a},function(e,i,s){i.a={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},function(e,i,s){s.d(i,"c",function(){return n}),s.d(i,"b",function(){return a}),s.d(i,"a",function(){return l});var r=s(3),n={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},a={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},l=function(){function o(c){this._type=c||"undefined",this._status=n.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return o.prototype.destroy=function(){this._status=n.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},o.prototype.isWorking=function(){return this._status===n.kConnecting||this._status===n.kBuffering},Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(c){this._onContentLengthKnown=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(c){this._onURLRedirect=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(c){this._onDataArrival=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onError",{get:function(){return this._onError},set:function(c){this._onError=c},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onComplete",{get:function(){return this._onComplete},set:function(c){this._onComplete=c},enumerable:!1,configurable:!0}),o.prototype.open=function(c,u){throw new r.c("Unimplemented abstract function!")},o.prototype.abort=function(){throw new r.c("Unimplemented abstract function!")},o}()},function(e,i,s){s.d(i,"d",function(){return a}),s.d(i,"a",function(){return l}),s.d(i,"b",function(){return o}),s.d(i,"c",function(){return c});var r,n=(r=function(u,h){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,m){p.__proto__=m}||function(p,m){for(var v in m)m.hasOwnProperty(v)&&(p[v]=m[v])})(u,h)},function(u,h){function p(){this.constructor=u}r(u,h),u.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}),a=function(){function u(h){this._message=h}return Object.defineProperty(u.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),u.prototype.toString=function(){return this.name+": "+this.message},u}(),l=function(u){function h(p){return u.call(this,p)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),h}(a),o=function(u){function h(p){return u.call(this,p)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),h}(a),c=function(u){function h(p){return u.call(this,p)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),h}(a)},function(e,i,s){var r={};(function(){var n=self.navigator.userAgent.toLowerCase(),a=/(edge)\/([\w.]+)/.exec(n)||/(opr)[\/]([\w.]+)/.exec(n)||/(chrome)[ \/]([\w.]+)/.exec(n)||/(iemobile)[\/]([\w.]+)/.exec(n)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(n)||[],l=/(ipad)/.exec(n)||/(ipod)/.exec(n)||/(windows phone)/.exec(n)||/(iphone)/.exec(n)||/(kindle)/.exec(n)||/(android)/.exec(n)||/(windows)/.exec(n)||/(mac)/.exec(n)||/(linux)/.exec(n)||/(cros)/.exec(n)||[],o={browser:a[5]||a[3]||a[1]||"",version:a[2]||a[4]||"0",majorVersion:a[4]||a[2]||"0",platform:l[0]||""},c={};if(o.browser){c[o.browser]=!0;var u=o.majorVersion.split(".");c.version={major:parseInt(o.majorVersion,10),string:o.version},u.length>1&&(c.version.minor=parseInt(u[1],10)),u.length>2&&(c.version.build=parseInt(u[2],10))}o.platform&&(c[o.platform]=!0),(c.chrome||c.opr||c.safari)&&(c.webkit=!0),(c.rv||c.iemobile)&&(c.rv&&delete c.rv,o.browser="msie",c.msie=!0),c.edge&&(delete c.edge,o.browser="msedge",c.msedge=!0),c.opr&&(o.browser="opera",c.opera=!0),c.safari&&c.android&&(o.browser="android",c.android=!0);for(var h in c.name=o.browser,c.platform=o.platform,r)r.hasOwnProperty(h)&&delete r[h];Object.assign(r,c)})(),i.a=r},function(e,i,s){i.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(e,i,s){var r,n=typeof Reflect=="object"?Reflect:null,a=n&&typeof n.apply=="function"?n.apply:function(x,P,M){return Function.prototype.apply.call(x,P,M)};r=n&&typeof n.ownKeys=="function"?n.ownKeys:Object.getOwnPropertySymbols?function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:function(x){return Object.getOwnPropertyNames(x)};var l=Number.isNaN||function(x){return x!=x};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(x,P){return new Promise(function(M,b){function T(A){x.removeListener(P,I),b(A)}function I(){typeof x.removeListener=="function"&&x.removeListener("error",T),M([].slice.call(arguments))}R(x,P,I,{once:!0}),P!=="error"&&function(A,U,B){typeof A.on=="function"&&R(A,"error",U,B)}(x,T,{once:!0})})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function u(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function h(x){return x._maxListeners===void 0?o.defaultMaxListeners:x._maxListeners}function p(x,P,M,b){var T,I,A,U;if(u(M),(I=x._events)===void 0?(I=x._events=Object.create(null),x._eventsCount=0):(I.newListener!==void 0&&(x.emit("newListener",P,M.listener?M.listener:M),I=x._events),A=I[P]),A===void 0)A=I[P]=M,++x._eventsCount;else if(typeof A=="function"?A=I[P]=b?[M,A]:[A,M]:b?A.unshift(M):A.push(M),(T=h(x))>0&&A.length>T&&!A.warned){A.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(P)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=x,B.type=P,B.count=A.length,U=B,console&&console.warn&&console.warn(U)}return x}function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(x,P,M){var b={fired:!1,wrapFn:void 0,target:x,type:P,listener:M},T=m.bind(b);return T.listener=M,b.wrapFn=T,T}function E(x,P,M){var b=x._events;if(b===void 0)return[];var T=b[P];return T===void 0?[]:typeof T=="function"?M?[T.listener||T]:[T]:M?function(I){for(var A=new Array(I.length),U=0;U<A.length;++U)A[U]=I[U].listener||I[U];return A}(T):N(T,T.length)}function C(x){var P=this._events;if(P!==void 0){var M=P[x];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}function N(x,P){for(var M=new Array(P),b=0;b<P;++b)M[b]=x[b];return M}function R(x,P,M,b){if(typeof x.on=="function")b.once?x.once(P,M):x.on(P,M);else{if(typeof x.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x);x.addEventListener(P,function T(I){b.once&&x.removeEventListener(P,T),M(I)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(x){if(typeof x!="number"||x<0||l(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");c=x}}),o.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||l(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(x){for(var P=[],M=1;M<arguments.length;M++)P.push(arguments[M]);var b=x==="error",T=this._events;if(T!==void 0)b=b&&T.error===void 0;else if(!b)return!1;if(b){var I;if(P.length>0&&(I=P[0]),I instanceof Error)throw I;var A=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw A.context=I,A}var U=T[x];if(U===void 0)return!1;if(typeof U=="function")a(U,this,P);else{var B=U.length,$=N(U,B);for(M=0;M<B;++M)a($[M],this,P)}return!0},o.prototype.addListener=function(x,P){return p(this,x,P,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(x,P){return p(this,x,P,!0)},o.prototype.once=function(x,P){return u(P),this.on(x,v(this,x,P)),this},o.prototype.prependOnceListener=function(x,P){return u(P),this.prependListener(x,v(this,x,P)),this},o.prototype.removeListener=function(x,P){var M,b,T,I,A;if(u(P),(b=this._events)===void 0)return this;if((M=b[x])===void 0)return this;if(M===P||M.listener===P)--this._eventsCount==0?this._events=Object.create(null):(delete b[x],b.removeListener&&this.emit("removeListener",x,M.listener||P));else if(typeof M!="function"){for(T=-1,I=M.length-1;I>=0;I--)if(M[I]===P||M[I].listener===P){A=M[I].listener,T=I;break}if(T<0)return this;T===0?M.shift():function(U,B){for(;B+1<U.length;B++)U[B]=U[B+1];U.pop()}(M,T),M.length===1&&(b[x]=M[0]),b.removeListener!==void 0&&this.emit("removeListener",x,A||P)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(x){var P,M,b;if((M=this._events)===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[x]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete M[x]),this;if(arguments.length===0){var T,I=Object.keys(M);for(b=0;b<I.length;++b)(T=I[b])!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(P=M[x])=="function")this.removeListener(x,P);else if(P!==void 0)for(b=P.length-1;b>=0;b--)this.removeListener(x,P[b]);return this},o.prototype.listeners=function(x){return E(this,x,!0)},o.prototype.rawListeners=function(x){return E(this,x,!1)},o.listenerCount=function(x,P){return typeof x.listenerCount=="function"?x.listenerCount(P):C.call(x,P)},o.prototype.listenerCount=C,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,i,s){s.d(i,"d",function(){return r}),s.d(i,"b",function(){return n}),s.d(i,"a",function(){return a}),s.d(i,"c",function(){return l});var r=function(o,c,u,h,p){this.dts=o,this.pts=c,this.duration=u,this.originalDts=h,this.isSyncPoint=p,this.fileposition=null},n=function(){function o(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return o.prototype.appendSyncPoint=function(c){c.isSyncPoint=!0,this.syncPoints.push(c)},o}(),a=function(){function o(){this._list=[]}return o.prototype.clear=function(){this._list=[]},o.prototype.appendArray=function(c){var u=this._list;c.length!==0&&(u.length>0&&c[0].originalDts<u[u.length-1].originalDts&&this.clear(),Array.prototype.push.apply(u,c))},o.prototype.getLastSyncPointBeforeDts=function(c){if(this._list.length==0)return null;var u=this._list,h=0,p=u.length-1,m=0,v=0,E=p;for(c<u[0].dts&&(h=0,v=E+1);v<=E;){if((m=v+Math.floor((E-v)/2))===p||c>=u[m].dts&&c<u[m+1].dts){h=m;break}u[m].dts<c?v=m+1:E=m-1}return this._list[h]},o}(),l=function(){function o(c){this._type=c,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),o.prototype.isEmpty=function(){return this._list.length===0},o.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},o.prototype._searchNearestSegmentBefore=function(c){var u=this._list;if(u.length===0)return-2;var h=u.length-1,p=0,m=0,v=h,E=0;if(c<u[0].originalBeginDts)return E=-1;for(;m<=v;){if((p=m+Math.floor((v-m)/2))===h||c>u[p].lastSample.originalDts&&c<u[p+1].originalBeginDts){E=p;break}u[p].originalBeginDts<c?m=p+1:v=p-1}return E},o.prototype._searchNearestSegmentAfter=function(c){return this._searchNearestSegmentBefore(c)+1},o.prototype.append=function(c){var u=this._list,h=c,p=this._lastAppendLocation,m=0;p!==-1&&p<u.length&&h.originalBeginDts>=u[p].lastSample.originalDts&&(p===u.length-1||p<u.length-1&&h.originalBeginDts<u[p+1].originalBeginDts)?m=p+1:u.length>0&&(m=this._searchNearestSegmentBefore(h.originalBeginDts)+1),this._lastAppendLocation=m,this._list.splice(m,0,h)},o.prototype.getLastSegmentBefore=function(c){var u=this._searchNearestSegmentBefore(c);return u>=0?this._list[u]:null},o.prototype.getLastSampleBefore=function(c){var u=this.getLastSegmentBefore(c);return u!=null?u.lastSample:null},o.prototype.getLastSyncPointBefore=function(c){for(var u=this._searchNearestSegmentBefore(c),h=this._list[u].syncPoints;h.length===0&&u>0;)u--,h=this._list[u].syncPoints;return h.length>0?h[h.length-1]:null},o}()},function(e,i,s){var r=function(){function n(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return n.prototype.isComplete=function(){var a=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,l=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&a&&l},n.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},n.prototype.getNearestKeyframe=function(a){if(this.keyframesIndex==null)return null;var l=this.keyframesIndex,o=this._search(l.times,a);return{index:o,milliseconds:l.times[o],fileposition:l.filepositions[o]}},n.prototype._search=function(a,l){var o=0,c=a.length-1,u=0,h=0,p=c;for(l<a[0]&&(o=0,h=p+1);h<=p;){if((u=h+Math.floor((p-h)/2))===c||l>=a[u]&&l<a[u+1]){o=u;break}a[u]<l?h=u+1:p=u-1}return o},n}();i.a=r},function(e,i,s){var r=s(6),n=s.n(r),a=s(0),l=function(){function o(){}return Object.defineProperty(o,"forceGlobalTag",{get:function(){return a.a.FORCE_GLOBAL_TAG},set:function(c){a.a.FORCE_GLOBAL_TAG=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"globalTag",{get:function(){return a.a.GLOBAL_TAG},set:function(c){a.a.GLOBAL_TAG=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableAll",{get:function(){return a.a.ENABLE_VERBOSE&&a.a.ENABLE_DEBUG&&a.a.ENABLE_INFO&&a.a.ENABLE_WARN&&a.a.ENABLE_ERROR},set:function(c){a.a.ENABLE_VERBOSE=c,a.a.ENABLE_DEBUG=c,a.a.ENABLE_INFO=c,a.a.ENABLE_WARN=c,a.a.ENABLE_ERROR=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableDebug",{get:function(){return a.a.ENABLE_DEBUG},set:function(c){a.a.ENABLE_DEBUG=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableVerbose",{get:function(){return a.a.ENABLE_VERBOSE},set:function(c){a.a.ENABLE_VERBOSE=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableInfo",{get:function(){return a.a.ENABLE_INFO},set:function(c){a.a.ENABLE_INFO=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableWarn",{get:function(){return a.a.ENABLE_WARN},set:function(c){a.a.ENABLE_WARN=c,o._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(o,"enableError",{get:function(){return a.a.ENABLE_ERROR},set:function(c){a.a.ENABLE_ERROR=c,o._notifyChange()},enumerable:!1,configurable:!0}),o.getConfig=function(){return{globalTag:a.a.GLOBAL_TAG,forceGlobalTag:a.a.FORCE_GLOBAL_TAG,enableVerbose:a.a.ENABLE_VERBOSE,enableDebug:a.a.ENABLE_DEBUG,enableInfo:a.a.ENABLE_INFO,enableWarn:a.a.ENABLE_WARN,enableError:a.a.ENABLE_ERROR,enableCallback:a.a.ENABLE_CALLBACK}},o.applyConfig=function(c){a.a.GLOBAL_TAG=c.globalTag,a.a.FORCE_GLOBAL_TAG=c.forceGlobalTag,a.a.ENABLE_VERBOSE=c.enableVerbose,a.a.ENABLE_DEBUG=c.enableDebug,a.a.ENABLE_INFO=c.enableInfo,a.a.ENABLE_WARN=c.enableWarn,a.a.ENABLE_ERROR=c.enableError,a.a.ENABLE_CALLBACK=c.enableCallback},o._notifyChange=function(){var c=o.emitter;if(c.listenerCount("change")>0){var u=o.getConfig();c.emit("change",u)}},o.registerListener=function(c){o.emitter.addListener("change",c)},o.removeListener=function(c){o.emitter.removeListener("change",c)},o.addLogListener=function(c){a.a.emitter.addListener("log",c),a.a.emitter.listenerCount("log")>0&&(a.a.ENABLE_CALLBACK=!0,o._notifyChange())},o.removeLogListener=function(c){a.a.emitter.removeListener("log",c),a.a.emitter.listenerCount("log")===0&&(a.a.ENABLE_CALLBACK=!1,o._notifyChange())},o}();l.emitter=new n.a,i.a=l},function(e,i,s){var r=s(6),n=s.n(r),a=s(0),l=s(4),o=s(8);function c(_,g,y){var f=_;if(g+y<f.length){for(;y--;)if((192&f[++g])!=128)return!1;return!0}return!1}var u,h=function(_){for(var g=[],y=_,f=0,S=_.length;f<S;)if(y[f]<128)g.push(String.fromCharCode(y[f])),++f;else{if(!(y[f]<192)){if(y[f]<224){if(c(y,f,1)&&(w=(31&y[f])<<6|63&y[f+1])>=128){g.push(String.fromCharCode(65535&w)),f+=2;continue}}else if(y[f]<240){if(c(y,f,2)&&(w=(15&y[f])<<12|(63&y[f+1])<<6|63&y[f+2])>=2048&&(63488&w)!=55296){g.push(String.fromCharCode(65535&w)),f+=3;continue}}else if(y[f]<248){var w;if(c(y,f,3)&&(w=(7&y[f])<<18|(63&y[f+1])<<12|(63&y[f+2])<<6|63&y[f+3])>65536&&w<1114112){w-=65536,g.push(String.fromCharCode(w>>>10|55296)),g.push(String.fromCharCode(1023&w|56320)),f+=4;continue}}}g.push(String.fromCharCode(65533)),++f}return g.join("")},p=s(3),m=(u=new ArrayBuffer(2),new DataView(u).setInt16(0,256,!0),new Int16Array(u)[0]===256),v=function(){function _(){}return _.parseScriptData=function(g,y,f){var S={};try{var w=_.parseValue(g,y,f),L=_.parseValue(g,y+w.size,f-w.size);S[w.data]=L.data}catch(O){a.a.e("AMF",O.toString())}return S},_.parseObject=function(g,y,f){if(f<3)throw new p.a("Data not enough when parse ScriptDataObject");var S=_.parseString(g,y,f),w=_.parseValue(g,y+S.size,f-S.size),L=w.objectEnd;return{data:{name:S.data,value:w.data},size:S.size+w.size,objectEnd:L}},_.parseVariable=function(g,y,f){return _.parseObject(g,y,f)},_.parseString=function(g,y,f){if(f<2)throw new p.a("Data not enough when parse String");var S=new DataView(g,y,f).getUint16(0,!m);return{data:S>0?h(new Uint8Array(g,y+2,S)):"",size:2+S}},_.parseLongString=function(g,y,f){if(f<4)throw new p.a("Data not enough when parse LongString");var S=new DataView(g,y,f).getUint32(0,!m);return{data:S>0?h(new Uint8Array(g,y+4,S)):"",size:4+S}},_.parseDate=function(g,y,f){if(f<10)throw new p.a("Data size invalid when parse Date");var S=new DataView(g,y,f),w=S.getFloat64(0,!m),L=S.getInt16(8,!m);return{data:new Date(w+=60*L*1e3),size:10}},_.parseValue=function(g,y,f){if(f<1)throw new p.a("Data not enough when parse Value");var S,w=new DataView(g,y,f),L=1,O=w.getUint8(0),j=!1;try{switch(O){case 0:S=w.getFloat64(1,!m),L+=8;break;case 1:S=!!w.getUint8(1),L+=1;break;case 2:var V=_.parseString(g,y+1,f-1);S=V.data,L+=V.size;break;case 3:S={};var K=0;for((16777215&w.getUint32(f-4,!m))==9&&(K=3);L<f-4;){var W=_.parseObject(g,y+L,f-L-K);if(W.objectEnd)break;S[W.data.name]=W.data.value,L+=W.size}L<=f-3&&(16777215&w.getUint32(L-1,!m))===9&&(L+=3);break;case 8:for(S={},L+=4,K=0,(16777215&w.getUint32(f-4,!m))==9&&(K=3);L<f-8;){var Y=_.parseVariable(g,y+L,f-L-K);if(Y.objectEnd)break;S[Y.data.name]=Y.data.value,L+=Y.size}L<=f-3&&(16777215&w.getUint32(L-1,!m))===9&&(L+=3);break;case 9:S=void 0,L=1,j=!0;break;case 10:S=[];var q=w.getUint32(1,!m);L+=4;for(var tt=0;tt<q;tt++){var lt=_.parseValue(g,y+L,f-L);S.push(lt.data),L+=lt.size}break;case 11:var st=_.parseDate(g,y+1,f-1);S=st.data,L+=st.size;break;case 12:var pt=_.parseString(g,y+1,f-1);S=pt.data,L+=pt.size;break;default:L=f,a.a.w("AMF","Unsupported AMF value type "+O)}}catch(ht){a.a.e("AMF",ht.toString())}return{data:S,size:L,objectEnd:j}},_}(),E=function(){function _(g){this.TAG="ExpGolomb",this._buffer=g,this._buffer_index=0,this._total_bytes=g.byteLength,this._total_bits=8*g.byteLength,this._current_word=0,this._current_word_bits_left=0}return _.prototype.destroy=function(){this._buffer=null},_.prototype._fillCurrentWord=function(){var g=this._total_bytes-this._buffer_index;if(g<=0)throw new p.a("ExpGolomb: _fillCurrentWord() but no bytes available");var y=Math.min(4,g),f=new Uint8Array(4);f.set(this._buffer.subarray(this._buffer_index,this._buffer_index+y)),this._current_word=new DataView(f.buffer).getUint32(0,!1),this._buffer_index+=y,this._current_word_bits_left=8*y},_.prototype.readBits=function(g){if(g>32)throw new p.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(g<=this._current_word_bits_left){var y=this._current_word>>>32-g;return this._current_word<<=g,this._current_word_bits_left-=g,y}var f=this._current_word_bits_left?this._current_word:0;f>>>=32-this._current_word_bits_left;var S=g-this._current_word_bits_left;this._fillCurrentWord();var w=Math.min(S,this._current_word_bits_left),L=this._current_word>>>32-w;return this._current_word<<=w,this._current_word_bits_left-=w,f=f<<w|L},_.prototype.readBool=function(){return this.readBits(1)===1},_.prototype.readByte=function(){return this.readBits(8)},_.prototype._skipLeadingZero=function(){var g;for(g=0;g<this._current_word_bits_left;g++)if((this._current_word&2147483648>>>g)!=0)return this._current_word<<=g,this._current_word_bits_left-=g,g;return this._fillCurrentWord(),g+this._skipLeadingZero()},_.prototype.readUEG=function(){var g=this._skipLeadingZero();return this.readBits(g+1)-1},_.prototype.readSEG=function(){var g=this.readUEG();return 1&g?g+1>>>1:-1*(g>>>1)},_}(),C=function(){function _(){}return _._ebsp2rbsp=function(g){for(var y=g,f=y.byteLength,S=new Uint8Array(f),w=0,L=0;L<f;L++)L>=2&&y[L]===3&&y[L-1]===0&&y[L-2]===0||(S[w]=y[L],w++);return new Uint8Array(S.buffer,0,w)},_.parseSPS=function(g){for(var y=g.subarray(1,4),f="avc1.",S=0;S<3;S++){var w=y[S].toString(16);w.length<2&&(w="0"+w),f+=w}var L=_._ebsp2rbsp(g),O=new E(L);O.readByte();var j=O.readByte();O.readByte();var V=O.readByte();O.readUEG();var K=_.getProfileString(j),W=_.getLevelString(V),Y=1,q=420,tt=8,lt=8;if((j===100||j===110||j===122||j===244||j===44||j===83||j===86||j===118||j===128||j===138||j===144)&&((Y=O.readUEG())===3&&O.readBits(1),Y<=3&&(q=[0,420,422,444][Y]),tt=O.readUEG()+8,lt=O.readUEG()+8,O.readBits(1),O.readBool()))for(var st=Y!==3?8:12,pt=0;pt<st;pt++)O.readBool()&&(pt<6?_._skipScalingList(O,16):_._skipScalingList(O,64));O.readUEG();var ht=O.readUEG();if(ht===0)O.readUEG();else if(ht===1){O.readBits(1),O.readSEG(),O.readSEG();var ct=O.readUEG();for(pt=0;pt<ct;pt++)O.readSEG()}var Lt=O.readUEG();O.readBits(1);var kt=O.readUEG(),dt=O.readUEG(),vt=O.readBits(1);vt===0&&O.readBits(1),O.readBits(1);var Ct=0,St=0,bt=0,Ut=0;O.readBool()&&(Ct=O.readUEG(),St=O.readUEG(),bt=O.readUEG(),Ut=O.readUEG());var Wt=1,Rt=1,Bt=0,qt=!0,te=0,Ve=0;if(O.readBool()){if(O.readBool()){var be=O.readByte();be>0&&be<16?(Wt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][be-1],Rt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][be-1]):be===255&&(Wt=O.readByte()<<8|O.readByte(),Rt=O.readByte()<<8|O.readByte())}if(O.readBool()&&O.readBool(),O.readBool()&&(O.readBits(4),O.readBool()&&O.readBits(24)),O.readBool()&&(O.readUEG(),O.readUEG()),O.readBool()){var $e=O.readBits(32),Xe=O.readBits(32);qt=O.readBool(),Bt=(te=Xe)/(Ve=2*$e)}}var ze=1;Wt===1&&Rt===1||(ze=Wt/Rt);var oe=0,Ot=0;Y===0?(oe=1,Ot=2-vt):(oe=Y===3?1:2,Ot=(Y===1?2:1)*(2-vt));var Oe=16*(kt+1),Ne=16*(dt+1)*(2-vt);Oe-=(Ct+St)*oe,Ne-=(bt+Ut)*Ot;var Si=Math.ceil(Oe*ze);return O.destroy(),O=null,{codec_mimetype:f,profile_idc:j,level_idc:V,profile_string:K,level_string:W,chroma_format_idc:Y,bit_depth:tt,bit_depth_luma:tt,bit_depth_chroma:lt,ref_frames:Lt,chroma_format:q,chroma_format_string:_.getChromaFormatString(q),frame_rate:{fixed:qt,fps:Bt,fps_den:Ve,fps_num:te},sar_ratio:{width:Wt,height:Rt},codec_size:{width:Oe,height:Ne},present_size:{width:Si,height:Ne}}},_._skipScalingList=function(g,y){for(var f=8,S=8,w=0;w<y;w++)S!==0&&(S=(f+g.readSEG()+256)%256),f=S===0?f:S},_.getProfileString=function(g){switch(g){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},_.getLevelString=function(g){return(g/10).toFixed(1)},_.getChromaFormatString=function(g){switch(g){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},_}(),N=s(5),R=function(){function _(){}return _._ebsp2rbsp=function(g){for(var y=g,f=y.byteLength,S=new Uint8Array(f),w=0,L=0;L<f;L++)L>=2&&y[L]===3&&y[L-1]===0&&y[L-2]===0||(S[w]=y[L],w++);return new Uint8Array(S.buffer,0,w)},_.parseVPS=function(g){var y=_._ebsp2rbsp(g),f=new E(y);return f.readByte(),f.readByte(),f.readBits(4),f.readBits(2),f.readBits(6),{num_temporal_layers:f.readBits(3)+1,temporal_id_nested:f.readBool()}},_.parseSPS=function(g){var y=_._ebsp2rbsp(g),f=new E(y);f.readByte(),f.readByte();for(var S=0,w=0,L=0,O=0,j=(f.readBits(4),f.readBits(3)),V=(f.readBool(),f.readBits(2)),K=f.readBool(),W=f.readBits(5),Y=f.readByte(),q=f.readByte(),tt=f.readByte(),lt=f.readByte(),st=f.readByte(),pt=f.readByte(),ht=f.readByte(),ct=f.readByte(),Lt=f.readByte(),kt=f.readByte(),dt=f.readByte(),vt=[],Ct=[],St=0;St<j;St++)vt.push(f.readBool()),Ct.push(f.readBool());if(j>0)for(St=j;St<8;St++)f.readBits(2);for(St=0;St<j;St++)vt[St]&&(f.readByte(),f.readByte(),f.readByte(),f.readByte(),f.readByte(),f.readByte(),f.readByte(),f.readByte(),f.readByte(),f.readByte(),f.readByte()),Ct[St]&&f.readByte();f.readUEG();var bt=f.readUEG();bt==3&&f.readBits(1);var Ut=f.readUEG(),Wt=f.readUEG();f.readBool()&&(S+=f.readUEG(),w+=f.readUEG(),L+=f.readUEG(),O+=f.readUEG());var Rt=f.readUEG(),Bt=f.readUEG(),qt=f.readUEG();for(St=f.readBool()?0:j;St<=j;St++)f.readUEG(),f.readUEG(),f.readUEG();if(f.readUEG(),f.readUEG(),f.readUEG(),f.readUEG(),f.readUEG(),f.readUEG(),f.readBool()&&f.readBool())for(var te=0;te<4;te++)for(var Ve=0;Ve<(te===3?2:6);Ve++)if(f.readBool()){var be=Math.min(64,1<<4+(te<<1));for(te>1&&f.readSEG(),St=0;St<be;St++)f.readSEG()}else f.readUEG();f.readBool(),f.readBool(),f.readBool()&&(f.readByte(),f.readUEG(),f.readUEG(),f.readBool());var $e=f.readUEG(),Xe=0;for(St=0;St<$e;St++){var ze=!1;if(St!==0&&(ze=f.readBool()),ze){St===$e&&f.readUEG(),f.readBool(),f.readUEG();for(var oe=0,Ot=0;Ot<=Xe;Ot++){var Oe=f.readBool(),Ne=!1;Oe||(Ne=f.readBool()),(Oe||Ne)&&oe++}Xe=oe}else{var Si=f.readUEG(),rs=f.readUEG();for(Xe=Si+rs,Ot=0;Ot<Si;Ot++)f.readUEG(),f.readBool();for(Ot=0;Ot<rs;Ot++)f.readUEG(),f.readBool()}}if(f.readBool()){var Ea=f.readUEG();for(St=0;St<Ea;St++){for(Ot=0;Ot<qt+4;Ot++)f.readBits(1);f.readBits(1)}}var ss=0,ci=1,di=1,ns=!1,Zi=1,Ji=1;if(f.readBool(),f.readBool(),f.readBool()){if(f.readBool()){var ui=f.readByte();ui>0&&ui<=16?(ci=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ui-1],di=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ui-1]):ui===255&&(ci=f.readBits(16),di=f.readBits(16))}if(f.readBool()&&f.readBool(),f.readBool()&&(f.readBits(3),f.readBool(),f.readBool()&&(f.readByte(),f.readByte(),f.readByte())),f.readBool()&&(f.readUEG(),f.readUEG()),f.readBool(),f.readBool(),f.readBool(),f.readBool()&&(f.readUEG(),f.readUEG(),f.readUEG(),f.readUEG()),f.readBool()&&(Zi=f.readBits(32),Ji=f.readBits(32),f.readBool()&&(f.readUEG(),f.readBool()))){var tr=!1,er=!1,xi=!1;for(tr=f.readBool(),er=f.readBool(),(tr||er)&&((xi=f.readBool())&&(f.readByte(),f.readBits(5),f.readBool(),f.readBits(5)),f.readBits(4),f.readBits(4),xi&&f.readBits(4),f.readBits(5),f.readBits(5),f.readBits(5)),St=0;St<=j;St++){var as=f.readBool();ns=as;var os=!1,ir=1;as||(os=f.readBool());var ls=!1;if(os?f.readSEG():ls=f.readBool(),ls||(ir=f.readUEG()+1),tr)for(Ot=0;Ot<ir;Ot++)f.readUEG(),f.readUEG(),xi&&(f.readUEG(),f.readUEG());if(er)for(Ot=0;Ot<ir;Ot++)f.readUEG(),f.readUEG(),xi&&(f.readUEG(),f.readUEG())}}f.readBool()&&(f.readBool(),f.readBool(),f.readBool(),ss=f.readUEG(),f.readUEG(),f.readUEG(),f.readUEG(),f.readUEG())}f.readBool();var Sa="hvc1."+W+".1.L"+dt+".B0",cs=Ut-(S+w)*(bt===1||bt===2?2:1),ds=Wt-(L+O)*(bt===1?2:1),us=1;return ci!==1&&di!==1&&(us=ci/di),f.destroy(),f=null,{codec_mimetype:Sa,level_string:_.getLevelString(dt),profile_idc:W,bit_depth:Rt+8,ref_frames:1,chroma_format:bt,chroma_format_string:_.getChromaFormatString(bt),general_level_idc:dt,general_profile_space:V,general_tier_flag:K,general_profile_idc:W,general_profile_compatibility_flags_1:Y,general_profile_compatibility_flags_2:q,general_profile_compatibility_flags_3:tt,general_profile_compatibility_flags_4:lt,general_constraint_indicator_flags_1:st,general_constraint_indicator_flags_2:pt,general_constraint_indicator_flags_3:ht,general_constraint_indicator_flags_4:ct,general_constraint_indicator_flags_5:Lt,general_constraint_indicator_flags_6:kt,min_spatial_segmentation_idc:ss,constant_frame_rate:0,chroma_format_idc:bt,bit_depth_luma_minus8:Rt,bit_depth_chroma_minus8:Bt,frame_rate:{fixed:ns,fps:Ji/Zi,fps_den:Zi,fps_num:Ji},sar_ratio:{width:ci,height:di},codec_size:{width:cs,height:ds},present_size:{width:cs*us,height:ds}}},_.parsePPS=function(g){var y=_._ebsp2rbsp(g),f=new E(y);f.readByte(),f.readByte(),f.readUEG(),f.readUEG(),f.readBool(),f.readBool(),f.readBits(3),f.readBool(),f.readBool(),f.readUEG(),f.readUEG(),f.readSEG(),f.readBool(),f.readBool(),f.readBool()&&f.readUEG(),f.readSEG(),f.readSEG(),f.readBool(),f.readBool(),f.readBool(),f.readBool();var S=f.readBool(),w=f.readBool(),L=1;return w&&S?L=0:w?L=3:S&&(L=2),{parallelismType:L}},_.getChromaFormatString=function(g){switch(g){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},_.getProfileString=function(g){switch(g){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},_.getLevelString=function(g){return(g/30).toFixed(1)},_}();function x(_){return _.byteOffset%2==0&&_.byteLength%2==0}function P(_){return _.byteOffset%4==0&&_.byteLength%4==0}function M(_,g){for(var y=0;y<_.length;y++)if(_[y]!==g[y])return!1;return!0}var b=function(_,g){return _.byteLength===g.byteLength&&(P(_)&&P(g)?function(y,f){return M(new Uint32Array(y.buffer,y.byteOffset,y.byteLength/4),new Uint32Array(f.buffer,f.byteOffset,f.byteLength/4))}(_,g):x(_)&&x(g)?function(y,f){return M(new Uint16Array(y.buffer,y.byteOffset,y.byteLength/2),new Uint16Array(f.buffer,f.byteOffset,f.byteLength/2))}(_,g):function(y,f){return M(y,f)}(_,g))},T,I=function(){function _(g,y){this.TAG="FLVDemuxer",this._config=y,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=g.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=g.hasAudioTrack,this._hasVideo=g.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new o.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var f=new ArrayBuffer(2);return new DataView(f).setInt16(0,256,!0),new Int16Array(f)[0]===256}()}return _.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},_.probe=function(g){var y=new Uint8Array(g);if(y.byteLength<9)return{needMoreData:!0};var f={match:!1};if(y[0]!==70||y[1]!==76||y[2]!==86||y[3]!==1)return f;var S,w,L=(4&y[4])>>>2!=0,O=(1&y[4])!=0,j=(S=y)[w=5]<<24|S[w+1]<<16|S[w+2]<<8|S[w+3];return j<9?f:{match:!0,consumed:j,dataOffset:j,hasAudioTrack:L,hasVideoTrack:O}},_.prototype.bindDataSource=function(g){return g.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(_.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(g){this._onTrackMetadata=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(g){this._onMediaInfo=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(g){this._onMetaDataArrived=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(g){this._onScriptDataArrived=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onError",{get:function(){return this._onError},set:function(g){this._onError=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(g){this._onDataAvailable=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(g){this._timestampBase=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedDuration",{get:function(){return this._duration},set:function(g){this._durationOverrided=!0,this._duration=g,this._mediaInfo.duration=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedHasAudio",{set:function(g){this._hasAudioFlagOverrided=!0,this._hasAudio=g,this._mediaInfo.hasAudio=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedHasVideo",{set:function(g){this._hasVideoFlagOverrided=!0,this._hasVideo=g,this._mediaInfo.hasVideo=g},enumerable:!1,configurable:!0}),_.prototype.resetMediaInfo=function(){this._mediaInfo=new o.a},_.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},_.prototype.parseChunks=function(g,y){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new p.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var f=0,S=this._littleEndian;if(y===0){if(!(g.byteLength>13))return 0;f=_.probe(g).dataOffset}for(this._firstParse&&(this._firstParse=!1,y+f!==this._dataOffset&&a.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(w=new DataView(g,f)).getUint32(0,!S)!==0&&a.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),f+=4);f<g.byteLength;){this._dispatch=!0;var w=new DataView(g,f);if(f+11+4>g.byteLength)break;var L=w.getUint8(0),O=16777215&w.getUint32(0,!S);if(f+11+O+4>g.byteLength)break;if(L===8||L===9||L===18){var j=w.getUint8(4),V=w.getUint8(5),K=w.getUint8(6)|V<<8|j<<16|w.getUint8(7)<<24;(16777215&w.getUint32(7,!S))!==0&&a.a.w(this.TAG,"Meet tag which has StreamID != 0!");var W=f+11;switch(L){case 8:this._parseAudioData(g,W,O,K);break;case 9:this._parseVideoData(g,W,O,K,y+f);break;case 18:this._parseScriptData(g,W,O)}var Y=w.getUint32(11+O,!S);Y!==11+O&&a.a.w(this.TAG,"Invalid PrevTagSize "+Y),f+=11+O+4}else a.a.w(this.TAG,"Unsupported tag type "+L+", skipped"),f+=11+O+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),f},_.prototype._parseScriptData=function(g,y,f){var S=v.parseScriptData(g,y,f);if(S.hasOwnProperty("onMetaData")){if(S.onMetaData==null||typeof S.onMetaData!="object")return void a.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&a.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=S;var w=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},w)),typeof w.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=w.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof w.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=w.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof w.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=w.audiodatarate),typeof w.videodatarate=="number"&&(this._mediaInfo.videoDataRate=w.videodatarate),typeof w.width=="number"&&(this._mediaInfo.width=w.width),typeof w.height=="number"&&(this._mediaInfo.height=w.height),typeof w.duration=="number"){if(!this._durationOverrided){var L=Math.floor(w.duration*this._timescale);this._duration=L,this._mediaInfo.duration=L}}else this._mediaInfo.duration=0;if(typeof w.framerate=="number"){var O=Math.floor(1e3*w.framerate);if(O>0){var j=O/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=j,this._referenceFrameRate.fps_num=O,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=j}}if(typeof w.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var V=w.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(V),w.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=w,a.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(S).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},S))},_.prototype._parseKeyframesIndex=function(g){for(var y=[],f=[],S=1;S<g.times.length;S++){var w=this._timestampBase+Math.floor(1e3*g.times[S]);y.push(w),f.push(g.filepositions[S])}return{times:y,filepositions:f}},_.prototype._parseAudioData=function(g,y,f,S){if(f<=1)a.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var w=new DataView(g,y,f).getUint8(0),L=w>>>4;if(L===2||L===10){var O=0,j=(12&w)>>>2;if(j>=0&&j<=4){O=this._flvSoundRateTable[j];var V=1&w,K=this._audioMetadata,W=this._audioTrack;if(K||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(K=this._audioMetadata={}).type="audio",K.id=W.id,K.timescale=this._timescale,K.duration=this._duration,K.audioSampleRate=O,K.channelCount=V===0?1:2),L===10){var Y=this._parseAACAudioData(g,y+1,f-1);if(Y==null)return;if(Y.packetType===0){if(K.config){if(b(Y.data.config,K.config))return;a.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var q=Y.data;K.audioSampleRate=q.samplingRate,K.channelCount=q.channelCount,K.codec=q.codec,K.originalCodec=q.originalCodec,K.config=q.config,K.refSampleDuration=1024/K.audioSampleRate*K.timescale,a.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",K),(st=this._mediaInfo).audioCodec=K.originalCodec,st.audioSampleRate=K.audioSampleRate,st.audioChannelCount=K.channelCount,st.hasVideo?st.videoCodec!=null&&(st.mimeType='video/x-flv; codecs="'+st.videoCodec+","+st.audioCodec+'"'):st.mimeType='video/x-flv; codecs="'+st.audioCodec+'"',st.isComplete()&&this._onMediaInfo(st)}else if(Y.packetType===1){var tt=this._timestampBase+S,lt={unit:Y.data,length:Y.data.byteLength,dts:tt,pts:tt};W.samples.push(lt),W.length+=Y.data.length}else a.a.e(this.TAG,"Flv: Unsupported AAC data type "+Y.packetType)}else if(L===2){if(!K.codec){var st;if((q=this._parseMP3AudioData(g,y+1,f-1,!0))==null)return;K.audioSampleRate=q.samplingRate,K.channelCount=q.channelCount,K.codec=q.codec,K.originalCodec=q.originalCodec,K.refSampleDuration=1152/K.audioSampleRate*K.timescale,a.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",K),(st=this._mediaInfo).audioCodec=K.codec,st.audioSampleRate=K.audioSampleRate,st.audioChannelCount=K.channelCount,st.audioDataRate=q.bitRate,st.hasVideo?st.videoCodec!=null&&(st.mimeType='video/x-flv; codecs="'+st.videoCodec+","+st.audioCodec+'"'):st.mimeType='video/x-flv; codecs="'+st.audioCodec+'"',st.isComplete()&&this._onMediaInfo(st)}var pt=this._parseMP3AudioData(g,y+1,f-1,!1);if(pt==null)return;tt=this._timestampBase+S;var ht={unit:pt,length:pt.byteLength,dts:tt,pts:tt};W.samples.push(ht),W.length+=pt.length}}else this._onError(N.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+j)}else this._onError(N.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+L)}},_.prototype._parseAACAudioData=function(g,y,f){if(!(f<=1)){var S={},w=new Uint8Array(g,y,f);return S.packetType=w[0],w[0]===0?S.data=this._parseAACAudioSpecificConfig(g,y+1,f-1):S.data=w.subarray(1),S}a.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},_.prototype._parseAACAudioSpecificConfig=function(g,y,f){var S,w,L=new Uint8Array(g,y,f),O=null,j=0,V=null;if(j=S=L[0]>>>3,(w=(7&L[0])<<1|L[1]>>>7)<0||w>=this._mpegSamplingRates.length)this._onError(N.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var K=this._mpegSamplingRates[w],W=(120&L[1])>>>3;if(!(W<0||W>=8)){j===5&&(V=(7&L[1])<<1|L[2]>>>7,(124&L[2])>>>2);var Y=self.navigator.userAgent.toLowerCase();return Y.indexOf("firefox")!==-1?w>=6?(j=5,O=new Array(4),V=w-3):(j=2,O=new Array(2),V=w):Y.indexOf("android")!==-1?(j=2,O=new Array(2),V=w):(j=5,V=w,O=new Array(4),w>=6?V=w-3:W===1&&(j=2,O=new Array(2),V=w)),O[0]=j<<3,O[0]|=(15&w)>>>1,O[1]=(15&w)<<7,O[1]|=(15&W)<<3,j===5&&(O[1]|=(15&V)>>>1,O[2]=(1&V)<<7,O[2]|=8,O[3]=0),{config:O,samplingRate:K,channelCount:W,codec:"mp4a.40."+j,originalCodec:"mp4a.40."+S}}this._onError(N.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},_.prototype._parseMP3AudioData=function(g,y,f,S){if(!(f<4)){this._littleEndian;var w=new Uint8Array(g,y,f),L=null;if(S){if(w[0]!==255)return;var O=w[1]>>>3&3,j=(6&w[1])>>1,V=(240&w[2])>>>4,K=(12&w[2])>>>2,W=(w[3]>>>6&3)!==3?2:1,Y=0,q=0;switch(O){case 0:Y=this._mpegAudioV25SampleRateTable[K];break;case 2:Y=this._mpegAudioV20SampleRateTable[K];break;case 3:Y=this._mpegAudioV10SampleRateTable[K]}switch(j){case 1:V<this._mpegAudioL3BitRateTable.length&&(q=this._mpegAudioL3BitRateTable[V]);break;case 2:V<this._mpegAudioL2BitRateTable.length&&(q=this._mpegAudioL2BitRateTable[V]);break;case 3:V<this._mpegAudioL1BitRateTable.length&&(q=this._mpegAudioL1BitRateTable[V])}L={bitRate:q,samplingRate:Y,channelCount:W,codec:"mp3",originalCodec:"mp3"}}else L=w;return L}a.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},_.prototype._parseVideoData=function(g,y,f,S,w){if(f<=1)a.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var L=new Uint8Array(g,y,f)[0],O=(112&L)>>>4;if((128&L)!=0){var j=15&L,V=String.fromCharCode.apply(String,new Uint8Array(g,y,f).slice(1,5));if(V!=="hvc1")return void this._onError(N.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+V);this._parseEnhancedHEVCVideoPacket(g,y+5,f-5,S,w,O,j)}else{var K=15&L;if(K===7)this._parseAVCVideoPacket(g,y+1,f-1,S,w,O);else{if(K!==12)return void this._onError(N.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+K);this._parseHEVCVideoPacket(g,y+1,f-1,S,w,O)}}}},_.prototype._parseAVCVideoPacket=function(g,y,f,S,w,L){if(f<4)a.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var O=this._littleEndian,j=new DataView(g,y,f),V=j.getUint8(0),K=(16777215&j.getUint32(0,!O))<<8>>8;if(V===0)this._parseAVCDecoderConfigurationRecord(g,y+4,f-4);else if(V===1)this._parseAVCVideoData(g,y+4,f-4,S,w,L,K);else if(V!==2)return void this._onError(N.a.FORMAT_ERROR,"Flv: Invalid video packet type "+V)}},_.prototype._parseHEVCVideoPacket=function(g,y,f,S,w,L){if(f<4)a.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var O=this._littleEndian,j=new DataView(g,y,f),V=j.getUint8(0),K=(16777215&j.getUint32(0,!O))<<8>>8;if(V===0)this._parseHEVCDecoderConfigurationRecord(g,y+4,f-4);else if(V===1)this._parseHEVCVideoData(g,y+4,f-4,S,w,L,K);else if(V!==2)return void this._onError(N.a.FORMAT_ERROR,"Flv: Invalid video packet type "+V)}},_.prototype._parseEnhancedHEVCVideoPacket=function(g,y,f,S,w,L,O){if(f<4)a.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var j=this._littleEndian,V=new DataView(g,y,f);if(O===0)this._parseHEVCDecoderConfigurationRecord(g,y,f);else if(O===1){var K=(4294967040&V.getUint32(0,!j))>>8;this._parseHEVCVideoData(g,y+3,f-3,S,w,L,K)}else if(O===3)this._parseHEVCVideoData(g,y,f,S,w,L,0);else if(O!==2)return void this._onError(N.a.FORMAT_ERROR,"Flv: Invalid video packet type "+O)}},_.prototype._parseAVCDecoderConfigurationRecord=function(g,y,f){if(f<7)a.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var S=this._videoMetadata,w=this._videoTrack,L=this._littleEndian,O=new DataView(g,y,f);if(S){if(S.avcc!==void 0){var j=new Uint8Array(g,y,f);if(b(j,S.avcc))return;a.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(S=this._videoMetadata={}).type="video",S.id=w.id,S.timescale=this._timescale,S.duration=this._duration;var V=O.getUint8(0),K=O.getUint8(1);if(O.getUint8(2),O.getUint8(3),V===1&&K!==0)if(this._naluLengthSize=1+(3&O.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var W=31&O.getUint8(5);if(W!==0){W>1&&a.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+W);for(var Y=6,q=0;q<W;q++){var tt=O.getUint16(Y,!L);if(Y+=2,tt!==0){var lt=new Uint8Array(g,y+Y,tt);Y+=tt;var st=C.parseSPS(lt);if(q===0){S.codecWidth=st.codec_size.width,S.codecHeight=st.codec_size.height,S.presentWidth=st.present_size.width,S.presentHeight=st.present_size.height,S.profile=st.profile_string,S.level=st.level_string,S.bitDepth=st.bit_depth,S.chromaFormat=st.chroma_format,S.sarRatio=st.sar_ratio,S.frameRate=st.frame_rate,st.frame_rate.fixed!==!1&&st.frame_rate.fps_num!==0&&st.frame_rate.fps_den!==0||(S.frameRate=this._referenceFrameRate);var pt=S.frameRate.fps_den,ht=S.frameRate.fps_num;S.refSampleDuration=S.timescale*(pt/ht);for(var ct=lt.subarray(1,4),Lt="avc1.",kt=0;kt<3;kt++){var dt=ct[kt].toString(16);dt.length<2&&(dt="0"+dt),Lt+=dt}S.codec=Lt;var vt=this._mediaInfo;vt.width=S.codecWidth,vt.height=S.codecHeight,vt.fps=S.frameRate.fps,vt.profile=S.profile,vt.level=S.level,vt.refFrames=st.ref_frames,vt.chromaFormat=st.chroma_format_string,vt.sarNum=S.sarRatio.width,vt.sarDen=S.sarRatio.height,vt.videoCodec=Lt,vt.hasAudio?vt.audioCodec!=null&&(vt.mimeType='video/x-flv; codecs="'+vt.videoCodec+","+vt.audioCodec+'"'):vt.mimeType='video/x-flv; codecs="'+vt.videoCodec+'"',vt.isComplete()&&this._onMediaInfo(vt)}}}var Ct=O.getUint8(Y);if(Ct!==0){for(Ct>1&&a.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+Ct),Y++,q=0;q<Ct;q++)tt=O.getUint16(Y,!L),Y+=2,tt!==0&&(Y+=tt);S.avcc=new Uint8Array(f),S.avcc.set(new Uint8Array(g,y,f),0),a.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",S)}else this._onError(N.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(N.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(N.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(N.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},_.prototype._parseHEVCDecoderConfigurationRecord=function(g,y,f){if(f<22)a.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var S=this._videoMetadata,w=this._videoTrack,L=this._littleEndian,O=new DataView(g,y,f);if(S){if(S.hvcc!==void 0){var j=new Uint8Array(g,y,f);if(b(j,S.hvcc))return;a.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(S=this._videoMetadata={}).type="video",S.id=w.id,S.timescale=this._timescale,S.duration=this._duration;var V=O.getUint8(0),K=31&O.getUint8(1);if(V===1&&K!==0)if(this._naluLengthSize=1+(3&O.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var W=O.getUint8(22),Y=0,q=23;Y<W;Y++){var tt=63&O.getUint8(q+0),lt=O.getUint16(q+1,!L);q+=3;for(var st=0;st<lt;st++){var pt=O.getUint16(q+0,!L);if(st===0)if(tt===33){q+=2;var ht=new Uint8Array(g,y+q,pt),ct=R.parseSPS(ht);S.codecWidth=ct.codec_size.width,S.codecHeight=ct.codec_size.height,S.presentWidth=ct.present_size.width,S.presentHeight=ct.present_size.height,S.profile=ct.profile_string,S.level=ct.level_string,S.bitDepth=ct.bit_depth,S.chromaFormat=ct.chroma_format,S.sarRatio=ct.sar_ratio,S.frameRate=ct.frame_rate,ct.frame_rate.fixed!==!1&&ct.frame_rate.fps_num!==0&&ct.frame_rate.fps_den!==0||(S.frameRate=this._referenceFrameRate);var Lt=S.frameRate.fps_den,kt=S.frameRate.fps_num;S.refSampleDuration=S.timescale*(Lt/kt),S.codec=ct.codec_mimetype;var dt=this._mediaInfo;dt.width=S.codecWidth,dt.height=S.codecHeight,dt.fps=S.frameRate.fps,dt.profile=S.profile,dt.level=S.level,dt.refFrames=ct.ref_frames,dt.chromaFormat=ct.chroma_format_string,dt.sarNum=S.sarRatio.width,dt.sarDen=S.sarRatio.height,dt.videoCodec=ct.codec_mimetype,dt.hasAudio?dt.audioCodec!=null&&(dt.mimeType='video/x-flv; codecs="'+dt.videoCodec+","+dt.audioCodec+'"'):dt.mimeType='video/x-flv; codecs="'+dt.videoCodec+'"',dt.isComplete()&&this._onMediaInfo(dt),q+=pt}else q+=2+pt;else q+=2+pt}}S.hvcc=new Uint8Array(f),S.hvcc.set(new Uint8Array(g,y,f),0),a.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",S)}else this._onError(N.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(N.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord")}},_.prototype._parseAVCVideoData=function(g,y,f,S,w,L,O){for(var j=this._littleEndian,V=new DataView(g,y,f),K=[],W=0,Y=0,q=this._naluLengthSize,tt=this._timestampBase+S,lt=L===1;Y<f;){if(Y+4>=f){a.a.w(this.TAG,"Malformed Nalu near timestamp "+tt+", offset = "+Y+", dataSize = "+f);break}var st=V.getUint32(Y,!j);if(q===3&&(st>>>=8),st>f-q)return void a.a.w(this.TAG,"Malformed Nalus near timestamp "+tt+", NaluSize > DataSize!");var pt=31&V.getUint8(Y+q);pt===5&&(lt=!0);var ht=new Uint8Array(g,y+Y,q+st),ct={type:pt,data:ht};K.push(ct),W+=ht.byteLength,Y+=q+st}if(K.length){var Lt=this._videoTrack,kt={units:K,length:W,isKeyframe:lt,dts:tt,cts:O,pts:tt+O};lt&&(kt.fileposition=w),Lt.samples.push(kt),Lt.length+=W}},_.prototype._parseHEVCVideoData=function(g,y,f,S,w,L,O){for(var j=this._littleEndian,V=new DataView(g,y,f),K=[],W=0,Y=0,q=this._naluLengthSize,tt=this._timestampBase+S,lt=L===1;Y<f;){if(Y+4>=f){a.a.w(this.TAG,"Malformed Nalu near timestamp "+tt+", offset = "+Y+", dataSize = "+f);break}var st=V.getUint32(Y,!j);if(q===3&&(st>>>=8),st>f-q)return void a.a.w(this.TAG,"Malformed Nalus near timestamp "+tt+", NaluSize > DataSize!");var pt=31&V.getUint8(Y+q);pt!==19&&pt!==20||(lt=!0);var ht=new Uint8Array(g,y+Y,q+st),ct={type:pt,data:ht};K.push(ct),W+=ht.byteLength,Y+=q+st}if(K.length){var Lt=this._videoTrack,kt={units:K,length:W,isKeyframe:lt,dts:tt,cts:O,pts:tt+O};lt&&(kt.fileposition=w),Lt.samples.push(kt),Lt.length+=W}},_}(),A=function(){function _(){}return _.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},_}(),U=function(){this.program_pmt_pid={}};(function(_){_[_.kMPEG1Audio=3]="kMPEG1Audio",_[_.kMPEG2Audio=4]="kMPEG2Audio",_[_.kPESPrivateData=6]="kPESPrivateData",_[_.kADTSAAC=15]="kADTSAAC",_[_.kLOASAAC=17]="kLOASAAC",_[_.kAC3=129]="kAC3",_[_.kID3=21]="kID3",_[_.kSCTE35=134]="kSCTE35",_[_.kH264=27]="kH264",_[_.kH265=36]="kH265"})(T||(T={}));var B,$=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.scte_35_pids={},this.smpte2038_pids={}},X=function(){},nt=function(){},ot=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(_){_[_.kUnspecified=0]="kUnspecified",_[_.kSliceNonIDR=1]="kSliceNonIDR",_[_.kSliceDPA=2]="kSliceDPA",_[_.kSliceDPB=3]="kSliceDPB",_[_.kSliceDPC=4]="kSliceDPC",_[_.kSliceIDR=5]="kSliceIDR",_[_.kSliceSEI=6]="kSliceSEI",_[_.kSliceSPS=7]="kSliceSPS",_[_.kSlicePPS=8]="kSlicePPS",_[_.kSliceAUD=9]="kSliceAUD",_[_.kEndOfSequence=10]="kEndOfSequence",_[_.kEndOfStream=11]="kEndOfStream",_[_.kFiller=12]="kFiller",_[_.kSPSExt=13]="kSPSExt",_[_.kReserved0=14]="kReserved0"})(B||(B={}));var z,k,F=function(){},G=function(_){var g=_.data.byteLength;this.type=_.type,this.data=new Uint8Array(4+g),new DataView(this.data.buffer).setUint32(0,g),this.data.set(_.data,4)},Z=function(){function _(g){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=g,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return _.prototype.findNextStartCodeOffset=function(g){for(var y=g,f=this.data_;;){if(y+3>=f.byteLength)return this.eof_flag_=!0,f.byteLength;var S=f[y+0]<<24|f[y+1]<<16|f[y+2]<<8|f[y+3],w=f[y+0]<<16|f[y+1]<<8|f[y+2];if(S===1||w===1)return y;y++}},_.prototype.readNextNaluPayload=function(){for(var g=this.data_,y=null;y==null&&!this.eof_flag_;){var f=this.current_startcode_offset_,S=31&g[f+=(g[f]<<24|g[f+1]<<16|g[f+2]<<8|g[f+3])===1?4:3],w=(128&g[f])>>>7,L=this.findNextStartCodeOffset(f);if(this.current_startcode_offset_=L,!(S>=B.kReserved0)&&w===0){var O=g.subarray(f,L);(y=new F).type=S,y.data=O}}return y},_}(),rt=function(){function _(g,y,f){var S=8+g.byteLength+1+2+y.byteLength,w=!1;g[3]!==66&&g[3]!==77&&g[3]!==88&&(w=!0,S+=4);var L=this.data=new Uint8Array(S);L[0]=1,L[1]=g[1],L[2]=g[2],L[3]=g[3],L[4]=255,L[5]=225;var O=g.byteLength;L[6]=O>>>8,L[7]=255&O;var j=8;L.set(g,8),L[j+=O]=1;var V=y.byteLength;L[j+1]=V>>>8,L[j+2]=255&V,L.set(y,j+3),j+=3+V,w&&(L[j]=252|f.chroma_format_idc,L[j+1]=248|f.bit_depth_luma-8,L[j+2]=248|f.bit_depth_chroma-8,L[j+3]=0,j+=4)}return _.prototype.getData=function(){return this.data},_}();(function(_){_[_.kNull=0]="kNull",_[_.kAACMain=1]="kAACMain",_[_.kAAC_LC=2]="kAAC_LC",_[_.kAAC_SSR=3]="kAAC_SSR",_[_.kAAC_LTP=4]="kAAC_LTP",_[_.kAAC_SBR=5]="kAAC_SBR",_[_.kAAC_Scalable=6]="kAAC_Scalable",_[_.kLayer1=32]="kLayer1",_[_.kLayer2=33]="kLayer2",_[_.kLayer3=34]="kLayer3"})(z||(z={})),function(_){_[_.k96000Hz=0]="k96000Hz",_[_.k88200Hz=1]="k88200Hz",_[_.k64000Hz=2]="k64000Hz",_[_.k48000Hz=3]="k48000Hz",_[_.k44100Hz=4]="k44100Hz",_[_.k32000Hz=5]="k32000Hz",_[_.k24000Hz=6]="k24000Hz",_[_.k22050Hz=7]="k22050Hz",_[_.k16000Hz=8]="k16000Hz",_[_.k12000Hz=9]="k12000Hz",_[_.k11025Hz=10]="k11025Hz",_[_.k8000Hz=11]="k8000Hz",_[_.k7350Hz=12]="k7350Hz"}(k||(k={}));var ut,gt,It=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Dt=(ut=function(_,g){return(ut=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,f){y.__proto__=f}||function(y,f){for(var S in f)f.hasOwnProperty(S)&&(y[S]=f[S])})(_,g)},function(_,g){function y(){this.constructor=_}ut(_,g),_.prototype=g===null?Object.create(g):(y.prototype=g.prototype,new y)}),et=function(){},at=function(_){function g(){return _!==null&&_.apply(this,arguments)||this}return Dt(g,_),g}(et),ft=function(){function _(g){this.TAG="AACADTSParser",this.data_=g,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return _.prototype.findNextSyncwordOffset=function(g){for(var y=g,f=this.data_;;){if(y+7>=f.byteLength)return this.eof_flag_=!0,f.byteLength;if((f[y+0]<<8|f[y+1])>>>4===4095)return y;y++}},_.prototype.readNextAACFrame=function(){for(var g=this.data_,y=null;y==null&&!this.eof_flag_;){var f=this.current_syncword_offset_,S=(8&g[f+1])>>>3,w=(6&g[f+1])>>>1,L=1&g[f+1],O=(192&g[f+2])>>>6,j=(60&g[f+2])>>>2,V=(1&g[f+2])<<2|(192&g[f+3])>>>6,K=(3&g[f+3])<<11|g[f+4]<<3|(224&g[f+5])>>>5;if(g[f+6],f+K>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var W=L===1?7:9,Y=K-W;f+=W;var q=this.findNextSyncwordOffset(f+Y);if(this.current_syncword_offset_=q,(S===0||S===1)&&w===0){var tt=g.subarray(f,f+Y);(y=new et).audio_object_type=O+1,y.sampling_freq_index=j,y.sampling_frequency=It[j],y.channel_config=V,y.data=tt}}return y},_.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},_.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},_}(),yt=function(){function _(g){this.TAG="AACLOASParser",this.data_=g,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return _.prototype.findNextSyncwordOffset=function(g){for(var y=g,f=this.data_;;){if(y+1>=f.byteLength)return this.eof_flag_=!0,f.byteLength;if((f[y+0]<<3|f[y+1]>>>5)===695)return y;y++}},_.prototype.getLATMValue=function(g){for(var y=g.readBits(2),f=0,S=0;S<=y;S++)f<<=8,f|=g.readByte();return f},_.prototype.readNextAACFrame=function(g){for(var y=this.data_,f=null;f==null&&!this.eof_flag_;){var S=this.current_syncword_offset_,w=(31&y[S+1])<<8|y[S+2];if(S+3+w>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var L=new E(y.subarray(S+3,S+3+w)),O=null;if(L.readBool()){if(g==null){a.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(S+3+w),L.destroy();continue}O=g}else{var j=L.readBool();if(j&&L.readBool()){a.a.e(this.TAG,"audioMuxVersionA is Not Supported"),L.destroy();break}if(j&&this.getLATMValue(L),!L.readBool()){a.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),L.destroy();break}if(L.readBits(6)!==0){a.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),L.destroy();break}if(L.readBits(4)!==0){a.a.e(this.TAG,"more than 2 numProgram Not Supported"),L.destroy();break}if(L.readBits(3)!==0){a.a.e(this.TAG,"more than 2 numLayer Not Supported"),L.destroy();break}var V=j?this.getLATMValue(L):0,K=L.readBits(5);V-=5;var W=L.readBits(4);V-=4;var Y=L.readBits(4);V-=4,L.readBits(3),(V-=3)>0&&L.readBits(V);var q=L.readBits(3);if(q!==0){a.a.e(this.TAG,"frameLengthType = "+q+". Only frameLengthType = 0 Supported"),L.destroy();break}L.readByte();var tt=L.readBool();if(tt)if(j)this.getLATMValue(L);else{for(var lt=0;;){lt<<=8;var st=L.readBool();if(lt+=L.readByte(),!st)break}console.log(lt)}L.readBool()&&L.readByte(),(O=new at).audio_object_type=K,O.sampling_freq_index=W,O.sampling_frequency=It[O.sampling_freq_index],O.channel_config=Y,O.other_data_present=tt}for(var pt=0;;){var ht=L.readByte();if(pt+=ht,ht!==255)break}for(var ct=new Uint8Array(pt),Lt=0;Lt<pt;Lt++)ct[Lt]=L.readByte();(f=new at).audio_object_type=O.audio_object_type,f.sampling_freq_index=O.sampling_freq_index,f.sampling_frequency=It[O.sampling_freq_index],f.channel_config=O.channel_config,f.other_data_present=O.other_data_present,f.data=ct,this.current_syncword_offset_=this.findNextSyncwordOffset(S+3+w)}return f},_.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},_.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},_}(),_t=function(_){var g=null,y=_.audio_object_type,f=_.audio_object_type,S=_.sampling_freq_index,w=_.channel_config,L=0,O=navigator.userAgent.toLowerCase();O.indexOf("firefox")!==-1?S>=6?(f=5,g=new Array(4),L=S-3):(f=2,g=new Array(2),L=S):O.indexOf("android")!==-1?(f=2,g=new Array(2),L=S):(f=5,L=S,g=new Array(4),S>=6?L=S-3:w===1&&(f=2,g=new Array(2),L=S)),g[0]=f<<3,g[0]|=(15&S)>>>1,g[1]=(15&S)<<7,g[1]|=(15&w)<<3,f===5&&(g[1]|=(15&L)>>>1,g[2]=(1&L)<<7,g[2]|=8,g[3]=0),this.config=g,this.sampling_rate=It[S],this.channel_count=w,this.codec_mimetype="mp4a.40."+f,this.original_codec_mimetype="mp4a.40."+y},wt=function(){},Vt=function(){};(function(_){_[_.kSpliceNull=0]="kSpliceNull",_[_.kSpliceSchedule=4]="kSpliceSchedule",_[_.kSpliceInsert=5]="kSpliceInsert",_[_.kTimeSignal=6]="kTimeSignal",_[_.kBandwidthReservation=7]="kBandwidthReservation",_[_.kPrivateCommand=255]="kPrivateCommand"})(gt||(gt={}));var Ft,Jt=function(_){var g=_.readBool();return g?(_.readBits(6),{time_specified_flag:g,pts_time:4*_.readBits(31)+_.readBits(2)}):(_.readBits(7),{time_specified_flag:g})},Qt=function(_){var g=_.readBool();return _.readBits(6),{auto_return:g,duration:4*_.readBits(31)+_.readBits(2)}},Re=function(_,g){var y=g.readBits(8);return _?{component_tag:y}:{component_tag:y,splice_time:Jt(g)}},De=function(_){return{component_tag:_.readBits(8),utc_splice_time:_.readBits(32)}},Ce=function(_){var g=_.readBits(32),y=_.readBool();_.readBits(7);var f={splice_event_id:g,splice_event_cancel_indicator:y};if(y)return f;if(f.out_of_network_indicator=_.readBool(),f.program_splice_flag=_.readBool(),f.duration_flag=_.readBool(),_.readBits(5),f.program_splice_flag)f.utc_splice_time=_.readBits(32);else{f.component_count=_.readBits(8),f.components=[];for(var S=0;S<f.component_count;S++)f.components.push(De(_))}return f.duration_flag&&(f.break_duration=Qt(_)),f.unique_program_id=_.readBits(16),f.avail_num=_.readBits(8),f.avails_expected=_.readBits(8),f},fe=function(_,g,y,f){return{descriptor_tag:_,descriptor_length:g,identifier:y,provider_avail_id:f.readBits(32)}},Et=function(_,g,y,f){var S=f.readBits(8),w=f.readBits(3);f.readBits(5);for(var L="",O=0;O<w;O++)L+=String.fromCharCode(f.readBits(8));return{descriptor_tag:_,descriptor_length:g,identifier:y,preroll:S,dtmf_count:w,DTMF_char:L}},ke=function(_){var g=_.readBits(8);return _.readBits(7),{component_tag:g,pts_offset:4*_.readBits(31)+_.readBits(2)}},Me=function(_,g,y,f){var S=f.readBits(32),w=f.readBool();f.readBits(7);var L={descriptor_tag:_,descriptor_length:g,identifier:y,segmentation_event_id:S,segmentation_event_cancel_indicator:w};if(w)return L;if(L.program_segmentation_flag=f.readBool(),L.segmentation_duration_flag=f.readBool(),L.delivery_not_restricted_flag=f.readBool(),L.delivery_not_restricted_flag?f.readBits(5):(L.web_delivery_allowed_flag=f.readBool(),L.no_regional_blackout_flag=f.readBool(),L.archive_allowed_flag=f.readBool(),L.device_restrictions=f.readBits(2)),!L.program_segmentation_flag){L.component_count=f.readBits(8),L.components=[];for(var O=0;O<L.component_count;O++)L.components.push(ke(f))}L.segmentation_duration_flag&&(L.segmentation_duration=f.readBits(40)),L.segmentation_upid_type=f.readBits(8),L.segmentation_upid_length=f.readBits(8);var j=new Uint8Array(L.segmentation_upid_length);for(O=0;O<L.segmentation_upid_length;O++)j[O]=f.readBits(8);return L.segmentation_upid=j.buffer,L.segmentation_type_id=f.readBits(8),L.segment_num=f.readBits(8),L.segments_expected=f.readBits(8),L.segmentation_type_id!==52&&L.segmentation_type_id!==54&&L.segmentation_type_id!==56&&L.segmentation_type_id!==58||(L.sub_segment_num=f.readBits(8),L.sub_segments_expected=f.readBits(8)),L},Ge=function(_,g,y,f){return{descriptor_tag:_,descriptor_length:g,identifier:y,TAI_seconds:f.readBits(48),TAI_ns:f.readBits(32),UTC_offset:f.readBits(16)}},qe=function(_){return{component_tag:_.readBits(8),ISO_code:String.fromCharCode(_.readBits(8),_.readBits(8),_.readBits(8)),Bit_Stream_Mode:_.readBits(3),Num_Channels:_.readBits(4),Full_Srvc_Audio:_.readBool()}},ye=function(_,g,y,f){for(var S=f.readBits(4),w=[],L=0;L<S;L++)w.push(qe(f));return{descriptor_tag:_,descriptor_length:g,identifier:y,audio_count:S,components:w}},he=function(_){var g=new E(_),y=g.readBits(8),f=g.readBool(),S=g.readBool();g.readBits(2);var w=g.readBits(12),L=g.readBits(8),O=g.readBool(),j=g.readBits(6),V=4*g.readBits(31)+g.readBits(2),K=g.readBits(8),W=g.readBits(12),Y=g.readBits(12),q=g.readBits(8),tt=null;q===gt.kSpliceNull?tt={}:q===gt.kSpliceSchedule?tt=function(bt){for(var Ut=bt.readBits(8),Wt=[],Rt=0;Rt<Ut;Rt++)Wt.push(Ce(bt));return{splice_count:Ut,events:Wt}}(g):q===gt.kSpliceInsert?tt=function(bt){var Ut=bt.readBits(32),Wt=bt.readBool();bt.readBits(7);var Rt={splice_event_id:Ut,splice_event_cancel_indicator:Wt};if(Wt)return Rt;if(Rt.out_of_network_indicator=bt.readBool(),Rt.program_splice_flag=bt.readBool(),Rt.duration_flag=bt.readBool(),Rt.splice_immediate_flag=bt.readBool(),bt.readBits(4),Rt.program_splice_flag&&!Rt.splice_immediate_flag&&(Rt.splice_time=Jt(bt)),!Rt.program_splice_flag){Rt.component_count=bt.readBits(8),Rt.components=[];for(var Bt=0;Bt<Rt.component_count;Bt++)Rt.components.push(Re(Rt.splice_immediate_flag,bt))}return Rt.duration_flag&&(Rt.break_duration=Qt(bt)),Rt.unique_program_id=bt.readBits(16),Rt.avail_num=bt.readBits(8),Rt.avails_expected=bt.readBits(8),Rt}(g):q===gt.kTimeSignal?tt=function(bt){return{splice_time:Jt(bt)}}(g):q===gt.kBandwidthReservation?tt={}:q===gt.kPrivateCommand?tt=function(bt,Ut){for(var Wt=String.fromCharCode(Ut.readBits(8),Ut.readBits(8),Ut.readBits(8),Ut.readBits(8)),Rt=new Uint8Array(bt-4),Bt=0;Bt<bt-4;Bt++)Rt[Bt]=Ut.readBits(8);return{identifier:Wt,private_data:Rt.buffer}}(Y,g):g.readBits(8*Y);for(var lt=[],st=g.readBits(16),pt=0;pt<st;){var ht=g.readBits(8),ct=g.readBits(8),Lt=String.fromCharCode(g.readBits(8),g.readBits(8),g.readBits(8),g.readBits(8));ht===0?lt.push(fe(ht,ct,Lt,g)):ht===1?lt.push(Et(ht,ct,Lt,g)):ht===2?lt.push(Me(ht,ct,Lt,g)):ht===3?lt.push(Ge(ht,ct,Lt,g)):ht===4?lt.push(ye(ht,ct,Lt,g)):g.readBits(8*(ct-4)),pt+=2+ct}var kt={table_id:y,section_syntax_indicator:f,private_indicator:S,section_length:w,protocol_version:L,encrypted_packet:O,encryption_algorithm:j,pts_adjustment:V,cw_index:K,tier:W,splice_command_length:Y,splice_command_type:q,splice_command:tt,descriptor_loop_length:st,splice_descriptors:lt,E_CRC32:O?g.readBits(32):void 0,CRC32:g.readBits(32)};if(q===gt.kSpliceInsert){var dt=tt;if(dt.splice_event_cancel_indicator)return{splice_command_type:q,detail:kt,data:_};if(dt.program_splice_flag&&!dt.splice_immediate_flag){var vt=dt.duration_flag?dt.break_duration.auto_return:void 0,Ct=dt.duration_flag?dt.break_duration.duration/90:void 0;return dt.splice_time.time_specified_flag?{splice_command_type:q,pts:(V+dt.splice_time.pts_time)%Math.pow(2,33),auto_return:vt,duraiton:Ct,detail:kt,data:_}:{splice_command_type:q,auto_return:vt,duraiton:Ct,detail:kt,data:_}}return{splice_command_type:q,auto_return:vt=dt.duration_flag?dt.break_duration.auto_return:void 0,duraiton:Ct=dt.duration_flag?dt.break_duration.duration/90:void 0,detail:kt,data:_}}if(q===gt.kTimeSignal){var St=tt;return St.splice_time.time_specified_flag?{splice_command_type:q,pts:(V+St.splice_time.pts_time)%Math.pow(2,33),detail:kt,data:_}:{splice_command_type:q,detail:kt,data:_}}return{splice_command_type:q,detail:kt,data:_}};(function(_){_[_.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",_[_.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",_[_.kSliceCRA_NUT=21]="kSliceCRA_NUT",_[_.kSliceVPS=32]="kSliceVPS",_[_.kSliceSPS=33]="kSliceSPS",_[_.kSlicePPS=34]="kSlicePPS",_[_.kSliceAUD=35]="kSliceAUD"})(Ft||(Ft={}));var Te=function(){},$i=function(_){var g=_.data.byteLength;this.type=_.type,this.data=new Uint8Array(4+g),new DataView(this.data.buffer).setUint32(0,g),this.data.set(_.data,4)},zi=function(){function _(g){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=g,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return _.prototype.findNextStartCodeOffset=function(g){for(var y=g,f=this.data_;;){if(y+3>=f.byteLength)return this.eof_flag_=!0,f.byteLength;var S=f[y+0]<<24|f[y+1]<<16|f[y+2]<<8|f[y+3],w=f[y+0]<<16|f[y+1]<<8|f[y+2];if(S===1||w===1)return y;y++}},_.prototype.readNextNaluPayload=function(){for(var g=this.data_,y=null;y==null&&!this.eof_flag_;){var f=this.current_startcode_offset_,S=g[f+=(g[f]<<24|g[f+1]<<16|g[f+2]<<8|g[f+3])===1?4:3]>>1&63,w=(128&g[f])>>>7,L=this.findNextStartCodeOffset(f);if(this.current_startcode_offset_=L,w===0){var O=g.subarray(f,L);(y=new Te).type=S,y.data=O}}return y},_}(),Hi=function(){function _(g,y,f,S){var w=23+(5+g.byteLength)+(5+y.byteLength)+(5+f.byteLength),L=this.data=new Uint8Array(w);L[0]=1,L[1]=(3&S.general_profile_space)<<6|(S.general_tier_flag?1:0)<<5|31&S.general_profile_idc,L[2]=S.general_profile_compatibility_flags_1,L[3]=S.general_profile_compatibility_flags_2,L[4]=S.general_profile_compatibility_flags_3,L[5]=S.general_profile_compatibility_flags_4,L[6]=S.general_constraint_indicator_flags_1,L[7]=S.general_constraint_indicator_flags_2,L[8]=S.general_constraint_indicator_flags_3,L[9]=S.general_constraint_indicator_flags_4,L[10]=S.general_constraint_indicator_flags_5,L[11]=S.general_constraint_indicator_flags_6,L[12]=S.general_level_idc,L[13]=240|(3840&S.min_spatial_segmentation_idc)>>8,L[14]=255&S.min_spatial_segmentation_idc,L[15]=252|3&S.parallelismType,L[16]=252|3&S.chroma_format_idc,L[17]=248|7&S.bit_depth_luma_minus8,L[18]=248|7&S.bit_depth_chroma_minus8,L[19]=0,L[20]=0,L[21]=(3&S.constant_frame_rate)<<6|(7&S.num_temporal_layers)<<3|(S.temporal_id_nested?1:0)<<2|3,L[22]=3,L[23]=128|Ft.kSliceVPS,L[24]=0,L[25]=1,L[26]=(65280&g.byteLength)>>8,L[27]=(255&g.byteLength)>>0,L.set(g,28),L[23+(5+g.byteLength)+0]=128|Ft.kSliceSPS,L[23+(5+g.byteLength)+1]=0,L[23+(5+g.byteLength)+2]=1,L[23+(5+g.byteLength)+3]=(65280&y.byteLength)>>8,L[23+(5+g.byteLength)+4]=(255&y.byteLength)>>0,L.set(y,23+(5+g.byteLength)+5),L[23+(5+g.byteLength+5+y.byteLength)+0]=128|Ft.kSlicePPS,L[23+(5+g.byteLength+5+y.byteLength)+1]=0,L[23+(5+g.byteLength+5+y.byteLength)+2]=1,L[23+(5+g.byteLength+5+y.byteLength)+3]=(65280&f.byteLength)>>8,L[23+(5+g.byteLength+5+y.byteLength)+4]=(255&f.byteLength)>>0,L.set(f,23+(5+g.byteLength+5+y.byteLength)+5)}return _.prototype.getData=function(){return this.data},_}(),Yi=function(){},Ki=function(){},Wi=function(){},qi=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],Qi=function(){function _(g){this.TAG="AC3Parser",this.data_=g,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&a.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return _.prototype.findNextSyncwordOffset=function(g){for(var y=g,f=this.data_;;){if(y+7>=f.byteLength)return this.eof_flag_=!0,f.byteLength;if((f[y+0]<<8|f[y+1]<<0)===2935)return y;y++}},_.prototype.readNextAC3Frame=function(){for(var g=this.data_,y=null;y==null&&!this.eof_flag_;){var f=this.current_syncword_offset_,S=g[f+4]>>6,w=[48e3,44200,33e3][S],L=63&g[f+4],O=2*qi[S][L];if(f+O>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var j=this.findNextSyncwordOffset(f+O);this.current_syncword_offset_=j;var V=g[f+5]>>3,K=7&g[f+5],W=g[f+6]>>5,Y=0;(1&W)!=0&&W!==1&&(Y+=2),(4&W)!=0&&(Y+=2),W===2&&(Y+=2);var q=(g[f+6]<<8|g[f+7]<<0)>>12-Y&1,tt=[2,1,2,3,3,4,4,5][W]+q;(y=new Wi).sampling_frequency=w,y.channel_count=tt,y.channel_mode=W,y.bit_stream_identification=V,y.low_frequency_effects_channel_on=q,y.bit_stream_mode=K,y.frame_size_code=L,y.data=g.subarray(f,f+O)}return y},_.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},_.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},_}(),Xi=function(_){var g;g=[_.sampling_rate_code<<6|_.bit_stream_identification<<1|_.bit_stream_mode>>2,(3&_.bit_stream_mode)<<6|_.channel_mode<<3|_.low_frequency_effects_channel_on<<2|_.frame_size_code>>4,_.frame_size_code<<4&224],this.config=g,this.sampling_rate=_.sampling_frequency,this.bit_stream_identification=_.bit_stream_identification,this.bit_stream_mode=_.bit_stream_mode,this.low_frequency_effects_channel_on=_.low_frequency_effects_channel_on,this.channel_count=_.channel_count,this.channel_mode=_.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},Mt=function(){var _=function(g,y){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,S){f.__proto__=S}||function(f,S){for(var w in S)S.hasOwnProperty(w)&&(f[w]=S[w])})(g,y)};return function(g,y){function f(){this.constructor=g}_(g,y),g.prototype=y===null?Object.create(y):(f.prototype=y.prototype,new f)}}(),Qe=function(){return(Qe=Object.assign||function(_){for(var g,y=1,f=arguments.length;y<f;y++)for(var S in g=arguments[y])Object.prototype.hasOwnProperty.call(g,S)&&(_[S]=g[S]);return _}).apply(this,arguments)},Jr=function(_){function g(y,f){var S=_.call(this)||this;return S.TAG="TSDemuxer",S.first_parse_=!0,S.media_info_=new o.a,S.timescale_=90,S.duration_=0,S.current_pmt_pid_=-1,S.program_pmt_map_={},S.pes_slice_queues_={},S.section_slice_queues_={},S.video_metadata_={vps:void 0,sps:void 0,pps:void 0,details:void 0},S.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},S.aac_last_sample_pts_=void 0,S.aac_last_incomplete_data_=null,S.has_video_=!1,S.has_audio_=!1,S.video_init_segment_dispatched_=!1,S.audio_init_segment_dispatched_=!1,S.video_metadata_changed_=!1,S.audio_metadata_changed_=!1,S.loas_previous_frame=null,S.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},S.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},S.ts_packet_size_=y.ts_packet_size,S.sync_offset_=y.sync_offset,S.config_=f,S}return Mt(g,_),g.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,_.prototype.destroy.call(this)},g.probe=function(y){var f=new Uint8Array(y),S=-1,w=188;if(f.byteLength<=3*w)return{needMoreData:!0};for(;S===-1;){for(var L=Math.min(1e3,f.byteLength-3*w),O=0;O<L;){if(f[O]===71&&f[O+w]===71&&f[O+2*w]===71){S=O;break}O++}if(S===-1)if(w===188)w=192;else{if(w!==192)break;w=204}}return S===-1?{match:!1}:(w===192&&S>=4?(a.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),S-=4):w===204&&a.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:w,sync_offset:S})},g.prototype.bindDataSource=function(y){return y.onDataArrival=this.parseChunks.bind(this),this},g.prototype.resetMediaInfo=function(){this.media_info_=new o.a},g.prototype.parseChunks=function(y,f){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new p.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var S=0;for(this.first_parse_&&(this.first_parse_=!1,S=this.sync_offset_);S+this.ts_packet_size_<=y.byteLength;){var w=f+S;this.ts_packet_size_===192&&(S+=4);var L=new Uint8Array(y,S,188),O=L[0];if(O!==71){a.a.e(this.TAG,"sync_byte = "+O+", not 0x47");break}var j=(64&L[1])>>>6,V=(L[1],(31&L[1])<<8|L[2]),K=(48&L[3])>>>4,W=15&L[3],Y={},q=4;if(K==2||K==3){var tt=L[4];if(5+tt===188){S+=188,this.ts_packet_size_===204&&(S+=16);continue}tt>0&&(Y=this.parseAdaptationField(y,S+4,1+tt)),q=5+tt}if(K==1||K==3){if(V===0||V===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[V]===T.kSCTE35){var lt=188-q;this.handleSectionSlice(y,S+q,lt,{pid:V,file_position:w,payload_unit_start_indicator:j,continuity_conunter:W,random_access_indicator:Y.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[V]!=null){lt=188-q;var st=this.pmt_.pid_stream_type[V];V!==this.pmt_.common_pids.h264&&V!==this.pmt_.common_pids.h265&&V!==this.pmt_.common_pids.adts_aac&&V!==this.pmt_.common_pids.loas_aac&&V!==this.pmt_.common_pids.ac3&&V!==this.pmt_.common_pids.opus&&V!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[V]!==!0&&this.pmt_.timed_id3_pids[V]!==!0||this.handlePESSlice(y,S+q,lt,{pid:V,stream_type:st,file_position:w,payload_unit_start_indicator:j,continuity_conunter:W,random_access_indicator:Y.random_access_indicator})}}S+=188,this.ts_packet_size_===204&&(S+=16)}return this.dispatchAudioVideoMediaSegment(),S},g.prototype.parseAdaptationField=function(y,f,S){var w=new Uint8Array(y,f,S),L=w[0];return L>0?L>183?(a.a.w(this.TAG,"Illegal adaptation_field_length: "+L),{}):{discontinuity_indicator:(128&w[1])>>>7,random_access_indicator:(64&w[1])>>>6,elementary_stream_priority_indicator:(32&w[1])>>>5}:{}},g.prototype.handleSectionSlice=function(y,f,S,w){var L=new Uint8Array(y,f,S),O=this.section_slice_queues_[w.pid];if(w.payload_unit_start_indicator){var j=L[0];if(O!=null&&O.total_length!==0){var V=new Uint8Array(y,f+1,Math.min(S,j));O.slices.push(V),O.total_length+=V.byteLength,O.total_length===O.expected_length?this.emitSectionSlices(O,w):this.clearSlices(O,w)}for(var K=1+j;K<L.byteLength&&L[K+0]!==255;){var W=(15&L[K+1])<<8|L[K+2];this.section_slice_queues_[w.pid]=new ot,(O=this.section_slice_queues_[w.pid]).expected_length=W+3,O.file_position=w.file_position,O.random_access_indicator=w.random_access_indicator,V=new Uint8Array(y,f+K,Math.min(S-K,O.expected_length-O.total_length)),O.slices.push(V),O.total_length+=V.byteLength,O.total_length===O.expected_length?this.emitSectionSlices(O,w):O.total_length>=O.expected_length&&this.clearSlices(O,w),K+=V.byteLength}}else O!=null&&O.total_length!==0&&(V=new Uint8Array(y,f,Math.min(S,O.expected_length-O.total_length)),O.slices.push(V),O.total_length+=V.byteLength,O.total_length===O.expected_length?this.emitSectionSlices(O,w):O.total_length>=O.expected_length&&this.clearSlices(O,w))},g.prototype.handlePESSlice=function(y,f,S,w){var L=new Uint8Array(y,f,S),O=L[0]<<16|L[1]<<8|L[2],j=(L[3],L[4]<<8|L[5]);if(w.payload_unit_start_indicator){if(O!==1)return void a.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value "+O);var V=this.pes_slice_queues_[w.pid];V&&(V.expected_length===0||V.expected_length===V.total_length?this.emitPESSlices(V,w):this.clearSlices(V,w)),this.pes_slice_queues_[w.pid]=new ot,this.pes_slice_queues_[w.pid].file_position=w.file_position,this.pes_slice_queues_[w.pid].random_access_indicator=w.random_access_indicator}if(this.pes_slice_queues_[w.pid]!=null){var K=this.pes_slice_queues_[w.pid];K.slices.push(L),w.payload_unit_start_indicator&&(K.expected_length=j===0?0:j+6),K.total_length+=L.byteLength,K.expected_length>0&&K.expected_length===K.total_length?this.emitPESSlices(K,w):K.expected_length>0&&K.expected_length<K.total_length&&this.clearSlices(K,w)}},g.prototype.emitSectionSlices=function(y,f){for(var S=new Uint8Array(y.total_length),w=0,L=0;w<y.slices.length;w++){var O=y.slices[w];S.set(O,L),L+=O.byteLength}y.slices=[],y.expected_length=-1,y.total_length=0;var j=new nt;j.pid=f.pid,j.data=S,j.file_position=y.file_position,j.random_access_indicator=y.random_access_indicator,this.parseSection(j)},g.prototype.emitPESSlices=function(y,f){for(var S=new Uint8Array(y.total_length),w=0,L=0;w<y.slices.length;w++){var O=y.slices[w];S.set(O,L),L+=O.byteLength}y.slices=[],y.expected_length=-1,y.total_length=0;var j=new X;j.pid=f.pid,j.data=S,j.stream_type=f.stream_type,j.file_position=y.file_position,j.random_access_indicator=y.random_access_indicator,this.parsePES(j)},g.prototype.clearSlices=function(y,f){y.slices=[],y.expected_length=-1,y.total_length=0},g.prototype.parseSection=function(y){var f=y.data,S=y.pid;S===0?this.parsePAT(f):S===this.current_pmt_pid_?this.parsePMT(f):this.pmt_!=null&&this.pmt_.scte_35_pids[S]&&this.parseSCTE35(f)},g.prototype.parsePES=function(y){var f=y.data,S=f[0]<<16|f[1]<<8|f[2],w=f[3],L=f[4]<<8|f[5];if(S===1)if(w!==188&&w!==190&&w!==191&&w!==240&&w!==241&&w!==255&&w!==242&&w!==248){f[6];var O=(192&f[7])>>>6,j=f[8],V=void 0,K=void 0;O!==2&&O!==3||(V=536870912*(14&f[9])+4194304*(255&f[10])+16384*(254&f[11])+128*(255&f[12])+(254&f[13])/2,K=O===3?536870912*(14&f[14])+4194304*(255&f[15])+16384*(254&f[16])+128*(255&f[17])+(254&f[18])/2:V);var W=9+j,Y=void 0;if(L!==0){if(L<3+j)return void a.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");Y=L-3-j}else Y=f.byteLength-W;var q=f.subarray(W,W+Y);switch(y.stream_type){case T.kMPEG1Audio:case T.kMPEG2Audio:this.parseMP3Payload(q,V);break;case T.kPESPrivateData:this.pmt_.common_pids.opus===y.pid?this.parseOpusPayload(q,V):this.pmt_.common_pids.ac3===y.pid?this.parseAC3Payload(q,V):this.pmt_.smpte2038_pids[y.pid]?this.parseSMPTE2038MetadataPayload(q,V,K,y.pid,w):this.parsePESPrivateDataPayload(q,V,K,y.pid,w);break;case T.kADTSAAC:this.parseADTSAACPayload(q,V);break;case T.kLOASAAC:this.parseLOASAACPayload(q,V);break;case T.kAC3:this.parseAC3Payload(q,V);break;case T.kID3:this.parseTimedID3MetadataPayload(q,V,K,y.pid,w);break;case T.kH264:this.parseH264Payload(q,V,K,y.file_position,y.random_access_indicator);break;case T.kH265:this.parseH265Payload(q,V,K,y.file_position,y.random_access_indicator)}}else(w===188||w===191||w===240||w===241||w===255||w===242||w===248)&&y.stream_type===T.kPESPrivateData&&(W=6,Y=void 0,Y=L!==0?L:f.byteLength-W,q=f.subarray(W,W+Y),this.parsePESPrivateDataPayload(q,void 0,void 0,y.pid,w));else a.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value "+S)},g.prototype.parsePAT=function(y){var f=y[0];if(f===0){var S=(15&y[1])<<8|y[2],w=(y[3],y[4],(62&y[5])>>>1),L=1&y[5],O=y[6],j=(y[7],null);if(L===1&&O===0)(j=new U).version_number=w;else if((j=this.pat_)==null)return;for(var V=S-5-4,K=-1,W=-1,Y=8;Y<8+V;Y+=4){var q=y[Y]<<8|y[Y+1],tt=(31&y[Y+2])<<8|y[Y+3];q===0?j.network_pid=tt:(j.program_pmt_pid[q]=tt,K===-1&&(K=q),W===-1&&(W=tt))}L===1&&O===0&&(this.pat_==null&&a.a.v(this.TAG,"Parsed first PAT: "+JSON.stringify(j)),this.pat_=j,this.current_program_=K,this.current_pmt_pid_=W)}else a.a.e(this.TAG,"parsePAT: table_id "+f+" is not corresponded to PAT!")},g.prototype.parsePMT=function(y){var f=y[0];if(f===2){var S=(15&y[1])<<8|y[2],w=y[3]<<8|y[4],L=(62&y[5])>>>1,O=1&y[5],j=y[6],V=(y[7],null);if(O===1&&j===0)(V=new $).program_number=w,V.version_number=L,this.program_pmt_map_[w]=V;else if((V=this.program_pmt_map_[w])==null)return;y[8],y[9];for(var K=(15&y[10])<<8|y[11],W=12+K,Y=S-9-K-4,q=W;q<W+Y;){var tt=y[q],lt=(31&y[q+1])<<8|y[q+2],st=(15&y[q+3])<<8|y[q+4];V.pid_stream_type[lt]=tt;var pt=V.common_pids.h264||V.common_pids.h265,ht=V.common_pids.adts_aac||V.common_pids.loas_aac||V.common_pids.ac3||V.common_pids.opus||V.common_pids.mp3;if(tt!==T.kH264||pt)if(tt!==T.kH265||pt)if(tt!==T.kADTSAAC||ht)if(tt!==T.kLOASAAC||ht)if(tt!==T.kAC3||ht)if(tt!==T.kMPEG1Audio&&tt!==T.kMPEG2Audio||ht)if(tt===T.kPESPrivateData){if(V.pes_private_data_pids[lt]=!0,st>0){for(var ct=q+5;ct<q+5+st;){var Lt=y[ct+0],kt=y[ct+1];if(Lt===5){var dt=String.fromCharCode.apply(String,Array.from(y.subarray(ct+2,ct+2+kt)));dt==="VANC"?V.smpte2038_pids[lt]=!0:dt==="Opus"&&(V.common_pids.opus=lt)}else if(Lt===127&&lt===V.common_pids.opus){var vt=null;if(y[ct+2]===128&&(vt=y[ct+3]),vt==null){a.a.e(this.TAG,"Not Supported Opus channel count.");continue}var Ct={codec:"opus",channel_count:(15&vt)==0?2:15&vt,channel_config_code:vt,sample_rate:48e3},St={codec:"opus",meta:Ct};this.audio_init_segment_dispatched_==0?(this.audio_metadata_=Ct,this.dispatchAudioInitSegment(St)):this.detectAudioMetadataChange(St)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(St))}ct+=2+kt}var bt=y.subarray(q+5,q+5+st);this.dispatchPESPrivateDataDescriptor(lt,tt,bt)}}else tt===T.kID3?V.timed_id3_pids[lt]=!0:tt===T.kSCTE35&&(V.scte_35_pids[lt]=!0);else V.common_pids.mp3=lt;else V.common_pids.ac3=lt;else V.common_pids.loas_aac=lt;else V.common_pids.adts_aac=lt;else V.common_pids.h265=lt;else V.common_pids.h264=lt;q+=5+st}w===this.current_program_&&(this.pmt_==null&&a.a.v(this.TAG,"Parsed first PMT: "+JSON.stringify(V)),this.pmt_=V,(V.common_pids.h264||V.common_pids.h265)&&(this.has_video_=!0),(V.common_pids.adts_aac||V.common_pids.loas_aac||V.common_pids.ac3||V.common_pids.opus||V.common_pids.mp3)&&(this.has_audio_=!0))}else a.a.e(this.TAG,"parsePMT: table_id "+f+" is not corresponded to PMT!")},g.prototype.parseSCTE35=function(y){var f=he(y);if(f.pts!=null){var S=Math.floor(f.pts/this.timescale_);f.pts=S}else f.nearest_pts=this.aac_last_sample_pts_;this.onSCTE35Metadata&&this.onSCTE35Metadata(f)},g.prototype.parseH264Payload=function(y,f,S,w,L){for(var O=new Z(y),j=null,V=[],K=0,W=!1;(j=O.readNextNaluPayload())!=null;){var Y=new G(j);if(Y.type===B.kSliceSPS){var q=C.parseSPS(j.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Y,q)===!0&&(a.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Y,pps:void 0,details:q}):(this.video_metadata_.sps=Y,this.video_metadata_.details=q)}else Y.type===B.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=Y,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(Y.type===B.kSliceIDR||Y.type===B.kSliceNonIDR&&L===1)&&(W=!0);this.video_init_segment_dispatched_&&(V.push(Y),K+=Y.data.byteLength)}var tt=Math.floor(f/this.timescale_),lt=Math.floor(S/this.timescale_);if(V.length){var st=this.video_track_,pt={units:V,length:K,isKeyframe:W,dts:lt,pts:tt,cts:tt-lt,file_position:w};st.samples.push(pt),st.length+=K}},g.prototype.parseH265Payload=function(y,f,S,w,L){for(var O=new zi(y),j=null,V=[],K=0,W=!1;(j=O.readNextNaluPayload())!=null;){var Y=new $i(j);if(Y.type===Ft.kSliceVPS){if(!this.video_init_segment_dispatched_){var q=R.parseVPS(j.data);this.video_metadata_.vps=Y,this.video_metadata_.details=Qe(Qe({},this.video_metadata_.details),q)}}else Y.type===Ft.kSliceSPS?(q=R.parseSPS(j.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Y,q)===!0&&(a.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Y,pps:void 0,details:q}):(this.video_metadata_.sps=Y,this.video_metadata_.details=Qe(Qe({},this.video_metadata_.details),q))):Y.type===Ft.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(q=R.parsePPS(j.data),this.video_metadata_.pps=Y,this.video_metadata_.details=Qe(Qe({},this.video_metadata_.details),q),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):Y.type!==Ft.kSliceIDR_W_RADL&&Y.type!==Ft.kSliceIDR_N_LP&&Y.type!==Ft.kSliceCRA_NUT||(W=!0);this.video_init_segment_dispatched_&&(V.push(Y),K+=Y.data.byteLength)}var tt=Math.floor(f/this.timescale_),lt=Math.floor(S/this.timescale_);if(V.length){var st=this.video_track_,pt={units:V,length:K,isKeyframe:W,dts:lt,pts:tt,cts:tt-lt,file_position:w};st.samples.push(pt),st.length+=K}},g.prototype.detectVideoMetadataChange=function(y,f){if(f.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return a.a.v(this.TAG,"Video: Codec mimeType changed from "+this.video_metadata_.details.codec_mimetype+" to "+f.codec_mimetype),!0;if(f.codec_size.width!==this.video_metadata_.details.codec_size.width||f.codec_size.height!==this.video_metadata_.details.codec_size.height){var S=this.video_metadata_.details.codec_size,w=f.codec_size;return a.a.v(this.TAG,"Video: Coded Resolution changed from "+S.width+"x"+S.height+" to "+w.width+"x"+w.height),!0}return f.present_size.width!==this.video_metadata_.details.present_size.width&&(a.a.v(this.TAG,"Video: Present resolution width changed from "+this.video_metadata_.details.present_size.width+" to "+f.present_size.width),!0)},g.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},g.prototype.dispatchVideoInitSegment=function(){var y=this.video_metadata_.details,f={type:"video"};f.id=this.video_track_.id,f.timescale=1e3,f.duration=this.duration_,f.codecWidth=y.codec_size.width,f.codecHeight=y.codec_size.height,f.presentWidth=y.present_size.width,f.presentHeight=y.present_size.height,f.profile=y.profile_string,f.level=y.level_string,f.bitDepth=y.bit_depth,f.chromaFormat=y.chroma_format,f.sarRatio=y.sar_ratio,f.frameRate=y.frame_rate;var S=f.frameRate.fps_den,w=f.frameRate.fps_num;if(f.refSampleDuration=S/w*1e3,f.codec=y.codec_mimetype,this.video_metadata_.vps){var L=this.video_metadata_.vps.data.subarray(4),O=this.video_metadata_.sps.data.subarray(4),j=this.video_metadata_.pps.data.subarray(4),V=new Hi(L,O,j,y);f.hvcc=V.getData(),this.video_init_segment_dispatched_==0&&a.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: "+f.codec)}else{O=this.video_metadata_.sps.data.subarray(4),j=this.video_metadata_.pps.data.subarray(4);var K=new rt(O,j,y);f.avcc=K.getData(),this.video_init_segment_dispatched_==0&&a.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: "+f.codec)}this.onTrackMetadata("video",f),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var W=this.media_info_;W.hasVideo=!0,W.width=f.codecWidth,W.height=f.codecHeight,W.fps=f.frameRate.fps,W.profile=f.profile,W.level=f.level,W.refFrames=y.ref_frames,W.chromaFormat=y.chroma_format_string,W.sarNum=f.sarRatio.width,W.sarDen=f.sarRatio.height,W.videoCodec=f.codec,W.hasAudio&&W.audioCodec?W.mimeType='video/mp2t; codecs="'+W.videoCodec+","+W.audioCodec+'"':W.mimeType='video/mp2t; codecs="'+W.videoCodec+'"',W.isComplete()&&this.onMediaInfo(W)},g.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},g.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},g.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},g.prototype.parseADTSAACPayload=function(y,f){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var S=new Uint8Array(y.byteLength+this.aac_last_incomplete_data_.byteLength);S.set(this.aac_last_incomplete_data_,0),S.set(y,this.aac_last_incomplete_data_.byteLength),y=S}var w,L;if(f!=null&&(L=f/this.timescale_),this.audio_metadata_.codec==="aac"){if(f==null&&this.aac_last_sample_pts_!=null)w=1024/this.audio_metadata_.sampling_frequency*1e3,L=this.aac_last_sample_pts_+w;else if(f==null)return void a.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){w=1024/this.audio_metadata_.sampling_frequency*1e3;var O=this.aac_last_sample_pts_+w;Math.abs(O-L)>1&&(a.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+O+"ms, PES pts: "+L+"ms"),L=O)}}for(var j,V=new ft(y),K=null,W=L;(K=V.readNextAACFrame())!=null;){w=1024/K.sampling_frequency*1e3;var Y={codec:"aac",data:K};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:K.audio_object_type,sampling_freq_index:K.sampling_freq_index,sampling_frequency:K.sampling_frequency,channel_config:K.channel_config},this.dispatchAudioInitSegment(Y)):this.detectAudioMetadataChange(Y)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Y)),j=W;var q=Math.floor(W),tt={unit:K.data,length:K.data.byteLength,pts:q,dts:q};this.audio_track_.samples.push(tt),this.audio_track_.length+=K.data.byteLength,W+=w}V.hasIncompleteData()&&(this.aac_last_incomplete_data_=V.getIncompleteData()),j&&(this.aac_last_sample_pts_=j)}},g.prototype.parseLOASAACPayload=function(y,f){var S;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var w=new Uint8Array(y.byteLength+this.aac_last_incomplete_data_.byteLength);w.set(this.aac_last_incomplete_data_,0),w.set(y,this.aac_last_incomplete_data_.byteLength),y=w}var L,O;if(f!=null&&(O=f/this.timescale_),this.audio_metadata_.codec==="aac"){if(f==null&&this.aac_last_sample_pts_!=null)L=1024/this.audio_metadata_.sampling_frequency*1e3,O=this.aac_last_sample_pts_+L;else if(f==null)return void a.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){L=1024/this.audio_metadata_.sampling_frequency*1e3;var j=this.aac_last_sample_pts_+L;Math.abs(j-O)>1&&(a.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+j+"ms, PES pts: "+O+"ms"),O=j)}}for(var V,K=new yt(y),W=null,Y=O;(W=K.readNextAACFrame((S=this.loas_previous_frame)!==null&&S!==void 0?S:void 0))!=null;){this.loas_previous_frame=W,L=1024/W.sampling_frequency*1e3;var q={codec:"aac",data:W};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:W.audio_object_type,sampling_freq_index:W.sampling_freq_index,sampling_frequency:W.sampling_frequency,channel_config:W.channel_config},this.dispatchAudioInitSegment(q)):this.detectAudioMetadataChange(q)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(q)),V=Y;var tt=Math.floor(Y),lt={unit:W.data,length:W.data.byteLength,pts:tt,dts:tt};this.audio_track_.samples.push(lt),this.audio_track_.length+=W.data.byteLength,Y+=L}K.hasIncompleteData()&&(this.aac_last_incomplete_data_=K.getIncompleteData()),V&&(this.aac_last_sample_pts_=V)}},g.prototype.parseAC3Payload=function(y,f){if(!this.has_video_||this.video_init_segment_dispatched_){var S,w;if(f!=null&&(w=f/this.timescale_),this.audio_metadata_.codec==="ac-3"){if(f==null&&this.aac_last_sample_pts_!=null)S=1536/this.audio_metadata_.sampling_frequency*1e3,w=this.aac_last_sample_pts_+S;else if(f==null)return void a.a.w(this.TAG,"Opus: Unknown pts")}for(var L,O=new Qi(y),j=null,V=w;(j=O.readNextAC3Frame())!=null;){S=1536/j.sampling_frequency*1e3;var K={codec:"ac-3",data:j};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ac-3",sampling_frequency:j.sampling_frequency,bit_stream_identification:j.bit_stream_identification,bit_stream_mode:j.bit_stream_mode,low_frequency_effects_channel_on:j.low_frequency_effects_channel_on,channel_mode:j.channel_mode},console.log(JSON.stringify(this.audio_metadata_)),this.dispatchAudioInitSegment(K)):this.detectAudioMetadataChange(K)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(K)),L=V;var W=Math.floor(V),Y={unit:j.data,length:j.data.byteLength,pts:W,dts:W};this.audio_track_.samples.push(Y),this.audio_track_.length+=j.data.byteLength,V+=S}L&&(this.aac_last_sample_pts_=L)}},g.prototype.parseOpusPayload=function(y,f){if(!this.has_video_||this.video_init_segment_dispatched_){var S,w;if(f!=null&&(w=f/this.timescale_),this.audio_metadata_.codec==="opus"){if(f==null&&this.aac_last_sample_pts_!=null)S=20,w=this.aac_last_sample_pts_+S;else if(f==null)return void a.a.w(this.TAG,"Opus: Unknown pts")}for(var L,O=w,j=0;j<y.length;){S=20;for(var V=(16&y[j+1])!=0,K=(8&y[j+1])!=0,W=j+2,Y=0;y[W]===255;)Y+=255,W+=1;Y+=y[W],W+=1,W+=V?2:0,W+=K?2:0,L=O;var q=Math.floor(O),tt=y.slice(W,W+Y),lt={unit:tt,length:tt.byteLength,pts:q,dts:q};this.audio_track_.samples.push(lt),this.audio_track_.length+=tt.byteLength,O+=S,j=W+Y}L&&(this.aac_last_sample_pts_=L)}},g.prototype.parseMP3Payload=function(y,f){if(!this.has_video_||this.video_init_segment_dispatched_){var S=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],w=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],L=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],O=y[1]>>>3&3,j=(6&y[1])>>1,V=(240&y[2])>>>4,K=(12&y[2])>>>2,W=(y[3]>>>6&3)!==3?2:1,Y=0,q=34;switch(O){case 0:Y=[11025,12e3,8e3,0][K];break;case 2:Y=[22050,24e3,16e3,0][K];break;case 3:Y=[44100,48e3,32e3,0][K]}switch(j){case 1:q=34,V<L.length&&L[V];break;case 2:q=33,V<w.length&&w[V];break;case 3:q=32,V<S.length&&S[V]}var tt=new Ki;tt.object_type=q,tt.sample_rate=Y,tt.channel_count=W,tt.data=y;var lt={codec:"mp3",data:tt};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:q,sample_rate:Y,channel_count:W},this.dispatchAudioInitSegment(lt)):this.detectAudioMetadataChange(lt)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(lt));var st={unit:y,length:y.byteLength,pts:f/this.timescale_,dts:f/this.timescale_};this.audio_track_.samples.push(st),this.audio_track_.length+=y.byteLength}},g.prototype.detectAudioMetadataChange=function(y){if(y.codec!==this.audio_metadata_.codec)return a.a.v(this.TAG,"Audio: Audio Codecs changed from "+this.audio_metadata_.codec+" to "+y.codec),!0;if(y.codec==="aac"&&this.audio_metadata_.codec==="aac"){if((f=y.data).audio_object_type!==this.audio_metadata_.audio_object_type)return a.a.v(this.TAG,"AAC: AudioObjectType changed from "+this.audio_metadata_.audio_object_type+" to "+f.audio_object_type),!0;if(f.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return a.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+this.audio_metadata_.sampling_freq_index+" to "+f.sampling_freq_index),!0;if(f.channel_config!==this.audio_metadata_.channel_config)return a.a.v(this.TAG,"AAC: Channel configuration changed from "+this.audio_metadata_.channel_config+" to "+f.channel_config),!0}else if(y.codec==="ac-3"&&this.audio_metadata_.codec==="ac-3"){var f;if((f=y.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return a.a.v(this.TAG,"AC3: Sampling Frequency changed from "+this.audio_metadata_.sampling_frequency+" to "+f.sampling_frequency),!0;if(f.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return a.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+this.audio_metadata_.bit_stream_identification+" to "+f.bit_stream_identification),!0;if(f.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return a.a.v(this.TAG,"AC3: BitStream Mode changed from "+this.audio_metadata_.bit_stream_mode+" to "+f.bit_stream_mode),!0;if(f.channel_mode!==this.audio_metadata_.channel_mode)return a.a.v(this.TAG,"AC3: Channel Mode changed from "+this.audio_metadata_.channel_mode+" to "+f.channel_mode),!0;if(f.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return a.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+this.audio_metadata_.low_frequency_effects_channel_on+" to "+f.low_frequency_effects_channel_on),!0}else if(y.codec==="opus"&&this.audio_metadata_.codec==="opus"){if((S=y.meta).sample_rate!==this.audio_metadata_.sample_rate)return a.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+S.sample_rate),!0;if(S.channel_count!==this.audio_metadata_.channel_count)return a.a.v(this.TAG,"Opus: Channel count changed from "+this.audio_metadata_.channel_count+" to "+S.channel_count),!0}else if(y.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var S;if((S=y.data).object_type!==this.audio_metadata_.object_type)return a.a.v(this.TAG,"MP3: AudioObjectType changed from "+this.audio_metadata_.object_type+" to "+S.object_type),!0;if(S.sample_rate!==this.audio_metadata_.sample_rate)return a.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+S.sample_rate),!0;if(S.channel_count!==this.audio_metadata_.channel_count)return a.a.v(this.TAG,"MP3: Channel count changed from "+this.audio_metadata_.channel_count+" to "+S.channel_count),!0}return!1},g.prototype.dispatchAudioInitSegment=function(y){var f={type:"audio"};if(f.id=this.audio_track_.id,f.timescale=1e3,f.duration=this.duration_,this.audio_metadata_.codec==="aac"){var S=y.codec==="aac"?y.data:null,w=new _t(S);f.audioSampleRate=w.sampling_rate,f.channelCount=w.channel_count,f.codec=w.codec_mimetype,f.originalCodec=w.original_codec_mimetype,f.config=w.config,f.refSampleDuration=1024/f.audioSampleRate*f.timescale}else if(this.audio_metadata_.codec==="ac-3"){var L=y.codec==="ac-3"?y.data:null,O=new Xi(L);f.audioSampleRate=O.sampling_rate,f.channelCount=O.channel_count,f.codec=O.codec_mimetype,f.originalCodec=O.original_codec_mimetype,f.config=O.config,f.refSampleDuration=1536/f.audioSampleRate*f.timescale}else this.audio_metadata_.codec==="opus"?(f.audioSampleRate=this.audio_metadata_.sample_rate,f.channelCount=this.audio_metadata_.channel_count,f.channelConfigCode=this.audio_metadata_.channel_config_code,f.codec="opus",f.originalCodec="opus",f.config=void 0,f.refSampleDuration=20):this.audio_metadata_.codec==="mp3"&&(f.audioSampleRate=this.audio_metadata_.sample_rate,f.channelCount=this.audio_metadata_.channel_count,f.codec="mp3",f.originalCodec="mp3",f.config=void 0);this.audio_init_segment_dispatched_==0&&a.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: "+f.codec),this.onTrackMetadata("audio",f),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var j=this.media_info_;j.hasAudio=!0,j.audioCodec=f.originalCodec,j.audioSampleRate=f.audioSampleRate,j.audioChannelCount=f.channelCount,j.hasVideo&&j.videoCodec?j.mimeType='video/mp2t; codecs="'+j.videoCodec+","+j.audioCodec+'"':j.mimeType='video/mp2t; codecs="'+j.audioCodec+'"',j.isComplete()&&this.onMediaInfo(j)},g.prototype.dispatchPESPrivateDataDescriptor=function(y,f,S){var w=new Vt;w.pid=y,w.stream_type=f,w.descriptor=S,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(w)},g.prototype.parsePESPrivateDataPayload=function(y,f,S,w,L){var O=new wt;if(O.pid=w,O.stream_id=L,O.len=y.byteLength,O.data=y,f!=null){var j=Math.floor(f/this.timescale_);O.pts=j}else O.nearest_pts=this.aac_last_sample_pts_;if(S!=null){var V=Math.floor(S/this.timescale_);O.dts=V}this.onPESPrivateData&&this.onPESPrivateData(O)},g.prototype.parseTimedID3MetadataPayload=function(y,f,S,w,L){var O=new wt;if(O.pid=w,O.stream_id=L,O.len=y.byteLength,O.data=y,f!=null){var j=Math.floor(f/this.timescale_);O.pts=j}if(S!=null){var V=Math.floor(S/this.timescale_);O.dts=V}this.onTimedID3Metadata&&this.onTimedID3Metadata(O)},g.prototype.parseSMPTE2038MetadataPayload=function(y,f,S,w,L){var O=new Yi;if(O.pid=w,O.stream_id=L,O.len=y.byteLength,O.data=y,f!=null){var j=Math.floor(f/this.timescale_);O.pts=j}if(O.nearest_pts=this.aac_last_sample_pts_,S!=null){var V=Math.floor(S/this.timescale_);O.dts=V}O.ancillaries=function(K){for(var W=new E(K),Y=0,q=[];Y+=6,W.readBits(6)===0;){var tt=W.readBool();Y+=1;var lt=W.readBits(11);Y+=11;var st=W.readBits(12);Y+=12;var pt=255&W.readBits(10);Y+=10;var ht=255&W.readBits(10);Y+=10;var ct=255&W.readBits(10);Y+=10;for(var Lt=new Uint8Array(ct),kt=0;kt<ct;kt++){var dt=255&W.readBits(10);Y+=10,Lt[kt]=dt}W.readBits(10),Y+=10;var vt="User Defined";pt===65?ht===7&&(vt="SCTE-104"):pt===95?ht===220?vt="ARIB STD-B37 (1SEG)":ht===221?vt="ARIB STD-B37 (ANALOG)":ht===222?vt="ARIB STD-B37 (SD)":ht===223&&(vt="ARIB STD-B37 (HD)"):pt===97&&(ht===1?vt="EIA-708":ht===2&&(vt="EIA-608")),q.push({yc_indicator:tt,line_number:lt,horizontal_offset:st,did:pt,sdid:ht,user_data:Lt,description:vt,information:{}}),W.readBits(8-(Y-Math.floor(Y/8))%8),Y+=(8-(Y-Math.floor(Y/8)))%8}return W.destroy(),W=null,q}(y),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(O)},g}(A),ya=function(){for(var _=0,g=0,y=arguments.length;g<y;g++)_+=arguments[g].length;var f=Array(_),S=0;for(g=0;g<y;g++)for(var w=arguments[g],L=0,O=w.length;L<O;L++,S++)f[S]=w[L];return f},ts=function(){function _(){}return _.init=function(){for(var g in _.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[]},_.types)_.types.hasOwnProperty(g)&&(_.types[g]=[g.charCodeAt(0),g.charCodeAt(1),g.charCodeAt(2),g.charCodeAt(3)]);var y=_.constants={};y.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),y.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),y.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),y.STSC=y.STCO=y.STTS,y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),y.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),y.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),y.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},_.box=function(g){for(var y=8,f=null,S=Array.prototype.slice.call(arguments,1),w=S.length,L=0;L<w;L++)y+=S[L].byteLength;(f=new Uint8Array(y))[0]=y>>>24&255,f[1]=y>>>16&255,f[2]=y>>>8&255,f[3]=255&y,f.set(g,4);var O=8;for(L=0;L<w;L++)f.set(S[L],O),O+=S[L].byteLength;return f},_.generateInitSegment=function(g){var y=_.box(_.types.ftyp,_.constants.FTYP),f=_.moov(g),S=new Uint8Array(y.byteLength+f.byteLength);return S.set(y,0),S.set(f,y.byteLength),S},_.moov=function(g){var y=_.mvhd(g.timescale,g.duration),f=_.trak(g),S=_.mvex(g);return _.box(_.types.moov,y,f,S)},_.mvhd=function(g,y){return _.box(_.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g,y>>>24&255,y>>>16&255,y>>>8&255,255&y,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},_.trak=function(g){return _.box(_.types.trak,_.tkhd(g),_.mdia(g))},_.tkhd=function(g){var y=g.id,f=g.duration,S=g.presentWidth,w=g.presentHeight;return _.box(_.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,255&f,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,S>>>8&255,255&S,0,0,w>>>8&255,255&w,0,0]))},_.mdia=function(g){return _.box(_.types.mdia,_.mdhd(g),_.hdlr(g),_.minf(g))},_.mdhd=function(g){var y=g.timescale,f=g.duration;return _.box(_.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,f>>>24&255,f>>>16&255,f>>>8&255,255&f,85,196,0,0]))},_.hdlr=function(g){var y=null;return y=g.type==="audio"?_.constants.HDLR_AUDIO:_.constants.HDLR_VIDEO,_.box(_.types.hdlr,y)},_.minf=function(g){var y=null;return y=g.type==="audio"?_.box(_.types.smhd,_.constants.SMHD):_.box(_.types.vmhd,_.constants.VMHD),_.box(_.types.minf,y,_.dinf(),_.stbl(g))},_.dinf=function(){return _.box(_.types.dinf,_.box(_.types.dref,_.constants.DREF))},_.stbl=function(g){return _.box(_.types.stbl,_.stsd(g),_.box(_.types.stts,_.constants.STTS),_.box(_.types.stsc,_.constants.STSC),_.box(_.types.stsz,_.constants.STSZ),_.box(_.types.stco,_.constants.STCO))},_.stsd=function(g){return g.type==="audio"?g.codec==="mp3"?_.box(_.types.stsd,_.constants.STSD_PREFIX,_.mp3(g)):g.codec==="ac-3"?_.box(_.types.stsd,_.constants.STSD_PREFIX,_.ac3(g)):g.codec==="opus"?_.box(_.types.stsd,_.constants.STSD_PREFIX,_.Opus(g)):_.box(_.types.stsd,_.constants.STSD_PREFIX,_.mp4a(g)):g.type==="video"&&g.codec.startsWith("hvc1")?_.box(_.types.stsd,_.constants.STSD_PREFIX,_.hvc1(g)):_.box(_.types.stsd,_.constants.STSD_PREFIX,_.avc1(g))},_.mp3=function(g){var y=g.channelCount,f=g.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y,0,16,0,0,0,0,f>>>8&255,255&f,0,0]);return _.box(_.types[".mp3"],S)},_.mp4a=function(g){var y=g.channelCount,f=g.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y,0,16,0,0,0,0,f>>>8&255,255&f,0,0]);return _.box(_.types.mp4a,S,_.esds(g))},_.ac3=function(g){var y=g.channelCount,f=g.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y,0,16,0,0,0,0,f>>>8&255,255&f,0,0]);return _.box(_.types["ac-3"],S,_.box(_.types.dac3,new Uint8Array(g.config)))},_.esds=function(g){var y=g.config||[],f=y.length,S=new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(y).concat([6,1,2]));return _.box(_.types.esds,S)},_.Opus=function(g){var y=g.channelCount,f=g.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,y,0,16,0,0,0,0,f>>>8&255,255&f,0,0]);return _.box(_.types.Opus,S,_.dOps(g))},_.dOps=function(g){var y=g.channelCount,f=g.channelConfigCode,S=g.audioSampleRate;if(g.config)return _.box(_.types.dOps,L);var w=[];switch(f){case 1:case 2:w=[0];break;case 0:w=[255,1,1,0,1];break;case 128:w=[255,2,0,0,1];break;case 3:w=[1,2,1,0,2,1];break;case 4:w=[1,2,2,0,1,2,3];break;case 5:w=[1,3,2,0,4,1,2,3];break;case 6:w=[1,4,2,0,4,1,2,3,5];break;case 7:w=[1,4,2,0,4,1,2,3,5,6];break;case 8:w=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:w=[1,1,2,0,1];break;case 131:w=[1,1,3,0,1,2];break;case 132:w=[1,1,4,0,1,2,3];break;case 133:w=[1,1,5,0,1,2,3,4];break;case 134:w=[1,1,6,0,1,2,3,4,5];break;case 135:w=[1,1,7,0,1,2,3,4,5,6];break;case 136:w=[1,1,8,0,1,2,3,4,5,6,7]}var L=new Uint8Array(ya([0,y,0,0,S>>>24&255,S>>>17&255,S>>>8&255,S>>>0&255,0,0],w));return _.box(_.types.dOps,L)},_.avc1=function(g){var y=g.avcc,f=g.codecWidth,S=g.codecHeight,w=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>>8&255,255&f,S>>>8&255,255&S,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return _.box(_.types.avc1,w,_.box(_.types.avcC,y))},_.hvc1=function(g){var y=g.hvcc,f=g.codecWidth,S=g.codecHeight,w=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>>8&255,255&f,S>>>8&255,255&S,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return _.box(_.types.hvc1,w,_.box(_.types.hvcC,y))},_.mvex=function(g){return _.box(_.types.mvex,_.trex(g))},_.trex=function(g){var y=g.id,f=new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return _.box(_.types.trex,f)},_.moof=function(g,y){return _.box(_.types.moof,_.mfhd(g.sequenceNumber),_.traf(g,y))},_.mfhd=function(g){var y=new Uint8Array([0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g]);return _.box(_.types.mfhd,y)},_.traf=function(g,y){var f=g.id,S=_.box(_.types.tfhd,new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,255&f])),w=_.box(_.types.tfdt,new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y])),L=_.sdtp(g),O=_.trun(g,L.byteLength+16+16+8+16+8+8);return _.box(_.types.traf,S,w,O,L)},_.sdtp=function(g){for(var y=g.samples||[],f=y.length,S=new Uint8Array(4+f),w=0;w<f;w++){var L=y[w].flags;S[w+4]=L.isLeading<<6|L.dependsOn<<4|L.isDependedOn<<2|L.hasRedundancy}return _.box(_.types.sdtp,S)},_.trun=function(g,y){var f=g.samples||[],S=f.length,w=12+16*S,L=new Uint8Array(w);y+=8+w,L.set([0,0,15,1,S>>>24&255,S>>>16&255,S>>>8&255,255&S,y>>>24&255,y>>>16&255,y>>>8&255,255&y],0);for(var O=0;O<S;O++){var j=f[O].duration,V=f[O].size,K=f[O].flags,W=f[O].cts;L.set([j>>>24&255,j>>>16&255,j>>>8&255,255&j,V>>>24&255,V>>>16&255,V>>>8&255,255&V,K.isLeading<<2|K.dependsOn,K.isDependedOn<<6|K.hasRedundancy<<4|K.isNonSync,0,0,W>>>24&255,W>>>16&255,W>>>8&255,255&W],12+16*O)}return _.box(_.types.trun,L)},_.mdat=function(g){return _.box(_.types.mdat,g)},_}();ts.init();var ii=ts,es=function(){function _(){}return _.getSilentFrame=function(g,y){if(g==="mp4a.40.2"){if(y===1)return new Uint8Array([0,200,0,128,35,128]);if(y===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(y===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(y===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(y===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(y===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(y===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(y===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(y===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},_}(),Pe=s(7),is=function(){function _(g){this.TAG="MP4Remuxer",this._config=g,this._isLive=g.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Pe.c("audio"),this._videoSegmentInfoList=new Pe.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!l.a.chrome||!(l.a.version.major<50||l.a.version.major===50&&l.a.version.build<2661)),this._fillSilentAfterSeek=l.a.msedge||l.a.msie,this._mp3UseMpegAudio=!l.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return _.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},_.prototype.bindDataSource=function(g){return g.onDataAvailable=this.remux.bind(this),g.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(_.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(g){this._onInitSegment=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(g){this._onMediaSegment=g},enumerable:!1,configurable:!0}),_.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},_.prototype.seek=function(g){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},_.prototype.remux=function(g,y){if(!this._onMediaSegment)throw new p.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(g,y),y&&this._remuxVideo(y),g&&this._remuxAudio(g)},_.prototype._onTrackMetadataReceived=function(g,y){var f=null,S="mp4",w=y.codec;if(g==="audio")this._audioMeta=y,y.codec==="mp3"&&this._mp3UseMpegAudio?(S="mpeg",w="",f=new Uint8Array):f=ii.generateInitSegment(y);else{if(g!=="video")return;this._videoMeta=y,f=ii.generateInitSegment(y)}if(!this._onInitSegment)throw new p.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(g,{type:g,data:f.buffer,codec:w,container:g+"/"+S,mediaDuration:y.duration})},_.prototype._calculateDtsBase=function(g,y){this._dtsBaseInited||(g&&g.samples&&g.samples.length&&(this._audioDtsBase=g.samples[0].dts),y&&y.samples&&y.samples.length&&(this._videoDtsBase=y.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},_.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},_.prototype.flushStashedSamples=function(){var g=this._videoStashedLastSample,y=this._audioStashedLastSample,f={type:"video",id:1,sequenceNumber:0,samples:[],length:0};g!=null&&(f.samples.push(g),f.length=g.length);var S={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};y!=null&&(S.samples.push(y),S.length=y.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(f,!0),this._remuxAudio(S,!0)},_.prototype._remuxAudio=function(g,y){if(this._audioMeta!=null){var f,S=g,w=S.samples,L=void 0,O=-1,j=this._audioMeta.refSampleDuration,V=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,K=this._dtsBaseInited&&this._audioNextDts===void 0,W=!1;if(w&&w.length!==0&&(w.length!==1||y)){var Y=0,q=null,tt=0;V?(Y=0,tt=S.length):(Y=8,tt=8+S.length);var lt=null;if(w.length>1&&(tt-=(lt=w.pop()).length),this._audioStashedLastSample!=null){var st=this._audioStashedLastSample;this._audioStashedLastSample=null,w.unshift(st),tt+=st.length}lt!=null&&(this._audioStashedLastSample=lt);var pt=w[0].dts-this._dtsBase;if(this._audioNextDts)L=pt-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())L=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(W=!0);else{var ht=this._audioSegmentInfoList.getLastSampleBefore(pt);if(ht!=null){var ct=pt-(ht.originalDts+ht.duration);ct<=3&&(ct=0),L=pt-(ht.dts+ht.duration+ct)}else L=0}if(W){var Lt=pt-L,kt=this._videoSegmentInfoList.getLastSegmentBefore(pt);if(kt!=null&&kt.beginDts<Lt){if(te=es.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var dt=kt.beginDts,vt=Lt-kt.beginDts;a.a.v(this.TAG,"InsertPrefixSilentAudio: dts: "+dt+", duration: "+vt),w.unshift({unit:te,dts:dt,pts:dt}),tt+=te.byteLength}}else W=!1}for(var Ct=[],St=0;St<w.length;St++){var bt=(st=w[St]).unit,Ut=st.dts-this._dtsBase,Wt=(dt=Ut,!1),Rt=null,Bt=0;if(!(Ut<-.001)){if(this._audioMeta.codec!=="mp3"){var qt=Ut;if(this._audioNextDts&&(qt=this._audioNextDts),(L=Ut-qt)<=-3*j){a.a.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Ut+" ms ,curRefDts: "+qt+" ms)  due to dtsCorrection: "+L+" ms overlap.");continue}if(L>=3*j&&this._fillAudioTimestampGap&&!l.a.safari){Wt=!0;var te,Ve=Math.floor(L/j);a.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
originalDts: `+Ut+" ms, curRefDts: "+qt+" ms, dtsCorrection: "+Math.round(L)+" ms, generate: "+Ve+" frames"),dt=Math.floor(qt),Bt=Math.floor(qt+j)-dt,(te=es.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(a.a.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),te=bt),Rt=[];for(var be=0;be<Ve;be++){qt+=j;var $e=Math.floor(qt),Xe=Math.floor(qt+j)-$e,ze={dts:$e,pts:$e,cts:0,unit:te,size:te.byteLength,duration:Xe,originalDts:Ut,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Rt.push(ze),tt+=ze.size}this._audioNextDts=qt+j}else dt=Math.floor(qt),Bt=Math.floor(qt+j)-dt,this._audioNextDts=qt+j}else dt=Ut-L,St!==w.length-1?Bt=w[St+1].dts-this._dtsBase-L-dt:lt!=null?Bt=lt.dts-this._dtsBase-L-dt:Bt=Ct.length>=1?Ct[Ct.length-1].duration:Math.floor(j),this._audioNextDts=dt+Bt;O===-1&&(O=dt),Ct.push({dts:dt,pts:dt,cts:0,unit:st.unit,size:st.unit.byteLength,duration:Bt,originalDts:Ut,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Wt&&Ct.push.apply(Ct,Rt)}}if(Ct.length===0)return S.samples=[],void(S.length=0);for(V?q=new Uint8Array(tt):((q=new Uint8Array(tt))[0]=tt>>>24&255,q[1]=tt>>>16&255,q[2]=tt>>>8&255,q[3]=255&tt,q.set(ii.types.mdat,4)),St=0;St<Ct.length;St++)bt=Ct[St].unit,q.set(bt,Y),Y+=bt.byteLength;var oe=Ct[Ct.length-1];f=oe.dts+oe.duration;var Ot=new Pe.b;Ot.beginDts=O,Ot.endDts=f,Ot.beginPts=O,Ot.endPts=f,Ot.originalBeginDts=Ct[0].originalDts,Ot.originalEndDts=oe.originalDts+oe.duration,Ot.firstSample=new Pe.d(Ct[0].dts,Ct[0].pts,Ct[0].duration,Ct[0].originalDts,!1),Ot.lastSample=new Pe.d(oe.dts,oe.pts,oe.duration,oe.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(Ot),S.samples=Ct,S.sequenceNumber++;var Oe=null;Oe=V?new Uint8Array:ii.moof(S,O),S.samples=[],S.length=0;var Ne={type:"audio",data:this._mergeBoxes(Oe,q).buffer,sampleCount:Ct.length,info:Ot};V&&K&&(Ne.timestampOffset=O),this._onMediaSegment("audio",Ne)}}},_.prototype._remuxVideo=function(g,y){if(this._videoMeta!=null){var f,S,w=g,L=w.samples,O=void 0,j=-1,V=-1;if(L&&L.length!==0&&(L.length!==1||y)){var K=8,W=null,Y=8+g.length,q=null;if(L.length>1&&(Y-=(q=L.pop()).length),this._videoStashedLastSample!=null){var tt=this._videoStashedLastSample;this._videoStashedLastSample=null,L.unshift(tt),Y+=tt.length}q!=null&&(this._videoStashedLastSample=q);var lt=L[0].dts-this._dtsBase;if(this._videoNextDts)O=lt-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())O=0;else{var st=this._videoSegmentInfoList.getLastSampleBefore(lt);if(st!=null){var pt=lt-(st.originalDts+st.duration);pt<=3&&(pt=0),O=lt-(st.dts+st.duration+pt)}else O=0}for(var ht=new Pe.b,ct=[],Lt=0;Lt<L.length;Lt++){var kt=(tt=L[Lt]).dts-this._dtsBase,dt=tt.isKeyframe,vt=kt-O,Ct=tt.cts,St=vt+Ct;j===-1&&(j=vt,V=St);var bt=0;if(Lt!==L.length-1?bt=L[Lt+1].dts-this._dtsBase-O-vt:q!=null?bt=q.dts-this._dtsBase-O-vt:bt=ct.length>=1?ct[ct.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),dt){var Ut=new Pe.d(vt,St,bt,tt.dts,!0);Ut.fileposition=tt.fileposition,ht.appendSyncPoint(Ut)}ct.push({dts:vt,pts:St,cts:Ct,units:tt.units,size:tt.length,isKeyframe:dt,duration:bt,originalDts:kt,flags:{isLeading:0,dependsOn:dt?2:1,isDependedOn:dt?1:0,hasRedundancy:0,isNonSync:dt?0:1}})}for((W=new Uint8Array(Y))[0]=Y>>>24&255,W[1]=Y>>>16&255,W[2]=Y>>>8&255,W[3]=255&Y,W.set(ii.types.mdat,4),Lt=0;Lt<ct.length;Lt++)for(var Wt=ct[Lt].units;Wt.length;){var Rt=Wt.shift().data;W.set(Rt,K),K+=Rt.byteLength}var Bt=ct[ct.length-1];if(f=Bt.dts+Bt.duration,S=Bt.pts+Bt.duration,this._videoNextDts=f,ht.beginDts=j,ht.endDts=f,ht.beginPts=V,ht.endPts=S,ht.originalBeginDts=ct[0].originalDts,ht.originalEndDts=Bt.originalDts+Bt.duration,ht.firstSample=new Pe.d(ct[0].dts,ct[0].pts,ct[0].duration,ct[0].originalDts,ct[0].isKeyframe),ht.lastSample=new Pe.d(Bt.dts,Bt.pts,Bt.duration,Bt.originalDts,Bt.isKeyframe),this._isLive||this._videoSegmentInfoList.append(ht),w.samples=ct,w.sequenceNumber++,this._forceFirstIDR){var qt=ct[0].flags;qt.dependsOn=2,qt.isNonSync=0}var te=ii.moof(w,j);w.samples=[],w.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(te,W).buffer,sampleCount:ct.length,info:ht})}}},_.prototype._mergeBoxes=function(g,y){var f=new Uint8Array(g.byteLength+y.byteLength);return f.set(g,0),f.set(y,g.byteLength),f},_}(),_a=s(11),ie=s(1),va=function(){function _(g,y){this.TAG="TransmuxingController",this._emitter=new n.a,this._config=y,g.segments||(g.segments=[{duration:g.duration,filesize:g.filesize,url:g.url}]),typeof g.cors!="boolean"&&(g.cors=!0),typeof g.withCredentials!="boolean"&&(g.withCredentials=!1),this._mediaDataSource=g,this._currentSegmentIndex=0;var f=0;this._mediaDataSource.segments.forEach(function(S){S.timestampBase=f,f+=S.duration,S.cors=g.cors,S.withCredentials=g.withCredentials,y.referrerPolicy&&(S.referrerPolicy=y.referrerPolicy)}),isNaN(f)||this._mediaDataSource.duration===f||(this._mediaDataSource.duration=f),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return _.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},_.prototype.on=function(g,y){this._emitter.addListener(g,y)},_.prototype.off=function(g,y){this._emitter.removeListener(g,y)},_.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},_.prototype._loadSegment=function(g,y){this._currentSegmentIndex=g;var f=this._mediaDataSource.segments[g],S=this._ioctl=new _a.a(f,this._config,g);S.onError=this._onIOException.bind(this),S.onSeeked=this._onIOSeeked.bind(this),S.onComplete=this._onIOComplete.bind(this),S.onRedirect=this._onIORedirect.bind(this),S.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),y?this._demuxer.bindDataSource(this._ioctl):S.onDataArrival=this._onInitChunkArrival.bind(this),S.open(y)},_.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},_.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},_.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},_.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},_.prototype.seek=function(g){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var y=this._searchSegmentIndexContains(g);if(y===this._currentSegmentIndex){var f=this._mediaInfo.segments[y];if(f==null)this._pendingSeekTime=g;else{var S=f.getNearestKeyframe(g);this._remuxer.seek(S.milliseconds),this._ioctl.seek(S.fileposition),this._pendingResolveSeekPoint=S.milliseconds}}else{var w=this._mediaInfo.segments[y];w==null?(this._pendingSeekTime=g,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(y)):(S=w.getNearestKeyframe(g),this._internalAbort(),this._remuxer.seek(g),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[y].timestampBase,this._loadSegment(y,S.fileposition),this._pendingResolveSeekPoint=S.milliseconds,this._reportSegmentMediaInfo(y))}this._enableStatisticsReporter()}},_.prototype._searchSegmentIndexContains=function(g){for(var y=this._mediaDataSource.segments,f=y.length-1,S=0;S<y.length;S++)if(g<y[S].timestampBase){f=S-1;break}return f},_.prototype._onInitChunkArrival=function(g,y){var f=this,S=0;if(y>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,S=this._demuxer.parseChunks(g,y);else{var w=null;(w=I.probe(g)).match&&(this._setupFLVDemuxerRemuxer(w),S=this._demuxer.parseChunks(g,y)),w.match||w.needMoreData||(w=Jr.probe(g)).match&&(this._setupTSDemuxerRemuxer(w),S=this._demuxer.parseChunks(g,y)),w.match||w.needMoreData||(w=null,a.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){f._internalAbort()}),this._emitter.emit(ie.a.DEMUX_ERROR,N.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return S},_.prototype._setupFLVDemuxerRemuxer=function(g){this._demuxer=new I(g,this._config),this._remuxer||(this._remuxer=new is(this._config));var y=this._mediaDataSource;y.duration==null||isNaN(y.duration)||(this._demuxer.overridedDuration=y.duration),typeof y.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=y.hasAudio),typeof y.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=y.hasVideo),this._demuxer.timestampBase=y.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},_.prototype._setupTSDemuxerRemuxer=function(g){var y=this._demuxer=new Jr(g,this._config);this._remuxer||(this._remuxer=new is(this._config)),y.onError=this._onDemuxException.bind(this),y.onMediaInfo=this._onMediaInfo.bind(this),y.onMetaDataArrived=this._onMetaDataArrived.bind(this),y.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),y.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),y.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),y.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),y.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},_.prototype._onMediaInfo=function(g){var y=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},g),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.a.prototype));var f=Object.assign({},g);Object.setPrototypeOf(f,o.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=f,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var S=y._pendingSeekTime;y._pendingSeekTime=null,y.seek(S)})},_.prototype._onMetaDataArrived=function(g){this._emitter.emit(ie.a.METADATA_ARRIVED,g)},_.prototype._onScriptDataArrived=function(g){this._emitter.emit(ie.a.SCRIPTDATA_ARRIVED,g)},_.prototype._onTimedID3Metadata=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.dts!=null&&(g.dts-=y),this._emitter.emit(ie.a.TIMED_ID3_METADATA_ARRIVED,g))},_.prototype._onSMPTE2038Metadata=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.dts!=null&&(g.dts-=y),g.nearest_pts!=null&&(g.nearest_pts-=y),this._emitter.emit(ie.a.SMPTE2038_METADATA_ARRIVED,g))},_.prototype._onSCTE35Metadata=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.nearest_pts!=null&&(g.nearest_pts-=y),this._emitter.emit(ie.a.SCTE35_METADATA_ARRIVED,g))},_.prototype._onPESPrivateDataDescriptor=function(g){this._emitter.emit(ie.a.PES_PRIVATE_DATA_DESCRIPTOR,g)},_.prototype._onPESPrivateData=function(g){var y=this._remuxer.getTimestampBase();y!=null&&(g.pts!=null&&(g.pts-=y),g.nearest_pts!=null&&(g.nearest_pts-=y),g.dts!=null&&(g.dts-=y),this._emitter.emit(ie.a.PES_PRIVATE_DATA_ARRIVED,g))},_.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},_.prototype._onIOComplete=function(g){var y=g+1;y<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(y)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(ie.a.LOADING_COMPLETE),this._disableStatisticsReporter())},_.prototype._onIORedirect=function(g){var y=this._ioctl.extraData;this._mediaDataSource.segments[y].redirectedURL=g},_.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(ie.a.RECOVERED_EARLY_EOF)},_.prototype._onIOException=function(g,y){a.a.e(this.TAG,"IOException: type = "+g+", code = "+y.code+", msg = "+y.msg),this._emitter.emit(ie.a.IO_ERROR,g,y),this._disableStatisticsReporter()},_.prototype._onDemuxException=function(g,y){a.a.e(this.TAG,"DemuxException: type = "+g+", info = "+y),this._emitter.emit(ie.a.DEMUX_ERROR,g,y)},_.prototype._onRemuxerInitSegmentArrival=function(g,y){this._emitter.emit(ie.a.INIT_SEGMENT,g,y)},_.prototype._onRemuxerMediaSegmentArrival=function(g,y){if(this._pendingSeekTime==null&&(this._emitter.emit(ie.a.MEDIA_SEGMENT,g,y),this._pendingResolveSeekPoint!=null&&g==="video")){var f=y.info.syncPoints,S=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,l.a.safari&&f.length>0&&f[0].originalDts===S&&(S=f[0].pts),this._emitter.emit(ie.a.RECOMMEND_SEEKPOINT,S)}},_.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},_.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},_.prototype._reportSegmentMediaInfo=function(g){var y=this._mediaInfo.segments[g],f=Object.assign({},y);f.duration=this._mediaInfo.duration,f.segmentCount=this._mediaInfo.segmentCount,delete f.segments,delete f.keyframesIndex,this._emitter.emit(ie.a.MEDIA_INFO,f)},_.prototype._reportStatisticsInfo=function(){var g={};g.url=this._ioctl.currentURL,g.hasRedirect=this._ioctl.hasRedirect,g.hasRedirect&&(g.redirectedURL=this._ioctl.currentRedirectedURL),g.speed=this._ioctl.currentSpeed,g.loaderType=this._ioctl.loaderType,g.currentSegmentIndex=this._currentSegmentIndex,g.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(ie.a.STATISTICS_INFO,g)},_}();i.a=va},function(e,i,s){var r,n=s(0),a=function(){function M(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return M.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},M.prototype.addBytes=function(b){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=b,this._totalBytes+=b):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=b,this._totalBytes+=b):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=b,this._totalBytes+=b,this._lastCheckpoint=this._now())},Object.defineProperty(M.prototype,"currentKBps",{get:function(){this.addBytes(0);var b=(this._now()-this._lastCheckpoint)/1e3;return b==0&&(b=1),this._intervalBytes/b/1024},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"averageKBps",{get:function(){var b=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/b/1024},enumerable:!1,configurable:!0}),M}(),l=s(2),o=s(4),c=s(3),u=(r=function(M,b){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,I){T.__proto__=I}||function(T,I){for(var A in I)I.hasOwnProperty(A)&&(T[A]=I[A])})(M,b)},function(M,b){function T(){this.constructor=M}r(M,b),M.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}),h=function(M){function b(T,I){var A=M.call(this,"fetch-stream-loader")||this;return A.TAG="FetchStreamLoader",A._seekHandler=T,A._config=I,A._needStash=!0,A._requestAbort=!1,A._abortController=null,A._contentLength=null,A._receivedLength=0,A}return u(b,M),b.isSupported=function(){try{var T=o.a.msedge&&o.a.version.minor>=15048,I=!o.a.msedge||T;return self.fetch&&self.ReadableStream&&I}catch(A){return!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),M.prototype.destroy.call(this)},b.prototype.open=function(T,I){var A=this;this._dataSource=T,this._range=I;var U=T.url;this._config.reuseRedirectedURL&&T.redirectedURL!=null&&(U=T.redirectedURL);var B=this._seekHandler.getConfig(U,I),$=new self.Headers;if(typeof B.headers=="object"){var X=B.headers;for(var nt in X)X.hasOwnProperty(nt)&&$.append(nt,X[nt])}var ot={method:"GET",headers:$,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var nt in this._config.headers)$.append(nt,this._config.headers[nt]);T.cors===!1&&(ot.mode="same-origin"),T.withCredentials&&(ot.credentials="include"),T.referrerPolicy&&(ot.referrerPolicy=T.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,ot.signal=this._abortController.signal),this._status=l.c.kConnecting,self.fetch(B.url,ot).then(function(z){if(A._requestAbort)return A._status=l.c.kIdle,void z.body.cancel();if(z.ok&&z.status>=200&&z.status<=299){if(z.url!==B.url&&A._onURLRedirect){var k=A._seekHandler.removeURLParameters(z.url);A._onURLRedirect(k)}var F=z.headers.get("Content-Length");return F!=null&&(A._contentLength=parseInt(F),A._contentLength!==0&&A._onContentLengthKnown&&A._onContentLengthKnown(A._contentLength)),A._pump.call(A,z.body.getReader())}if(A._status=l.c.kError,!A._onError)throw new c.d("FetchStreamLoader: Http code invalid, "+z.status+" "+z.statusText);A._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:z.status,msg:z.statusText})}).catch(function(z){if(!A._abortController||!A._abortController.signal.aborted){if(A._status=l.c.kError,!A._onError)throw z;A._onError(l.b.EXCEPTION,{code:-1,msg:z.message})}})},b.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==l.c.kBuffering||!o.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(T){}},b.prototype._pump=function(T){var I=this;return T.read().then(function(A){if(A.done)if(I._contentLength!==null&&I._receivedLength<I._contentLength){I._status=l.c.kError;var U=l.b.EARLY_EOF,B={code:-1,msg:"Fetch stream meet Early-EOF"};if(!I._onError)throw new c.d(B.msg);I._onError(U,B)}else I._status=l.c.kComplete,I._onComplete&&I._onComplete(I._range.from,I._range.from+I._receivedLength-1);else{if(I._abortController&&I._abortController.signal.aborted)return void(I._status=l.c.kComplete);if(I._requestAbort===!0)return I._status=l.c.kComplete,T.cancel();I._status=l.c.kBuffering;var $=A.value.buffer,X=I._range.from+I._receivedLength;I._receivedLength+=$.byteLength,I._onDataArrival&&I._onDataArrival($,X,I._receivedLength),I._pump(T)}}).catch(function(A){if(I._abortController&&I._abortController.signal.aborted)I._status=l.c.kComplete;else if(A.code!==11||!o.a.msedge){I._status=l.c.kError;var U=0,B=null;if(A.code!==19&&A.message!=="network error"||!(I._contentLength===null||I._contentLength!==null&&I._receivedLength<I._contentLength)?(U=l.b.EXCEPTION,B={code:A.code,msg:A.message}):(U=l.b.EARLY_EOF,B={code:A.code,msg:"Fetch stream meet Early-EOF"}),!I._onError)throw new c.d(B.msg);I._onError(U,B)}})},b}(l.a),p=function(){var M=function(b,T){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,A){I.__proto__=A}||function(I,A){for(var U in A)A.hasOwnProperty(U)&&(I[U]=A[U])})(b,T)};return function(b,T){function I(){this.constructor=b}M(b,T),b.prototype=T===null?Object.create(T):(I.prototype=T.prototype,new I)}}(),m=function(M){function b(T,I){var A=M.call(this,"xhr-moz-chunked-loader")||this;return A.TAG="MozChunkedLoader",A._seekHandler=T,A._config=I,A._needStash=!0,A._xhr=null,A._requestAbort=!1,A._contentLength=null,A._receivedLength=0,A}return p(b,M),b.isSupported=function(){try{var T=new XMLHttpRequest;return T.open("GET","https://example.com",!0),T.responseType="moz-chunked-arraybuffer",T.responseType==="moz-chunked-arraybuffer"}catch(I){return n.a.w("MozChunkedLoader",I.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),M.prototype.destroy.call(this)},b.prototype.open=function(T,I){this._dataSource=T,this._range=I;var A=T.url;this._config.reuseRedirectedURL&&T.redirectedURL!=null&&(A=T.redirectedURL);var U=this._seekHandler.getConfig(A,I);this._requestURL=U.url;var B=this._xhr=new XMLHttpRequest;if(B.open("GET",U.url,!0),B.responseType="moz-chunked-arraybuffer",B.onreadystatechange=this._onReadyStateChange.bind(this),B.onprogress=this._onProgress.bind(this),B.onloadend=this._onLoadEnd.bind(this),B.onerror=this._onXhrError.bind(this),T.withCredentials&&(B.withCredentials=!0),typeof U.headers=="object"){var $=U.headers;for(var X in $)$.hasOwnProperty(X)&&B.setRequestHeader(X,$[X])}if(typeof this._config.headers=="object"){$=this._config.headers;for(var X in $)$.hasOwnProperty(X)&&B.setRequestHeader(X,$[X])}this._status=l.c.kConnecting,B.send()},b.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=l.c.kComplete},b.prototype._onReadyStateChange=function(T){var I=T.target;if(I.readyState===2){if(I.responseURL!=null&&I.responseURL!==this._requestURL&&this._onURLRedirect){var A=this._seekHandler.removeURLParameters(I.responseURL);this._onURLRedirect(A)}if(I.status!==0&&(I.status<200||I.status>299)){if(this._status=l.c.kError,!this._onError)throw new c.d("MozChunkedLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}else this._status=l.c.kBuffering}},b.prototype._onProgress=function(T){if(this._status!==l.c.kError){this._contentLength===null&&T.total!==null&&T.total!==0&&(this._contentLength=T.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var I=T.target.response,A=this._range.from+this._receivedLength;this._receivedLength+=I.byteLength,this._onDataArrival&&this._onDataArrival(I,A,this._receivedLength)}},b.prototype._onLoadEnd=function(T){this._requestAbort!==!0?this._status!==l.c.kError&&(this._status=l.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},b.prototype._onXhrError=function(T){this._status=l.c.kError;var I=0,A=null;if(this._contentLength&&T.loaded<this._contentLength?(I=l.b.EARLY_EOF,A={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(I=l.b.EXCEPTION,A={code:-1,msg:T.constructor.name+" "+T.type}),!this._onError)throw new c.d(A.msg);this._onError(I,A)},b}(l.a),v=function(){var M=function(b,T){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,A){I.__proto__=A}||function(I,A){for(var U in A)A.hasOwnProperty(U)&&(I[U]=A[U])})(b,T)};return function(b,T){function I(){this.constructor=b}M(b,T),b.prototype=T===null?Object.create(T):(I.prototype=T.prototype,new I)}}(),E=function(M){function b(T,I){var A=M.call(this,"xhr-range-loader")||this;return A.TAG="RangeLoader",A._seekHandler=T,A._config=I,A._needStash=!1,A._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],A._currentChunkSizeKB=384,A._currentSpeedNormalized=0,A._zeroSpeedChunkCount=0,A._xhr=null,A._speedSampler=new a,A._requestAbort=!1,A._waitForTotalLength=!1,A._totalLengthReceived=!1,A._currentRequestURL=null,A._currentRedirectedURL=null,A._currentRequestRange=null,A._totalLength=null,A._contentLength=null,A._receivedLength=0,A._lastTimeLoaded=0,A}return v(b,M),b.isSupported=function(){try{var T=new XMLHttpRequest;return T.open("GET","https://example.com",!0),T.responseType="arraybuffer",T.responseType==="arraybuffer"}catch(I){return n.a.w("RangeLoader",I.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),M.prototype.destroy.call(this)},Object.defineProperty(b.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),b.prototype.open=function(T,I){this._dataSource=T,this._range=I,this._status=l.c.kConnecting;var A=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(A=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||A?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},b.prototype._openSubRange=function(){var T=1024*this._currentChunkSizeKB,I=this._range.from+this._receivedLength,A=I+T;this._contentLength!=null&&A-this._range.from>=this._contentLength&&(A=this._range.from+this._contentLength-1),this._currentRequestRange={from:I,to:A},this._internalOpen(this._dataSource,this._currentRequestRange)},b.prototype._internalOpen=function(T,I){this._lastTimeLoaded=0;var A=T.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?A=this._currentRedirectedURL:T.redirectedURL!=null&&(A=T.redirectedURL));var U=this._seekHandler.getConfig(A,I);this._currentRequestURL=U.url;var B=this._xhr=new XMLHttpRequest;if(B.open("GET",U.url,!0),B.responseType="arraybuffer",B.onreadystatechange=this._onReadyStateChange.bind(this),B.onprogress=this._onProgress.bind(this),B.onload=this._onLoad.bind(this),B.onerror=this._onXhrError.bind(this),T.withCredentials&&(B.withCredentials=!0),typeof U.headers=="object"){var $=U.headers;for(var X in $)$.hasOwnProperty(X)&&B.setRequestHeader(X,$[X])}if(typeof this._config.headers=="object"){$=this._config.headers;for(var X in $)$.hasOwnProperty(X)&&B.setRequestHeader(X,$[X])}B.send()},b.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=l.c.kComplete},b.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},b.prototype._onReadyStateChange=function(T){var I=T.target;if(I.readyState===2){if(I.responseURL!=null){var A=this._seekHandler.removeURLParameters(I.responseURL);I.responseURL!==this._currentRequestURL&&A!==this._currentRedirectedURL&&(this._currentRedirectedURL=A,this._onURLRedirect&&this._onURLRedirect(A))}if(I.status>=200&&I.status<=299){if(this._waitForTotalLength)return;this._status=l.c.kBuffering}else{if(this._status=l.c.kError,!this._onError)throw new c.d("RangeLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}}},b.prototype._onProgress=function(T){if(this._status!==l.c.kError){if(this._contentLength===null){var I=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,I=!0;var A=T.total;this._internalAbort(),A!=null&A!==0&&(this._totalLength=A)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,I)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var U=T.loaded-this._lastTimeLoaded;this._lastTimeLoaded=T.loaded,this._speedSampler.addBytes(U)}},b.prototype._normalizeSpeed=function(T){var I=this._chunkSizeKBList,A=I.length-1,U=0,B=0,$=A;if(T<I[0])return I[0];for(;B<=$;){if((U=B+Math.floor(($-B)/2))===A||T>=I[U]&&T<I[U+1])return I[U];I[U]<T?B=U+1:$=U-1}},b.prototype._onLoad=function(T){if(this._status!==l.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var I=this._speedSampler.lastSecondKBps;if(I===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(I=this._speedSampler.currentKBps)),I!==0){var A=this._normalizeSpeed(I);this._currentSpeedNormalized!==A&&(this._currentSpeedNormalized=A,this._currentChunkSizeKB=A)}var U=T.target.response,B=this._range.from+this._receivedLength;this._receivedLength+=U.byteLength;var $=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():$=!0,this._onDataArrival&&this._onDataArrival(U,B,this._receivedLength),$&&(this._status=l.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},b.prototype._onXhrError=function(T){this._status=l.c.kError;var I=0,A=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(I=l.b.EARLY_EOF,A={code:-1,msg:"RangeLoader meet Early-Eof"}):(I=l.b.EXCEPTION,A={code:-1,msg:T.constructor.name+" "+T.type}),!this._onError)throw new c.d(A.msg);this._onError(I,A)},b}(l.a),C=function(){var M=function(b,T){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,A){I.__proto__=A}||function(I,A){for(var U in A)A.hasOwnProperty(U)&&(I[U]=A[U])})(b,T)};return function(b,T){function I(){this.constructor=b}M(b,T),b.prototype=T===null?Object.create(T):(I.prototype=T.prototype,new I)}}(),N=function(M){function b(){var T=M.call(this,"websocket-loader")||this;return T.TAG="WebSocketLoader",T._needStash=!0,T._ws=null,T._requestAbort=!1,T._receivedLength=0,T}return C(b,M),b.isSupported=function(){try{return self.WebSocket!==void 0}catch(T){return!1}},b.prototype.destroy=function(){this._ws&&this.abort(),M.prototype.destroy.call(this)},b.prototype.open=function(T){try{var I=this._ws=new self.WebSocket(T.url);I.binaryType="arraybuffer",I.onopen=this._onWebSocketOpen.bind(this),I.onclose=this._onWebSocketClose.bind(this),I.onmessage=this._onWebSocketMessage.bind(this),I.onerror=this._onWebSocketError.bind(this),this._status=l.c.kConnecting}catch(U){this._status=l.c.kError;var A={code:U.code,msg:U.message};if(!this._onError)throw new c.d(A.msg);this._onError(l.b.EXCEPTION,A)}},b.prototype.abort=function(){var T=this._ws;!T||T.readyState!==0&&T.readyState!==1||(this._requestAbort=!0,T.close()),this._ws=null,this._status=l.c.kComplete},b.prototype._onWebSocketOpen=function(T){this._status=l.c.kBuffering},b.prototype._onWebSocketClose=function(T){this._requestAbort!==!0?(this._status=l.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},b.prototype._onWebSocketMessage=function(T){var I=this;if(T.data instanceof ArrayBuffer)this._dispatchArrayBuffer(T.data);else if(T.data instanceof Blob){var A=new FileReader;A.onload=function(){I._dispatchArrayBuffer(A.result)},A.readAsArrayBuffer(T.data)}else{this._status=l.c.kError;var U={code:-1,msg:"Unsupported WebSocket message type: "+T.data.constructor.name};if(!this._onError)throw new c.d(U.msg);this._onError(l.b.EXCEPTION,U)}},b.prototype._dispatchArrayBuffer=function(T){var I=T,A=this._receivedLength;this._receivedLength+=I.byteLength,this._onDataArrival&&this._onDataArrival(I,A,this._receivedLength)},b.prototype._onWebSocketError=function(T){this._status=l.c.kError;var I={code:T.code,msg:T.message};if(!this._onError)throw new c.d(I.msg);this._onError(l.b.EXCEPTION,I)},b}(l.a),R=function(){function M(b){this._zeroStart=b||!1}return M.prototype.getConfig=function(b,T){var I={};if(T.from!==0||T.to!==-1){var A=void 0;A=T.to!==-1?"bytes="+T.from.toString()+"-"+T.to.toString():"bytes="+T.from.toString()+"-",I.Range=A}else this._zeroStart&&(I.Range="bytes=0-");return{url:b,headers:I}},M.prototype.removeURLParameters=function(b){return b},M}(),x=function(){function M(b,T){this._startName=b,this._endName=T}return M.prototype.getConfig=function(b,T){var I=b;if(T.from!==0||T.to!==-1){var A=!0;I.indexOf("?")===-1&&(I+="?",A=!1),A&&(I+="&"),I+=this._startName+"="+T.from.toString(),T.to!==-1&&(I+="&"+this._endName+"="+T.to.toString())}return{url:I,headers:{}}},M.prototype.removeURLParameters=function(b){var T=b.split("?")[0],I=void 0,A=b.indexOf("?");A!==-1&&(I=b.substring(A+1));var U="";if(I!=null&&I.length>0)for(var B=I.split("&"),$=0;$<B.length;$++){var X=B[$].split("="),nt=$>0;X[0]!==this._startName&&X[0]!==this._endName&&(nt&&(U+="&"),U+=B[$])}return U.length===0?T:T+"?"+U},M}(),P=function(){function M(b,T,I){this.TAG="IOController",this._config=T,this._extraData=I,this._stashInitialSize=65536,T.stashInitialSize!=null&&T.stashInitialSize>0&&(this._stashInitialSize=T.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,T.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=b,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(b.url),this._refTotalLength=b.filesize?b.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new a,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return M.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},M.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},M.prototype.isPaused=function(){return this._paused},Object.defineProperty(M.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"extraData",{get:function(){return this._extraData},set:function(b){this._extraData=b},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(b){this._onDataArrival=b},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(b){this._onSeeked=b},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onError",{get:function(){return this._onError},set:function(b){this._onError=b},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onComplete",{get:function(){return this._onComplete},set:function(b){this._onComplete=b},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(b){this._onRedirect=b},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(b){this._onRecoveredEarlyEof=b},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"currentSpeed",{get:function(){return this._loaderClass===E?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),M.prototype._selectSeekHandler=function(){var b=this._config;if(b.seekType==="range")this._seekHandler=new R(this._config.rangeLoadZeroStart);else if(b.seekType==="param"){var T=b.seekParamStart||"bstart",I=b.seekParamEnd||"bend";this._seekHandler=new x(T,I)}else{if(b.seekType!=="custom")throw new c.b("Invalid seekType in config: "+b.seekType);if(typeof b.customSeekHandler!="function")throw new c.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new b.customSeekHandler}},M.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=N;else if(h.isSupported())this._loaderClass=h;else if(m.isSupported())this._loaderClass=m;else{if(!E.isSupported())throw new c.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=E}},M.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},M.prototype.open=function(b){this._currentRange={from:0,to:-1},b&&(this._currentRange.from=b),this._speedSampler.reset(),b||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},M.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},M.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},M.prototype.resume=function(){if(this._paused){this._paused=!1;var b=this._resumeFrom;this._resumeFrom=0,this._internalSeek(b,!0)}},M.prototype.seek=function(b){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(b,!0)},M.prototype._internalSeek=function(b,T){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(T),this._loader.destroy(),this._loader=null;var I={from:b,to:-1};this._currentRange={from:I.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,I),this._onSeeked&&this._onSeeked()},M.prototype.updateUrl=function(b){if(!b||typeof b!="string"||b.length===0)throw new c.b("Url must be a non-empty string!");this._dataSource.url=b},M.prototype._expandBuffer=function(b){for(var T=this._stashSize;T+1048576<b;)T*=2;if((T+=1048576)!==this._bufferSize){var I=new ArrayBuffer(T);if(this._stashUsed>0){var A=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(I,0,T).set(A,0)}this._stashBuffer=I,this._bufferSize=T}},M.prototype._normalizeSpeed=function(b){var T=this._speedNormalizeList,I=T.length-1,A=0,U=0,B=I;if(b<T[0])return T[0];for(;U<=B;){if((A=U+Math.floor((B-U)/2))===I||b>=T[A]&&b<T[A+1])return T[A];T[A]<b?U=A+1:B=A-1}},M.prototype._adjustStashSize=function(b){var T=0;(T=this._config.isLive?b/8:b<512?b:b>=512&&b<=1024?Math.floor(1.5*b):2*b)>8192&&(T=8192);var I=1024*T+1048576;this._bufferSize<I&&this._expandBuffer(I),this._stashSize=1024*T},M.prototype._dispatchChunks=function(b,T){return this._currentRange.to=T+b.byteLength-1,this._onDataArrival(b,T)},M.prototype._onURLRedirect=function(b){this._redirectedURL=b,this._onRedirect&&this._onRedirect(b)},M.prototype._onContentLengthKnown=function(b){b&&this._fullRequestFlag&&(this._totalLength=b,this._fullRequestFlag=!1)},M.prototype._onLoaderChunkArrival=function(b,T,I){if(!this._onDataArrival)throw new c.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(b.byteLength);var A=this._speedSampler.lastSecondKBps;if(A!==0){var U=this._normalizeSpeed(A);this._speedNormalized!==U&&(this._speedNormalized=U,this._adjustStashSize(U))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=T),this._stashUsed+b.byteLength<=this._stashSize)(X=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength;else if(X=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var B=this._stashBuffer.slice(0,this._stashUsed);(nt=this._dispatchChunks(B,this._stashByteStart))<B.byteLength?nt>0&&(ot=new Uint8Array(B,nt),X.set(ot,0),this._stashUsed=ot.byteLength,this._stashByteStart+=nt):(this._stashUsed=0,this._stashByteStart+=nt),this._stashUsed+b.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+b.byteLength),X=new Uint8Array(this._stashBuffer,0,this._bufferSize)),X.set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength}else(nt=this._dispatchChunks(b,T))<b.byteLength&&(($=b.byteLength-nt)>this._bufferSize&&(this._expandBuffer($),X=new Uint8Array(this._stashBuffer,0,this._bufferSize)),X.set(new Uint8Array(b,nt),0),this._stashUsed+=$,this._stashByteStart=T+nt);else if(this._stashUsed===0){var $;(nt=this._dispatchChunks(b,T))<b.byteLength&&(($=b.byteLength-nt)>this._bufferSize&&this._expandBuffer($),(X=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(b,nt),0),this._stashUsed+=$,this._stashByteStart=T+nt)}else{var X,nt;if(this._stashUsed+b.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+b.byteLength),(X=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength,(nt=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&nt>0){var ot=new Uint8Array(this._stashBuffer,nt);X.set(ot,0)}this._stashUsed-=nt,this._stashByteStart+=nt}}},M.prototype._flushStashBuffer=function(b){if(this._stashUsed>0){var T=this._stashBuffer.slice(0,this._stashUsed),I=this._dispatchChunks(T,this._stashByteStart),A=T.byteLength-I;if(I<T.byteLength){if(!b){if(I>0){var U=new Uint8Array(this._stashBuffer,0,this._bufferSize),B=new Uint8Array(T,I);U.set(B,0),this._stashUsed=B.byteLength,this._stashByteStart+=I}return 0}n.a.w(this.TAG,A+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,A}return 0},M.prototype._onLoaderComplete=function(b,T){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},M.prototype._onLoaderError=function(b,T){switch(n.a.e(this.TAG,"Loader error, code = "+T.code+", msg = "+T.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,b=l.b.UNRECOVERABLE_EARLY_EOF),b){case l.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var I=this._currentRange.to+1;return void(I<this._totalLength&&(n.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(I,!1)))}b=l.b.UNRECOVERABLE_EARLY_EOF;break;case l.b.UNRECOVERABLE_EARLY_EOF:case l.b.CONNECTING_TIMEOUT:case l.b.HTTP_STATUS_CODE_INVALID:case l.b.EXCEPTION:}if(!this._onError)throw new c.d("IOException: "+T.msg);this._onError(b,T)},M}();i.a=P},function(e,i,s){var r=function(){function n(){}return n.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(a,l){return a.__proto__=l,a},Object.assign=Object.assign||function(a){if(a==null)throw new TypeError("Cannot convert undefined or null to object");for(var l=Object(a),o=1;o<arguments.length;o++){var c=arguments[o];if(c!=null)for(var u in c)c.hasOwnProperty(u)&&(l[u]=c[u])}return l},typeof self.Promise!="function"&&s(15).polyfill()},n}();r.install(),i.a=r},function(e,i,s){function r(o){var c={};function u(p){if(c[p])return c[p].exports;var m=c[p]={i:p,l:!1,exports:{}};return o[p].call(m.exports,m,m.exports,u),m.l=!0,m.exports}u.m=o,u.c=c,u.i=function(p){return p},u.d=function(p,m,v){u.o(p,m)||Object.defineProperty(p,m,{configurable:!1,enumerable:!0,get:v})},u.r=function(p){Object.defineProperty(p,"__esModule",{value:!0})},u.n=function(p){var m=p&&p.__esModule?function(){return p.default}:function(){return p};return u.d(m,"a",m),m},u.o=function(p,m){return Object.prototype.hasOwnProperty.call(p,m)},u.p="/",u.oe=function(p){throw console.error(p),p};var h=u(u.s=ENTRY_MODULE);return h.default||h}function n(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(o,c,u){var h={};h[u]=[];var p=c.toString(),m=p.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!m)return h;for(var v,E=m[1],C=new RegExp("(\\\\n|\\W)"+n(E)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");v=C.exec(p);)v[3]!=="dll-reference"&&h[u].push(v[3]);for(C=new RegExp("\\("+n(E)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");v=C.exec(p);)o[v[2]]||(h[u].push(v[1]),o[v[2]]=s(v[1]).m),h[v[2]]=h[v[2]]||[],h[v[2]].push(v[4]);for(var N,R=Object.keys(h),x=0;x<R.length;x++)for(var P=0;P<h[R[x]].length;P++)N=h[R[x]][P],isNaN(1*N)||(h[R[x]][P]=1*h[R[x]][P]);return h}function l(o){return Object.keys(o).reduce(function(c,u){return c||o[u].length>0},!1)}e.exports=function(o,c){c=c||{};var u={main:s.m},h=c.all?{main:Object.keys(u.main)}:function(C,N){for(var R={main:[N]},x={main:[]},P={main:{}};l(R);)for(var M=Object.keys(R),b=0;b<M.length;b++){var T=M[b],I=R[T].pop();if(P[T]=P[T]||{},!P[T][I]&&C[T][I]){P[T][I]=!0,x[T]=x[T]||[],x[T].push(I);for(var A=a(C,C[T][I],T),U=Object.keys(A),B=0;B<U.length;B++)R[U[B]]=R[U[B]]||[],R[U[B]]=R[U[B]].concat(A[U[B]])}}return x}(u,o),p="";Object.keys(h).filter(function(C){return C!=="main"}).forEach(function(C){for(var N=0;h[C][N];)N++;h[C].push(N),u[C][N]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",p=p+"var "+C+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(N))+")({"+h[C].map(function(R){return JSON.stringify(R)+": "+u[C][R].toString()}).join(",")+`});
`}),p=p+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+h.main.map(function(C){return JSON.stringify(C)+": "+u.main[C].toString()}).join(",")+"}))(self);";var m=new window.Blob([p],{type:"text/javascript"});if(c.bare)return m;var v=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(m),E=new window.Worker(v);return E.objectURL=v,E}},function(e,i,s){e.exports=s(19).default},function(e,i,s){(function(r,n){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var a;a=function(){function l(et){return typeof et=="function"}var o=Array.isArray?Array.isArray:function(et){return Object.prototype.toString.call(et)==="[object Array]"},c=0,u=void 0,h=void 0,p=function(et,at){x[c]=et,x[c+1]=at,(c+=2)===2&&(h?h(P):A())},m=typeof window!="undefined"?window:void 0,v=m||{},E=v.MutationObserver||v.WebKitMutationObserver,C=typeof self=="undefined"&&r!==void 0&&{}.toString.call(r)==="[object process]",N=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";function R(){var et=setTimeout;return function(){return et(P,1)}}var x=new Array(1e3);function P(){for(var et=0;et<c;et+=2)(0,x[et])(x[et+1]),x[et]=void 0,x[et+1]=void 0;c=0}var M,b,T,I,A=void 0;function U(et,at){var ft=this,yt=new this.constructor(X);yt[$]===void 0&&gt(yt);var _t=ft._state;if(_t){var wt=arguments[_t-1];p(function(){return rt(_t,yt,wt,ft._result)})}else G(ft,yt,et,at);return yt}function B(et){if(et&&typeof et=="object"&&et.constructor===this)return et;var at=new this(X);return ot(at,et),at}C?A=function(){return r.nextTick(P)}:E?(b=0,T=new E(P),I=document.createTextNode(""),T.observe(I,{characterData:!0}),A=function(){I.data=b=++b%2}):N?((M=new MessageChannel).port1.onmessage=P,A=function(){return M.port2.postMessage(0)}):A=m===void 0?function(){try{var et=Function("return this")().require("vertx");return(u=et.runOnLoop||et.runOnContext)!==void 0?function(){u(P)}:R()}catch(at){return R()}}():R();var $=Math.random().toString(36).substring(2);function X(){}function nt(et,at,ft){at.constructor===et.constructor&&ft===U&&at.constructor.resolve===B?function(yt,_t){_t._state===1?k(yt,_t._result):_t._state===2?F(yt,_t._result):G(_t,void 0,function(wt){return ot(yt,wt)},function(wt){return F(yt,wt)})}(et,at):ft===void 0?k(et,at):l(ft)?function(yt,_t,wt){p(function(Vt){var Ft=!1,Jt=function(Qt,Re,De,Ce){try{Qt.call(Re,De,Ce)}catch(fe){return fe}}(wt,_t,function(Qt){Ft||(Ft=!0,_t!==Qt?ot(Vt,Qt):k(Vt,Qt))},function(Qt){Ft||(Ft=!0,F(Vt,Qt))},Vt._label);!Ft&&Jt&&(Ft=!0,F(Vt,Jt))},yt)}(et,at,ft):k(et,at)}function ot(et,at){if(et===at)F(et,new TypeError("You cannot resolve a promise with itself"));else if(_t=typeof(yt=at),yt===null||_t!=="object"&&_t!=="function")k(et,at);else{var ft=void 0;try{ft=at.then}catch(wt){return void F(et,wt)}nt(et,at,ft)}var yt,_t}function z(et){et._onerror&&et._onerror(et._result),Z(et)}function k(et,at){et._state===void 0&&(et._result=at,et._state=1,et._subscribers.length!==0&&p(Z,et))}function F(et,at){et._state===void 0&&(et._state=2,et._result=at,p(z,et))}function G(et,at,ft,yt){var _t=et._subscribers,wt=_t.length;et._onerror=null,_t[wt]=at,_t[wt+1]=ft,_t[wt+2]=yt,wt===0&&et._state&&p(Z,et)}function Z(et){var at=et._subscribers,ft=et._state;if(at.length!==0){for(var yt=void 0,_t=void 0,wt=et._result,Vt=0;Vt<at.length;Vt+=3)yt=at[Vt],_t=at[Vt+ft],yt?rt(ft,yt,_t,wt):_t(wt);et._subscribers.length=0}}function rt(et,at,ft,yt){var _t=l(ft),wt=void 0,Vt=void 0,Ft=!0;if(_t){try{wt=ft(yt)}catch(Jt){Ft=!1,Vt=Jt}if(at===wt)return void F(at,new TypeError("A promises callback cannot return that same promise."))}else wt=yt;at._state!==void 0||(_t&&Ft?ot(at,wt):Ft===!1?F(at,Vt):et===1?k(at,wt):et===2&&F(at,wt))}var ut=0;function gt(et){et[$]=ut++,et._state=void 0,et._result=void 0,et._subscribers=[]}var It=function(){function et(at,ft){this._instanceConstructor=at,this.promise=new at(X),this.promise[$]||gt(this.promise),o(ft)?(this.length=ft.length,this._remaining=ft.length,this._result=new Array(this.length),this.length===0?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(ft),this._remaining===0&&k(this.promise,this._result))):F(this.promise,new Error("Array Methods must be provided an Array"))}return et.prototype._enumerate=function(at){for(var ft=0;this._state===void 0&&ft<at.length;ft++)this._eachEntry(at[ft],ft)},et.prototype._eachEntry=function(at,ft){var yt=this._instanceConstructor,_t=yt.resolve;if(_t===B){var wt=void 0,Vt=void 0,Ft=!1;try{wt=at.then}catch(Qt){Ft=!0,Vt=Qt}if(wt===U&&at._state!==void 0)this._settledAt(at._state,ft,at._result);else if(typeof wt!="function")this._remaining--,this._result[ft]=at;else if(yt===Dt){var Jt=new yt(X);Ft?F(Jt,Vt):nt(Jt,at,wt),this._willSettleAt(Jt,ft)}else this._willSettleAt(new yt(function(Qt){return Qt(at)}),ft)}else this._willSettleAt(_t(at),ft)},et.prototype._settledAt=function(at,ft,yt){var _t=this.promise;_t._state===void 0&&(this._remaining--,at===2?F(_t,yt):this._result[ft]=yt),this._remaining===0&&k(_t,this._result)},et.prototype._willSettleAt=function(at,ft){var yt=this;G(at,void 0,function(_t){return yt._settledAt(1,ft,_t)},function(_t){return yt._settledAt(2,ft,_t)})},et}(),Dt=function(){function et(at){this[$]=ut++,this._result=this._state=void 0,this._subscribers=[],X!==at&&(typeof at!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof et?function(ft,yt){try{yt(function(_t){ot(ft,_t)},function(_t){F(ft,_t)})}catch(_t){F(ft,_t)}}(this,at):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return et.prototype.catch=function(at){return this.then(null,at)},et.prototype.finally=function(at){var ft=this.constructor;return l(at)?this.then(function(yt){return ft.resolve(at()).then(function(){return yt})},function(yt){return ft.resolve(at()).then(function(){throw yt})}):this.then(at,at)},et}();return Dt.prototype.then=U,Dt.all=function(et){return new It(this,et).promise},Dt.race=function(et){var at=this;return o(et)?new at(function(ft,yt){for(var _t=et.length,wt=0;wt<_t;wt++)at.resolve(et[wt]).then(ft,yt)}):new at(function(ft,yt){return yt(new TypeError("You must pass an array to race."))})},Dt.resolve=B,Dt.reject=function(et){var at=new this(X);return F(at,et),at},Dt._setScheduler=function(et){h=et},Dt._setAsap=function(et){p=et},Dt._asap=p,Dt.polyfill=function(){var et=void 0;if(n!==void 0)et=n;else if(typeof self!="undefined")et=self;else try{et=Function("return this")()}catch(yt){throw new Error("polyfill failed because global object is unavailable in this environment")}var at=et.Promise;if(at){var ft=null;try{ft=Object.prototype.toString.call(at.resolve())}catch(yt){}if(ft==="[object Promise]"&&!at.cast)return}et.Promise=Dt},Dt.Promise=Dt,Dt},e.exports=a()}).call(this,s(16),s(17))},function(e,i){var s,r,n=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function o(N){if(s===setTimeout)return setTimeout(N,0);if((s===a||!s)&&setTimeout)return s=setTimeout,setTimeout(N,0);try{return s(N,0)}catch(R){try{return s.call(null,N,0)}catch(x){return s.call(this,N,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:a}catch(N){s=a}try{r=typeof clearTimeout=="function"?clearTimeout:l}catch(N){r=l}})();var c,u=[],h=!1,p=-1;function m(){h&&c&&(h=!1,c.length?u=c.concat(u):p=-1,u.length&&v())}function v(){if(!h){var N=o(m);h=!0;for(var R=u.length;R;){for(c=u,u=[];++p<R;)c&&c[p].run();p=-1,R=u.length}c=null,h=!1,function(x){if(r===clearTimeout)return clearTimeout(x);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(x);try{r(x)}catch(P){try{return r.call(null,x)}catch(M){return r.call(this,x)}}}(N)}}function E(N,R){this.fun=N,this.array=R}function C(){}n.nextTick=function(N){var R=new Array(arguments.length-1);if(arguments.length>1)for(var x=1;x<arguments.length;x++)R[x-1]=arguments[x];u.push(new E(N,R)),u.length!==1||h||o(v)},E.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=C,n.addListener=C,n.once=C,n.off=C,n.removeListener=C,n.removeAllListeners=C,n.emit=C,n.prependListener=C,n.prependOnceListener=C,n.listeners=function(N){return[]},n.binding=function(N){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(N){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,i){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(r){typeof window=="object"&&(s=window)}e.exports=s},function(e,i,s){s.r(i);var r=s(9),n=s(12),a=s(10),l=s(1);i.default=function(o){var c=null,u=function(B,$){o.postMessage({msg:"logcat_callback",data:{type:B,logcat:$}})}.bind(this);function h(B,$){var X={msg:l.a.INIT_SEGMENT,data:{type:B,data:$}};o.postMessage(X,[$.data])}function p(B,$){var X={msg:l.a.MEDIA_SEGMENT,data:{type:B,data:$}};o.postMessage(X,[$.data])}function m(){var B={msg:l.a.LOADING_COMPLETE};o.postMessage(B)}function v(){var B={msg:l.a.RECOVERED_EARLY_EOF};o.postMessage(B)}function E(B){var $={msg:l.a.MEDIA_INFO,data:B};o.postMessage($)}function C(B){var $={msg:l.a.METADATA_ARRIVED,data:B};o.postMessage($)}function N(B){var $={msg:l.a.SCRIPTDATA_ARRIVED,data:B};o.postMessage($)}function R(B){var $={msg:l.a.TIMED_ID3_METADATA_ARRIVED,data:B};o.postMessage($)}function x(B){var $={msg:l.a.SMPTE2038_METADATA_ARRIVED,data:B};o.postMessage($)}function P(B){var $={msg:l.a.SCTE35_METADATA_ARRIVED,data:B};o.postMessage($)}function M(B){var $={msg:l.a.PES_PRIVATE_DATA_DESCRIPTOR,data:B};o.postMessage($)}function b(B){var $={msg:l.a.PES_PRIVATE_DATA_ARRIVED,data:B};o.postMessage($)}function T(B){var $={msg:l.a.STATISTICS_INFO,data:B};o.postMessage($)}function I(B,$){o.postMessage({msg:l.a.IO_ERROR,data:{type:B,info:$}})}function A(B,$){o.postMessage({msg:l.a.DEMUX_ERROR,data:{type:B,info:$}})}function U(B){o.postMessage({msg:l.a.RECOMMEND_SEEKPOINT,data:B})}n.a.install(),o.addEventListener("message",function(B){switch(B.data.cmd){case"init":(c=new a.a(B.data.param[0],B.data.param[1])).on(l.a.IO_ERROR,I.bind(this)),c.on(l.a.DEMUX_ERROR,A.bind(this)),c.on(l.a.INIT_SEGMENT,h.bind(this)),c.on(l.a.MEDIA_SEGMENT,p.bind(this)),c.on(l.a.LOADING_COMPLETE,m.bind(this)),c.on(l.a.RECOVERED_EARLY_EOF,v.bind(this)),c.on(l.a.MEDIA_INFO,E.bind(this)),c.on(l.a.METADATA_ARRIVED,C.bind(this)),c.on(l.a.SCRIPTDATA_ARRIVED,N.bind(this)),c.on(l.a.TIMED_ID3_METADATA_ARRIVED,R.bind(this)),c.on(l.a.SMPTE2038_METADATA_ARRIVED,x.bind(this)),c.on(l.a.SCTE35_METADATA_ARRIVED,P.bind(this)),c.on(l.a.PES_PRIVATE_DATA_DESCRIPTOR,M.bind(this)),c.on(l.a.PES_PRIVATE_DATA_ARRIVED,b.bind(this)),c.on(l.a.STATISTICS_INFO,T.bind(this)),c.on(l.a.RECOMMEND_SEEKPOINT,U.bind(this));break;case"destroy":c&&(c.destroy(),c=null),o.postMessage({msg:"destroyed"});break;case"start":c.start();break;case"stop":c.stop();break;case"seek":c.seek(B.data.param);break;case"pause":c.pause();break;case"resume":c.resume();break;case"logging_config":var $=B.data.param;r.a.applyConfig($),$.enableCallback===!0?r.a.addLogListener(u):r.a.removeLogListener(u)}})}},function(e,i,s){s.r(i);var r=s(12),n=s(11),a={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function l(){return Object.assign({},a)}var o=function(){function z(){}return z.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},z.supportMSEH265Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')},z.supportNetworkStreamIO=function(){var k=new n.a({},l()),F=k.loaderType;return k.destroy(),F=="fetch-stream-loader"||F=="xhr-moz-chunked-loader"},z.getNetworkLoaderTypeName=function(){var k=new n.a({},l()),F=k.loaderType;return k.destroy(),F},z.supportNativeMediaPlayback=function(k){z.videoElement==null&&(z.videoElement=window.document.createElement("video"));var F=z.videoElement.canPlayType(k);return F==="probably"||F=="maybe"},z.getFeatureList=function(){var k={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return k.msePlayback=z.supportMSEH264Playback(),k.networkStreamIO=z.supportNetworkStreamIO(),k.networkLoaderName=z.getNetworkLoaderTypeName(),k.mseLivePlayback=k.msePlayback&&k.networkStreamIO,k.mseH265Playback=z.supportMSEH265Playback(),k.nativeMP4H264Playback=z.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),k.nativeMP4H265Playback=z.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),k.nativeWebmVP8Playback=z.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),k.nativeWebmVP9Playback=z.supportNativeMediaPlayback('video/webm; codecs="vp9"'),k},z}(),c=s(2),u=s(6),h=s.n(u),p=s(0),m=s(4),v={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info"},E=s(13),C=s.n(E),N=s(9),R=s(10),x=s(1),P=s(8),M=function(){function z(k,F){if(this.TAG="Transmuxer",this._emitter=new h.a,F.enableWorker&&typeof Worker!="undefined")try{this._worker=C()(18),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[k,F]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},N.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:N.a.getConfig()})}catch(Z){p.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new R.a(k,F)}else this._controller=new R.a(k,F);if(this._controller){var G=this._controller;G.on(x.a.IO_ERROR,this._onIOError.bind(this)),G.on(x.a.DEMUX_ERROR,this._onDemuxError.bind(this)),G.on(x.a.INIT_SEGMENT,this._onInitSegment.bind(this)),G.on(x.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),G.on(x.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),G.on(x.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),G.on(x.a.MEDIA_INFO,this._onMediaInfo.bind(this)),G.on(x.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),G.on(x.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),G.on(x.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),G.on(x.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),G.on(x.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),G.on(x.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),G.on(x.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),G.on(x.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),G.on(x.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return z.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),N.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},z.prototype.on=function(k,F){this._emitter.addListener(k,F)},z.prototype.off=function(k,F){this._emitter.removeListener(k,F)},z.prototype.hasWorker=function(){return this._worker!=null},z.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},z.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},z.prototype.seek=function(k){this._worker?this._worker.postMessage({cmd:"seek",param:k}):this._controller.seek(k)},z.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},z.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},z.prototype._onInitSegment=function(k,F){var G=this;Promise.resolve().then(function(){G._emitter.emit(x.a.INIT_SEGMENT,k,F)})},z.prototype._onMediaSegment=function(k,F){var G=this;Promise.resolve().then(function(){G._emitter.emit(x.a.MEDIA_SEGMENT,k,F)})},z.prototype._onLoadingComplete=function(){var k=this;Promise.resolve().then(function(){k._emitter.emit(x.a.LOADING_COMPLETE)})},z.prototype._onRecoveredEarlyEof=function(){var k=this;Promise.resolve().then(function(){k._emitter.emit(x.a.RECOVERED_EARLY_EOF)})},z.prototype._onMediaInfo=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.MEDIA_INFO,k)})},z.prototype._onMetaDataArrived=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.METADATA_ARRIVED,k)})},z.prototype._onScriptDataArrived=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.SCRIPTDATA_ARRIVED,k)})},z.prototype._onTimedID3MetadataArrived=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.TIMED_ID3_METADATA_ARRIVED,k)})},z.prototype._onSMPTE2038MetadataArrived=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.SMPTE2038_METADATA_ARRIVED,k)})},z.prototype._onSCTE35MetadataArrived=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.SCTE35_METADATA_ARRIVED,k)})},z.prototype._onPESPrivateDataDescriptor=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.PES_PRIVATE_DATA_DESCRIPTOR,k)})},z.prototype._onPESPrivateDataArrived=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.PES_PRIVATE_DATA_ARRIVED,k)})},z.prototype._onStatisticsInfo=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.STATISTICS_INFO,k)})},z.prototype._onIOError=function(k,F){var G=this;Promise.resolve().then(function(){G._emitter.emit(x.a.IO_ERROR,k,F)})},z.prototype._onDemuxError=function(k,F){var G=this;Promise.resolve().then(function(){G._emitter.emit(x.a.DEMUX_ERROR,k,F)})},z.prototype._onRecommendSeekpoint=function(k){var F=this;Promise.resolve().then(function(){F._emitter.emit(x.a.RECOMMEND_SEEKPOINT,k)})},z.prototype._onLoggingConfigChanged=function(k){this._worker&&this._worker.postMessage({cmd:"logging_config",param:k})},z.prototype._onWorkerMessage=function(k){var F=k.data,G=F.data;if(F.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(F.msg){case x.a.INIT_SEGMENT:case x.a.MEDIA_SEGMENT:this._emitter.emit(F.msg,G.type,G.data);break;case x.a.LOADING_COMPLETE:case x.a.RECOVERED_EARLY_EOF:this._emitter.emit(F.msg);break;case x.a.MEDIA_INFO:Object.setPrototypeOf(G,P.a.prototype),this._emitter.emit(F.msg,G);break;case x.a.METADATA_ARRIVED:case x.a.SCRIPTDATA_ARRIVED:case x.a.TIMED_ID3_METADATA_ARRIVED:case x.a.SMPTE2038_METADATA_ARRIVED:case x.a.SCTE35_METADATA_ARRIVED:case x.a.PES_PRIVATE_DATA_DESCRIPTOR:case x.a.PES_PRIVATE_DATA_ARRIVED:case x.a.STATISTICS_INFO:this._emitter.emit(F.msg,G);break;case x.a.IO_ERROR:case x.a.DEMUX_ERROR:this._emitter.emit(F.msg,G.type,G.info);break;case x.a.RECOMMEND_SEEKPOINT:this._emitter.emit(F.msg,G);break;case"logcat_callback":p.a.emitter.emit("log",G.type,G.logcat)}},z}(),b={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"},T=s(7),I=s(3),A=function(){function z(k){this.TAG="MSEController",this._config=k,this._emitter=new h.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new T.a}return z.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},z.prototype.on=function(k,F){this._emitter.addListener(k,F)},z.prototype.off=function(k,F){this._emitter.removeListener(k,F)},z.prototype.attachMediaElement=function(k){if(this._mediaSource)throw new I.a("MediaSource has been attached to an HTMLMediaElement!");var F=this._mediaSource=new window.MediaSource;F.addEventListener("sourceopen",this.e.onSourceOpen),F.addEventListener("sourceended",this.e.onSourceEnded),F.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=k,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),k.src=this._mediaSourceObjectURL},z.prototype.detachMediaElement=function(){if(this._mediaSource){var k=this._mediaSource;for(var F in this._sourceBuffers){var G=this._pendingSegments[F];G.splice(0,G.length),this._pendingSegments[F]=null,this._pendingRemoveRanges[F]=null,this._lastInitSegments[F]=null;var Z=this._sourceBuffers[F];if(Z){if(k.readyState!=="closed"){try{k.removeSourceBuffer(Z)}catch(rt){p.a.e(this.TAG,rt.message)}Z.removeEventListener("error",this.e.onSourceBufferError),Z.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[F]=null,this._sourceBuffers[F]=null}}if(k.readyState==="open")try{k.endOfStream()}catch(rt){p.a.e(this.TAG,rt.message)}k.removeEventListener("sourceopen",this.e.onSourceOpen),k.removeEventListener("sourceended",this.e.onSourceEnded),k.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},z.prototype.appendInitSegment=function(k,F){if(!this._mediaSource||this._mediaSource.readyState!=="open")return this._pendingSourceBufferInit.push(k),void this._pendingSegments[k.type].push(k);var G=k,Z=""+G.container;G.codec&&G.codec.length>0&&(Z+=";codecs="+G.codec);var rt=!1;if(p.a.v(this.TAG,"Received Initialization Segment, mimeType: "+Z),this._lastInitSegments[G.type]=G,Z!==this._mimeTypes[G.type]){if(this._mimeTypes[G.type])p.a.v(this.TAG,"Notice: "+G.type+" mimeType changed, origin: "+this._mimeTypes[G.type]+", target: "+Z);else{rt=!0;try{var ut=this._sourceBuffers[G.type]=this._mediaSource.addSourceBuffer(Z);ut.addEventListener("error",this.e.onSourceBufferError),ut.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(gt){return p.a.e(this.TAG,gt.message),void this._emitter.emit(b.ERROR,{code:gt.code,msg:gt.message})}}this._mimeTypes[G.type]=Z}F||this._pendingSegments[G.type].push(G),rt||this._sourceBuffers[G.type]&&!this._sourceBuffers[G.type].updating&&this._doAppendSegments(),m.a.safari&&G.container==="audio/mpeg"&&G.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=G.mediaDuration/1e3,this._updateMediaSourceDuration())},z.prototype.appendMediaSegment=function(k){var F=k;this._pendingSegments[F.type].push(F),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var G=this._sourceBuffers[F.type];!G||G.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},z.prototype.seek=function(k){for(var F in this._sourceBuffers)if(this._sourceBuffers[F]){var G=this._sourceBuffers[F];if(this._mediaSource.readyState==="open")try{G.abort()}catch(Dt){p.a.e(this.TAG,Dt.message)}this._idrList.clear();var Z=this._pendingSegments[F];if(Z.splice(0,Z.length),this._mediaSource.readyState!=="closed"){for(var rt=0;rt<G.buffered.length;rt++){var ut=G.buffered.start(rt),gt=G.buffered.end(rt);this._pendingRemoveRanges[F].push({start:ut,end:gt})}if(G.updating||this._doRemoveRanges(),m.a.safari){var It=this._lastInitSegments[F];It&&(this._pendingSegments[F].push(It),G.updating||this._doAppendSegments())}}}},z.prototype.endOfStream=function(){var k=this._mediaSource,F=this._sourceBuffers;k&&k.readyState==="open"?F.video&&F.video.updating||F.audio&&F.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,k.endOfStream()):k&&k.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},z.prototype.getNearestKeyframe=function(k){return this._idrList.getLastSyncPointBeforeDts(k)},z.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var k=this._mediaElement.currentTime;for(var F in this._sourceBuffers){var G=this._sourceBuffers[F];if(G){var Z=G.buffered;if(Z.length>=1&&k-Z.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},z.prototype._doCleanupSourceBuffer=function(){var k=this._mediaElement.currentTime;for(var F in this._sourceBuffers){var G=this._sourceBuffers[F];if(G){for(var Z=G.buffered,rt=!1,ut=0;ut<Z.length;ut++){var gt=Z.start(ut),It=Z.end(ut);if(gt<=k&&k<It+3){if(k-gt>=this._config.autoCleanupMaxBackwardDuration){rt=!0;var Dt=k-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[F].push({start:gt,end:Dt})}}else It<k&&(rt=!0,this._pendingRemoveRanges[F].push({start:gt,end:It}))}rt&&!G.updating&&this._doRemoveRanges()}}},z.prototype._updateMediaSourceDuration=function(){var k=this._sourceBuffers;if(this._mediaElement.readyState!==0&&this._mediaSource.readyState==="open"&&!(k.video&&k.video.updating||k.audio&&k.audio.updating)){var F=this._mediaSource.duration,G=this._pendingMediaDuration;G>0&&(isNaN(F)||G>F)&&(p.a.v(this.TAG,"Update MediaSource duration from "+F+" to "+G),this._mediaSource.duration=G),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},z.prototype._doRemoveRanges=function(){for(var k in this._pendingRemoveRanges)if(this._sourceBuffers[k]&&!this._sourceBuffers[k].updating)for(var F=this._sourceBuffers[k],G=this._pendingRemoveRanges[k];G.length&&!F.updating;){var Z=G.shift();F.remove(Z.start,Z.end)}},z.prototype._doAppendSegments=function(){var k=this._pendingSegments;for(var F in k)if(this._sourceBuffers[F]&&!this._sourceBuffers[F].updating&&k[F].length>0){var G=k[F].shift();if(G.timestampOffset){var Z=this._sourceBuffers[F].timestampOffset,rt=G.timestampOffset/1e3;Math.abs(Z-rt)>.1&&(p.a.v(this.TAG,"Update MPEG audio timestampOffset from "+Z+" to "+rt),this._sourceBuffers[F].timestampOffset=rt),delete G.timestampOffset}if(!G.data||G.data.byteLength===0)continue;try{this._sourceBuffers[F].appendBuffer(G.data),this._isBufferFull=!1,F==="video"&&G.hasOwnProperty("info")&&this._idrList.appendArray(G.info.syncPoints)}catch(ut){this._pendingSegments[F].unshift(G),ut.code===22?(this._isBufferFull||this._emitter.emit(b.BUFFER_FULL),this._isBufferFull=!0):(p.a.e(this.TAG,ut.message),this._emitter.emit(b.ERROR,{code:ut.code,msg:ut.message}))}}},z.prototype._onSourceOpen=function(){if(p.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var k=this._pendingSourceBufferInit;k.length;){var F=k.shift();this.appendInitSegment(F,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(b.SOURCE_OPEN)},z.prototype._onSourceEnded=function(){p.a.v(this.TAG,"MediaSource onSourceEnded")},z.prototype._onSourceClose=function(){p.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},z.prototype._hasPendingSegments=function(){var k=this._pendingSegments;return k.video.length>0||k.audio.length>0},z.prototype._hasPendingRemoveRanges=function(){var k=this._pendingRemoveRanges;return k.video.length>0||k.audio.length>0},z.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(b.UPDATE_END)},z.prototype._onSourceBufferError=function(k){p.a.e(this.TAG,"SourceBuffer Error: "+k)},z}(),U=s(5),B={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},$={NETWORK_EXCEPTION:c.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:c.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:c.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:c.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:U.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:U.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:U.a.CODEC_UNSUPPORTED},X=function(){function z(k,F){this.TAG="MSEPlayer",this._type="MSEPlayer",this._emitter=new h.a,this._config=l(),typeof F=="object"&&Object.assign(this._config,F);var G=k.type.toLowerCase();if(G!=="mse"&&G!=="mpegts"&&G!=="m2ts"&&G!=="flv")throw new I.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");k.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=k,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var Z=m.a.chrome&&(m.a.version.major<50||m.a.version.major===50&&m.a.version.build<2661);this._alwaysSeekKeyframe=!!(Z||m.a.msedge||m.a.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return z.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},z.prototype.on=function(k,F){var G=this;k===v.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){G._emitter.emit(v.MEDIA_INFO,G.mediaInfo)}):k===v.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){G._emitter.emit(v.STATISTICS_INFO,G.statisticsInfo)}),this._emitter.addListener(k,F)},z.prototype.off=function(k,F){this._emitter.removeListener(k,F)},z.prototype.attachMediaElement=function(k){var F=this;if(this._mediaElement=k,k.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),k.addEventListener("seeking",this.e.onvSeeking),k.addEventListener("canplay",this.e.onvCanPlay),k.addEventListener("stalled",this.e.onvStalled),k.addEventListener("progress",this.e.onvProgress),this._msectl=new A(this._config),this._msectl.on(b.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(b.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(b.SOURCE_OPEN,function(){F._mseSourceOpened=!0,F._hasPendingLoad&&(F._hasPendingLoad=!1,F.load())}),this._msectl.on(b.ERROR,function(G){F._emitter.emit(v.ERROR,B.MEDIA_ERROR,$.MEDIA_MSE_ERROR,G)}),this._msectl.attachMediaElement(k),this._pendingSeekTime!=null)try{k.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(G){}},z.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},z.prototype.load=function(){var k=this;if(!this._mediaElement)throw new I.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new I.a("MSEPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new M(this._mediaDataSource,this._config),this._transmuxer.on(x.a.INIT_SEGMENT,function(F,G){k._msectl.appendInitSegment(G)}),this._transmuxer.on(x.a.MEDIA_SEGMENT,function(F,G){if(k._msectl.appendMediaSegment(G),k._config.lazyLoad&&!k._config.isLive){var Z=k._mediaElement.currentTime;G.info.endDts>=1e3*(Z+k._config.lazyLoadMaxDuration)&&k._progressChecker==null&&(p.a.v(k.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),k._suspendTransmuxer())}}),this._transmuxer.on(x.a.LOADING_COMPLETE,function(){k._msectl.endOfStream(),k._emitter.emit(v.LOADING_COMPLETE)}),this._transmuxer.on(x.a.RECOVERED_EARLY_EOF,function(){k._emitter.emit(v.RECOVERED_EARLY_EOF)}),this._transmuxer.on(x.a.IO_ERROR,function(F,G){k._emitter.emit(v.ERROR,B.NETWORK_ERROR,F,G)}),this._transmuxer.on(x.a.DEMUX_ERROR,function(F,G){k._emitter.emit(v.ERROR,B.MEDIA_ERROR,F,{code:-1,msg:G})}),this._transmuxer.on(x.a.MEDIA_INFO,function(F){k._mediaInfo=F,k._emitter.emit(v.MEDIA_INFO,Object.assign({},F))}),this._transmuxer.on(x.a.METADATA_ARRIVED,function(F){k._emitter.emit(v.METADATA_ARRIVED,F)}),this._transmuxer.on(x.a.SCRIPTDATA_ARRIVED,function(F){k._emitter.emit(v.SCRIPTDATA_ARRIVED,F)}),this._transmuxer.on(x.a.TIMED_ID3_METADATA_ARRIVED,function(F){k._emitter.emit(v.TIMED_ID3_METADATA_ARRIVED,F)}),this._transmuxer.on(x.a.SMPTE2038_METADATA_ARRIVED,function(F){k._emitter.emit(v.SMPTE2038_METADATA_ARRIVED,F)}),this._transmuxer.on(x.a.SCTE35_METADATA_ARRIVED,function(F){k._emitter.emit(v.SCTE35_METADATA_ARRIVED,F)}),this._transmuxer.on(x.a.PES_PRIVATE_DATA_DESCRIPTOR,function(F){k._emitter.emit(v.PES_PRIVATE_DATA_DESCRIPTOR,F)}),this._transmuxer.on(x.a.PES_PRIVATE_DATA_ARRIVED,function(F){k._emitter.emit(v.PES_PRIVATE_DATA_ARRIVED,F)}),this._transmuxer.on(x.a.STATISTICS_INFO,function(F){k._statisticsInfo=k._fillStatisticsInfo(F),k._emitter.emit(v.STATISTICS_INFO,Object.assign({},k._statisticsInfo))}),this._transmuxer.on(x.a.RECOMMEND_SEEKPOINT,function(F){k._mediaElement&&!k._config.accurateSeek&&(k._requestSetTime=!0,k._mediaElement.currentTime=F/1e3)}),this._transmuxer.open()))},z.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},z.prototype.play=function(){return this._mediaElement.play()},z.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(z.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(k){this._mediaElement.volume=k},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(k){this._mediaElement.muted=k},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(k){this._mediaElement?this._internalSeek(k):this._pendingSeekTime=k},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),z.prototype._fillStatisticsInfo=function(k){if(k.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return k;var F=!0,G=0,Z=0;if(this._mediaElement.getVideoPlaybackQuality){var rt=this._mediaElement.getVideoPlaybackQuality();G=rt.totalVideoFrames,Z=rt.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(G=this._mediaElement.webkitDecodedFrameCount,Z=this._mediaElement.webkitDroppedFrameCount):F=!1;return F&&(k.decodedFrames=G,k.droppedFrames=Z),k},z.prototype._onmseUpdateEnd=function(){var k=this._mediaElement.buffered,F=this._mediaElement.currentTime;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&k.length>0&&!this._mediaElement.paused){var G=k.end(k.length-1);if(G>this._config.liveBufferLatencyMaxLatency&&G-F>this._config.liveBufferLatencyMaxLatency){var Z=G-this._config.liveBufferLatencyMinRemain;this.currentTime=Z}}if(this._config.lazyLoad&&!this._config.isLive){for(var rt=0,ut=0;ut<k.length;ut++){var gt=k.start(ut),It=k.end(ut);if(gt<=F&&F<It){rt=It;break}}rt>=F+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(p.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},z.prototype._onmseBufferFull=function(){p.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},z.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},z.prototype._checkProgressAndResume=function(){for(var k=this._mediaElement.currentTime,F=this._mediaElement.buffered,G=!1,Z=0;Z<F.length;Z++){var rt=F.start(Z),ut=F.end(Z);if(k>=rt&&k<ut){k>=ut-this._config.lazyLoadRecoverDuration&&(G=!0);break}}G&&(window.clearInterval(this._progressChecker),this._progressChecker=null,G&&(p.a.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},z.prototype._isTimepointBuffered=function(k){for(var F=this._mediaElement.buffered,G=0;G<F.length;G++){var Z=F.start(G),rt=F.end(G);if(k>=Z&&k<rt)return!0}return!1},z.prototype._internalSeek=function(k){var F=this._isTimepointBuffered(k),G=!1,Z=0;if(k<1&&this._mediaElement.buffered.length>0){var rt=this._mediaElement.buffered.start(0);(rt<1&&k<rt||m.a.safari)&&(G=!0,Z=m.a.safari?.1:rt)}if(G)this._requestSetTime=!0,this._mediaElement.currentTime=Z;else if(F){if(this._alwaysSeekKeyframe){var ut=this._msectl.getNearestKeyframe(Math.floor(1e3*k));this._requestSetTime=!0,this._mediaElement.currentTime=ut!=null?ut.dts/1e3:k}else this._requestSetTime=!0,this._mediaElement.currentTime=k;this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(k),this._transmuxer.seek(Math.floor(1e3*k)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=k)},z.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var k=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(k)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(k),this._transmuxer.seek(Math.floor(1e3*k)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=k))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},z.prototype._checkAndResumeStuckPlayback=function(k){var F=this._mediaElement;if(k||!this._receivedCanPlay||F.readyState<2){var G=F.buffered;G.length>0&&F.currentTime<G.start(0)&&(p.a.w(this.TAG,"Playback seems stuck at "+F.currentTime+", seek to "+G.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=G.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},z.prototype._onvLoadedMetadata=function(k){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},z.prototype._onvSeeking=function(k){var F=this._mediaElement.currentTime,G=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(F<1&&G.length>0){var Z=G.start(0);if(Z<1&&F<Z||m.a.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=m.a.safari?.1:Z)}if(this._isTimepointBuffered(F)){if(this._alwaysSeekKeyframe){var rt=this._msectl.getNearestKeyframe(Math.floor(1e3*F));rt!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=rt.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:F,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},z.prototype._onvCanPlay=function(k){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},z.prototype._onvStalled=function(k){this._checkAndResumeStuckPlayback(!0)},z.prototype._onvProgress=function(k){this._checkAndResumeStuckPlayback()},z}(),nt=function(){function z(k,F){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new h.a,this._config=l(),typeof F=="object"&&Object.assign(this._config,F);var G=k.type.toLowerCase();if(G==="mse"||G==="mpegts"||G==="m2ts"||G==="flv")throw new I.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(k.hasOwnProperty("segments"))throw new I.b("NativePlayer("+k.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=k,this._mediaElement=null}return z.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},z.prototype.on=function(k,F){var G=this;k===v.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){G._emitter.emit(v.MEDIA_INFO,G.mediaInfo)}):k===v.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){G._emitter.emit(v.STATISTICS_INFO,G.statisticsInfo)}),this._emitter.addListener(k,F)},z.prototype.off=function(k,F){this._emitter.removeListener(k,F)},z.prototype.attachMediaElement=function(k){if(this._mediaElement=k,k.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{k.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(F){}},z.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},z.prototype.load=function(){if(!this._mediaElement)throw new I.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},z.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},z.prototype.play=function(){return this._mediaElement.play()},z.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(z.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(k){this._mediaElement.volume=k},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(k){this._mediaElement.muted=k},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(k){this._mediaElement?this._mediaElement.currentTime=k:this._pendingSeekTime=k},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"mediaInfo",{get:function(){var k={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(k.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(k.width=this._mediaElement.videoWidth,k.height=this._mediaElement.videoHeight)),k},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"statisticsInfo",{get:function(){var k={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return k;var F=!0,G=0,Z=0;if(this._mediaElement.getVideoPlaybackQuality){var rt=this._mediaElement.getVideoPlaybackQuality();G=rt.totalVideoFrames,Z=rt.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(G=this._mediaElement.webkitDecodedFrameCount,Z=this._mediaElement.webkitDroppedFrameCount):F=!1;return F&&(k.decodedFrames=G,k.droppedFrames=Z),k},enumerable:!1,configurable:!0}),z.prototype._onvLoadedMetadata=function(k){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(v.MEDIA_INFO,this.mediaInfo)},z.prototype._reportStatisticsInfo=function(){this._emitter.emit(v.STATISTICS_INFO,this.statisticsInfo)},z}();r.a.install();var ot={createPlayer:function(z,k){var F=z;if(F==null||typeof F!="object")throw new I.b("MediaDataSource must be an javascript object!");if(!F.hasOwnProperty("type"))throw new I.b("MediaDataSource must has type field to indicate video file type!");switch(F.type){case"mse":case"mpegts":case"m2ts":case"flv":return new X(F,k);default:return new nt(F,k)}},isSupported:function(){return o.supportMSEH264Playback()},getFeatureList:function(){return o.getFeatureList()}};ot.BaseLoader=c.a,ot.LoaderStatus=c.c,ot.LoaderErrors=c.b,ot.Events=v,ot.ErrorTypes=B,ot.ErrorDetails=$,ot.MSEPlayer=X,ot.NativePlayer=nt,ot.LoggingControl=N.a,Object.defineProperty(ot,"version",{enumerable:!0,get:function(){return"1.7.3"}}),i.default=ot}])})})(_n);var vs=gn(_n.exports);function lo(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var vn={exports:{}};(function(d,t){(function(e){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,o,c){if(c=c||{},l=l.trim(),o=o.trim(),!o){if(!c.alwaysNormalize)return l;var u=a.parseURL(l);if(!u)throw new Error("Error trying to parse base URL.");return u.path=a.normalizePath(u.path),a.buildURLFromParts(u)}var h=a.parseURL(o);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=a.normalizePath(h.path),a.buildURLFromParts(h)):o;var p=a.parseURL(l);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var m=s.exec(p.path);p.netLoc=m[1],p.path=m[2]}p.netLoc&&!p.path&&(p.path="/");var v={scheme:p.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(v.netLoc=p.netLoc,h.path[0]!=="/"))if(!h.path)v.path=p.path,h.params||(v.params=p.params,h.query||(v.query=p.query));else{var E=p.path,C=E.substring(0,E.lastIndexOf("/")+1)+h.path;v.path=a.normalizePath(C)}return v.path===null&&(v.path=c.alwaysNormalize?a.normalizePath(h.path):h.path),a.buildURLFromParts(v)},parseURL:function(l){var o=i.exec(l);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(n,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};d.exports=a})()})(vn);var Fr=vn.exports;function Es(d,t){var e=Object.keys(d);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(d);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(d,s).enumerable})),e.push.apply(e,i)}return e}function le(d){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Es(Object(e),!0).forEach(function(i){co(d,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(e)):Es(Object(e)).forEach(function(i){Object.defineProperty(d,i,Object.getOwnPropertyDescriptor(e,i))})}return d}function co(d,t,e){return t=ho(t),t in d?Object.defineProperty(d,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):d[t]=e,d}function Zt(){return Zt=Object.assign?Object.assign.bind():function(d){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(d[i]=e[i])}return d},Zt.apply(this,arguments)}function uo(d,t){if(typeof d!="object"||d===null)return d;var e=d[Symbol.toPrimitive];if(e!==void 0){var i=e.call(d,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(d)}function ho(d){var t=uo(d,"string");return typeof t=="symbol"?t:String(t)}const mt=Number.isFinite||function(d){return typeof d=="number"&&isFinite(d)},fo=Number.isSafeInteger||function(d){return typeof d=="number"&&Math.abs(d)<=po},po=Number.MAX_SAFE_INTEGER||9007199254740991;let D=function(d){return d.MEDIA_ATTACHING="hlsMediaAttaching",d.MEDIA_ATTACHED="hlsMediaAttached",d.MEDIA_DETACHING="hlsMediaDetaching",d.MEDIA_DETACHED="hlsMediaDetached",d.BUFFER_RESET="hlsBufferReset",d.BUFFER_CODECS="hlsBufferCodecs",d.BUFFER_CREATED="hlsBufferCreated",d.BUFFER_APPENDING="hlsBufferAppending",d.BUFFER_APPENDED="hlsBufferAppended",d.BUFFER_EOS="hlsBufferEos",d.BUFFER_FLUSHING="hlsBufferFlushing",d.BUFFER_FLUSHED="hlsBufferFlushed",d.MANIFEST_LOADING="hlsManifestLoading",d.MANIFEST_LOADED="hlsManifestLoaded",d.MANIFEST_PARSED="hlsManifestParsed",d.LEVEL_SWITCHING="hlsLevelSwitching",d.LEVEL_SWITCHED="hlsLevelSwitched",d.LEVEL_LOADING="hlsLevelLoading",d.LEVEL_LOADED="hlsLevelLoaded",d.LEVEL_UPDATED="hlsLevelUpdated",d.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",d.LEVELS_UPDATED="hlsLevelsUpdated",d.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",d.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",d.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",d.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",d.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",d.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",d.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",d.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",d.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",d.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",d.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",d.CUES_PARSED="hlsCuesParsed",d.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",d.INIT_PTS_FOUND="hlsInitPtsFound",d.FRAG_LOADING="hlsFragLoading",d.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",d.FRAG_LOADED="hlsFragLoaded",d.FRAG_DECRYPTED="hlsFragDecrypted",d.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",d.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",d.FRAG_PARSING_METADATA="hlsFragParsingMetadata",d.FRAG_PARSED="hlsFragParsed",d.FRAG_BUFFERED="hlsFragBuffered",d.FRAG_CHANGED="hlsFragChanged",d.FPS_DROP="hlsFpsDrop",d.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",d.ERROR="hlsError",d.DESTROYING="hlsDestroying",d.KEY_LOADING="hlsKeyLoading",d.KEY_LOADED="hlsKeyLoaded",d.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",d.BACK_BUFFER_REACHED="hlsBackBufferReached",d}({}),xt=function(d){return d.NETWORK_ERROR="networkError",d.MEDIA_ERROR="mediaError",d.KEY_SYSTEM_ERROR="keySystemError",d.MUX_ERROR="muxError",d.OTHER_ERROR="otherError",d}({}),J=function(d){return d.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",d.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",d.KEY_SYSTEM_NO_SESSION="keySystemNoSession",d.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",d.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",d.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",d.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",d.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",d.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",d.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",d.MANIFEST_LOAD_ERROR="manifestLoadError",d.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",d.MANIFEST_PARSING_ERROR="manifestParsingError",d.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",d.LEVEL_EMPTY_ERROR="levelEmptyError",d.LEVEL_LOAD_ERROR="levelLoadError",d.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",d.LEVEL_PARSING_ERROR="levelParsingError",d.LEVEL_SWITCH_ERROR="levelSwitchError",d.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",d.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",d.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",d.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",d.FRAG_LOAD_ERROR="fragLoadError",d.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",d.FRAG_DECRYPT_ERROR="fragDecryptError",d.FRAG_PARSING_ERROR="fragParsingError",d.FRAG_GAP="fragGap",d.REMUX_ALLOC_ERROR="remuxAllocError",d.KEY_LOAD_ERROR="keyLoadError",d.KEY_LOAD_TIMEOUT="keyLoadTimeOut",d.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",d.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",d.BUFFER_APPEND_ERROR="bufferAppendError",d.BUFFER_APPENDING_ERROR="bufferAppendingError",d.BUFFER_STALLED_ERROR="bufferStalledError",d.BUFFER_FULL_ERROR="bufferFullError",d.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",d.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",d.INTERNAL_EXCEPTION="internalException",d.INTERNAL_ABORTED="aborted",d.UNKNOWN="unknown",d}({});const Je=function(){},Ir={trace:Je,debug:Je,log:Je,warn:Je,info:Je,error:Je};let gi=Ir;function mo(d){const t=self.console[d];return t?t.bind(self.console,`[${d}] >`):Je}function go(d,...t){t.forEach(function(e){gi[e]=d[e]?d[e].bind(d):mo(e)})}function yo(d,t){if(self.console&&d===!0||typeof d=="object"){go(d,"debug","log","info","warn","error");try{gi.log(`Debug logs enabled for "${t}" in hls.js version 1.4.14`)}catch(e){gi=Ir}}else gi=Ir}const H=gi,_o=/^(\d+)x(\d+)$/,Ss=/(.+?)=(".*?"|.*?)(?:,|$)/g;class zt{constructor(t){typeof t=="string"&&(t=zt.parseAttrList(t));for(const e in t)t.hasOwnProperty(e)&&(e.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(e)),this[e]=t[e])}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const i=new Uint8Array(e.length/2);for(let s=0;s<e.length/2;s++)i[s]=parseInt(e.slice(s*2,s*2+2),16);return i}else return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const i=this[t];return i?parseFloat(i):e}enumeratedString(t){return this[t]}bool(t){return this[t]==="YES"}decimalResolution(t){const e=_o.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t){let e;const i={},s='"';for(Ss.lastIndex=0;(e=Ss.exec(t))!==null;){let r=e[2];r.indexOf(s)===0&&r.lastIndexOf(s)===r.length-1&&(r=r.slice(1,-1));const n=e[1].trim();i[n]=r}return i}}function vo(d){return d!=="ID"&&d!=="CLASS"&&d!=="START-DATE"&&d!=="DURATION"&&d!=="END-DATE"&&d!=="END-ON-NEXT"}function Eo(d){return d==="SCTE35-OUT"||d==="SCTE35-IN"}class En{constructor(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){const i=e.attr;for(const s in i)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==i[s]){H.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=s;break}t=Zt(new zt({}),i,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const i=new Date(this.attr["END-DATE"]);mt(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const t=this.duration;return t!==null?new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(mt(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&mt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class ji{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var jt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Sn{constructor(t){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[jt.AUDIO]:null,[jt.VIDEO]:null,[jt.AUDIOVIDEO]:null},this.baseurl=t}setByteRange(t,e){const i=t.split("@",2),s=[];i.length===1?s[0]=e?e.byteRangeEndOffset:0:s[0]=parseInt(i[1]),s[1]=parseInt(i[0])+s[0],this._byteRange=s}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Fr.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}}class sr extends Sn{constructor(t,e){super(e),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new ji,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!mt(this.programDateTime))return null;const t=mt(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),i=e.length;if(i>1||i===1&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,i,s,r,n=!1){const{elementaryStreams:a}=this,l=a[t];if(!l){a[t]={startPTS:e,endPTS:i,startDTS:s,endDTS:r,partial:n};return}l.startPTS=Math.min(l.startPTS,e),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,r)}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[jt.AUDIO]=null,t[jt.VIDEO]=null,t[jt.AUDIOVIDEO]=null}}class So extends Sn{constructor(t,e,i,s,r){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new ji,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=s;const n=t.enumeratedString("BYTERANGE");n&&this.setByteRange(n,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}const xo=10;class To{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||e===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?mt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||xo}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Br(d){return Uint8Array.from(atob(d),t=>t.charCodeAt(0))}function bo(d){const t=xn(d).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function Ao(d){const t=function(i,s,r){const n=i[s];i[s]=i[r],i[r]=n};t(d,0,3),t(d,1,2),t(d,4,5),t(d,6,7)}function Lo(d){const t=d.split(":");let e=null;if(t[0]==="data"&&t.length===2){const i=t[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const r=s[0]==="base64",n=s[1];r?(i.splice(-1,1),e=Br(n)):e=bo(n)}}return e}function xn(d){return Uint8Array.from(unescape(encodeURIComponent(d)),t=>t.charCodeAt(0))}var Yt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ue={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function xs(d){switch(d){case ue.FAIRPLAY:return Yt.FAIRPLAY;case ue.PLAYREADY:return Yt.PLAYREADY;case ue.WIDEVINE:return Yt.WIDEVINE;case ue.CLEARKEY:return Yt.CLEARKEY}}var Tn={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Io(d){if(d===Tn.WIDEVINE)return Yt.WIDEVINE}function Ts(d){switch(d){case Yt.FAIRPLAY:return ue.FAIRPLAY;case Yt.PLAYREADY:return ue.PLAYREADY;case Yt.WIDEVINE:return ue.WIDEVINE;case Yt.CLEARKEY:return ue.CLEARKEY}}function nr(d){const{drmSystems:t,widevineLicenseUrl:e}=d,i=t?[Yt.FAIRPLAY,Yt.WIDEVINE,Yt.PLAYREADY,Yt.CLEARKEY].filter(s=>!!t[s]):[];return!i[Yt.WIDEVINE]&&e&&i.push(Yt.WIDEVINE),i}const bn=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function wo(d,t,e,i){let s;switch(d){case Yt.FAIRPLAY:s=["cenc","sinf"];break;case Yt.WIDEVINE:case Yt.PLAYREADY:s=["cenc"];break;case Yt.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${d}`)}return Ro(s,t,e,i)}function Ro(d,t,e,i){return[{initDataTypes:d,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(r=>({contentType:`audio/mp4; codecs="${r}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:e.map(r=>({contentType:`video/mp4; codecs="${r}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function ti(d,t,e){return Uint8Array.prototype.slice?d.slice(t,e):new Uint8Array(Array.prototype.slice.call(d,t,e))}const Ur=(d,t)=>t+10<=d.length&&d[t]===73&&d[t+1]===68&&d[t+2]===51&&d[t+3]<255&&d[t+4]<255&&d[t+6]<128&&d[t+7]<128&&d[t+8]<128&&d[t+9]<128,An=(d,t)=>t+10<=d.length&&d[t]===51&&d[t+1]===68&&d[t+2]===73&&d[t+3]<255&&d[t+4]<255&&d[t+6]<128&&d[t+7]<128&&d[t+8]<128&&d[t+9]<128,Pi=(d,t)=>{const e=t;let i=0;for(;Ur(d,t);)i+=10,i+=Gi(d,t+6),An(d,t+10)&&(i+=10),t+=i;if(i>0)return d.subarray(e,e+i)},Gi=(d,t)=>{let e=0;return e=(d[t]&127)<<21,e|=(d[t+1]&127)<<14,e|=(d[t+2]&127)<<7,e|=d[t+3]&127,e},Do=(d,t)=>Ur(d,t)&&Gi(d,t+6)+10<=d.length-t,Co=d=>{const t=In(d);for(let e=0;e<t.length;e++){const i=t[e];if(Ln(i))return Fo(i)}},Ln=d=>d&&d.key==="PRIV"&&d.info==="com.apple.streaming.transportStreamTimestamp",ko=d=>{const t=String.fromCharCode(d[0],d[1],d[2],d[3]),e=Gi(d,4),i=10;return{type:t,size:e,data:d.subarray(i,i+e)}},In=d=>{let t=0;const e=[];for(;Ur(d,t);){const i=Gi(d,t+6);t+=10;const s=t+i;for(;t+8<s;){const r=ko(d.subarray(t)),n=Mo(r);n&&e.push(n),t+=r.size+10}An(d,t)&&(t+=10)}return e},Mo=d=>d.type==="PRIV"?Po(d):d.type[0]==="W"?No(d):Oo(d),Po=d=>{if(d.size<2)return;const t=Ie(d.data,!0),e=new Uint8Array(d.data.subarray(t.length+1));return{key:d.type,info:t,data:e.buffer}},Oo=d=>{if(d.size<2)return;if(d.type==="TXXX"){let e=1;const i=Ie(d.data.subarray(e),!0);e+=i.length+1;const s=Ie(d.data.subarray(e));return{key:d.type,info:i,data:s}}const t=Ie(d.data.subarray(1));return{key:d.type,data:t}},No=d=>{if(d.type==="WXXX"){if(d.size<2)return;let e=1;const i=Ie(d.data.subarray(e),!0);e+=i.length+1;const s=Ie(d.data.subarray(e));return{key:d.type,info:i,data:s}}const t=Ie(d.data);return{key:d.type,data:t}},Fo=d=>{if(d.data.byteLength===8){const t=new Uint8Array(d.data),e=t[3]&1;let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,e&&(i+=4772185884e-2),Math.round(i)}},Ie=(d,t=!1)=>{const e=Bo();if(e){const o=e.decode(d);if(t){const c=o.indexOf("\0");return c!==-1?o.substring(0,c):o}return o.replace(/\0/g,"")}const i=d.length;let s,r,n,a="",l=0;for(;l<i;){if(s=d[l++],s===0&&t)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:r=d[l++],a+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=d[l++],n=d[l++],a+=String.fromCharCode((s&15)<<12|(r&63)<<6|(n&63)<<0);break}}return a};let ar;function Bo(){if(!navigator.userAgent.includes("PlayStation 4"))return!ar&&typeof self.TextDecoder!="undefined"&&(ar=new self.TextDecoder("utf-8")),ar}const Ae={hexDump:function(d){let t="";for(let e=0;e<d.length;e++){let i=d[e].toString(16);i.length<2&&(i="0"+i),t+=i}return t}},Oi=Math.pow(2,32)-1,Uo=[].push,wn={video:1,audio:2,id3:3,text:4};function re(d){return String.fromCharCode.apply(null,d)}function Rn(d,t){const e=d[t]<<8|d[t+1];return e<0?65536+e:e}function At(d,t){const e=Dn(d,t);return e<0?4294967296+e:e}function Dn(d,t){return d[t]<<24|d[t+1]<<16|d[t+2]<<8|d[t+3]}function or(d,t,e){d[t]=e>>24,d[t+1]=e>>16&255,d[t+2]=e>>8&255,d[t+3]=e&255}function Pt(d,t){const e=[];if(!t.length)return e;const i=d.byteLength;for(let s=0;s<i;){const r=At(d,s),n=re(d.subarray(s+4,s+8)),a=r>1?s+r:i;if(n===t[0])if(t.length===1)e.push(d.subarray(s+8,a));else{const l=Pt(d.subarray(s+8,a),t.slice(1));l.length&&Uo.apply(e,l)}s=a}return e}function jo(d){const t=[],e=d[0];let i=8;const s=At(d,i);i+=4;const r=0,n=0;e===0?i+=8:i+=16,i+=2;let a=d.length+n;const l=Rn(d,i);i+=2;for(let o=0;o<l;o++){let c=i;const u=At(d,c);c+=4;const h=u&2147483647;if((u&2147483648)>>>31===1)return H.warn("SIDX has hierarchical references (not supported)"),null;const m=At(d,c);c+=4,t.push({referenceSize:h,subsegmentDuration:m,info:{duration:m/s,start:a,end:a+h-1}}),a+=h,c+=4,i=c}return{earliestPresentationTime:r,timescale:s,version:e,referencesCount:l,references:t}}function Cn(d){const t=[],e=Pt(d,["moov","trak"]);for(let s=0;s<e.length;s++){const r=e[s],n=Pt(r,["tkhd"])[0];if(n){let a=n[0],l=a===0?12:20;const o=At(n,l),c=Pt(r,["mdia","mdhd"])[0];if(c){a=c[0],l=a===0?12:20;const u=At(c,l),h=Pt(r,["mdia","hdlr"])[0];if(h){const p=re(h.subarray(8,12)),m={soun:jt.AUDIO,vide:jt.VIDEO}[p];if(m){const v=Pt(r,["mdia","minf","stbl","stsd"])[0];let E;v&&(E=re(v.subarray(12,16))),t[o]={timescale:u,type:m},t[m]={timescale:u,id:o,codec:E}}}}}}return Pt(d,["moov","mvex","trex"]).forEach(s=>{const r=At(s,4),n=t[r];n&&(n.default={duration:At(s,12),flags:At(s,20)})}),t}function Go(d,t){if(!d||!t)return d;const e=t.keyId;return e&&t.isCommonEncryption&&Pt(d,["moov","trak"]).forEach(s=>{const n=Pt(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=Pt(n,["enca"]);const l=a.length>0;l||(a=Pt(n,["encv"])),a.forEach(o=>{const c=l?o.subarray(28):o.subarray(78);Pt(c,["sinf"]).forEach(h=>{const p=kn(h);if(p){const m=p.subarray(8,24);m.some(v=>v!==0)||(H.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Ae.hexDump(m)} -> ${Ae.hexDump(e)}`),p.set(e,8))}})})}),d}function kn(d){const t=Pt(d,["schm"])[0];if(t){const e=re(t.subarray(4,8));if(e==="cbcs"||e==="cenc")return Pt(d,["schi","tenc"])[0]}return H.error("[eme] missing 'schm' box"),null}function Vo(d,t){return Pt(t,["moof","traf"]).reduce((e,i)=>{const s=Pt(i,["tfdt"])[0],r=s[0],n=Pt(i,["tfhd"]).reduce((a,l)=>{const o=At(l,4),c=d[o];if(c){let u=At(s,4);if(r===1){if(u===Oi)return H.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;u*=Oi+1,u+=At(s,8)}const h=c.timescale||9e4,p=u/h;if(mt(p)&&(a===null||p<a))return p}return a},null);return n!==null&&mt(n)&&(e===null||n<e)?n:e},null)}function $o(d,t){let e=0,i=0,s=0;const r=Pt(d,["moof","traf"]);for(let n=0;n<r.length;n++){const a=r[n],l=Pt(a,["tfhd"])[0],o=At(l,4),c=t[o];if(!c)continue;const u=c.default,h=At(l,0)|(u==null?void 0:u.flags);let p=u==null?void 0:u.duration;h&8&&(h&2?p=At(l,12):p=At(l,8));const m=c.timescale||9e4,v=Pt(a,["trun"]);for(let E=0;E<v.length;E++){if(e=zo(v[E]),!e&&p){const C=At(v[E],4);e=p*C}c.type===jt.VIDEO?i+=e/m:c.type===jt.AUDIO&&(s+=e/m)}}if(i===0&&s===0){let n=0;const a=Pt(d,["sidx"]);for(let l=0;l<a.length;l++){const o=jo(a[l]);o!=null&&o.references&&(n+=o.references.reduce((c,u)=>c+u.info.duration||0,0))}return n}return i||s}function zo(d){const t=At(d,0);let e=8;t&1&&(e+=4),t&4&&(e+=4);let i=0;const s=At(d,4);for(let r=0;r<s;r++)t&256&&(i+=At(d,e),e+=4),t&512&&(e+=4),t&1024&&(e+=4),t&2048&&(e+=4);return i}function Ho(d,t,e){Pt(t,["moof","traf"]).forEach(i=>{Pt(i,["tfhd"]).forEach(s=>{const r=At(s,4),n=d[r];if(!n)return;const a=n.timescale||9e4;Pt(i,["tfdt"]).forEach(l=>{const o=l[0];let c=At(l,4);if(o===0)c-=e*a,c=Math.max(c,0),or(l,4,c);else{c*=Math.pow(2,32),c+=At(l,8),c-=e*a,c=Math.max(c,0);const u=Math.floor(c/(Oi+1)),h=Math.floor(c%(Oi+1));or(l,4,u),or(l,8,h)}})})})}function Yo(d){const t={valid:null,remainder:null},e=Pt(d,["moof"]);if(e){if(e.length<2)return t.remainder=d,t}else return t;const i=e[e.length-1];return t.valid=ti(d,0,i.byteOffset-8),t.remainder=ti(d,i.byteOffset-8),t}function ei(d,t){const e=new Uint8Array(d.length+t.length);return e.set(d),e.set(t,d.length),e}function bs(d,t){const e=[],i=t.samples,s=t.timescale,r=t.id;let n=!1;return Pt(i,["moof"]).map(l=>{const o=l.byteOffset-8;Pt(l,["traf"]).map(u=>{const h=Pt(u,["tfdt"]).map(p=>{const m=p[0];let v=At(p,4);return m===1&&(v*=Math.pow(2,32),v+=At(p,8)),v/s})[0];return h!==void 0&&(d=h),Pt(u,["tfhd"]).map(p=>{const m=At(p,4),v=At(p,0)&16777215,E=(v&1)!==0,C=(v&2)!==0,N=(v&8)!==0;let R=0;const x=(v&16)!==0;let P=0;const M=(v&32)!==0;let b=8;m===r&&(E&&(b+=8),C&&(b+=4),N&&(R=At(p,b),b+=4),x&&(P=At(p,b),b+=4),M&&(b+=4),t.type==="video"&&(n=Ko(t.codec)),Pt(u,["trun"]).map(T=>{const I=T[0],A=At(T,0)&16777215,U=(A&1)!==0;let B=0;const $=(A&4)!==0,X=(A&256)!==0;let nt=0;const ot=(A&512)!==0;let z=0;const k=(A&1024)!==0,F=(A&2048)!==0;let G=0;const Z=At(T,4);let rt=8;U&&(B=At(T,rt),rt+=4),$&&(rt+=4);let ut=B+o;for(let gt=0;gt<Z;gt++){if(X?(nt=At(T,rt),rt+=4):nt=R,ot?(z=At(T,rt),rt+=4):z=P,k&&(rt+=4),F&&(I===0?G=At(T,rt):G=Dn(T,rt),rt+=4),t.type===jt.VIDEO){let It=0;for(;It<z;){const Dt=At(i,ut);if(ut+=4,Wo(n,i[ut])){const et=i.subarray(ut,ut+Dt);Mn(et,n?2:1,d+G/s,e)}ut+=Dt,It+=Dt+4}}d+=nt/s}}))})})}),e}function Ko(d){if(!d)return!1;const t=d.indexOf("."),e=t<0?d:d.substring(0,t);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Wo(d,t){if(d){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function Mn(d,t,e,i){const s=Pn(d);let r=0;r+=t;let n=0,a=0,l=!1,o=0;for(;r<s.length;){n=0;do{if(r>=s.length)break;o=s[r++],n+=o}while(o===255);a=0;do{if(r>=s.length)break;o=s[r++],a+=o}while(o===255);const c=s.length-r;if(!l&&n===4&&r<s.length){if(l=!0,s[r++]===181){const h=Rn(s,r);if(r+=2,h===49){const p=At(s,r);if(r+=4,p===1195456820){const m=s[r++];if(m===3){const v=s[r++],E=31&v,C=64&v,N=C?2+E*3:0,R=new Uint8Array(N);if(C){R[0]=v;for(let x=1;x<N;x++)R[x]=s[r++]}i.push({type:m,payloadType:n,pts:e,bytes:R})}}}}}else if(n===5&&a<c){if(l=!0,a>16){const u=[];for(let m=0;m<16;m++){const v=s[r++].toString(16);u.push(v.length==1?"0"+v:v),(m===3||m===5||m===7||m===9)&&u.push("-")}const h=a-16,p=new Uint8Array(h);for(let m=0;m<h;m++)p[m]=s[r++];i.push({payloadType:n,pts:e,uuid:u.join(""),userData:Ie(p),userDataBytes:p})}}else if(a<c)r+=a;else if(a>c)break}}function Pn(d){const t=d.byteLength,e=[];let i=1;for(;i<t-2;)d[i]===0&&d[i+1]===0&&d[i+2]===3?(e.push(i+2),i+=2):i++;if(e.length===0)return d;const s=t-e.length,r=new Uint8Array(s);let n=0;for(i=0;i<s;n++,i++)n===e[0]&&(n++,e.shift()),r[i]=d[n];return r}function qo(d){const t=d[0];let e="",i="",s=0,r=0,n=0,a=0,l=0,o=0;if(t===0){for(;re(d.subarray(o,o+1))!=="\0";)e+=re(d.subarray(o,o+1)),o+=1;for(e+=re(d.subarray(o,o+1)),o+=1;re(d.subarray(o,o+1))!=="\0";)i+=re(d.subarray(o,o+1)),o+=1;i+=re(d.subarray(o,o+1)),o+=1,s=At(d,12),r=At(d,16),a=At(d,20),l=At(d,24),o=28}else if(t===1){o+=4,s=At(d,o),o+=4;const u=At(d,o);o+=4;const h=At(d,o);for(o+=4,n=ps(2,32)*u+h,fo(n)||(n=Number.MAX_SAFE_INTEGER,H.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=At(d,o),o+=4,l=At(d,o),o+=4;re(d.subarray(o,o+1))!=="\0";)e+=re(d.subarray(o,o+1)),o+=1;for(e+=re(d.subarray(o,o+1)),o+=1;re(d.subarray(o,o+1))!=="\0";)i+=re(d.subarray(o,o+1)),o+=1;i+=re(d.subarray(o,o+1)),o+=1}const c=d.subarray(o,d.byteLength);return{schemeIdUri:e,value:i,timeScale:s,presentationTime:n,presentationTimeDelta:r,eventDuration:a,id:l,payload:c}}function Qo(d,...t){const e=t.length;let i=8,s=e;for(;s--;)i+=t[s].byteLength;const r=new Uint8Array(i);for(r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=i&255,r.set(d,4),s=0,i=8;s<e;s++)r.set(t[s],i),i+=t[s].byteLength;return r}function Xo(d,t,e){if(d.byteLength!==16)throw new RangeError("Invalid system id");let i,s;if(t){i=1,s=new Uint8Array(t.length*16);for(let a=0;a<t.length;a++){const l=t[a];if(l.byteLength!==16)throw new RangeError("Invalid key");s.set(l,a*16)}}else i=0,s=new Uint8Array;let r;i>0?(r=new Uint8Array(4),t.length>0&&new DataView(r.buffer).setUint32(0,t.length,!1)):r=new Uint8Array;const n=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(n.buffer).setUint32(0,e.byteLength,!1),Qo([112,115,115,104],new Uint8Array([i,0,0,0]),d,r,s,n,e||new Uint8Array)}function Zo(d){if(!(d instanceof ArrayBuffer)||d.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},e=new DataView(d),i=e.getUint32(0);if(d.byteLength!==i&&i>44||e.getUint32(4)!==1886614376||(t.version=e.getUint32(8)>>>24,t.version>1))return null;t.systemId=Ae.hexDump(new Uint8Array(d,12,16));const r=e.getUint32(28);if(t.version===0){if(i-32<r)return null;t.data=new Uint8Array(d,32,r)}else if(t.version===1){t.kids=[];for(let n=0;n<r;n++)t.kids.push(new Uint8Array(d,32+n*16,16))}return t}let Ti={};class _i{static clearKeyUriToKeyIdMap(){Ti={}}constructor(t,e,i,s=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=i,this.keyFormatVersions=s,this.iv=r,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&t!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ue.FAIRPLAY:case ue.WIDEVINE:case ue.PLAYREADY:case ue.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof t!="number"&&(this.method==="AES-128"&&!this.iv&&H.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const i=Jo(t);return new _i(this.method,this.uri,"identity",this.keyFormatVersions,i)}const e=Lo(this.uri);if(e)switch(this.keyFormat){case ue.WIDEVINE:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case ue.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Xo(i,null,e);const s=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),r=String.fromCharCode.apply(null,Array.from(s)),n=r.substring(r.indexOf("<"),r.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const c=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(c){const u=Br(c).subarray(0,16);Ao(u),this.keyId=u}}break}default:{let i=e.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Ti[this.uri];if(!i){const s=Object.keys(Ti).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),Ti[this.uri]=i}this.keyId=i}return this}}function Jo(d){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=d>>8*(15-e)&255;return t}const On=/\{\$([a-zA-Z0-9-_]+)\}/g;function As(d){return On.test(d)}function de(d,t,e){if(d.variableList!==null||d.hasVariableRefs)for(let i=e.length;i--;){const s=e[i],r=t[s];r&&(t[s]=wr(d,r))}}function wr(d,t){if(d.variableList!==null||d.hasVariableRefs){const e=d.variableList;return t.replace(On,i=>{const s=i.substring(2,i.length-1),r=e==null?void 0:e[s];return r===void 0?(d.playlistParsingError||(d.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):r})}return t}function Ls(d,t,e){let i=d.variableList;i||(d.variableList=i={});let s,r;if("QUERYPARAM"in t){s=t.QUERYPARAM;try{const n=new self.URL(e).searchParams;if(n.has(s))r=n.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${e}"`)}catch(n){d.playlistParsingError||(d.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${n.message}`))}}else s=t.NAME,r=t.VALUE;s in i?d.playlistParsingError||(d.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=r||""}function tl(d,t,e){const i=t.IMPORT;if(e&&i in e){let s=d.variableList;s||(d.variableList=s={}),s[i]=e[i]}else d.playlistParsingError||(d.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function Vi(){if(typeof self!="undefined")return self.MediaSource||self.WebKitMediaSource}const el={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Is=Vi();function il(d,t){const e=el[t];return!!e&&e[d.slice(0,4)]===!0}function lr(d,t){var e;return(e=Is==null?void 0:Is.isTypeSupported(`${t||"video"}/mp4;codecs="${d}"`))!=null?e:!1}const ws=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Rs=/#EXT-X-MEDIA:(.*)/g,rl=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ds=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),sl=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class xe{static findGroup(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(s.id===e)return s}}static convertAVC1ToAVCOTI(t){const e=t.split(".");if(e.length>2){let i=e.shift()+".";return i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),i}return t}static resolve(t,e){return Fr.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return rl.test(t)}static parseMasterPlaylist(t,e){const i=As(t),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},r=[];ws.lastIndex=0;let n;for(;(n=ws.exec(t))!=null;)if(n[1]){var a;const o=new zt(n[1]);de(s,o,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const c=wr(s,n[2]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:xe.resolve(c,e)},h=o.decimalResolution("RESOLUTION");h&&(u.width=h.width,u.height=h.height),nl((o.CODECS||"").split(/[ ,]+/).filter(p=>p),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=xe.convertAVC1ToAVCOTI(u.videoCodec)),(a=u.unknownCodecs)!=null&&a.length||r.push(u),s.levels.push(u)}else if(n[3]){const o=n[3],c=n[4];switch(o){case"SESSION-DATA":{const u=new zt(c);de(s,u,["DATA-ID","LANGUAGE","VALUE","URI"]);const h=u["DATA-ID"];h&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[h]=u);break}case"SESSION-KEY":{const u=Cs(c,e,s);u.encrypted&&u.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(u)):H.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const u=new zt(c);de(s,u,["NAME","VALUE","QUERYPARAM"]),Ls(s,u,e)}break}case"CONTENT-STEERING":{const u=new zt(c);de(s,u,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:xe.resolve(u["SERVER-URI"],e),pathwayId:u["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=ks(c);break}}}const l=r.length>0&&r.length<s.levels.length;return s.levels=l?r:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(t,e,i){let s;const r={},n=i.levels,a={AUDIO:n.map(o=>({id:o.attrs.AUDIO,audioCodec:o.audioCodec})),SUBTITLES:n.map(o=>({id:o.attrs.SUBTITLES,textCodec:o.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Rs.lastIndex=0;(s=Rs.exec(t))!==null;){const o=new zt(s[1]),c=o.TYPE;if(c){const u=a[c],h=r[c]||[];r[c]=h,de(i,o,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const p={attrs:o,bitrate:0,id:l++,groupId:o["GROUP-ID"]||"",instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE||"",type:c,default:o.bool("DEFAULT"),autoselect:o.bool("AUTOSELECT"),forced:o.bool("FORCED"),lang:o.LANGUAGE,url:o.URI?xe.resolve(o.URI,e):""};if(u!=null&&u.length){const m=xe.findGroup(u,p.groupId)||u[0];Ms(p,m,"audioCodec"),Ms(p,m,"textCodec")}h.push(p)}}return r}static parseLevelPlaylist(t,e,i,s,r,n){const a=new To(e),l=a.fragments;let o=null,c=0,u=0,h=0,p=0,m=null,v=new sr(s,e),E,C,N,R=-1,x=!1;for(Ds.lastIndex=0,a.m3u8=t,a.hasVariableRefs=As(t);(E=Ds.exec(t))!==null;){x&&(x=!1,v=new sr(s,e),v.start=h,v.sn=c,v.cc=p,v.level=i,o&&(v.initSegment=o,v.rawProgramDateTime=o.rawProgramDateTime,o.rawProgramDateTime=null));const T=E[1];if(T){v.duration=parseFloat(T);const I=(" "+E[2]).slice(1);v.title=I||null,v.tagList.push(I?["INF",T,I]:["INF",T])}else if(E[3]){if(mt(v.duration)){v.start=h,N&&Ns(v,N,a),v.sn=c,v.level=i,v.cc=p,v.urlId=r,l.push(v);const I=(" "+E[3]).slice(1);v.relurl=wr(a,I),Ps(v,m),m=v,h+=v.duration,c++,u=0,x=!0}}else if(E[4]){const I=(" "+E[4]).slice(1);m?v.setByteRange(I,m):v.setByteRange(I)}else if(E[5])v.rawProgramDateTime=(" "+E[5]).slice(1),v.tagList.push(["PROGRAM-DATE-TIME",v.rawProgramDateTime]),R===-1&&(R=l.length);else{if(E=E[0].match(sl),!E){H.warn("No matches on slow regex match for level playlist!");continue}for(C=1;C<E.length&&typeof E[C]=="undefined";C++);const I=(" "+E[C]).slice(1),A=(" "+E[C+1]).slice(1),U=E[C+2]?(" "+E[C+2]).slice(1):"";switch(I){case"PLAYLIST-TYPE":a.type=A.toUpperCase();break;case"MEDIA-SEQUENCE":c=a.startSN=parseInt(A);break;case"SKIP":{const B=new zt(A);de(a,B,["RECENTLY-REMOVED-DATERANGES"]);const $=B.decimalInteger("SKIPPED-SEGMENTS");if(mt($)){a.skippedSegments=$;for(let nt=$;nt--;)l.unshift(null);c+=$}const X=B.enumeratedString("RECENTLY-REMOVED-DATERANGES");X&&(a.recentlyRemovedDateranges=X.split("	"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(A),1);break;case"VERSION":a.version=parseInt(A);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(A||U)&&v.tagList.push(U?[A,U]:[A]);break;case"DISCONTINUITY":p++,v.tagList.push(["DIS"]);break;case"GAP":v.gap=!0,v.tagList.push([I]);break;case"BITRATE":v.tagList.push([I,A]);break;case"DATERANGE":{const B=new zt(A);de(a,B,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),de(a,B,B.clientAttrs);const $=new En(B,a.dateRanges[B.ID]);$.isValid||a.skippedSegments?a.dateRanges[$.id]=$:H.warn(`Ignoring invalid DATERANGE tag: "${A}"`),v.tagList.push(["EXT-X-DATERANGE",A]);break}case"DEFINE":{{const B=new zt(A);de(a,B,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in B?tl(a,B,n):Ls(a,B,e)}break}case"DISCONTINUITY-SEQUENCE":p=parseInt(A);break;case"KEY":{const B=Cs(A,e,a);if(B.isSupported()){if(B.method==="NONE"){N=void 0;break}N||(N={}),N[B.keyFormat]&&(N=Zt({},N)),N[B.keyFormat]=B}else H.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${A}"`);break}case"START":a.startTimeOffset=ks(A);break;case"MAP":{const B=new zt(A);if(de(a,B,["BYTERANGE","URI"]),v.duration){const $=new sr(s,e);Os($,B,i,N),o=$,v.initSegment=o,o.rawProgramDateTime&&!v.rawProgramDateTime&&(v.rawProgramDateTime=o.rawProgramDateTime)}else Os(v,B,i,N),o=v,x=!0;break}case"SERVER-CONTROL":{const B=new zt(A);a.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),a.holdBack=B.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const B=new zt(A);a.partTarget=B.decimalFloatingPoint("PART-TARGET");break}case"PART":{let B=a.partList;B||(B=a.partList=[]);const $=u>0?B[B.length-1]:void 0,X=u++,nt=new zt(A);de(a,nt,["BYTERANGE","URI"]);const ot=new So(nt,v,e,X,$);B.push(ot),v.duration+=ot.duration;break}case"PRELOAD-HINT":{const B=new zt(A);de(a,B,["URI"]),a.preloadHint=B;break}case"RENDITION-REPORT":{const B=new zt(A);de(a,B,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(B);break}default:H.warn(`line parsed but not handled: ${E}`);break}}}m&&!m.relurl?(l.pop(),h-=m.duration,a.partList&&(a.fragmentHint=m)):a.partList&&(Ps(v,m),v.cc=p,a.fragmentHint=v,N&&Ns(v,N,a));const P=l.length,M=l[0],b=l[P-1];if(h+=a.skippedSegments*a.targetduration,h>0&&P&&b){a.averagetargetduration=h/P;const T=b.sn;a.endSN=T!=="initSegment"?T:0,a.live||(b.endList=!0),M&&(a.startCC=M.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(h+=a.fragmentHint.duration),a.totalduration=h,a.endCC=p,R>0&&al(l,R),a}}function Cs(d,t,e){var i,s;const r=new zt(d);de(e,r,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const n=(i=r.METHOD)!=null?i:"",a=r.URI,l=r.hexadecimalInteger("IV"),o=r.KEYFORMATVERSIONS,c=(s=r.KEYFORMAT)!=null?s:"identity";a&&r.IV&&!l&&H.error(`Invalid IV: ${r.IV}`);const u=a?xe.resolve(a,t):"",h=(o||"1").split("/").map(Number).filter(Number.isFinite);return new _i(n,u,c,h,l)}function ks(d){const e=new zt(d).decimalFloatingPoint("TIME-OFFSET");return mt(e)?e:null}function nl(d,t){["video","audio","text"].forEach(e=>{const i=d.filter(s=>il(s,e));if(i.length){const s=i.filter(r=>r.lastIndexOf("avc1",0)===0||r.lastIndexOf("mp4a",0)===0);t[`${e}Codec`]=s.length>0?s[0]:i[0],d=d.filter(r=>i.indexOf(r)===-1)}}),t.unknownCodecs=d}function Ms(d,t,e){const i=t[e];i&&(d[e]=i)}function al(d,t){let e=d[t];for(let i=t;i--;){const s=d[i];if(!s)return;s.programDateTime=e.programDateTime-s.duration*1e3,e=s}}function Ps(d,t){d.rawProgramDateTime?d.programDateTime=Date.parse(d.rawProgramDateTime):t!=null&&t.programDateTime&&(d.programDateTime=t.endProgramDateTime),mt(d.programDateTime)||(d.programDateTime=null,d.rawProgramDateTime=null)}function Os(d,t,e,i){d.relurl=t.URI,t.BYTERANGE&&d.setByteRange(t.BYTERANGE),d.level=e,d.sn="initSegment",i&&(d.levelkeys=i),d.initSegment=null}function Ns(d,t,e){d.levelkeys=t;const{encryptedFragments:i}=e;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(s=>t[s].isCommonEncryption)&&i.push(d)}var Nt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Tt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Fs(d){const{type:t}=d;switch(t){case Nt.AUDIO_TRACK:return Tt.AUDIO;case Nt.SUBTITLE_TRACK:return Tt.SUBTITLE;default:return Tt.MAIN}}function cr(d,t){let e=d.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class ol{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(D.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(D.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(t){const e=this.hls.config,i=e.pLoader,s=e.loader,r=i||s,n=new r(e);return this.loaders[t.type]=n,n}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:i}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Nt.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(t,e){const{id:i,level:s,url:r,deliveryDirectives:n}=e;this.load({id:i,level:s,responseType:"text",type:Nt.LEVEL,url:r,deliveryDirectives:n})}onAudioTrackLoading(t,e){const{id:i,groupId:s,url:r,deliveryDirectives:n}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:Nt.AUDIO_TRACK,url:r,deliveryDirectives:n})}onSubtitleTrackLoading(t,e){const{id:i,groupId:s,url:r,deliveryDirectives:n}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:Nt.SUBTITLE_TRACK,url:r,deliveryDirectives:n})}load(t){var e;const i=this.hls.config;let s=this.getInternalLoader(t);if(s){const o=s.context;if(o&&o.url===t.url){H.trace("[playlist-loader]: playlist request ongoing");return}H.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),s.abort()}let r;if(t.type===Nt.MANIFEST?r=i.manifestLoadPolicy.default:r=Zt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(t),(e=t.deliveryDirectives)!=null&&e.part){let o;if(t.type===Nt.LEVEL&&t.level!==null?o=this.hls.levels[t.level].details:t.type===Nt.AUDIO_TRACK&&t.id!==null?o=this.hls.audioTracks[t.id].details:t.type===Nt.SUBTITLE_TRACK&&t.id!==null&&(o=this.hls.subtitleTracks[t.id].details),o){const c=o.partTarget,u=o.targetduration;if(c&&u){const h=Math.max(c*3,u*.8)*1e3;r=Zt({},r,{maxTimeToFirstByteMs:Math.min(h,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,r.maxTimeToFirstByteMs)})}}}const n=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},l={onSuccess:(o,c,u,h)=>{const p=this.getInternalLoader(u);this.resetInternalLoader(u.type);const m=o.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(o,u,new Error("no EXTM3U delimiter"),h||null,c);return}c.parsing.start=performance.now(),xe.isMediaPlaylist(m)?this.handleTrackOrLevelPlaylist(o,c,u,h||null,p):this.handleMasterPlaylist(o,c,u,h)},onError:(o,c,u,h)=>{this.handleNetworkError(c,u,!1,o,h)},onTimeout:(o,c,u)=>{this.handleNetworkError(c,u,!0,void 0,o)}};s.load(t,a,l)}handleMasterPlaylist(t,e,i,s){const r=this.hls,n=t.data,a=cr(t,i),l=xe.parseMasterPlaylist(n,a);if(l.playlistParsingError){this.handleManifestParsingError(t,i,l.playlistParsingError,s,e);return}const{contentSteering:o,levels:c,sessionData:u,sessionKeys:h,startTimeOffset:p,variableList:m}=l;this.variableList=m;const{AUDIO:v=[],SUBTITLES:E,"CLOSED-CAPTIONS":C}=xe.parseMasterPlaylistMedia(n,a,l);v.length&&!v.some(R=>!R.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(H.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new zt({}),bitrate:0,url:""})),r.trigger(D.MANIFEST_LOADED,{levels:c,audioTracks:v,subtitles:E,captions:C,contentSteering:o,url:a,stats:e,networkDetails:s,sessionData:u,sessionKeys:h,startTimeOffset:p,variableList:m})}handleTrackOrLevelPlaylist(t,e,i,s,r){const n=this.hls,{id:a,level:l,type:o}=i,c=cr(t,i),u=mt(a)?a:0,h=mt(l)?l:u,p=Fs(i),m=xe.parseLevelPlaylist(t.data,c,h,p,u,this.variableList);if(o===Nt.MANIFEST){const v={attrs:new zt({}),bitrate:0,details:m,name:"",url:c};n.trigger(D.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:c,stats:e,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),i.levelDetails=m,this.handlePlaylistLoaded(m,t,e,i,s,r)}handleManifestParsingError(t,e,i,s,r){this.hls.trigger(D.ERROR,{type:xt.NETWORK_ERROR,details:J.MANIFEST_PARSING_ERROR,fatal:e.type===Nt.MANIFEST,url:t.url,err:i,error:i,reason:i.message,response:t,context:e,networkDetails:s,stats:r})}handleNetworkError(t,e,i=!1,s,r){let n=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${t.type}`;t.type===Nt.LEVEL?n+=`: ${t.level} id: ${t.id}`:(t.type===Nt.AUDIO_TRACK||t.type===Nt.SUBTITLE_TRACK)&&(n+=` id: ${t.id} group-id: "${t.groupId}"`);const a=new Error(n);H.warn(`[playlist-loader]: ${n}`);let l=J.UNKNOWN,o=!1;const c=this.getInternalLoader(t);switch(t.type){case Nt.MANIFEST:l=i?J.MANIFEST_LOAD_TIMEOUT:J.MANIFEST_LOAD_ERROR,o=!0;break;case Nt.LEVEL:l=i?J.LEVEL_LOAD_TIMEOUT:J.LEVEL_LOAD_ERROR,o=!1;break;case Nt.AUDIO_TRACK:l=i?J.AUDIO_TRACK_LOAD_TIMEOUT:J.AUDIO_TRACK_LOAD_ERROR,o=!1;break;case Nt.SUBTITLE_TRACK:l=i?J.SUBTITLE_TRACK_LOAD_TIMEOUT:J.SUBTITLE_LOAD_ERROR,o=!1;break}c&&this.resetInternalLoader(t.type);const u={type:xt.NETWORK_ERROR,details:l,fatal:o,url:t.url,loader:c,context:t,error:a,networkDetails:e,stats:r};if(s){const h=(e==null?void 0:e.url)||t.url;u.response=le({url:h,data:void 0},s)}this.hls.trigger(D.ERROR,u)}handlePlaylistLoaded(t,e,i,s,r,n){const a=this.hls,{type:l,level:o,id:c,groupId:u,deliveryDirectives:h}=s,p=cr(e,s),m=Fs(s),v=typeof s.level=="number"&&m===Tt.MAIN?o:void 0;if(!t.fragments.length){const C=new Error("No Segments found in Playlist");a.trigger(D.ERROR,{type:xt.NETWORK_ERROR,details:J.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:C,reason:C.message,response:e,context:s,level:v,parent:m,networkDetails:r,stats:i});return}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const E=t.playlistParsingError;if(E){a.trigger(D.ERROR,{type:xt.NETWORK_ERROR,details:J.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:E,reason:E.message,response:e,context:s,level:v,parent:m,networkDetails:r,stats:i});return}switch(t.live&&n&&(n.getCacheAge&&(t.ageHeader=n.getCacheAge()||0),(!n.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),l){case Nt.MANIFEST:case Nt.LEVEL:a.trigger(D.LEVEL_LOADED,{details:t,level:v||0,id:c||0,stats:i,networkDetails:r,deliveryDirectives:h});break;case Nt.AUDIO_TRACK:a.trigger(D.AUDIO_TRACK_LOADED,{details:t,id:c||0,groupId:u||"",stats:i,networkDetails:r,deliveryDirectives:h});break;case Nt.SUBTITLE_TRACK:a.trigger(D.SUBTITLE_TRACK_LOADED,{details:t,id:c||0,groupId:u||"",stats:i,networkDetails:r,deliveryDirectives:h});break}}}function Nn(d,t){let e;try{e=new Event("addtrack")}catch(i){e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=d,t.dispatchEvent(e)}function Fn(d,t){const e=d.mode;if(e==="disabled"&&(d.mode="hidden"),d.cues&&!d.cues.getCueById(t.id))try{if(d.addCue(t),!d.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){H.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,d.addCue(s)}catch(s){H.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}e==="disabled"&&(d.mode=e)}function oi(d){const t=d.mode;if(t==="disabled"&&(d.mode="hidden"),d.cues)for(let e=d.cues.length;e--;)d.removeCue(d.cues[e]);t==="disabled"&&(d.mode=t)}function Rr(d,t,e,i){const s=d.mode;if(s==="disabled"&&(d.mode="hidden"),d.cues&&d.cues.length>0){const r=cl(d.cues,t,e);for(let n=0;n<r.length;n++)(!i||i(r[n]))&&d.removeCue(r[n])}s==="disabled"&&(d.mode=s)}function ll(d,t){if(t<d[0].startTime)return 0;const e=d.length-1;if(t>d[e].endTime)return-1;let i=0,s=e;for(;i<=s;){const r=Math.floor((s+i)/2);if(t<d[r].startTime)s=r-1;else if(t>d[r].startTime&&i<e)i=r+1;else return r}return d[i].startTime-t<t-d[s].startTime?i:s}function cl(d,t,e){const i=[],s=ll(d,t);if(s>-1)for(let r=s,n=d.length;r<n;r++){const a=d[r];if(a.startTime>=t&&a.endTime<=e)i.push(a);else if(a.startTime>e)return i}return i}var Se={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const dl=.25;function Dr(){if(typeof self!="undefined")return self.VTTCue||self.TextTrackCue}function Bs(d,t,e,i,s){let r=new d(t,e,"");try{r.value=i,s&&(r.type=s)}catch(n){r=new d(t,e,JSON.stringify(s?le({type:s},i):i))}return r}const bi=(()=>{const d=Dr();try{d&&new d(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dr(d,t){return d.getTime()/1e3-t}function ul(d){return Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class hl{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(t,e){this.media=e.media}onMediaDetaching(){!this.id3Track||(oi(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(!!this.media){for(let e=0;e<t.length;e++){const i=t[e];if(i.kind==="metadata"&&i.label==="id3")return Nn(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:r}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=Dr();if(!!n)for(let a=0;a<r.length;a++){const l=r[a].type;if(l===Se.emsg&&!i||!s)continue;const o=In(r[a].data);if(o){const c=r[a].pts;let u=c+r[a].duration;u>bi&&(u=bi),u-c<=0&&(u=c+dl);for(let p=0;p<o.length;p++){const m=o[p];if(!Ln(m)){this.updateId3CueEnds(c,l);const v=Bs(n,c,u,m,l);v&&this.id3Track.addCue(v)}}}}}updateId3CueEnds(t,e){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let r=s.length;r--;){const n=s[r];n.type===e&&n.startTime<t&&n.endTime===bi&&(n.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:i,type:s}){const{id3Track:r,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=n;if(r&&(a||l)){let o;s==="audio"?o=c=>c.type===Se.audioId3&&l:s==="video"?o=c=>c.type===Se.emsg&&a:o=c=>c.type===Se.audioId3&&l||c.type===Se.emsg&&a,Rr(r,e,i,o)}}onLevelUpdated(t,{details:e}){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:s}=this,{dateRanges:r}=e,n=Object.keys(r);if(s){const c=Object.keys(i).filter(u=>!n.includes(u));for(let u=c.length;u--;){const h=c[u];Object.keys(i[h].cues).forEach(p=>{s.removeCue(i[h].cues[p])}),delete i[h]}}const a=e.fragments[e.fragments.length-1];if(n.length===0||!mt(a==null?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,o=Dr();for(let c=0;c<n.length;c++){const u=n[c],h=r[u],p=i[u],m=(p==null?void 0:p.cues)||{};let v=(p==null?void 0:p.durationKnown)||!1;const E=dr(h.startDate,l);let C=bi;const N=h.endDate;if(N)C=dr(N,l),v=!0;else if(h.endOnNext&&!v){const x=n.reduce((P,M)=>{const b=r[M];return b.class===h.class&&b.id!==M&&b.startDate>h.startDate&&P.push(b),P},[]).sort((P,M)=>P.startDate.getTime()-M.startDate.getTime())[0];x&&(C=dr(x.startDate,l),v=!0)}const R=Object.keys(h.attr);for(let x=0;x<R.length;x++){const P=R[x];if(!vo(P))continue;const M=m[P];if(M)v&&!p.durationKnown&&(M.endTime=C);else if(o){let b=h.attr[P];Eo(P)&&(b=ul(b));const T=Bs(o,E,C,{key:P,data:b},Se.dateRange);T&&(T.id=u,this.id3Track.addCue(T),m[P]=T)}}i[u]={cues:m,dateRange:h,durationKnown:v}}}}class fl{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=t,this.config=t.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:t,levelDetails:e}=this;return t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const{levelDetails:t}=this;if(t===null)return null;const{holdBack:e,partHoldBack:i,targetduration:s}=t,{liveSyncDuration:r,liveSyncDurationCount:n,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let o=a&&i||e;(l.liveSyncDuration||l.liveSyncDurationCount||o===0)&&(o=r!==void 0?r:n*s);const c=s,u=1;return o+Math.min(this.stallCount*u,c)}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency,i=this.levelDetails;if(t===null||e===null||i===null)return null;const s=i.edge,r=t-e-this.edgeStalled,n=s-i.totalduration,a=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(n,r),a)}get drift(){const{levelDetails:t}=this;return t===null?1:t.drift}get edgeStalled(){const{levelDetails:t}=this;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t,levelDetails:e}=this;if(!t||!e)return 0;const i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(D.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(D.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(D.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){this.levelDetails=e,e.advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(t,e){var i;e.details===J.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&H.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:t,levelDetails:e}=this;if(!t||!e)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:r}=this.config;if(!s||r===1)return;const n=this.targetLatency;if(n===null)return;const a=i-n,l=Math.min(this.maxLatency,n+e.targetduration),o=a<l;if(e.live&&o&&a>.05&&this.forwardBufferLength>1){const c=Math.min(2,Math.max(1,r)),u=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;t.playbackRate=Math.min(c,Math.max(1,u))}else t.playbackRate!==1&&t.playbackRate!==0&&(t.playbackRate=1)}estimateLiveEdge(){const{levelDetails:t}=this;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}const Cr=["NONE","TYPE-0","TYPE-1",null];var yi={No:"",Yes:"YES",v2:"v2"};function pl(d,t){const{canSkipUntil:e,canSkipDateRanges:i,endSN:s}=d,r=t!==void 0?t-s:0;return e&&r<e?i?yi.v2:yi.Yes:yi.No}class Us{constructor(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class vi{constructor(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(e=>e).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(t){const e=t%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}get audioGroupId(){var t;return(t=this.audioGroupIds)==null?void 0:t[this.urlId]}get textGroupId(){var t;return(t=this.textGroupIds)==null?void 0:t[this.urlId]}addFallback(t){this.url.push(t.url),this._attrs.push(t.attrs)}}function ur(d,t){const e=t.startPTS;if(mt(e)){let i=0,s;t.sn>d.sn?(i=e-d.start,s=d):(i=d.start-e,s=t),s.duration!==i&&(s.duration=i)}else t.sn>d.sn?d.cc===t.cc&&d.minEndPTS?t.start=d.start+(d.minEndPTS-d.start):t.start=d.start+d.duration:t.start=Math.max(d.start-t.duration,0)}function Bn(d,t,e,i,s,r){i-e<=0&&(H.warn("Fragment should have a positive duration",t),i=e+t.duration,r=s+t.duration);let a=e,l=i;const o=t.startPTS,c=t.endPTS;if(mt(o)){const E=Math.abs(o-e);mt(t.deltaPTS)?t.deltaPTS=Math.max(E,t.deltaPTS):t.deltaPTS=E,a=Math.max(e,o),e=Math.min(e,o),s=Math.min(s,t.startDTS),l=Math.min(i,c),i=Math.max(i,c),r=Math.max(r,t.endDTS)}const u=e-t.start;t.start!==0&&(t.start=e),t.duration=i-t.start,t.startPTS=e,t.maxStartPTS=a,t.startDTS=s,t.endPTS=i,t.minEndPTS=l,t.endDTS=r;const h=t.sn;if(!d||h<d.startSN||h>d.endSN)return 0;let p;const m=h-d.startSN,v=d.fragments;for(v[m]=t,p=m;p>0;p--)ur(v[p],v[p-1]);for(p=m;p<v.length-1;p++)ur(v[p],v[p+1]);return d.fragmentHint&&ur(v[v.length-1],d.fragmentHint),d.PTSKnown=d.alignedSliding=!0,u}function ml(d,t){let e=null;const i=d.fragments;for(let l=i.length-1;l>=0;l--){const o=i[l].initSegment;if(o){e=o;break}}d.fragmentHint&&delete d.fragmentHint.endPTS;let s=0,r;if(_l(d,t,(l,o)=>{l.relurl&&(s=l.cc-o.cc),mt(l.startPTS)&&mt(l.endPTS)&&(o.start=o.startPTS=l.startPTS,o.startDTS=l.startDTS,o.maxStartPTS=l.maxStartPTS,o.endPTS=l.endPTS,o.endDTS=l.endDTS,o.minEndPTS=l.minEndPTS,o.duration=l.endPTS-l.startPTS,o.duration&&(r=o),t.PTSKnown=t.alignedSliding=!0),o.elementaryStreams=l.elementaryStreams,o.loader=l.loader,o.stats=l.stats,o.urlId=l.urlId,l.initSegment&&(o.initSegment=l.initSegment,e=l.initSegment)}),e&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach(o=>{var c;(!o.initSegment||o.initSegment.relurl===((c=e)==null?void 0:c.relurl))&&(o.initSegment=e)}),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(l=>!l),t.deltaUpdateFailed){H.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=t.skippedSegments;l--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=gl(d.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const n=t.fragments;if(s){H.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<n.length;l++)n[l].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),yl(d.partList,t.partList,(l,o)=>{o.elementaryStreams=l.elementaryStreams,o.stats=l.stats}),r?Bn(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Un(d,t),n.length&&(t.totalduration=t.edge-n[0].start),t.driftStartTime=d.driftStartTime,t.driftStart=d.driftStart;const a=t.advancedDateTime;if(t.advanced&&a){const l=t.edge;t.driftStart||(t.driftStartTime=a,t.driftStart=l),t.driftEndTime=a,t.driftEnd=l}else t.driftEndTime=d.driftEndTime,t.driftEnd=d.driftEnd,t.advancedDateTime=d.advancedDateTime}function gl(d,t,e){const i=Zt({},d);return e&&e.forEach(s=>{delete i[s]}),Object.keys(t).forEach(s=>{const r=new En(t[s].attr,i[s]);r.isValid?i[s]=r:H.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[s].attr)}"`)}),i}function yl(d,t,e){if(d&&t){let i=0;for(let s=0,r=d.length;s<=r;s++){const n=d[s],a=t[s+i];n&&a&&n.index===a.index&&n.fragment.sn===a.fragment.sn?e(n,a):i--}}}function _l(d,t,e){const i=t.skippedSegments,s=Math.max(d.startSN,t.startSN)-t.startSN,r=(d.fragmentHint?1:0)+(i?t.endSN:Math.min(d.endSN,t.endSN))-t.startSN,n=t.startSN-d.startSN,a=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=d.fragmentHint?d.fragments.concat(d.fragmentHint):d.fragments;for(let o=s;o<=r;o++){const c=l[n+o];let u=a[o];i&&!u&&o<i&&(u=t.fragments[o]=c),c&&u&&e(c,u)}}function Un(d,t){const e=t.startSN+t.skippedSegments-d.startSN,i=d.fragments;e<0||e>=i.length||kr(t,i[e].start)}function kr(d,t){if(t){const e=d.fragments;for(let i=d.skippedSegments;i<e.length;i++)e[i].start+=t;d.fragmentHint&&(d.fragmentHint.start+=t)}}function vl(d,t=1/0){let e=1e3*d.targetduration;if(d.updated){const i=d.fragments,s=4;if(i.length&&e*s>t){const r=i[i.length-1].duration*1e3;r<e&&(e=r)}}else e/=2;return Math.round(e)}function El(d,t,e){if(!(d!=null&&d.details))return null;const i=d.details;let s=i.fragments[t-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===t)?s:t<i.startSN&&e&&e.sn===t?e:null}function js(d,t,e){var i;return d!=null&&d.details?jn((i=d.details)==null?void 0:i.partList,t,e):null}function jn(d,t,e){if(d)for(let i=d.length;i--;){const s=d[i];if(s.index===e&&s.fragment.sn===t)return s}return null}function Ni(d){switch(d.details){case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_TIMEOUT:case J.LEVEL_LOAD_TIMEOUT:case J.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Gs(d,t){const e=Ni(t);return d.default[`${e?"timeout":"error"}Retry`]}function jr(d,t){const e=d.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*d.retryDelayMs,d.maxRetryDelayMs)}function Vs(d){return le(le({},d),{errorRetry:null,timeoutRetry:null})}function Fi(d,t,e,i){return!!d&&t<d.maxNumRetry&&(Sl(i)||!!e)}function Sl(d){return d===0&&navigator.onLine===!1||!!d&&(d<400||d>499)}const Gn={search:function(d,t){let e=0,i=d.length-1,s=null,r=null;for(;e<=i;){s=(e+i)/2|0,r=d[s];const n=t(r);if(n>0)e=s+1;else if(n<0)i=s-1;else return r}return null}};function xl(d,t,e){if(t===null||!Array.isArray(d)||!d.length||!mt(t))return null;const i=d[0].programDateTime;if(t<(i||0))return null;const s=d[d.length-1].endProgramDateTime;if(t>=(s||0))return null;e=e||0;for(let r=0;r<d.length;++r){const n=d[r];if(Tl(t,e,n))return n}return null}function Ei(d,t,e=0,i=0){let s=null;if(d?s=t[d.sn-t[0].sn+1]||null:e===0&&t[0].start===0&&(s=t[0]),s&&Mr(e,i,s)===0)return s;const r=Gn.search(t,Mr.bind(null,e,i));return r&&(r!==d||!s)?r:s}function Mr(d=0,t=0,e){if(e.start<=d&&e.start+e.duration>d)return 0;const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-i<=d?1:e.start-i>d&&e.start?-1:0}function Tl(d,t,e){const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-i>d}function bl(d,t){return Gn.search(d,e=>e.cc<t?1:e.cc>t?-1:0)}const Al=3e5;var ae={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},me={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class Ll{constructor(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=H.log.bind(H,"[info]:"),this.warn=H.warn.bind(H,"[warning]:"),this.error=H.error.bind(H,"[error]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(D.ERROR,this.onError,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;!t||(t.off(D.ERROR,this.onError,this),t.off(D.ERROR,this.onErrorOut,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){this.playlistError=0}stopLoad(){}getVariantLevelIndex(t){return(t==null?void 0:t.type)===Tt.MAIN?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,e){var i,s;if(e.fatal)return;const r=this.hls,n=e.context;switch(e.details){case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case J.FRAG_PARSING_ERROR:if((i=e.frag)!=null&&i.gap){e.errorAction={action:ae.DoNothing,flags:me.None};return}case J.FRAG_GAP:case J.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=ae.SendAlternateToPenaltyBox;return}case J.LEVEL_EMPTY_ERROR:case J.LEVEL_PARSING_ERROR:{var a,l;const o=e.parent===Tt.MAIN?e.level:r.loadLevel;e.details===J.LEVEL_EMPTY_ERROR&&!!((a=e.context)!=null&&(l=a.levelDetails)!=null&&l.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,o):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,o))}return;case J.LEVEL_LOAD_ERROR:case J.LEVEL_LOAD_TIMEOUT:typeof(n==null?void 0:n.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,n.level));return;case J.AUDIO_TRACK_LOAD_ERROR:case J.AUDIO_TRACK_LOAD_TIMEOUT:case J.SUBTITLE_LOAD_ERROR:case J.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const o=r.levels[r.loadLevel];if(o&&(n.type===Nt.AUDIO_TRACK&&n.groupId===o.audioGroupId||n.type===Nt.SUBTITLE_TRACK&&n.groupId===o.textGroupId)){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.loadLevel),e.errorAction.action=ae.SendAlternateToPenaltyBox,e.errorAction.flags=me.MoveAllAlternatesMatchingHost;return}}return;case J.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const o=r.levels[r.loadLevel],c=o==null?void 0:o.attrs["HDCP-LEVEL"];c&&(e.errorAction={action:ae.SendAlternateToPenaltyBox,flags:me.MoveAllAlternatesMatchingHDCP,hdcpLevel:c})}return;case J.BUFFER_ADD_CODEC_ERROR:case J.REMUX_ALLOC_ERROR:e.errorAction=this.getLevelSwitchAction(e,(s=e.level)!=null?s:r.loadLevel);return;case J.INTERNAL_EXCEPTION:case J.BUFFER_APPENDING_ERROR:case J.BUFFER_APPEND_ERROR:case J.BUFFER_FULL_ERROR:case J.LEVEL_SWITCH_ERROR:case J.BUFFER_STALLED_ERROR:case J.BUFFER_SEEK_OVER_HOLE:case J.BUFFER_NUDGE_ON_STALL:e.errorAction={action:ae.DoNothing,flags:me.None};return}if(e.type===xt.KEY_SYSTEM_ERROR){const o=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,o);return}}getPlaylistRetryOrSwitchAction(t,e){var i;const s=this.hls,r=Gs(s.config.playlistLoadPolicy,t),n=this.playlistError++,a=(i=t.response)==null?void 0:i.code;if(Fi(r,n,Ni(t),a))return{action:ae.RetryRequest,flags:me.None,retryConfig:r,retryCount:n};const o=this.getLevelSwitchAction(t,e);return r&&(o.retryConfig=r,o.retryCount=n),o}getFragRetryOrSwitchAction(t){const e=this.hls,i=this.getVariantLevelIndex(t.frag),s=e.levels[i],{fragLoadPolicy:r,keyLoadPolicy:n}=e.config,a=Gs(t.details.startsWith("key")?n:r,t),l=e.levels.reduce((u,h)=>u+h.fragmentError,0);if(s){var o;t.details!==J.FRAG_GAP&&s.fragmentError++;const u=(o=t.response)==null?void 0:o.code;if(Fi(a,l,Ni(t),u))return{action:ae.RetryRequest,flags:me.None,retryConfig:a,retryCount:l}}const c=this.getLevelSwitchAction(t,i);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(t,e){const i=this.hls;e==null&&(e=i.loadLevel);const s=this.hls.levels[e];if(s&&(s.loadError++,i.autoLevelEnabled)){var r,n;let a=-1;const{levels:l,loadLevel:o,minAutoLevel:c,maxAutoLevel:u}=i,h=(r=t.frag)==null?void 0:r.type,{type:p,groupId:m}=(n=t.context)!=null?n:{};for(let v=l.length;v--;){const E=(v+o)%l.length;if(E!==o&&E>=c&&E<=u&&l[E].loadError===0){const C=l[E];if(t.details===J.FRAG_GAP&&t.frag){const N=l[E].details;if(N){const R=Ei(t.frag,N.fragments,t.frag.start);if(R!=null&&R.gap)continue}}else{if(p===Nt.AUDIO_TRACK&&m===C.audioGroupId||p===Nt.SUBTITLE_TRACK&&m===C.textGroupId)continue;if(h===Tt.AUDIO&&s.audioGroupId===C.audioGroupId||h===Tt.SUBTITLE&&s.textGroupId===C.textGroupId)continue}a=E;break}}if(a>-1&&i.loadLevel!==a)return t.levelRetry=!0,this.playlistError=0,{action:ae.SendAlternateToPenaltyBox,flags:me.None,nextAutoLevel:a}}return{action:ae.SendAlternateToPenaltyBox,flags:me.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var i;switch((i=e.errorAction)==null?void 0:i.action){case ae.DoNothing:break;case ae.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==J.FRAG_GAP&&(e.fatal=!0);break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,i=t.errorAction;if(!i)return;const{flags:s,hdcpLevel:r,nextAutoLevel:n}=i;switch(s){case me.None:this.switchLevel(t,n);break;case me.MoveAllAlternatesMatchingHost:i.resolved||(i.resolved=this.redundantFailover(t));break;case me.MoveAllAlternatesMatchingHDCP:r&&(e.maxHdcpLevel=Cr[Cr.indexOf(r)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(t,n)}switchLevel(t,e){e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(t){const{hls:e,penalizedRenditions:i}=this,s=t.parent===Tt.MAIN?t.level:e.loadLevel,r=e.levels[s],n=r.url.length,a=t.frag?t.frag.urlId:r.urlId;r.urlId===a&&(!t.frag||r.details)&&this.penalizeRendition(r,t);for(let l=1;l<n;l++){const o=(a+l)%n,c=i[o];if(!c||Il(c,t,i[a]))return this.warn(`Switching to Redundant Stream ${o+1}/${n}: "${r.url[o]}" after ${t.details}`),this.playlistError=0,e.levels.forEach(u=>{u.urlId=o}),e.nextLoadLevel=s,!0}return!1}penalizeRendition(t,e){const{penalizedRenditions:i}=this,s=i[t.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};s.lastErrorPerfMs=performance.now(),s.errors.push(e),s.details=t.details,i[t.urlId]=s}}function Il(d,t,e){if(performance.now()-d.lastErrorPerfMs>Al)return!0;const i=d.details;if(t.details===J.FRAG_GAP&&i&&t.frag){const s=t.frag.start,r=Ei(null,i.fragments,s);if(r&&!r.gap)return!0}if(e&&d.errors.length<e.errors.length){const s=d.errors[d.errors.length-1];if(i&&s.frag&&t.frag&&Math.abs(s.frag.start-t.frag.start)>i.targetduration*3)return!0}return!1}class Gr{constructor(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=H.log.bind(H,`${e}:`),this.warn=H.warn.bind(H,`${e}:`),this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e){const i=e==null?void 0:e.renditionReports;if(i){let s=-1;for(let r=0;r<i.length;r++){const n=i[r];let a;try{a=new self.URL(n.URI,e.url).href}catch(l){H.warn(`Could not construct new URL for Rendition Report: ${l}`),a=n.URI||""}if(a===t){s=r;break}else a===t.substring(0,a.length)&&(s=r)}if(s!==-1){const r=i[s],n=parseInt(r["LAST-MSN"])||(e==null?void 0:e.lastPartSn);let a=parseInt(r["LAST-PART"])||(e==null?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){const l=Math.min(e.age-e.partTarget,e.targetduration);a>=0&&l>e.partTarget&&(a+=1)}return new Us(n,a>=0?a:void 0,yi.No)}}}loadPlaylist(t){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}shouldReloadPlaylist(t){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(t)}playlistLoaded(t,e,i){const{details:s,stats:r}=e,n=self.performance.now(),a=r.loading.first?Math.max(0,n-r.loading.first):0;if(s.advancedDateTime=Date.now()-a,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log(`live playlist ${t} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),i&&s.fragments.length>0&&ml(i,s),!this.canLoad||!s.live)return;let l,o,c;if(s.canBlockReload&&s.endSN&&s.advanced){const E=this.hls.config.lowLatencyMode,C=s.lastPartSn,N=s.endSN,R=s.lastPartIndex,x=R!==-1,P=C===N,M=E?0:R;x?(o=P?N+1:C,c=P?M:R+1):o=N+1;const b=s.age,T=b+s.ageHeader;let I=Math.min(T-s.partTarget,s.targetduration*1.5);if(I>0){if(i&&I>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${I} with playlist age: ${s.age}`),I=0;else{const A=Math.floor(I/s.targetduration);o+=A,c!==void 0&&(c+=Math.round(I%s.targetduration/s.partTarget)),this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${b.toFixed(2)}s goal: ${I} skip sn ${A} to part ${c}`)}s.tuneInGoal=I}if(l=this.getDeliveryDirectives(s,e.deliveryDirectives,o,c),E||!P){this.loadPlaylist(l);return}}else(s.canBlockReload||s.canSkipUntil)&&(l=this.getDeliveryDirectives(s,e.deliveryDirectives,o,c));const u=this.hls.mainForwardBufferInfo,h=u?u.end-u.len:0,p=(s.edge-h)*1e3,m=vl(s,p);s.updated&&n>this.requestScheduled+m&&(this.requestScheduled=r.loading.start),o!==void 0&&s.canBlockReload?this.requestScheduled=r.loading.first+m-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+m<n?this.requestScheduled=n:this.requestScheduled-n<=0&&(this.requestScheduled+=m);let v=this.requestScheduled-n;v=Math.max(0,v),this.log(`reload live playlist ${t} in ${Math.round(v)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),v)}else this.clearTimer()}getDeliveryDirectives(t,e,i,s){let r=pl(t,i);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,s=e.part,r=yi.No),new Us(i,s,r)}checkRetry(t){const e=t.details,i=Ni(t),s=t.errorAction,{action:r,retryCount:n=0,retryConfig:a}=s||{},l=!!s&&!!a&&(r===ae.RetryRequest||!s.resolved&&r===ae.SendAlternateToPenaltyBox);if(l){var o;if(this.requestScheduled=-1,n>=a.maxNumRetry)return!1;if(i&&(o=t.context)!=null&&o.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const c=jr(a,n);this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${e}" in ${c}ms`)}t.levelRetry=!0,s.resolved=!0}return l}}let hr;class wl extends Gr{constructor(t,e){super(t,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const i=[],s={};let r;e.levels.forEach(n=>{var a;const l=n.attrs;((a=n.audioCodec)==null?void 0:a.indexOf("mp4a.40.34"))!==-1&&(hr||(hr=/chrome|firefox/i.test(navigator.userAgent)),hr&&(n.audioCodec=void 0));const{AUDIO:o,CODECS:c,"FRAME-RATE":u,"PATHWAY-ID":h,RESOLUTION:p,SUBTITLES:m}=l,E=`${`${h||"."}-`}${n.bitrate}-${p}-${u}-${c}`;r=s[E],r?r.addFallback(n):(r=new vi(n),s[E]=r,i.push(r)),Bi(r,"audio",o),Bi(r,"text",m)}),this.filterAndSortMediaOptions(i,e)}filterAndSortMediaOptions(t,e){let i=[],s=[],r=!1,n=!1,a=!1,l=t.filter(({audioCodec:p,videoCodec:m,width:v,height:E,unknownCodecs:C})=>(r||(r=!!(v&&E)),n||(n=!!m),a||(a=!!p),!(C!=null&&C.length)&&(!p||lr(p,"audio"))&&(!m||lr(m,"video"))));if((r||n)&&a&&(l=l.filter(({videoCodec:p,width:m,height:v})=>!!p||!!(m&&v))),l.length===0){Promise.resolve().then(()=>{if(this.hls){const p=new Error("no level with compatible codecs found in manifest");this.hls.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:p,reason:p.message})}});return}e.audioTracks&&(i=e.audioTracks.filter(p=>!p.audioCodec||lr(p.audioCodec,"audio")),$s(i)),e.subtitles&&(s=e.subtitles,$s(s));const o=l.slice(0);l.sort((p,m)=>p.attrs["HDCP-LEVEL"]!==m.attrs["HDCP-LEVEL"]?(p.attrs["HDCP-LEVEL"]||"")>(m.attrs["HDCP-LEVEL"]||"")?1:-1:p.bitrate!==m.bitrate?p.bitrate-m.bitrate:p.attrs["FRAME-RATE"]!==m.attrs["FRAME-RATE"]?p.attrs.decimalFloatingPoint("FRAME-RATE")-m.attrs.decimalFloatingPoint("FRAME-RATE"):p.attrs.SCORE!==m.attrs.SCORE?p.attrs.decimalFloatingPoint("SCORE")-m.attrs.decimalFloatingPoint("SCORE"):r&&p.height!==m.height?p.height-m.height:0);let c=o[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==o.length)){for(let p=0;p<o.length;p++)if(o[p].pathwayId===l[0].pathwayId){c=o[p];break}}this._levels=l;for(let p=0;p<l.length;p++)if(l[p]===c){this._firstLevel=p,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${c.bitrate}`);break}const u=a&&!n,h={levels:l,audioTracks:i,subtitleTracks:s,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:a,video:n,altAudio:!u&&i.some(p=>!!p.url)};this.hls.trigger(D.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const c=new Error("invalid level idx"),u=t<0;if(this.hls.trigger(D.ERROR,{type:xt.OTHER_ERROR,details:J.LEVEL_SWITCH_ERROR,level:t,fatal:u,error:c,reason:c.message}),u)return;t=Math.min(t,e.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,r=s?s.attrs["PATHWAY-ID"]:void 0,n=e[t],a=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=n,i===t&&n.details&&s&&r===a)return;this.log(`Switching to level ${t}${a?" with Pathway "+a:""} from level ${i}${r?" with Pathway "+r:""}`);const l=Zt({},n,{level:t,maxBitrate:n.maxBitrate,attrs:n.attrs,uri:n.uri,urlId:n.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(D.LEVEL_SWITCHING,l);const o=n.details;if(!o||o.live){const c=this.switchParams(n.uri,s==null?void 0:s.details);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}else return this._startLevel}set startLevel(t){this._startLevel=t}onError(t,e){e.fatal||!e.context||e.context.type===Nt.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragLoaded(t,{frag:e}){if(e!==void 0&&e.type===Tt.MAIN){const i=this._levels[e.level];i!==void 0&&(i.loadError=0)}}onLevelLoaded(t,e){var i;const{level:s,details:r}=e,n=this._levels[s];if(!n){var a;this.warn(`Invalid level index ${s}`),(a=e.deliveryDirectives)!=null&&a.skip&&(r.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(n.fragmentError===0&&(n.loadError=0),this.playlistLoaded(s,e,n.details)):(i=e.deliveryDirectives)!=null&&i.skip&&(r.deltaUpdateFailed=!0)}onAudioTrackSwitched(t,e){const i=this.currentLevel;if(!i)return;const s=this.hls.audioTracks[e.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==s){let r=-1;for(let n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===s){r=n;break}r!==-1&&r!==i.urlId&&(i.urlId=r,this.canLoad&&this.startLoad())}}loadPlaylist(t){super.loadPlaylist();const e=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const s=i.urlId;let r=i.uri;if(t)try{r=t.addDirectives(r)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const n=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${e}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""} with${n?" Pathway "+n:""} URI ${s+1}/${i.url.length} ${r}`),this.clearTimer(),this.hls.trigger(D.LEVEL_LOADING,{url:r,level:e,id:s,deliveryDirectives:t||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t,e){const i=(r,n)=>n!==e,s=this._levels.filter((r,n)=>n!==t?!0:r.url.length>1&&e!==void 0?(r.url=r.url.filter(i),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(i)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(i)),r.urlId=0,!0):(this.steering&&this.steering.removeLevel(r),!1));this.hls.trigger(D.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(t,{levels:e}){e.forEach((i,s)=>{const{details:r}=i;r!=null&&r.fragments&&r.fragments.forEach(n=>{n.level=s})}),this._levels=e}}function Bi(d,t,e){!e||(t==="audio"?(d.audioGroupIds||(d.audioGroupIds=[]),d.audioGroupIds[d.url.length-1]=e):t==="text"&&(d.textGroupIds||(d.textGroupIds=[]),d.textGroupIds[d.url.length-1]=e))}function $s(d){const t={};d.forEach(e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}var ee={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Rl{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(D.BUFFER_APPENDED,this.onBufferAppended,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.BUFFER_APPENDED,this.onBufferAppended,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const i=this.activePartLists[e];if(i)for(let s=i.length;s--;){const r=i[s];if(!r)break;const n=r.end;if(r.start<=t&&n!==null&&t<=n)return r}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){const{fragments:i}=this,s=Object.keys(i);for(let r=s.length;r--;){const n=i[s[r]];if((n==null?void 0:n.body.type)===e&&n.buffered){const a=n.body;if(a.start<=t&&t<=a.end)return a}}return null}detectEvictedFragments(t,e,i,s){this.timeRanges&&(this.timeRanges[t]=e);const r=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(n=>{const a=this.fragments[n];if(!a||r>=a.body.sn)return;if(!a.buffered&&!a.loaded){a.body.type===i&&this.removeFragment(a.body);return}const l=a.range[t];!l||l.time.some(o=>{const c=!this.isTimeBuffered(o.startPTS,o.endPTS,e);return c&&this.removeFragment(a.body),c})})}detectPartialFragments(t){const e=this.timeRanges,{frag:i,part:s}=t;if(!e||i.sn==="initSegment")return;const r=ri(i),n=this.fragments[r];if(!n||n.buffered&&i.gap)return;const a=!i.relurl;Object.keys(e).forEach(l=>{const o=i.elementaryStreams[l];if(!o)return;const c=e[l],u=a||o.partial===!0;n.range[l]=this.getBufferedTimes(i,s,u,c)}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,(n.body.endList=i.endList||n.body.endList)&&(this.endListFragments[n.body.type]=n),Ai(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}removeParts(t,e){const i=this.activePartLists[e];!i||(this.activePartLists[e]=i.filter(s=>s.fragment.sn>=t))}fragBuffered(t,e){const i=ri(t);let s=this.fragments[i];!s&&e&&(s=this.fragments[i]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(t,e,i,s){const r={time:[],partial:i},n=t.start,a=t.end,l=t.minEndPTS||a,o=t.maxStartPTS||n;for(let c=0;c<s.length;c++){const u=s.start(c)-this.bufferPadding,h=s.end(c)+this.bufferPadding;if(o>=u&&l<=h){r.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(a,s.end(c))});break}else if(n<h&&a>u)r.partial=!0,r.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(a,s.end(c))});else if(a<=u)break}return r}getPartialFragment(t){let e=null,i,s,r,n=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(o=>{const c=l[o];!c||Ai(c)&&(s=c.body.start-a,r=c.body.end+a,t>=s&&t<=r&&(i=Math.min(t-s,r-t),n<=i&&(e=c.body,n=i)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||Ai(e))}getState(t){const e=ri(t),i=this.fragments[e];return i?i.buffered?Ai(i)?ee.PARTIAL:ee.OK:ee.APPENDING:ee.NOT_LOADED}isTimeBuffered(t,e,i){let s,r;for(let n=0;n<i.length;n++){if(s=i.start(n)-this.bufferPadding,r=i.end(n)+this.bufferPadding,t>=s&&e<=r)return!0;if(e<=s)return!1}return!1}onFragLoaded(t,e){const{frag:i,part:s}=e;if(i.sn==="initSegment"||i.bitrateTest)return;const r=s?null:e,n=ri(i);this.fragments[n]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:i,part:s,timeRanges:r}=e;if(i.sn==="initSegment")return;const n=i.type;if(s){let a=this.activePartLists[n];a||(this.activePartLists[n]=a=[]),a.push(s)}this.timeRanges=r,Object.keys(r).forEach(a=>{const l=r[a];this.detectEvictedFragments(a,l,n,s)})}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=ri(t);return!!this.fragments[e]}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,i,s,r){s&&!this.hasGaps||Object.keys(this.fragments).forEach(n=>{const a=this.fragments[n];if(!a)return;const l=a.body;l.type!==i||s&&!l.gap||l.start<e&&l.end>t&&(a.buffered||r)&&this.removeFragment(l)})}removeFragment(t){const e=ri(t);t.stats.loaded=0,t.clearElementaryStreamInfo();const i=this.activePartLists[t.type];if(i){const s=t.sn;this.activePartLists[t.type]=i.filter(r=>r.fragment.sn!==s)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Ai(d){var t,e,i;return d.buffered&&(d.body.gap||((t=d.range.video)==null?void 0:t.partial)||((e=d.range.audio)==null?void 0:e.partial)||((i=d.range.audiovideo)==null?void 0:i.partial))}function ri(d){return`${d.type}_${d.level}_${d.urlId}_${d.sn}`}const zs=Math.pow(2,17);class Dl{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const i=t.url;if(!i)return Promise.reject(new Ue({type:xt.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,r=s.fLoader,n=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),t.gap)if(t.tagList.some(p=>p[0]==="GAP")){l(Ys(t));return}else t.gap=!1;const o=this.loader=t.loader=r?new r(s):new n(s),c=Hs(t),u=Vs(s.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:zs};t.stats=o.stats,o.load(c,h,{onSuccess:(p,m,v,E)=>{this.resetLoader(t,o);let C=p.data;v.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(C.slice(0,16)),C=C.slice(16)),a({frag:t,part:null,payload:C,networkDetails:E})},onError:(p,m,v,E)=>{this.resetLoader(t,o),l(new Ue({type:xt.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:le({url:i,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:v,stats:E}))},onAbort:(p,m,v)=>{this.resetLoader(t,o),l(new Ue({type:xt.NETWORK_ERROR,details:J.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:v,stats:p}))},onTimeout:(p,m,v)=>{this.resetLoader(t,o),l(new Ue({type:xt.NETWORK_ERROR,details:J.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:v,stats:p}))},onProgress:(p,m,v,E)=>{e&&e({frag:t,part:null,payload:v,networkDetails:E})}})})}loadPart(t,e,i){this.abort();const s=this.config,r=s.fLoader,n=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){l(Ys(t,e));return}const o=this.loader=t.loader=r?new r(s):new n(s),c=Hs(t,e),u=Vs(s.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:zs};e.stats=o.stats,o.load(c,h,{onSuccess:(p,m,v,E)=>{this.resetLoader(t,o),this.updateStatsFromPart(t,e);const C={frag:t,part:e,payload:p.data,networkDetails:E};i(C),a(C)},onError:(p,m,v,E)=>{this.resetLoader(t,o),l(new Ue({type:xt.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:le({url:c.url,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:v,stats:E}))},onAbort:(p,m,v)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,o),l(new Ue({type:xt.NETWORK_ERROR,details:J.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:v,stats:p}))},onTimeout:(p,m,v)=>{this.resetLoader(t,o),l(new Ue({type:xt.NETWORK_ERROR,details:J.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:v,stats:p}))}})})}updateStatsFromPart(t,e){const i=t.stats,s=e.stats,r=s.total;if(i.loaded+=s.loaded,r){const l=Math.round(t.duration/e.duration),o=Math.min(Math.round(i.loaded/r),l),u=(l-o)*Math.round(i.loaded/o);i.total=i.loaded+u}else i.total=Math.max(i.loaded,i.total);const n=i.loading,a=s.loading;n.start?n.first+=a.first-a.start:(n.start=a.start,n.first=a.first),n.end=a.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Hs(d,t=null){const e=t||d,i={frag:d,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},s=e.byteRangeStartOffset,r=e.byteRangeEndOffset;if(mt(s)&&mt(r)){var n;let a=s,l=r;if(d.sn==="initSegment"&&((n=d.decryptdata)==null?void 0:n.method)==="AES-128"){const o=r-s;o%16&&(l=r+(16-o%16)),s!==0&&(i.resetIV=!0,a=s-16)}i.rangeStart=a,i.rangeEnd=l}return i}function Ys(d,t){const e=new Error(`GAP ${d.gap?"tag":"attribute"} found`),i={type:xt.MEDIA_ERROR,details:J.FRAG_GAP,fatal:!1,frag:d,error:e,networkDetails:null};return t&&(i.part=t),(t||d).stats.aborted=!0,new Ue(i)}class Ue extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class Cl{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e].loader;if(i){if(t&&t!==i.context.frag.type)return;i.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,e=J.KEY_LOAD_ERROR,i,s,r){return new Ue({type:xt.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:r,error:i,networkDetails:s})}loadClear(t,e){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:s}=t;for(let r=0;r<e.length;r++){const n=e[r];if(s<=n.cc&&(i==="initSegment"||n.sn==="initSegment"||i<n.sn)){this.emeController.selectKeySystemFormat(n).then(a=>{n.setKeyFormat(a)});break}}}}load(t){return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var i,s;e&&t.setKeyFormat(e);const r=t.decryptdata;if(!r){const o=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,J.KEY_LOAD_ERROR,o))}const n=r.uri;if(!n)return Promise.reject(this.createKeyLoadError(t,J.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let a=this.keyUriToKeyInfo[n];if((i=a)!=null&&i.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:t,keyInfo:a});if((s=a)!=null&&s.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(o=>(r.key=o.keyInfo.decryptdata.key,{frag:t,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[n]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(a,t):this.loadKeyEME(a,t);case"AES-128":return this.loadKeyHTTP(a,t);default:return Promise.reject(this.createKeyLoadError(t,J.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(t,e){const i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(t.keyLoadPromise=s.then(r=>(t.mediaKeySessionContext=r,i))).catch(r=>{throw t.keyLoadPromise=null,r})}return Promise.resolve(i)}loadKeyHTTP(t,e){const i=this.config,s=i.loader,r=new s(i);return e.keyLoader=t.loader=r,t.keyLoadPromise=new Promise((n,a)=>{const l={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},o=i.keyLoadPolicy.default,c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(h,p,m,v)=>{const{frag:E,keyInfo:C,url:N}=m;if(!E.decryptdata||C!==this.keyUriToKeyInfo[N])return a(this.createKeyLoadError(E,J.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),v));C.decryptdata.key=E.decryptdata.key=new Uint8Array(h.data),E.keyLoader=null,C.loader=null,n({frag:E,keyInfo:C})},onError:(h,p,m,v)=>{this.resetLoader(p),a(this.createKeyLoadError(e,J.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),m,le({url:l.url,data:void 0},h)))},onTimeout:(h,p,m)=>{this.resetLoader(p),a(this.createKeyLoadError(e,J.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(h,p,m)=>{this.resetLoader(p),a(this.createKeyLoadError(e,J.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};r.load(l,c,u)})}resetLoader(t){const{frag:e,keyInfo:i,url:s}=t,r=i.loader;e.keyLoader===r&&(e.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],r&&r.destroy()}}class kl{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const Ml={length:0,start:()=>0,end:()=>0};class Gt{static isBuffered(t,e){try{if(t){const i=Gt.getBuffered(t);for(let s=0;s<i.length;s++)if(e>=i.start(s)&&e<=i.end(s))return!0}}catch(i){}return!1}static bufferInfo(t,e,i){try{if(t){const s=Gt.getBuffered(t),r=[];let n;for(n=0;n<s.length;n++)r.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(r,e,i)}}catch(s){}return{len:0,start:e,end:e,nextStart:void 0}}static bufferedInfo(t,e,i){e=Math.max(0,e),t.sort(function(o,c){const u=o.start-c.start;return u||c.end-o.end});let s=[];if(i)for(let o=0;o<t.length;o++){const c=s.length;if(c){const u=s[c-1].end;t[o].start-u<i?t[o].end>u&&(s[c-1].end=t[o].end):s.push(t[o])}else s.push(t[o])}else s=t;let r=0,n,a=e,l=e;for(let o=0;o<s.length;o++){const c=s[o].start,u=s[o].end;if(e+i>=c&&e<u)a=c,l=u,r=l-e;else if(e+i<c){n=c;break}}return{len:r,start:a||0,end:l||0,nextStart:n}}static getBuffered(t){try{return t.buffered}catch(e){return H.log("failed to get media.buffered",e),Ml}}}class Vr{constructor(t,e,i,s=0,r=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Li(),this.buffering={audio:Li(),video:Li(),audiovideo:Li()},this.level=t,this.sn=e,this.id=i,this.size=s,this.part=r,this.partial=n}}function Li(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Vn(d,t){let e=null;for(let i=0,s=d.length;i<s;i++){const r=d[i];if(r&&r.cc===t){e=r;break}}return e}function Pl(d,t,e){return!!(t.details&&(e.endCC>e.startCC||d&&d.cc<e.startCC))}function Ol(d,t,e=0){const i=d.fragments,s=t.fragments;if(!s.length||!i.length){H.log("No fragments to align");return}const r=Vn(i,s[0].cc);if(!r||r&&!r.startPTS){H.log("No frag in previous level to align on");return}return r}function Ks(d,t){if(d){const e=d.start+t;d.start=d.startPTS=e,d.endPTS=e+d.duration}}function $r(d,t){const e=t.fragments;for(let i=0,s=e.length;i<s;i++)Ks(e[i],d);t.fragmentHint&&Ks(t.fragmentHint,d),t.alignedSliding=!0}function Nl(d,t,e){!t||(Fl(d,e,t),!e.alignedSliding&&t.details&&Bl(e,t.details),!e.alignedSliding&&t.details&&!e.skippedSegments&&Un(t.details,e))}function Fl(d,t,e){if(Pl(d,e,t)){const i=Ol(e.details,t);i&&mt(i.start)&&(H.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),$r(i.start,t))}}function Bl(d,t){if(!t.fragments.length||!d.hasProgramDateTime||!t.hasProgramDateTime)return;const e=t.fragments[0].programDateTime,i=d.fragments[0].programDateTime,s=(i-e)/1e3+t.fragments[0].start;s&&mt(s)&&(H.log(`Adjusting PTS using programDateTime delta ${i-e}ms, sliding:${s.toFixed(3)} ${d.url} `),$r(s,d))}function $n(d,t){if(!d.hasProgramDateTime||!t.hasProgramDateTime)return;const e=d.fragments,i=t.fragments;if(!e.length||!i.length)return;const s=Math.round(i.length/2)-1,r=i[s],n=Vn(e,r.cc)||e[Math.round(e.length/2)-1],a=r.programDateTime,l=n.programDateTime;if(a===null||l===null)return;const o=(l-a)/1e3-(n.start-r.start);$r(o,d)}class Ul{constructor(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}decrypt(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)}}class jl{constructor(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Gl(d){const t=d.byteLength,e=t&&new DataView(d.buffer).getUint8(t-1);return e?ti(d,0,t-e):d}class Vl{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=e.getUint32(s*4);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],r=i[1],n=i[2],a=i[3],l=this.invSubMix,o=l[0],c=l[1],u=l[2],h=l[3],p=new Uint32Array(256);let m=0,v=0,E=0;for(E=0;E<256;E++)E<128?p[E]=E<<1:p[E]=E<<1^283;for(E=0;E<256;E++){let C=v^v<<1^v<<2^v<<3^v<<4;C=C>>>8^C&255^99,t[m]=C,e[C]=m;const N=p[m],R=p[N],x=p[R];let P=p[C]*257^C*16843008;s[m]=P<<24|P>>>8,r[m]=P<<16|P>>>16,n[m]=P<<8|P>>>24,a[m]=P,P=x*16843009^R*65537^N*257^m*16843008,o[C]=P<<24|P>>>8,c[C]=P<<16|P>>>16,u[C]=P<<8|P>>>24,h[C]=P,m?(m=N^p[p[p[x^N]]],v^=p[p[v]]):m=v=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let i=!0,s=0;for(;s<e.length&&i;)i=e[s]===this.key[s],s++;if(i)return;this.key=e;const r=this.keySize=e.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const n=this.ksRows=(r+6+1)*4;let a,l;const o=this.keySchedule=new Uint32Array(n),c=this.invKeySchedule=new Uint32Array(n),u=this.sBox,h=this.rcon,p=this.invSubMix,m=p[0],v=p[1],E=p[2],C=p[3];let N,R;for(a=0;a<n;a++){if(a<r){N=o[a]=e[a];continue}R=N,a%r===0?(R=R<<8|R>>>24,R=u[R>>>24]<<24|u[R>>>16&255]<<16|u[R>>>8&255]<<8|u[R&255],R^=h[a/r|0]<<24):r>6&&a%r===4&&(R=u[R>>>24]<<24|u[R>>>16&255]<<16|u[R>>>8&255]<<8|u[R&255]),o[a]=N=(o[a-r]^R)>>>0}for(l=0;l<n;l++)a=n-l,l&3?R=o[a]:R=o[a-4],l<4||a<=4?c[l]=R:c[l]=m[u[R>>>24]]^v[u[R>>>16&255]]^E[u[R>>>8&255]]^C[u[R&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,i){const s=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,l=a[0],o=a[1],c=a[2],u=a[3],h=this.uint8ArrayToUint32Array_(i);let p=h[0],m=h[1],v=h[2],E=h[3];const C=new Int32Array(t),N=new Int32Array(C.length);let R,x,P,M,b,T,I,A,U,B,$,X,nt,ot;const z=this.networkToHostOrderSwap;for(;e<C.length;){for(U=z(C[e]),B=z(C[e+1]),$=z(C[e+2]),X=z(C[e+3]),b=U^r[0],T=X^r[1],I=$^r[2],A=B^r[3],nt=4,ot=1;ot<s;ot++)R=l[b>>>24]^o[T>>16&255]^c[I>>8&255]^u[A&255]^r[nt],x=l[T>>>24]^o[I>>16&255]^c[A>>8&255]^u[b&255]^r[nt+1],P=l[I>>>24]^o[A>>16&255]^c[b>>8&255]^u[T&255]^r[nt+2],M=l[A>>>24]^o[b>>16&255]^c[T>>8&255]^u[I&255]^r[nt+3],b=R,T=x,I=P,A=M,nt=nt+4;R=n[b>>>24]<<24^n[T>>16&255]<<16^n[I>>8&255]<<8^n[A&255]^r[nt],x=n[T>>>24]<<24^n[I>>16&255]<<16^n[A>>8&255]<<8^n[b&255]^r[nt+1],P=n[I>>>24]<<24^n[A>>16&255]<<16^n[b>>8&255]<<8^n[T&255]^r[nt+2],M=n[A>>>24]<<24^n[b>>16&255]<<16^n[T>>8&255]<<8^n[I&255]^r[nt+3],N[e]=z(R^p),N[e+1]=z(M^m),N[e+2]=z(P^v),N[e+3]=z(x^E),p=U,m=B,v=$,E=X,e=e+4}return N.buffer}}const $l=16;class zr{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(i){}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Gl(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,i){return this.useSoftware?new Promise((s,r)=>{this.softwareDecrypt(new Uint8Array(t),e,i);const n=this.flush();n?s(n.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,i)}softwareDecrypt(t,e,i){const{currentIV:s,currentResult:r,remainderData:n}=this;this.logOnce("JS AES decrypt"),n&&(t=ei(n,t),this.remainderData=null);const a=this.getValidChunk(t);if(!a.length)return null;s&&(i=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Vl),l.expandKey(e);const o=r;return this.currentResult=l.decrypt(a.buffer,0,i),this.currentIV=ti(a,-16).buffer,o||null}webCryptoDecrypt(t,e,i){const s=this.subtle;return(this.key!==e||!this.fastAesKey)&&(this.key=e,this.fastAesKey=new jl(s,e)),this.fastAesKey.expandKey().then(r=>s?(this.logOnce("WebCrypto AES decrypt"),new Ul(s,new Uint8Array(i)).decrypt(t.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(H.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(t,e,i)))}onWebCryptoError(t,e,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,i);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(t){let e=t;const i=t.length-t.length%$l;return i!==t.length&&(e=ti(t,0,i),this.remainderData=ti(t,i)),e}logOnce(t){!this.logEnabled||(H.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const zl={toString:function(d){let t="";const e=d.length;for(let i=0;i<e;i++)t+=`[${d.start(i).toFixed(3)}-${d.end(i).toFixed(3)}]`;return t}},it={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Hr extends kl{constructor(t,e,i,s,r){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=it.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=r,this.logPrefix=s,this.log=H.log.bind(H,`${s}:`),this.warn=H.warn.bind(H,`${s}:`),this.hls=t,this.fragmentLoader=new Dl(t.config),this.keyLoader=i,this.fragmentTracker=e,this.config=t.config,this.decrypter=new zr(t.config),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=it.STOPPED}_streamEnded(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;const i=e.partList;if(i!=null&&i.length){const r=i[i.length-1];return Gt.isBuffered(this.media,r.start+r.duration/2)}const s=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var t;return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details}}onMediaAttached(t,e){const i=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===it.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:t,fragCurrent:e,media:i,mediaBuffer:s,state:r}=this,n=i?i.currentTime:0,a=Gt.bufferInfo(s||i,n,t.maxBufferHole);if(this.log(`media seeking to ${mt(n)?n.toFixed(3):n}, state: ${r}`),this.state===it.ENDED)this.resetLoadingState();else if(e){const l=t.maxFragLookUpTolerance,o=e.start-l,c=e.start+e.duration+l;if(!a.len||c<a.start||o>a.end){const u=n>c;(n<o||u)&&(u&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),this.lastCurrentTime=n),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=n),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=it.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,i){this._loadFragForPlayback(t,e,i)}_loadFragForPlayback(t,e,i){const s=r=>{if(this.fragContextChanged(t)){this.warn(`Fragment ${t.sn}${r.part?" p: "+r.part.index:""} of level ${t.level} was dropped during download.`),this.fragmentTracker.removeFragment(t);return}t.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(t,e,i,s).then(r=>{if(!r)return;const n=this.state;if(this.fragContextChanged(t)){(n===it.FRAG_LOADING||!this.fragCurrent&&n===it.PARSING)&&(this.fragmentTracker.removeFragment(t),this.state=it.IDLE);return}"payload"in r&&(this.log(`Loaded fragment ${t.sn} of level ${t.level}`),this.hls.trigger(D.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===it.STOPPED||this.state===it.ERROR||(this.warn(r),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:i}=this;if(i.getState(t)===ee.APPENDING){const r=t.type,n=this.getFwdBufferInfo(this.mediaBuffer,r),a=Math.max(t.duration,n?n.len:this.config.maxBufferLength);this.reduceMaxBufferLength(a)&&i.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===ee.PARTIAL&&i.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}flushMainBuffer(t,e,i=null){if(!(t-e))return;const s={startOffset:t,endOffset:e,type:i};this.hls.trigger(D.BUFFER_FLUSHING,s)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(i=>{if(!i||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{payload:r}=i,n=t.decryptdata;if(r&&r.byteLength>0&&n&&n.key&&n.iv&&n.method==="AES-128"){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).catch(l=>{throw s.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{const o=self.performance.now();return s.trigger(D.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:a,tdecrypt:o}}),i.payload=l,i})}return i}).then(i=>{const{fragCurrent:s,hls:r,levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const a=t.stats;this.state=it.IDLE,e.fragmentError=0,t.data=new Uint8Array(i.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),i.frag===s&&r.trigger(D.FRAG_BUFFERED,{stats:a,frag:s,part:null,id:t.type}),this.tick()}).catch(i=>{this.state===it.STOPPED||this.state===it.ERROR||(this.warn(i),this.resetFragmentLoading(t))})}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId}fragBufferedComplete(t,e){var i,s,r,n;const a=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.playlistType===Tt.MAIN?"level":"track"} ${t.level} (frag:[${((i=t.startPTS)!=null?i:NaN).toFixed(3)}-${((s=t.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${a?zl.toString(Gt.getBuffered(a)):"(detached)"})`),this.state=it.IDLE,a&&(!this.loadedmetadata&&t.type==Tt.MAIN&&a.buffered.length&&((r=this.fragCurrent)==null?void 0:r.sn)===((n=this.fragPrevious)==null?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:i,part:s,partsLoaded:r}=t,n=!r||r.length===0||r.some(l=>!l),a=new Vr(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!n);e.flush(a)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,i=null,s){var r;const n=e==null?void 0:e.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let a=null;if(t.encrypted&&!((r=t.decryptdata)!=null&&r.key)?(this.log(`Loading key for ${t.sn} of [${n.startSN}-${n.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${t.level}`),this.state=it.KEY_LOADING,this.fragCurrent=t,a=this.keyLoader.load(t).then(c=>{if(!this.fragContextChanged(c.frag))return this.hls.trigger(D.KEY_LOADED,c),this.state===it.KEY_LOADING&&(this.state=it.IDLE),c}),this.hls.trigger(D.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!t.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(t,n.encryptedFragments),i=Math.max(t.start,i||0),this.config.lowLatencyMode&&t.sn!=="initSegment"){const c=n.partList;if(c&&s){i>t.end&&n.fragmentHint&&(t=n.fragmentHint);const u=this.getNextPart(c,t,i);if(u>-1){const h=c[u];this.log(`Loading part sn: ${t.sn} p: ${h.index} cc: ${t.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${u}-${c.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=it.FRAG_LOADING;let p;return a?p=a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(t,h,e,s)).catch(m=>this.handleFragLoadError(m)):p=this.doFragPartsLoad(t,h,e,s).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(D.FRAG_LOADING,{frag:t,part:h,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!t.url||this.loadedEndOfParts(c,i))return Promise.resolve(null)}}this.log(`Loading fragment ${t.sn} cc: ${t.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),mt(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=it.FRAG_LOADING;const l=this.config.progressive;let o;return l&&a?o=a.then(c=>!c||this.fragContextChanged(c==null?void 0:c.frag)?null:this.fragmentLoader.load(t,s)).catch(c=>this.handleFragLoadError(c)):o=Promise.all([this.fragmentLoader.load(t,l?s:void 0),a]).then(([c])=>(!l&&c&&s&&s(c),c)).catch(c=>this.handleFragLoadError(c)),this.hls.trigger(D.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):o}doFragPartsLoad(t,e,i,s){return new Promise((r,n)=>{var a;const l=[],o=(a=i.details)==null?void 0:a.partList,c=u=>{this.fragmentLoader.loadPart(t,u,s).then(h=>{l[u.index]=h;const p=h.part;this.hls.trigger(D.FRAG_LOADED,h);const m=js(i,t.sn,u.index+1)||jn(o,t.sn,u.index+1);if(m)c(m);else return r({frag:t,part:p,partsLoaded:l})}).catch(n)};c(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;t.data&&e.details===J.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(D.ERROR,e)}else this.hls.trigger(D.ERROR,{type:xt.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==it.PARSING){!this.fragCurrent&&this.state!==it.STOPPED&&this.state!==it.ERROR&&(this.state=it.IDLE);return}const{frag:i,part:s,level:r}=e,n=self.performance.now();i.stats.parsing.end=n,s&&(s.stats.parsing.end=n),this.updateLevelTiming(i,s,r,t.partial)}getCurrentContext(t){const{levels:e,fragCurrent:i}=this,{level:s,sn:r,part:n}=t;if(!(e!=null&&e[s]))return this.warn(`Levels object was unset while buffering fragment ${r} of level ${s}. The current chunk will not be buffered.`),null;const a=e[s],l=n>-1?js(a,r,n):null,o=l?l.fragment:El(a,r,i);return o?(i&&i!==o&&(o.stats=i.stats),{frag:o,part:l,level:a}):null}bufferFragmentData(t,e,i,s,r){var n;if(!t||this.state!==it.PARSING)return;const{data1:a,data2:l}=t;let o=a;if(a&&l&&(o=ei(a,l)),!((n=o)!=null&&n.length))return;const c={type:t.type,frag:e,part:i,chunkMeta:s,parent:e.type,data:o};if(this.hls.trigger(D.BUFFER_APPENDING,c),t.dropped&&t.independent&&!i){if(r)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!Gt.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const i=e.currentTime,s=Gt.bufferInfo(e,i,0),r=t.duration,n=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),a=Math.max(Math.min(t.start-n,s.end-n),i+n);t.start-a>n&&this.flushMainBuffer(a,t.start)}getFwdBufferInfo(t,e){const i=this.getLoadPosition();return mt(i)?this.getFwdBufferInfoAtPos(t,i,e):null}getFwdBufferInfoAtPos(t,e,i){const{config:{maxBufferHole:s}}=this,r=Gt.bufferInfo(t,e,s);if(r.len===0&&r.nextStart!==void 0){const n=this.fragmentTracker.getBufferedFrag(e,i);if(n&&r.nextStart<n.end)return Gt.bufferInfo(t,e,Math.max(r.nextStart,s))}return r}getMaxBufferLength(t){const{config:e}=this;let i;return t?i=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):i=e.maxBufferLength,Math.min(i,e.maxMaxBufferLength)}reduceMaxBufferLength(t){const e=this.config,i=t||e.maxBufferLength;return e.maxMaxBufferLength>=i?(e.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${e.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(t,e=Tt.MAIN){const i=this.fragmentTracker.getAppendedFrag(t,Tt.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(t,e){const i=e.fragments,s=i.length;if(!s)return null;const{config:r}=this,n=i[0].start;let a;if(e.live){const l=r.initialLiveManifestSize;if(s<l)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${l})`),null;!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(a=this.getInitialLiveFragment(e,i),this.startPosition=a?this.hls.liveSyncPosition||a.start:t)}else t<=n&&(a=i[0]);if(!a){const l=r.lowLatencyMode?e.partEnd:e.fragmentEnd;a=this.getFragmentAtPosition(t,l,e)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(t,e){const i=this.fragmentTracker.getState(t);return(i===ee.OK||i===ee.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,i,s,r){const n=t.gap,a=this.getNextFragment(this.nextLoadPosition,e);if(a===null)return a;if(t=a,n&&t&&!t.gap&&i.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s);if(l!==null&&i.len+l.len>=r)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${t.sn}`),null}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!(t!=null&&t.initSegment.data)&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,i){let s=-1,r=!1,n=!0;for(let a=0,l=t.length;a<l;a++){const o=t[a];if(n=n&&!o.independent,s>-1&&i<o.start)break;const c=o.loaded;c?s=-1:(r||o.independent||n)&&o.fragment===e&&(s=a),r=c}return s}loadedEndOfParts(t,e){const i=t[t.length-1];return i&&e>i.start&&i.loaded}getInitialLiveFragment(t,e){const i=this.fragPrevious;let s=null;if(i){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=xl(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const r=i.sn+1;if(r>=t.startSN&&r<=t.endSN){const n=e[r-t.startSN];i.cc===n.cc&&(s=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=bl(e,i.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(s=this.getFragmentAtPosition(r,this.bitrateTest?t.fragmentEnd:t.edge,t))}return s}getFragmentAtPosition(t,e,i){const{config:s}=this;let{fragPrevious:r}=this,{fragments:n,endSN:a}=i;const{fragmentHint:l}=i,o=s.maxFragLookUpTolerance,c=i.partList,u=!!(s.lowLatencyMode&&c!=null&&c.length&&l);u&&l&&!this.bitrateTest&&(n=n.concat(l),a=l.sn);let h;if(t<e){const p=t>e-o?0:o;h=Ei(r,n,t,p)}else h=n[n.length-1];if(h){const p=h.sn-i.startSN,m=this.fragmentTracker.getState(h);if((m===ee.OK||m===ee.PARTIAL&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!u||c[0].fragment.sn>h.sn)&&r&&h.level===r.level){const E=n[p+1];h.sn<a&&this.fragmentTracker.getState(E)!==ee.OK?h=E:h=null}}return h}synchronizeToLiveEdge(t){const{config:e,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,r=i.currentTime,n=t.fragments[0].start,a=t.edge,l=r>=n-e.maxFragLookUpTolerance&&r<=a;if(s!==null&&i.duration>s&&(r<s||!l)){const o=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!l&&i.readyState<4||r<a-o)&&(this.loadedmetadata||(this.nextLoadPosition=s),i.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),i.currentTime=s))}}alignPlaylists(t,e){const{levels:i,levelLastLoaded:s,fragPrevious:r}=this,n=s!==null?i[s]:null,a=t.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const l=t.fragments[0].start,o=!e,c=t.alignedSliding&&mt(l);if(o||!c&&!l){Nl(r,n,t);const u=t.fragments[0].start;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} prev-sn: ${r?r.sn:"na"} fragments: ${a}`),u}return l}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let i=this.startPosition;if(i<e&&(i=-1),i===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,r=s?this.startTimeOffset:t.startTimeOffset;r!==null&&mt(r)?(i=e+r,r<0&&(i+=t.totalduration),i=Math.min(Math.max(e,i),e+t.totalduration),this.log(`Start time offset ${r} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||e:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:t}=this;let e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e}handleFragLoadAborted(t,e){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn(`Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==it.FRAG_LOADING_WAITING_RETRY)&&(this.state=it.IDLE)}onFragmentOrKeyLoadError(t,e){if(e.chunkMeta&&!e.frag){const u=this.getCurrentContext(e.chunkMeta);u&&(e.frag=u.frag)}const i=e.frag;if(!i||i.type!==t||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const r=e.details===J.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(i,!0);const n=e.errorAction,{action:a,retryCount:l=0,retryConfig:o}=n||{};if(n&&a===ae.RetryRequest&&o){var c;this.resetStartWhenNotLoaded((c=this.levelLastLoaded)!=null?c:i.level);const u=jr(o,l);this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${e.details}, retrying loading ${l+1}/${o.maxNumRetry} in ${u}ms`),n.resolved=!0,this.retryDate=self.performance.now()+u,this.state=it.FRAG_LOADING_WAITING_RETRY}else o&&n?(this.resetFragmentErrors(t),l<o.maxNumRetry?r||(n.resolved=!0):H.warn(`${e.details} reached or exceeded max retry (${l})`)):(n==null?void 0:n.action)===ae.SendAlternateToPenaltyBox?this.state=it.WAITING_LEVEL:this.state=it.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(t){if(this.state===it.PARSING||this.state===it.PARSED){const e=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,e),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len);const r=!s;return r&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${e} buffer`),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),r}return!1}resetFragmentErrors(t){t===Tt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==it.STOPPED&&(this.state=it.IDLE)}afterBufferFlushed(t,e,i){if(!t)return;const s=Gt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,s,i),this.state===it.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=it.IDLE}resetStartWhenNotLoaded(t){if(!this.loadedmetadata){this.startFragRequested=!1;const e=this.levels?this.levels[t].details:null;e!=null&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){var e;this.warn(`The loading context changed while buffering fragment ${t.sn} of level ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded((e=this.levelLastLoaded)!=null?e:t.level),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,i,s){var r;const n=i.details;if(!n){this.warn("level.details undefined");return}if(Object.keys(t.elementaryStreams).reduce((l,o)=>{const c=t.elementaryStreams[o];if(c){const u=c.endPTS-c.startPTS;if(u<=0)return this.warn(`Could not parse fragment ${t.sn} ${o} duration reliably (${u})`),l||!1;const h=s?0:Bn(n,t,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(D.LEVEL_PTS_UPDATED,{details:n,level:i,drift:h,type:o,frag:t,start:c.startPTS,end:c.endPTS}),!0}return l},!1))i.fragmentError=0;else if(((r=this.transmuxer)==null?void 0:r.error)===null){const l=new Error(`Found no media in fragment ${t.sn} of level ${t.level} resetting transmuxer to fallback to playlist timing`);if(i.fragmentError===0&&(i.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)),this.warn(l.message),this.hls.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:t,reason:`Found no media in msn ${t.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=it.PARSED,this.hls.trigger(D.FRAG_PARSED,{frag:t,part:e})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(t){if(t.event==="demuxerWorker"){var e,i,s;this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded((e=(i=this.levelLastLoaded)!=null?i:(s=this.fragCurrent)==null?void 0:s.level)!=null?e:0),this.resetLoadingState()}}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function zn(){return self.SourceBuffer||self.WebKitSourceBuffer}function Hl(){const d=Vi();if(!d)return!1;const t=zn(),e=d&&typeof d.isTypeSupported=="function"&&d.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!e&&!!i}function Yl(){var d;const t=zn();return typeof(t==null||(d=t.prototype)==null?void 0:d.changeType)=="function"}function Kl(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Wl(){const d=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(d);return{worker:new self.Worker(t),objectURL:t}}function ql(d){const t=new self.URL(d,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}function Le(d="",t=9e4){return{type:d,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Hn{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,i){}demux(t,e){this.cachedData&&(t=ei(this.cachedData,t),this.cachedData=null);let i=Pi(t,0),s=i?i.length:0,r;const n=this._audioTrack,a=this._id3Track,l=i?Co(i):void 0,o=t.length;for((this.basePTS===null||this.frameIndex===0&&mt(l))&&(this.basePTS=Ql(l,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Se.audioId3,duration:Number.POSITIVE_INFINITY});s<o;){if(this.canParse(t,s)){const c=this.appendFrame(n,t,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,r=s):s=o}else Do(t,s)?(i=Pi(t,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Se.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,r=s):s++;if(s===o&&r!==o){const c=ti(t,r);this.cachedData?this.cachedData=ei(this.cachedData,c):this.cachedData=c}}return{audioTrack:n,videoTrack:Le(),id3Track:a,textTrack:Le()}}demuxSampleAes(t,e,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Le(),id3Track:this._id3Track,textTrack:Le()}}destroy(){}}const Ql=(d,t,e)=>{if(mt(d))return d*90;const i=e?e.baseTime*9e4/e.timescale:0;return t*9e4+i};function Xl(d,t,e,i){let s,r,n,a;const l=navigator.userAgent.toLowerCase(),o=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((t[e+2]&192)>>>6)+1;const u=(t[e+2]&60)>>>2;if(u>c.length-1){d.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${u}`});return}return n=(t[e+2]&1)<<2,n|=(t[e+3]&192)>>>6,H.log(`manifest codec:${i}, ADTS type:${s}, samplingIndex:${u}`),/firefox/i.test(l)?u>=6?(s=5,a=new Array(4),r=u-3):(s=2,a=new Array(2),r=u):l.indexOf("android")!==-1?(s=2,a=new Array(2),r=u):(s=5,a=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&u>=6?r=u-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(u>=6&&n===1||/vivaldi/i.test(l))||!i&&n===1)&&(s=2,a=new Array(2)),r=u)),a[0]=s<<3,a[0]|=(u&14)>>1,a[1]|=(u&1)<<7,a[1]|=n<<3,s===5&&(a[1]|=(r&14)>>1,a[2]=(r&1)<<7,a[2]|=2<<2,a[3]=0),{config:a,samplerate:c[u],channelCount:n,codec:"mp4a.40."+s,manifestCodec:o}}function Yn(d,t){return d[t]===255&&(d[t+1]&246)===240}function Kn(d,t){return d[t+1]&1?7:9}function Yr(d,t){return(d[t+3]&3)<<11|d[t+4]<<3|(d[t+5]&224)>>>5}function Zl(d,t){return t+5<d.length}function Ui(d,t){return t+1<d.length&&Yn(d,t)}function Jl(d,t){return Zl(d,t)&&Yn(d,t)&&Yr(d,t)<=d.length-t}function tc(d,t){if(Ui(d,t)){const e=Kn(d,t);if(t+e>=d.length)return!1;const i=Yr(d,t);if(i<=e)return!1;const s=t+i;return s===d.length||Ui(d,s)}return!1}function Wn(d,t,e,i,s){if(!d.samplerate){const r=Xl(t,e,i,s);if(!r)return;d.config=r.config,d.samplerate=r.samplerate,d.channelCount=r.channelCount,d.codec=r.codec,d.manifestCodec=r.manifestCodec,H.log(`parsed codec:${d.codec}, rate:${r.samplerate}, channels:${r.channelCount}`)}}function qn(d){return 1024*9e4/d}function ec(d,t){const e=Kn(d,t);if(t+e<=d.length){const i=Yr(d,t)-e;if(i>0)return{headerLength:e,frameLength:i}}}function Qn(d,t,e,i,s){const r=qn(d.samplerate),n=i+s*r,a=ec(t,e);let l;if(a){const{frameLength:u,headerLength:h}=a,p=h+u,m=Math.max(0,e+p-t.length);m?(l=new Uint8Array(p-h),l.set(t.subarray(e+h,t.length),0)):l=t.subarray(e+h,e+p);const v={unit:l,pts:n};return m||d.samples.push(v),{sample:v,length:p,missing:m}}const o=t.length-e;return l=new Uint8Array(o),l.set(t.subarray(e,t.length),0),{sample:{unit:l,pts:n},length:o,missing:-1}}class ic extends Hn{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let i=(Pi(t,0)||[]).length;for(let s=t.length;i<s;i++)if(tc(t,i))return H.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return Jl(t,e)}appendFrame(t,e,i){Wn(t,this.observer,e,i,t.manifestCodec);const s=Qn(t,e,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const rc=/\/emsg[-/]ID3/i;class sc{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,i,s){const r=this.videoTrack=Le("video",1),n=this.audioTrack=Le("audio",1),a=this.txtTrack=Le("text",1);if(this.id3Track=Le("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const l=Cn(t);if(l.video){const{id:o,timescale:c,codec:u}=l.video;r.id=o,r.timescale=a.timescale=c,r.codec=u}if(l.audio){const{id:o,timescale:c,codec:u}=l.audio;n.id=o,n.timescale=c,n.codec=u}a.id=wn.text,r.sampleDuration=0,r.duration=n.duration=s}resetContiguity(){this.remainderData=null}static probe(t){return t=t.length>16384?t.subarray(0,16384):t,Pt(t,["moof"]).length>0}demux(t,e){this.timeOffset=e;let i=t;const s=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=ei(this.remainderData,t));const a=Yo(i);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=i;const n=this.extractID3Track(s,e);return r.samples=bs(e,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(e,this.timeOffset);return i.samples=bs(t,e),{videoTrack:e,audioTrack:Le(),id3Track:s,textTrack:Le()}}extractID3Track(t,e){const i=this.id3Track;if(t.samples.length){const s=Pt(t.samples,["emsg"]);s&&s.forEach(r=>{const n=qo(r);if(rc.test(n.schemeIdUri)){const a=mt(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale;let l=n.eventDuration===4294967295?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const o=n.payload;i.samples.push({data:o,len:o.byteLength,dts:a,pts:a,type:Se.emsg,duration:l})}})}return i}demuxSampleAes(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let Ii=null;const nc=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ac=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],oc=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],lc=[0,1,1,4];function Xn(d,t,e,i,s){if(e+24>t.length)return;const r=Zn(t,e);if(r&&e+r.frameLength<=t.length){const n=r.samplesPerFrame*9e4/r.sampleRate,a=i+s*n,l={unit:t.subarray(e,e+r.frameLength),pts:a,dts:a};return d.config=[],d.channelCount=r.channelCount,d.samplerate=r.sampleRate,d.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}function Zn(d,t){const e=d[t+1]>>3&3,i=d[t+1]>>1&3,s=d[t+2]>>4&15,r=d[t+2]>>2&3;if(e!==1&&s!==0&&s!==15&&r!==3){const n=d[t+2]>>1&1,a=d[t+3]>>6,l=e===3?3-i:i===3?3:4,o=nc[l*14+s-1]*1e3,u=ac[(e===3?0:e===2?1:2)*3+r],h=a===3?1:2,p=oc[e][i],m=lc[i],v=p*8*m,E=Math.floor(p*o/u+n)*m;if(Ii===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ii=R?parseInt(R[1]):0}return!!Ii&&Ii<=87&&i===2&&o>=224e3&&a===0&&(d[t+3]=d[t+3]|128),{sampleRate:u,channelCount:h,frameLength:E,samplesPerFrame:v}}}function Kr(d,t){return d[t]===255&&(d[t+1]&224)===224&&(d[t+1]&6)!==0}function Jn(d,t){return t+1<d.length&&Kr(d,t)}function cc(d,t){return Kr(d,t)&&4<=d.length-t}function dc(d,t){if(t+1<d.length&&Kr(d,t)){const i=Zn(d,t);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const r=t+s;return r===d.length||Jn(d,r)}return!1}class Ws{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,i=t.byteLength-e,s=new Uint8Array(4),r=Math.min(4,e);if(r===0)throw new Error("no bytes available");s.set(t.subarray(i,i+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const i=this.word>>>32-e;if(t>32&&H.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(t){let e=8,i=8,s;for(let r=0;r<t;r++)i!==0&&(s=this.readEG(),i=(e+s+256)%256),e=i===0?e:i}readSPS(){let t=0,e=0,i=0,s=0,r,n,a;const l=this.readUByte.bind(this),o=this.readBits.bind(this),c=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),p=this.skipEG.bind(this),m=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);l();const E=l();if(o(5),h(3),l(),m(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const M=c();if(M===3&&h(1),m(),m(),h(1),u())for(n=M!==3?8:12,a=0;a<n;a++)u()&&(a<6?v(16):v(64))}m();const C=c();if(C===0)c();else if(C===1)for(h(1),p(),p(),r=c(),a=0;a<r;a++)p();m(),h(1);const N=c(),R=c(),x=o(1);x===0&&h(1),h(1),u()&&(t=c(),e=c(),i=c(),s=c());let P=[1,1];if(u()&&u())switch(l()){case 1:P=[1,1];break;case 2:P=[12,11];break;case 3:P=[10,11];break;case 4:P=[16,11];break;case 5:P=[40,33];break;case 6:P=[24,11];break;case 7:P=[20,11];break;case 8:P=[32,11];break;case 9:P=[80,33];break;case 10:P=[18,11];break;case 11:P=[15,11];break;case 12:P=[64,33];break;case 13:P=[160,99];break;case 14:P=[4,3];break;case 15:P=[3,2];break;case 16:P=[2,1];break;case 255:{P=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((N+1)*16-t*2-e*2),height:(2-x)*(R+1)*16-(x?2:4)*(i+s),pixelRatio:P}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class uc{constructor(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new zr(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(t,e,i){const s=t[e].unit;if(s.length<=16)return;const r=s.subarray(16,s.length-s.length%16),n=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(n).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,i)})}decryptAacSamples(t,e,i){for(;;e++){if(e>=t.length){i();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,i=new Int8Array(e);let s=0;for(let r=32;r<t.length-16;r+=160,s+=16)i.set(t.subarray(r,r+16),s);return i}getAvcDecryptedUnit(t,e){const i=new Uint8Array(e);let s=0;for(let r=32;r<t.length-16;r+=160,s+=16)t.set(i.subarray(s,s+16),r);return t}decryptAvcSample(t,e,i,s,r){const n=Pn(r.data),a=this.getAvcEncryptedData(n);this.decryptBuffer(a.buffer).then(l=>{r.data=this.getAvcDecryptedUnit(n,l),this.decrypter.isSync()||this.decryptAvcSamples(t,e,i+1,s)})}decryptAvcSamples(t,e,i,s){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length){s();return}const r=t[e].units;for(;!(i>=r.length);i++){const n=r[i];if(!(n.data.length<=48||n.type!==1&&n.type!==5)&&(this.decryptAvcSample(t,e,i,s,n),!this.decrypter.isSync()))return}}}}const ne=188;class Ye{constructor(t,e,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=i}static probe(t){const e=Ye.syncOffset(t);return e>0&&H.warn(`MPEG2-TS detected but first sync word found @ offset ${e}`),e!==-1}static syncOffset(t){const e=t.length;let i=Math.min(ne*5,t.length-ne)+1,s=0;for(;s<i;){let r=!1,n=-1,a=0;for(let l=s;l<e;l+=ne)if(t[l]===71){if(a++,n===-1&&(n=l,n!==0&&(i=Math.min(n+ne*99,t.length-ne)+1)),r||(r=Pr(t,l)===0),r&&a>1&&(n===0&&a>2||l+ne>i))return n}else{if(a)return-1;break}s++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:wn[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,i,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Ye.createTrack("video"),this._audioTrack=Ye.createTrack("audio",s),this._id3Track=Ye.createTrack("id3"),this._txtTrack=Ye.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_avcTrack:e,_id3Track:i}=this;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(t,e,i=!1,s=!1){i||(this.sampleAes=null);let r;const n=this._avcTrack,a=this._audioTrack,l=this._id3Track,o=this._txtTrack;let c=n.pid,u=n.pesData,h=a.pid,p=l.pid,m=a.pesData,v=l.pesData,E=null,C=this.pmtParsed,N=this._pmtId,R=t.length;if(this.remainderData&&(t=ei(this.remainderData,t),R=t.length,this.remainderData=null),R<ne&&!s)return this.remainderData=t,{audioTrack:a,videoTrack:n,id3Track:l,textTrack:o};const x=Math.max(0,Ye.syncOffset(t));R-=(R-x)%ne,R<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,R,t.buffer.byteLength-R));let P=0;for(let b=x;b<R;b+=ne)if(t[b]===71){const T=!!(t[b+1]&64),I=Pr(t,b),A=(t[b+3]&48)>>4;let U;if(A>1){if(U=b+5+t[b+4],U===b+ne)continue}else U=b+4;switch(I){case c:T&&(u&&(r=si(u))&&this.parseAVCPES(n,o,r,!1),u={data:[],size:0}),u&&(u.data.push(t.subarray(U,b+ne)),u.size+=b+ne-U);break;case h:if(T){if(m&&(r=si(m)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break}m={data:[],size:0}}m&&(m.data.push(t.subarray(U,b+ne)),m.size+=b+ne-U);break;case p:T&&(v&&(r=si(v))&&this.parseID3PES(l,r),v={data:[],size:0}),v&&(v.data.push(t.subarray(U,b+ne)),v.size+=b+ne-U);break;case 0:T&&(U+=t[U]+1),N=this._pmtId=hc(t,U);break;case N:{T&&(U+=t[U]+1);const B=fc(t,U,this.typeSupported,i);c=B.avc,c>0&&(n.pid=c),h=B.audio,h>0&&(a.pid=h,a.segmentCodec=B.segmentCodec),p=B.id3,p>0&&(l.pid=p),E!==null&&!C&&(H.warn(`MPEG-TS PMT found at ${b} after unknown PID '${E}'. Backtracking to sync byte @${x} to parse all TS packets.`),E=null,b=x-188),C=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=I;break}}else P++;if(P>0){const b=new Error(`Found ${P} TS packet/s that do not start with 0x47`);this.observer.emit(D.ERROR,D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:b,reason:b.message})}n.pesData=u,a.pesData=m,l.pesData=v;const M={audioTrack:a,videoTrack:n,id3Track:l,textTrack:o};return s&&this.extractRemainingSamples(M),M}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:i,id3Track:s,textTrack:r}=t,n=i.pesData,a=e.pesData,l=s.pesData;let o;if(n&&(o=si(n))?(this.parseAVCPES(i,r,o,!0),i.pesData=null):i.pesData=n,a&&(o=si(a))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,o);break;case"mp3":this.parseMPEGPES(e,o);break}e.pesData=null}else a!=null&&a.size&&H.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=a;l&&(o=si(l))?(this.parseID3PES(s,o),s.pesData=null):s.pesData=l}demuxSampleAes(t,e,i){const s=this.demux(t,i,!0,!this.config.progressive),r=this.sampleAes=new uc(this.observer,this.config,e);return this.decrypt(s,r)}decrypt(t,e){return new Promise(i=>{const{audioTrack:s,videoTrack:r}=t;s.samples&&s.segmentCodec==="aac"?e.decryptAacSamples(s.samples,0,()=>{r.samples?e.decryptAvcSamples(r.samples,0,0,()=>{i(t)}):i(t)}):r.samples&&e.decryptAvcSamples(r.samples,0,0,()=>{i(t)})})}destroy(){this._duration=0}parseAVCPES(t,e,i,s){const r=this.parseAVCNALu(t,i.data);let n=this.avcSample,a,l=!1;i.data=null,n&&r.length&&!t.audFound&&(hi(n,t),n=this.avcSample=wi(!1,i.pts,i.dts,"")),r.forEach(o=>{var c;switch(o.type){case 1:{let h=!1;a=!0;const p=o.data;if(l&&p.length>4){const m=new Ws(p).readSliceType();(m===2||m===4||m===7||m===9)&&(h=!0)}if(h){var u;(u=n)!=null&&u.frame&&!n.key&&(hi(n,t),n=this.avcSample=null)}n||(n=this.avcSample=wi(!0,i.pts,i.dts,"")),n.frame=!0,n.key=h;break}case 5:a=!0,(c=n)!=null&&c.frame&&!n.key&&(hi(n,t),n=this.avcSample=null),n||(n=this.avcSample=wi(!0,i.pts,i.dts,"")),n.key=!0,n.frame=!0;break;case 6:{a=!0,Mn(o.data,1,i.pts,e.samples);break}case 7:if(a=!0,l=!0,!t.sps){const h=o.data,m=new Ws(h).readSPS();t.width=m.width,t.height=m.height,t.pixelRatio=m.pixelRatio,t.sps=[h],t.duration=this._duration;const v=h.subarray(1,4);let E="avc1.";for(let C=0;C<3;C++){let N=v[C].toString(16);N.length<2&&(N="0"+N),E+=N}t.codec=E}break;case 8:a=!0,t.pps||(t.pps=[o.data]);break;case 9:a=!1,t.audFound=!0,n&&hi(n,t),n=this.avcSample=wi(!1,i.pts,i.dts,"");break;case 12:a=!0;break;default:a=!1,n&&(n.debug+="unknown NAL "+o.type+" ");break}n&&a&&n.units.push(o)}),s&&n&&(hi(n,t),this.avcSample=null)}getLastNalUnit(t){var e;let i=this.avcSample,s;if((!i||i.units.length===0)&&(i=t[t.length-1]),(e=i)!=null&&e.units){const r=i.units;s=r[r.length-1]}return s}parseAVCNALu(t,e){const i=e.byteLength;let s=t.naluState||0;const r=s,n=[];let a=0,l,o,c,u=-1,h=0;for(s===-1&&(u=0,h=e[0]&31,s=0,a=1);a<i;){if(l=e[a++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(u>=0){const p={data:e.subarray(u,a-s-1),type:h};n.push(p)}else{const p=this.getLastNalUnit(t.samples);if(p&&(r&&a<=4-r&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-r)),o=a-s-1,o>0)){const m=new Uint8Array(p.data.byteLength+o);m.set(p.data,0),m.set(e.subarray(0,o),p.data.byteLength),p.data=m,p.state=0}}a<i?(c=e[a]&31,u=a,h=c,s=0):s=-1}else s=0}if(u>=0&&s>=0){const p={data:e.subarray(u,i),type:h,state:s};n.push(p)}if(n.length===0){const p=this.getLastNalUnit(t.samples);if(p){const m=new Uint8Array(p.data.byteLength+e.byteLength);m.set(p.data,0),m.set(e,p.data.byteLength),p.data=m}}return t.naluState=s,n}parseAACPES(t,e){let i=0;const s=this.aacOverFlow;let r=e.data;if(s){this.aacOverFlow=null;const u=s.missing,h=s.sample.unit.byteLength;if(u===-1){const p=new Uint8Array(h+r.byteLength);p.set(s.sample.unit,0),p.set(r,h),r=p}else{const p=h-u;s.sample.unit.set(r.subarray(0,u),p),t.samples.push(s.sample),i=s.missing}}let n,a;for(n=i,a=r.length;n<a-1&&!Ui(r,n);n++);if(n!==i){let u;const h=n<a-1;h?u=`AAC PES did not start with ADTS header,offset:${n}`:u="No ADTS header found in AAC PES";const p=new Error(u);if(H.warn(`parsing error: ${u}`),this.observer.emit(D.ERROR,D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,levelRetry:h,error:p,reason:u}),!h)return}Wn(t,this.observer,r,n,this.audioCodec);let l;if(e.pts!==void 0)l=e.pts;else if(s){const u=qn(t.samplerate);l=s.sample.pts+u}else{H.warn("[tsdemuxer]: AAC PES unknown PTS");return}let o=0,c;for(;n<a;)if(c=Qn(t,r,n,l,o),n+=c.length,c.missing){this.aacOverFlow=c;break}else for(o++;n<a-1&&!Ui(r,n);n++);}parseMPEGPES(t,e){const i=e.data,s=i.length;let r=0,n=0;const a=e.pts;if(a===void 0){H.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<s;)if(Jn(i,n)){const l=Xn(t,i,n,a,r);if(l)n+=l.length,r++;else break}else n++}parseID3PES(t,e){if(e.pts===void 0){H.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Zt({},e,{type:this._avcTrack?Se.emsg:Se.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(i)}}function wi(d,t,e,i){return{key:d,frame:!1,pts:t,dts:e,units:[],debug:i,length:0}}function Pr(d,t){return((d[t+1]&31)<<8)+d[t+2]}function hc(d,t){return(d[t+10]&31)<<8|d[t+11]}function fc(d,t,e,i){const s={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},r=(d[t+1]&15)<<8|d[t+2],n=t+3+r-4,a=(d[t+10]&15)<<8|d[t+11];for(t+=12+a;t<n;){const l=Pr(d,t);switch(d[t]){case 207:if(!i){H.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:s.audio===-1&&(s.audio=l);break;case 21:s.id3===-1&&(s.id3=l);break;case 219:if(!i){H.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:s.avc===-1&&(s.avc=l);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?H.log("MPEG audio found, not supported in this browser"):s.audio===-1&&(s.audio=l,s.segmentCodec="mp3");break;case 36:H.warn("Unsupported HEVC stream type found");break}t+=((d[t+3]&15)<<8|d[t+4])+5}return s}function si(d){let t=0,e,i,s,r,n;const a=d.data;if(!d||d.size===0)return null;for(;a[0].length<19&&a.length>1;){const o=new Uint8Array(a[0].length+a[1].length);o.set(a[0]),o.set(a[1],a[0].length),a[0]=o,a.splice(1,1)}if(e=a[0],(e[0]<<16)+(e[1]<<8)+e[2]===1){if(i=(e[4]<<8)+e[5],i&&i>d.size-6)return null;const o=e[7];o&192&&(r=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,o&64?(n=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,r-n>60*9e4&&(H.warn(`${Math.round((r-n)/9e4)}s delta between PTS and DTS, align them`),r=n)):n=r),s=e[8];let c=s+9;if(d.size<=c)return null;d.size-=c;const u=new Uint8Array(d.size);for(let h=0,p=a.length;h<p;h++){e=a[h];let m=e.byteLength;if(c)if(c>m){c-=m;continue}else e=e.subarray(c),m-=c,c=0;u.set(e,t),t+=m}return i&&(i-=s+3),{data:u,pts:r,dts:n,len:i}}return null}function hi(d,t){if(d.units.length&&d.frame){if(d.pts===void 0){const e=t.samples,i=e.length;if(i){const s=e[i-1];d.pts=s.pts,d.dts=s.dts}else{t.dropped++;return}}t.samples.push(d)}d.debug.length&&H.log(d.pts+"/"+d.dts+":"+d.debug)}class pc extends Hn{resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let i=(Pi(t,0)||[]).length;for(let s=t.length;i<s;i++)if(dc(t,i))return H.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return cc(t,e)}appendFrame(t,e,i){if(this.basePTS!==null)return Xn(t,e,i,this.basePTS,this.frameIndex)}}class qs{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const He=Math.pow(2,32)-1;class Q{static init(){Q.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in Q.types)Q.types.hasOwnProperty(t)&&(Q.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Q.HDLR_TYPES={video:e,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Q.STTS=Q.STSC=Q.STCO=r,Q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);Q.FTYP=Q.box(Q.types.ftyp,n,l,n,a),Q.DINF=Q.box(Q.types.dinf,Q.box(Q.types.dref,s))}static box(t,...e){let i=8,s=e.length;const r=s;for(;s--;)i+=e[s].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(t,4),s=0,i=8;s<r;s++)n.set(e[s],i),i+=e[s].byteLength;return n}static hdlr(t){return Q.box(Q.types.hdlr,Q.HDLR_TYPES[t])}static mdat(t){return Q.box(Q.types.mdat,t)}static mdhd(t,e){e*=t;const i=Math.floor(e/(He+1)),s=Math.floor(e%(He+1));return Q.box(Q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(t){return Q.box(Q.types.mdia,Q.mdhd(t.timescale,t.duration),Q.hdlr(t.type),Q.minf(t))}static mfhd(t){return Q.box(Q.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?Q.box(Q.types.minf,Q.box(Q.types.smhd,Q.SMHD),Q.DINF,Q.stbl(t)):Q.box(Q.types.minf,Q.box(Q.types.vmhd,Q.VMHD),Q.DINF,Q.stbl(t))}static moof(t,e,i){return Q.box(Q.types.moof,Q.mfhd(t),Q.traf(i,e))}static moov(t){let e=t.length;const i=[];for(;e--;)i[e]=Q.trak(t[e]);return Q.box.apply(null,[Q.types.moov,Q.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(Q.mvex(t)))}static mvex(t){let e=t.length;const i=[];for(;e--;)i[e]=Q.trex(t[e]);return Q.box.apply(null,[Q.types.mvex,...i])}static mvhd(t,e){e*=t;const i=Math.floor(e/(He+1)),s=Math.floor(e%(He+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Q.box(Q.types.mvhd,r)}static sdtp(t){const e=t.samples||[],i=new Uint8Array(4+e.length);let s,r;for(s=0;s<e.length;s++)r=e[s].flags,i[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Q.box(Q.types.sdtp,i)}static stbl(t){return Q.box(Q.types.stbl,Q.stsd(t),Q.box(Q.types.stts,Q.STTS),Q.box(Q.types.stsc,Q.STSC),Q.box(Q.types.stsz,Q.STSZ),Q.box(Q.types.stco,Q.STCO))}static avc1(t){let e=[],i=[],s,r,n;for(s=0;s<t.sps.length;s++)r=t.sps[s],n=r.byteLength,e.push(n>>>8&255),e.push(n&255),e=e.concat(Array.prototype.slice.call(r));for(s=0;s<t.pps.length;s++)r=t.pps[s],n=r.byteLength,i.push(n>>>8&255),i.push(n&255),i=i.concat(Array.prototype.slice.call(r));const a=Q.box(Q.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(i))),l=t.width,o=t.height,c=t.pixelRatio[0],u=t.pixelRatio[1];return Q.box(Q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,o>>8&255,o&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Q.box(Q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Q.box(Q.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,u>>24,u>>16&255,u>>8&255,u&255])))}static esds(t){const e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}static mp4a(t){const e=t.samplerate;return Q.box(Q.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]),Q.box(Q.types.esds,Q.esds(t)))}static mp3(t){const e=t.samplerate;return Q.box(Q.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]))}static stsd(t){return t.type==="audio"?t.segmentCodec==="mp3"&&t.codec==="mp3"?Q.box(Q.types.stsd,Q.STSD,Q.mp3(t)):Q.box(Q.types.stsd,Q.STSD,Q.mp4a(t)):Q.box(Q.types.stsd,Q.STSD,Q.avc1(t))}static tkhd(t){const e=t.id,i=t.duration*t.timescale,s=t.width,r=t.height,n=Math.floor(i/(He+1)),a=Math.floor(i%(He+1));return Q.box(Q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,r>>8&255,r&255,0,0]))}static traf(t,e){const i=Q.sdtp(t),s=t.id,r=Math.floor(e/(He+1)),n=Math.floor(e%(He+1));return Q.box(Q.types.traf,Q.box(Q.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),Q.box(Q.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255])),Q.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,Q.box(Q.types.trak,Q.tkhd(t),Q.mdia(t))}static trex(t){const e=t.id;return Q.box(Q.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const i=t.samples||[],s=i.length,r=12+16*s,n=new Uint8Array(r);let a,l,o,c,u,h;for(e+=8+r,n.set([t.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),a=0;a<s;a++)l=i[a],o=l.duration,c=l.size,u=l.flags,h=l.cts,n.set([o>>>24&255,o>>>16&255,o>>>8&255,o&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,u.degradPrio&240<<8,u.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*a);return Q.box(Q.types.trun,n)}static initSegment(t){Q.types||Q.init();const e=Q.moov(t),i=new Uint8Array(Q.FTYP.byteLength+e.byteLength);return i.set(Q.FTYP),i.set(e,Q.FTYP.byteLength),i}}Q.types=void 0;Q.HDLR_TYPES=void 0;Q.STTS=void 0;Q.STSC=void 0;Q.STCO=void 0;Q.STSZ=void 0;Q.VMHD=void 0;Q.SMHD=void 0;Q.STSD=void 0;Q.FTYP=void 0;Q.DINF=void 0;const ta=9e4;function Wr(d,t,e=1,i=!1){const s=d*t*e;return i?Math.round(s):s}function mc(d,t,e=1,i=!1){return Wr(d,t,1/e,i)}function fi(d,t=!1){return Wr(d,1e3,1/ta,t)}function gc(d,t=1){return Wr(d,ta,1/t)}const yc=10*1e3,Qs=1024,_c=1152;let Ri=null,fr=null;class pr{constructor(t,e,i,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,Ri===null){const n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ri=n?parseInt(n[1]):0}if(fr===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);fr=r?parseInt(r[1]):0}}destroy(){}resetTimeStamp(t){H.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){H.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){H.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(t){let e=!1;const i=t.reduce((s,r)=>{const n=r.pts-s;return n<-4294967296?(e=!0,ge(s,r.pts)):n>0?s:r.pts},t[0].pts);return e&&H.debug("PTS rollover detected"),i}remux(t,e,i,s,r,n,a,l){let o,c,u,h,p,m,v=r,E=r;const C=t.pid>-1,N=e.pid>-1,R=e.samples.length,x=t.samples.length>0,P=a&&R>0||R>1;if((!C||x)&&(!N||P)||this.ISGenerated||a){this.ISGenerated||(u=this.generateIS(t,e,r,n));const b=this.isVideoContiguous;let T=-1,I;if(P&&(T=vc(e.samples),!b&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,T>0){H.warn(`[mp4-remuxer]: Dropped ${T} out of ${R} video samples due to a missing keyframe`);const A=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(T),e.dropped+=T,E+=(e.samples[0].pts-A)/e.inputTimeScale,I=E}else T===-1&&(H.warn(`[mp4-remuxer]: No keyframe found out of ${R} video samples`),m=!1);if(this.ISGenerated){if(x&&P){const A=this.getVideoStartPts(e.samples),B=(ge(t.samples[0].pts,A)-A)/e.inputTimeScale;v+=Math.max(0,B),E+=Math.max(0,-B)}if(x){if(t.samplerate||(H.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(t,e,r,n)),c=this.remuxAudio(t,v,this.isAudioContiguous,n,N||P||l===Tt.AUDIO?E:void 0),P){const A=c?c.endPTS-c.startPTS:0;e.inputTimeScale||(H.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(t,e,r,n)),o=this.remuxVideo(e,E,b,A)}}else P&&(o=this.remuxVideo(e,E,b,0));o&&(o.firstKeyFrame=T,o.independent=T!==-1,o.firstKeyFramePTS=I)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(p=ea(i,r,this._initPTS,this._initDTS)),s.samples.length&&(h=ia(s,r,this._initPTS))),{audio:c,video:o,initSegment:u,independent:m,text:h,id3:p}}generateIS(t,e,i,s){const r=t.samples,n=e.samples,a=this.typeSupported,l={},o=this._initPTS;let c=!o||s,u="audio/mp4",h,p,m;if(c&&(h=p=1/0),t.config&&r.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":a.mpeg?(u="audio/mpeg",t.codec=""):a.mp3&&(t.codec="mp3");break}l.audio={id:"audio",container:u,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):Q.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(m=t.inputTimeScale,!o||m!==o.timescale?h=p=r[0].pts-Math.round(m*i):c=!1)}if(e.sps&&e.pps&&n.length&&(e.timescale=e.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Q.initSegment([e]),metadata:{width:e.width,height:e.height}},c))if(m=e.inputTimeScale,!o||m!==o.timescale){const v=this.getVideoStartPts(n),E=Math.round(m*i);p=Math.min(p,ge(n[0].dts,v)-E),h=Math.min(h,v-E)}else c=!1;if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:h,timescale:m},this._initDTS={baseTime:p,timescale:m}):h=m=void 0,{tracks:l,initPTS:h,timescale:m}}remuxVideo(t,e,i,s){const r=t.inputTimeScale,n=t.samples,a=[],l=n.length,o=this._initPTS;let c=this.nextAvcDts,u=8,h=this.videoSampleDuration,p,m,v=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,C=!1;if(!i||c===null){const k=e*r,F=n[0].pts-ge(n[0].dts,n[0].pts);c=k-F}const N=o.baseTime*r/o.timescale;for(let k=0;k<l;k++){const F=n[k];F.pts=ge(F.pts-N,c),F.dts=ge(F.dts-N,c),F.dts<n[k>0?k-1:k].dts&&(C=!0)}C&&n.sort(function(k,F){const G=k.dts-F.dts,Z=k.pts-F.pts;return G||Z}),p=n[0].dts,m=n[n.length-1].dts;const R=m-p,x=R?Math.round(R/(l-1)):h||t.inputTimeScale/30;if(i){const k=p-c,F=k>x,G=k<-1;if((F||G)&&(F?H.warn(`AVC: ${fi(k,!0)} ms (${k}dts) hole between fragments detected, filling it`):H.warn(`AVC: ${fi(-k,!0)} ms (${k}dts) overlapping between fragments detected`),!G||c>=n[0].pts)){p=c;const Z=n[0].pts-k;n[0].dts=p,n[0].pts=Z,H.log(`Video: First PTS/DTS adjusted: ${fi(Z,!0)}/${fi(p,!0)}, delta: ${fi(k,!0)} ms`)}}p=Math.max(0,p);let P=0,M=0;for(let k=0;k<l;k++){const F=n[k],G=F.units,Z=G.length;let rt=0;for(let ut=0;ut<Z;ut++)rt+=G[ut].data.length;M+=rt,P+=Z,F.length=rt,F.dts=Math.max(F.dts,p),v=Math.min(F.pts,v),E=Math.max(F.pts,E)}m=n[l-1].dts;const b=M+4*P+8;let T;try{T=new Uint8Array(b)}catch(k){this.observer.emit(D.ERROR,D.ERROR,{type:xt.MUX_ERROR,details:J.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:b,reason:`fail allocating video mdat ${b}`});return}const I=new DataView(T.buffer);I.setUint32(0,b),T.set(Q.types.mdat,4);let A=!1,U=Number.POSITIVE_INFINITY,B=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,X=Number.NEGATIVE_INFINITY;for(let k=0;k<l;k++){const F=n[k],G=F.units;let Z=0;for(let gt=0,It=G.length;gt<It;gt++){const Dt=G[gt],et=Dt.data,at=Dt.data.byteLength;I.setUint32(u,at),u+=4,T.set(et,u),u+=at,Z+=4+at}let rt;if(k<l-1)h=n[k+1].dts-F.dts,rt=n[k+1].pts-F.pts;else{const gt=this.config,It=k>0?F.dts-n[k-1].dts:x;if(rt=k>0?F.pts-n[k-1].pts:x,gt.stretchShortVideoTrack&&this.nextAudioPts!==null){const Dt=Math.floor(gt.maxBufferHole*r),et=(s?v+s*r:this.nextAudioPts)-F.pts;et>Dt?(h=et-It,h<0?h=It:A=!0,H.log(`[mp4-remuxer]: It is approximately ${et/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=It}else h=It}const ut=Math.round(F.pts-F.dts);U=Math.min(U,h),$=Math.max($,h),B=Math.min(B,rt),X=Math.max(X,rt),a.push(new Xs(F.key,h,Z,ut))}if(a.length){if(Ri){if(Ri<70){const k=a[0].flags;k.dependsOn=2,k.isNonSync=0}}else if(fr&&X-B<$-U&&x/$<.025&&a[0].cts===0){H.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let k=p;for(let F=0,G=a.length;F<G;F++){const Z=k+a[F].duration,rt=k+a[F].cts;if(F<G-1){const ut=Z+a[F+1].cts;a[F].duration=ut-rt}else a[F].duration=F?a[F-1].duration:x;a[F].cts=0,k=Z}}}h=A||!h?x:h,this.nextAvcDts=c=m+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const nt=Q.moof(t.sequenceNumber++,p,Zt({},t,{samples:a})),ot="video",z={data1:nt,data2:T,startPTS:v/r,endPTS:(E+h)/r,startDTS:p/r,endDTS:c/r,type:ot,hasAudio:!1,hasVideo:!0,nb:a.length,dropped:t.dropped};return t.samples=[],t.dropped=0,z}remuxAudio(t,e,i,s,r){const n=t.inputTimeScale,a=t.samplerate?t.samplerate:n,l=n/a,o=t.segmentCodec==="aac"?Qs:_c,c=o*l,u=this._initPTS,h=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,p=[],m=r!==void 0;let v=t.samples,E=h?0:8,C=this.nextAudioPts||-1;const N=e*n,R=u.baseTime*n/u.timescale;if(this.isAudioContiguous=i=i||v.length&&C>0&&(s&&Math.abs(N-C)<9e3||Math.abs(ge(v[0].pts-R,N)-C)<20*c),v.forEach(function(ot){ot.pts=ge(ot.pts-R,N)}),!i||C<0){if(v=v.filter(ot=>ot.pts>=0),!v.length)return;r===0?C=0:s&&!m?C=Math.max(0,N):C=v[0].pts}if(t.segmentCodec==="aac"){const ot=this.config.maxAudioFramesDrift;for(let z=0,k=C;z<v.length;z++){const F=v[z],G=F.pts,Z=G-k,rt=Math.abs(1e3*Z/n);if(Z<=-ot*c&&m)z===0&&(H.warn(`Audio frame @ ${(G/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Z/n)} ms.`),this.nextAudioPts=C=k=G);else if(Z>=ot*c&&rt<yc&&m){let ut=Math.round(Z/c);k=G-ut*c,k<0&&(ut--,k+=c),z===0&&(this.nextAudioPts=C=k),H.warn(`[mp4-remuxer]: Injecting ${ut} audio frame @ ${(k/n).toFixed(3)}s due to ${Math.round(1e3*Z/n)} ms gap.`);for(let gt=0;gt<ut;gt++){const It=Math.max(k,0);let Dt=qs.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);Dt||(H.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Dt=F.unit.subarray()),v.splice(z,0,{unit:Dt,pts:It}),k+=c,z++}}F.pts=k,k+=c}}let x=null,P=null,M,b=0,T=v.length;for(;T--;)b+=v[T].unit.byteLength;for(let ot=0,z=v.length;ot<z;ot++){const k=v[ot],F=k.unit;let G=k.pts;if(P!==null){const rt=p[ot-1];rt.duration=Math.round((G-P)/l)}else if(i&&t.segmentCodec==="aac"&&(G=C),x=G,b>0){b+=E;try{M=new Uint8Array(b)}catch(rt){this.observer.emit(D.ERROR,D.ERROR,{type:xt.MUX_ERROR,details:J.REMUX_ALLOC_ERROR,fatal:!1,error:rt,bytes:b,reason:`fail allocating audio mdat ${b}`});return}h||(new DataView(M.buffer).setUint32(0,b),M.set(Q.types.mdat,4))}else return;M.set(F,E);const Z=F.byteLength;E+=Z,p.push(new Xs(!0,o,Z,0)),P=G}const I=p.length;if(!I)return;const A=p[p.length-1];this.nextAudioPts=C=P+l*A.duration;const U=h?new Uint8Array(0):Q.moof(t.sequenceNumber++,x/l,Zt({},t,{samples:p}));t.samples=[];const B=x/n,$=C/n,nt={data1:U,data2:M,startPTS:B,endPTS:$,startDTS:B,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,nt}remuxEmptyAudio(t,e,i,s){const r=t.inputTimeScale,n=t.samplerate?t.samplerate:r,a=r/n,l=this.nextAudioPts,o=this._initDTS,c=o.baseTime*9e4/o.timescale,u=(l!==null?l:s.startDTS*r)+c,h=s.endDTS*r+c,p=a*Qs,m=Math.ceil((h-u)/p),v=qs.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(H.warn("[mp4-remuxer]: remux empty Audio"),!v){H.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const E=[];for(let C=0;C<m;C++){const N=u+C*p;E.push({unit:v,pts:N,dts:N})}return t.samples=E,this.remuxAudio(t,e,i,!1)}}function ge(d,t){let e;if(t===null)return d;for(t<d?e=-8589934592:e=8589934592;Math.abs(d-t)>4294967296;)d+=e;return d}function vc(d){for(let t=0;t<d.length;t++)if(d[t].key)return t;return-1}function ea(d,t,e,i){const s=d.samples.length;if(!s)return;const r=d.inputTimeScale;for(let a=0;a<s;a++){const l=d.samples[a];l.pts=ge(l.pts-e.baseTime*r/e.timescale,t*r)/r,l.dts=ge(l.dts-i.baseTime*r/i.timescale,t*r)/r}const n=d.samples;return d.samples=[],{samples:n}}function ia(d,t,e){const i=d.samples.length;if(!i)return;const s=d.inputTimeScale;for(let n=0;n<i;n++){const a=d.samples[n];a.pts=ge(a.pts-e.baseTime*s/e.timescale,t*s)/s}d.samples.sort((n,a)=>n.pts-a.pts);const r=d.samples;return d.samples=[],{samples:r}}class Xs{constructor(t,e,i,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=i,this.cts=s,this.flags=new Ec(t)}}class Ec{constructor(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}}class Sc{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(t){this.initPTS=t,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(t,e,i,s){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(Go(t,s)),this.emitInitSegment=!0}generateInitSegment(t){let{audioCodec:e,videoCodec:i}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=Cn(t);e||(e=Zs(s.audio,jt.AUDIO)),i||(i=Zs(s.video,jt.VIDEO));const r={};s.audio&&s.video?r.audiovideo={container:"video/mp4",codec:e+","+i,initSegment:t,id:"main"}:s.audio?r.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:s.video?r.video={container:"video/mp4",codec:i,initSegment:t,id:"main"}:H.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(t,e,i,s,r,n){var a,l;let{initPTS:o,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};mt(c)||(c=this.lastEndTime=r||0);const h=e.samples;if(!(h!=null&&h.length))return u;const p={initPTS:void 0,timescale:1};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(h),m=this.initData),!((l=m)!=null&&l.length))return H.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);const v=$o(h,m),E=Vo(m,h),C=E===null?r:E;(xc(o,C,r,v)||p.timescale!==o.timescale&&n)&&(p.initPTS=C-r,o&&o.timescale===1&&H.warn(`Adjusting initPTS by ${p.initPTS-o.baseTime}`),this.initPTS=o={baseTime:p.initPTS,timescale:1});const N=t?C-o.baseTime/o.timescale:c,R=N+v;Ho(m,h,o.baseTime/o.timescale),v>0?this.lastEndTime=R:(H.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const x=!!m.audio,P=!!m.video;let M="";x&&(M+="audio"),P&&(M+="video");const b={data1:h,startPTS:N,startDTS:N,endPTS:R,endDTS:R,type:M,hasAudio:x,hasVideo:P,nb:1,dropped:0};return u.audio=b.type==="audio"?b:void 0,u.video=b.type!=="audio"?b:void 0,u.initSegment=p,u.id3=ea(i,r,o,o),s.samples.length&&(u.text=ia(s,r,o)),u}}function xc(d,t,e,i){if(d===null)return!0;const s=Math.max(i,1),r=t-d.baseTime/d.timescale;return Math.abs(r-e)>s}function Zs(d,t){const e=d==null?void 0:d.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.6.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||t===jt.VIDEO?"avc1.42e01e":"mp4a.40.5"}let je;try{je=self.performance.now.bind(self.performance)}catch(d){H.debug("Unable to use Performance API on this environment"),je=typeof self!="undefined"&&self.Date.now}const mr=[{demux:sc,remux:Sc},{demux:Ye,remux:pr},{demux:ic,remux:pr},{demux:pc,remux:pr}];class Js{constructor(t,e,i,s,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.vendor=s,this.id=r}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,i,s){const r=i.transmuxing;r.executeStart=je();let n=new Uint8Array(t);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:o,discontinuity:c,trackSwitch:u,accurateTimeOffset:h,timeOffset:p,initSegmentChange:m}=s||a,{audioCodec:v,videoCodec:E,defaultInitPts:C,duration:N,initSegmentData:R}=l,x=Tc(n,e);if(x&&x.method==="AES-128"){const T=this.getDecrypter();if(T.isSync()){let I=T.softwareDecrypt(n,x.key.buffer,x.iv.buffer);if(i.part>-1&&(I=T.flush()),!I)return r.executeEnd=je(),gr(i);n=new Uint8Array(I)}else return this.decryptionPromise=T.webCryptoDecrypt(n,x.key.buffer,x.iv.buffer).then(I=>{const A=this.push(I,null,i);return this.decryptionPromise=null,A}),this.decryptionPromise}const P=this.needsProbing(c,u);if(P){const T=this.configureTransmuxer(n);if(T)return H.warn(`[transmuxer] ${T.message}`),this.observer.emit(D.ERROR,D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:T,reason:T.message}),r.executeEnd=je(),gr(i)}(c||u||m||P)&&this.resetInitSegment(R,v,E,N,e),(c||m||P)&&this.resetInitialTimestamp(C),o||this.resetContiguity();const M=this.transmux(n,x,p,h,i),b=this.currentTransmuxState;return b.contiguous=!0,b.discontinuity=!1,b.trackSwitch=!1,r.executeEnd=je(),M}flush(t){const e=t.transmuxing;e.executeStart=je();const{decrypter:i,currentTransmuxState:s,decryptionPromise:r}=this;if(r)return r.then(()=>this.flush(t));const n=[],{timeOffset:a}=s;if(i){const u=i.flush();u&&n.push(this.push(u,null,t))}const{demuxer:l,remuxer:o}=this;if(!l||!o)return e.executeEnd=je(),[gr(t)];const c=l.flush(a);return Mi(c)?c.then(u=>(this.flushRemux(n,u,t),n)):(this.flushRemux(n,c,t),n)}flushRemux(t,e,i){const{audioTrack:s,videoTrack:r,id3Track:n,textTrack:a}=e,{accurateTimeOffset:l,timeOffset:o}=this.currentTransmuxState;H.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const c=this.remuxer.remux(s,r,n,a,o,l,!0,this.id);t.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=je()}resetInitialTimestamp(t){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetTimeStamp(t),i.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,i,s,r){const{demuxer:n,remuxer:a}=this;!n||!a||(n.resetInitSegment(t,e,i,s),a.resetInitSegment(t,e,i,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,i,s,r){let n;return e&&e.method==="SAMPLE-AES"?n=this.transmuxSampleAes(t,e,i,s,r):n=this.transmuxUnencrypted(t,i,s,r),n}transmuxUnencrypted(t,e,i,s){const{audioTrack:r,videoTrack:n,id3Track:a,textTrack:l}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,n,a,l,e,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(t,e,i,s,r){return this.demuxer.demuxSampleAes(t,e,i).then(n=>({remuxResult:this.remuxer.remux(n.audioTrack,n.videoTrack,n.id3Track,n.textTrack,i,s,!1,this.id),chunkMeta:r}))}configureTransmuxer(t){const{config:e,observer:i,typeSupported:s,vendor:r}=this;let n;for(let u=0,h=mr.length;u<h;u++)if(mr[u].demux.probe(t)){n=mr[u];break}if(!n)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,o=n.remux,c=n.demux;(!l||!(l instanceof o))&&(this.remuxer=new o(i,e,s,r)),(!a||!(a instanceof c))&&(this.demuxer=new c(i,e,s),this.probe=c.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new zr(this.config)),t}}function Tc(d,t){let e=null;return d.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const gr=d=>({remuxResult:{},chunkMeta:d});function Mi(d){return"then"in d&&d.then instanceof Function}class bc{constructor(t,e,i,s,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=s,this.defaultInitPts=r||null}}class Ac{constructor(t,e,i,s,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=r,this.initSegmentChange=n}}var ra={exports:{}};(function(d){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(l,o,c){this.fn=l,this.context=o,this.once=c||!1}function r(l,o,c,u,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new s(c,u||l,h),m=e?e+o:o;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],p]:l._events[m].push(p):(l._events[m]=p,l._eventsCount++),l}function n(l,o){--l._eventsCount===0?l._events=new i:delete l._events[o]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var o=[],c,u;if(this._eventsCount===0)return o;for(u in c=this._events)t.call(c,u)&&o.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(c)):o},a.prototype.listeners=function(o){var c=e?e+o:o,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,p=u.length,m=new Array(p);h<p;h++)m[h]=u[h].fn;return m},a.prototype.listenerCount=function(o){var c=e?e+o:o,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(o,c,u,h,p,m){var v=e?e+o:o;if(!this._events[v])return!1;var E=this._events[v],C=arguments.length,N,R;if(E.fn){switch(E.once&&this.removeListener(o,E.fn,void 0,!0),C){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,c),!0;case 3:return E.fn.call(E.context,c,u),!0;case 4:return E.fn.call(E.context,c,u,h),!0;case 5:return E.fn.call(E.context,c,u,h,p),!0;case 6:return E.fn.call(E.context,c,u,h,p,m),!0}for(R=1,N=new Array(C-1);R<C;R++)N[R-1]=arguments[R];E.fn.apply(E.context,N)}else{var x=E.length,P;for(R=0;R<x;R++)switch(E[R].once&&this.removeListener(o,E[R].fn,void 0,!0),C){case 1:E[R].fn.call(E[R].context);break;case 2:E[R].fn.call(E[R].context,c);break;case 3:E[R].fn.call(E[R].context,c,u);break;case 4:E[R].fn.call(E[R].context,c,u,h);break;default:if(!N)for(P=1,N=new Array(C-1);P<C;P++)N[P-1]=arguments[P];E[R].fn.apply(E[R].context,N)}}return!0},a.prototype.on=function(o,c,u){return r(this,o,c,u,!1)},a.prototype.once=function(o,c,u){return r(this,o,c,u,!0)},a.prototype.removeListener=function(o,c,u,h){var p=e?e+o:o;if(!this._events[p])return this;if(!c)return n(this,p),this;var m=this._events[p];if(m.fn)m.fn===c&&(!h||m.once)&&(!u||m.context===u)&&n(this,p);else{for(var v=0,E=[],C=m.length;v<C;v++)(m[v].fn!==c||h&&!m[v].once||u&&m[v].context!==u)&&E.push(m[v]);E.length?this._events[p]=E.length===1?E[0]:E:n(this,p)}return this},a.prototype.removeAllListeners=function(o){var c;return o?(c=e?e+o:o,this._events[c]&&n(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,d.exports=a})(ra);var Lc=ra.exports,qr=lo(Lc);const yr=Vi()||{isTypeSupported:()=>!1};class sa{constructor(t,e,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const r=t.config;this.hls=t,this.id=e,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const n=(o,c)=>{c=c||{},c.frag=this.frag,c.id=this.id,o===D.ERROR&&(this.error=c.error),this.hls.trigger(o,c)};this.observer=new qr,this.observer.on(D.FRAG_DECRYPTED,n),this.observer.on(D.ERROR,n);const a={mp4:yr.isTypeSupported("video/mp4"),mpeg:yr.isTypeSupported("audio/mpeg"),mp3:yr.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"&&(r.workerPath||Kl())){try{r.workerPath?(H.log(`loading Web Worker ${r.workerPath} for "${e}"`),this.workerContext=ql(r.workerPath)):(H.log(`injecting Web Worker for "${e}"`),this.workerContext=Wl()),this.onwmsg=u=>this.onWorkerMessage(u);const{worker:c}=this.workerContext;c.addEventListener("message",this.onwmsg),c.onerror=u=>{const h=new Error(`${u.message}  (${u.filename}:${u.lineno})`);r.enableWorker=!1,H.warn(`Error in "${e}" Web Worker, fallback to inline`),this.hls.trigger(D.ERROR,{type:xt.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})},c.postMessage({cmd:"init",typeSupported:a,vendor:l,id:e,config:JSON.stringify(r)})}catch(c){H.warn(`Error setting up "${e}" Web Worker, fallback to inline`,c),this.resetWorker(),this.error=null,this.transmuxer=new Js(this.observer,a,r,l,e)}return}this.transmuxer=new Js(this.observer,a,r,l,e)}resetWorker(){if(this.workerContext){const{worker:t,objectURL:e}=this.workerContext;e&&self.URL.revokeObjectURL(e),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(t,e,i,s,r,n,a,l,o,c){var u,h;o.transmuxing.start=self.performance.now();const{transmuxer:p}=this,m=n?n.start:r.start,v=r.decryptdata,E=this.frag,C=!(E&&r.cc===E.cc),N=!(E&&o.level===E.level),R=E?o.sn-E.sn:-1,x=this.part?o.part-this.part.index:-1,P=R===0&&o.id>1&&o.id===(E==null?void 0:E.stats.chunkCount),M=!N&&(R===1||R===0&&(x===1||P&&x<=0)),b=self.performance.now();(N||R||r.stats.parsing.start===0)&&(r.stats.parsing.start=b),n&&(x||!M)&&(n.stats.parsing.start=b);const T=!(E&&((u=r.initSegment)==null?void 0:u.url)===((h=E.initSegment)==null?void 0:h.url)),I=new Ac(C,M,l,N,m,T);if(!M||C||T){H.log(`[transmuxer-interface, ${r.type}]: Starting new transmux session for sn: ${o.sn} p: ${o.part} level: ${o.level} id: ${o.id}
        discontinuity: ${C}
        trackSwitch: ${N}
        contiguous: ${M}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${T}`);const A=new bc(i,s,e,a,c);this.configureTransmuxer(A)}if(this.frag=r,this.part=n,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:v,chunkMeta:o,state:I},t instanceof ArrayBuffer?[t]:[]);else if(p){const A=p.push(t,v,o,I);Mi(A)?(p.async=!0,A.then(U=>{this.handleTransmuxComplete(U)}).catch(U=>{this.transmuxerError(U,o,"transmuxer-interface push error")})):(p.async=!1,this.handleTransmuxComplete(A))}}flush(t){t.transmuxing.start=self.performance.now();const{transmuxer:e}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(e){let i=e.flush(t);Mi(i)||e.async?(Mi(i)||(i=Promise.resolve(i)),i.then(r=>{this.handleFlushResult(r,t)}).catch(r=>{this.transmuxerError(r,t,"transmuxer-interface flush error")})):this.handleFlushResult(i,t)}}transmuxerError(t,e,i){!this.hls||(this.error=t,this.hls.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,chunkMeta:e,fatal:!1,error:t,err:t,reason:i}))}handleFlushResult(t,e){t.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(e)}onWorkerMessage(t){const e=t.data,i=this.hls;switch(e.event){case"init":{var s;const r=(s=this.workerContext)==null?void 0:s.objectURL;r&&self.URL.revokeObjectURL(r);break}case"transmuxComplete":{this.handleTransmuxComplete(e.data);break}case"flush":{this.onFlush(e.data);break}case"workerLog":H[e.data.logType]&&H[e.data.logType](e.data.message);break;default:{e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data);break}}}configureTransmuxer(t){const{transmuxer:e}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const Ic=250,_r=2,wc=.1,Rc=.05;class Dc{constructor(t,e,i,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=i,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(t,e){const{config:i,media:s,stalled:r}=this;if(s===null)return;const{currentTime:n,seeking:a}=s,l=this.seeking&&!a,o=!this.seeking&&a;if(this.seeking=a,n!==t){if(this.moved=!0,r!==null){if(this.stallReported){const C=self.performance.now()-r;H.warn(`playback not stuck anymore @${n}, after ${Math.round(C)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(o||l){this.stalled=null;return}if(s.paused&&!a||s.ended||s.playbackRate===0||!Gt.getBuffered(s).length)return;const c=Gt.bufferInfo(s,n,0),u=c.len>0,h=c.nextStart||0;if(!u&&!h)return;if(a){const C=c.len>_r,N=!h||e&&e.start<=n||h-n>_r&&!this.fragmentTracker.getPartialFragment(n);if(C||N)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var p;const C=Math.max(h,c.start||0)-n,N=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,x=(N==null||(p=N.details)==null?void 0:p.live)?N.details.targetduration*2:_r,P=this.fragmentTracker.getPartialFragment(n);if(C>0&&(C<=x||P)){this._trySkipBufferHole(P);return}}const m=self.performance.now();if(r===null){this.stalled=m;return}const v=m-r;if(!a&&v>=Ic&&(this._reportStall(c),!this.media))return;const E=Gt.bufferInfo(s,n,i.maxBufferHole);this._tryFixBufferStall(E,v)}_tryFixBufferStall(t,e){const{config:i,fragmentTracker:s,media:r}=this;if(r===null)return;const n=r.currentTime,a=s.getPartialFragment(n);a&&(this._trySkipBufferHole(a)||!this.media)||(t.len>i.maxBufferHole||t.nextStart&&t.nextStart-n<i.maxBufferHole)&&e>i.highBufferWatchdogPeriod*1e3&&(H.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(t){const{hls:e,media:i,stallReported:s}=this;if(!s&&i){this.stallReported=!0;const r=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(t)})`);H.warn(r.message),e.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:t.len})}}_trySkipBufferHole(t){const{config:e,hls:i,media:s}=this;if(s===null)return 0;const r=s.currentTime,n=Gt.bufferInfo(s,r,0),a=r<n.start?n.start:n.nextStart;if(a){const l=n.len<=e.maxBufferHole,o=n.len>0&&n.len<1&&s.readyState<3,c=a-r;if(c>0&&(l||o)){if(c>e.maxBufferHole){const{fragmentTracker:h}=this;let p=!1;if(r===0){const m=h.getAppendedFrag(0,Tt.MAIN);m&&a<m.end&&(p=!0)}if(!p){const m=t||h.getAppendedFrag(r,Tt.MAIN);if(m){let v=!1,E=m.end;for(;E<a;){const C=h.getPartialFragment(E);if(C)E+=C.duration;else{v=!0;break}}if(v)return 0}}}const u=Math.max(a+Rc,r+wc);if(H.warn(`skipping hole, adjusting currentTime from ${r} to ${u}`),this.moved=!0,this.stalled=null,s.currentTime=u,t&&!t.gap){const h=new Error(`fragment loaded with buffer holes, seeking from ${r} to ${u}`);i.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:t})}return u}}return 0}_tryNudgeBuffer(){const{config:t,hls:e,media:i,nudgeRetry:s}=this;if(i===null)return;const r=i.currentTime;if(this.nudgeRetry++,s<t.nudgeMaxRetry){const n=r+(s+1)*t.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${r} to ${n}`);H.warn(a.message),i.currentTime=n,e.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${r} after ${t.nudgeMaxRetry} nudges`);H.error(n.message),e.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}const Cc=100;class kc extends Hr{constructor(t,e,i){super(t,e,i,"[stream-controller]",Tt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(D.ERROR,this.onError,this),t.on(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this),t.on(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(D.ERROR,this.onError,this),t.off(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this),t.off(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(t){if(this.levels){const{lastCurrentTime:e,hls:i}=this;if(this.stopLoad(),this.setInterval(Cc),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.nextAutoLevel),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}e>0&&t===-1&&(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e),this.state=it.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=it.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case it.WAITING_LEVEL:{var t;const{levels:i,level:s}=this,r=i==null||(t=i[s])==null?void 0:t.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=it.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=it.IDLE;break}break}case it.FRAG_LOADING_WAITING_RETRY:{var e;const i=self.performance.now(),s=this.retryDate;(!s||i>=s||(e=this.media)!=null&&e.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=it.IDLE)}break}this.state===it.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:i,media:s}=this,{config:r,nextLoadLevel:n}=t;if(e===null||!s&&(this.startFragRequested||!r.startFragPrefetch)||this.altAudio&&this.audioOnly||!(i!=null&&i[n]))return;const a=i[n],l=this.getMainFwdBufferInfo();if(l===null)return;const o=this.getLevelDetails();if(o&&this._streamEnded(l,o)){const E={};this.altAudio&&(E.type="video"),this.hls.trigger(D.BUFFER_EOS,E),this.state=it.ENDED;return}t.loadLevel!==n&&t.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=t.nextLoadLevel=n;const c=a.details;if(!c||this.state===it.WAITING_LEVEL||c.live&&this.levelLastLoaded!==n){this.level=n,this.state=it.WAITING_LEVEL;return}const u=l.len,h=this.getMaxBufferLength(a.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:l.end;let m=this.getNextFragment(p,c);if(this.couldBacktrack&&!this.fragPrevious&&m&&m.sn!=="initSegment"&&this.fragmentTracker.getState(m)!==ee.OK){var v;const C=((v=this.backtrackFragment)!=null?v:m).sn-c.startSN,N=c.fragments[C-1];N&&m.cc===N.cc&&(m=N,this.fragmentTracker.removeFragment(N))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,p)){if(!m.gap){const C=this.audioOnly&&!this.altAudio?jt.AUDIO:jt.VIDEO,N=(C===jt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;N&&this.afterBufferFlushed(N,C,Tt.MAIN)}m=this.getNextFragmentLoopLoading(m,c,l,Tt.MAIN,h)}!m||(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,a,p))}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);this.fragCurrent=t,s===ee.NOT_LOADED||s===ee.PARTIAL?t.sn==="initSegment"?this._loadInitSegment(t,e):this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):(this.startFragRequested=!0,super.loadFragment(t,e,i)):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,Tt.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let i;const s=this.getAppendedFrag(e.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<r.targetduration*2)return}if(!e.paused&&t){const a=this.hls.nextLoadLevel,l=t[a],o=this.fragLastKbps;o&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*o)+1:i=0}else i=0;const n=this.getBufferedFrag(e.currentTime+i);if(n){const a=this.followingBufferedFrag(n);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,o=a.duration,c=Math.max(n.end,l+Math.min(Math.max(o-this.config.maxFragLookUpTolerance,o*.5),o*.75));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case it.KEY_LOADING:case it.FRAG_LOADING:case it.FRAG_LOADING_WAITING_RETRY:case it.PARSING:case it.PARSED:this.state=it.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const i=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Dc(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:t}=this;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const t=this.media,e=t?t.currentTime:null;mt(e)&&this.log(`Media seeked to ${e.toFixed(3)}`);const i=this.getMainFwdBufferInfo();if(i===null||i.len===0){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(t,e){let i=!1,s=!1,r;e.levels.forEach(n=>{r=n.audioCodec,r&&(r.indexOf("mp4a.40.2")!==-1&&(i=!0),r.indexOf("mp4a.40.5")!==-1&&(s=!0))}),this.audioCodecSwitch=i&&s&&!Yl(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:i}=this;if(!i||this.state!==it.IDLE)return;const s=i[e.level];(!s.details||s.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(s.details))&&(this.state=it.WAITING_LEVEL)}onLevelLoaded(t,e){var i;const{levels:s}=this,r=e.level,n=e.details,a=n.totalduration;if(!s){this.warn(`Levels were reset while loading level ${r}`);return}this.log(`Level ${r} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${a}`);const l=s[r],o=this.fragCurrent;o&&(this.state===it.FRAG_LOADING||this.state===it.FRAG_LOADING_WAITING_RETRY)&&(o.level!==e.level||o.urlId!==l.urlId)&&o.loader&&this.abortCurrentFrag();let c=0;if(n.live||(i=l.details)!=null&&i.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;c=this.alignPlaylists(n,l.details)}if(l.details=n,this.levelLastLoaded=r,this.hls.trigger(D.LEVEL_UPDATED,{details:n,level:r}),this.state===it.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=it.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,c),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:s,payload:r}=t,{levels:n}=this;if(!n){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const a=n[i.level],l=a.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const o=a.videoCodec,c=l.PTSKnown||!l.live,u=(e=i.initSegment)==null?void 0:e.data,h=this._getAudioCodec(a),p=this.transmuxer=this.transmuxer||new sa(this.hls,Tt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=s?s.index:-1,v=m!==-1,E=new Vr(i.level,i.sn,i.stats.chunkCount,r.byteLength,m,v),C=this.initPTS[i.cc];p.push(r,u,h,o,i,s,l.totalduration,c,E,C)}onAudioTrackSwitching(t,e){const i=this.altAudio;if(!!!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const r=this.hls;i&&(r.trigger(D.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),r.trigger(D.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const i=e.id,s=!!this.hls.audioTracks[i].url;if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s,this.tick()}onBufferCreated(t,e){const i=e.tracks;let s,r,n=!1;for(const a in i){const l=i[a];if(l.id==="main"){if(r=a,s=l,a==="video"){const o=i[a];o&&(this.videoBuffer=o.buffer)}}else n=!0}n&&s?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:i,part:s}=e;if(i&&i.type!==Tt.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===it.PARSED&&(this.state=it.IDLE);return}const r=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}onError(t,e){var i;if(e.fatal){this.state=it.ERROR;return}switch(e.details){case J.FRAG_GAP:case J.FRAG_PARSING_ERROR:case J.FRAG_DECRYPT_ERROR:case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Tt.MAIN,e);break;case J.LEVEL_LOAD_ERROR:case J.LEVEL_LOAD_TIMEOUT:case J.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===it.WAITING_LEVEL&&((i=e.context)==null?void 0:i.type)===Nt.LEVEL&&(this.state=it.IDLE);break;case J.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case J.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}checkBuffer(){const{media:t,gapController:e}=this;if(!(!t||!e||!t.readyState)){if(this.loadedmetadata||!Gt.getBuffered(t).length){const i=this.state!==it.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}}onFragLoadEmergencyAborted(){this.state=it.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==jt.AUDIO||this.audioOnly&&!this.altAudio){const i=(e===jt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,e,Tt.MAIN)}}onLevelsUpdated(t,e){this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let i=this.startPosition;if(i>=0&&e<i){if(t.seeking){this.log(`could not seek to ${i}, already seeking at ${e}`);return}const s=Gt.getBuffered(t),n=(s.length?s.start(0):0)-i;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${n} to match buffer start`),i+=n,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${e}`),t.currentTime=i}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(i=>{const{hls:s}=this;if(!i||this.fragContextChanged(t))return;e.fragmentError=0,this.state=it.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const r=t.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(D.FRAG_LOADED,i),t.bitrateTest=!1})}_handleTransmuxComplete(t){var e;const i="main",{hls:s}=this,{remuxResult:r,chunkMeta:n}=t,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:l,part:o,level:c}=a,{video:u,text:h,id3:p,initSegment:m}=r,{details:v}=c,E=this.altAudio?void 0:r.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=it.PARSING,m){if(m!=null&&m.tracks){const R=l.initSegment||l;this._bufferInitSegment(c,m.tracks,R,n),s.trigger(D.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:i,tracks:m.tracks})}const C=m.initPTS,N=m.timescale;mt(C)&&(this.initPTS[l.cc]={baseTime:C,timescale:N},s.trigger(D.INIT_PTS_FOUND,{frag:l,id:i,initPTS:C,timescale:N}))}if(u&&v&&l.sn!=="initSegment"){const C=v.fragments[l.sn-1-v.startSN],N=l.sn===v.startSN,R=!C||l.cc>C.cc;if(r.independent!==!1){const{startPTS:x,endPTS:P,startDTS:M,endDTS:b}=u;if(o)o.elementaryStreams[u.type]={startPTS:x,endPTS:P,startDTS:M,endDTS:b};else if(u.firstKeyFrame&&u.independent&&n.id===1&&!R&&(this.couldBacktrack=!0),u.dropped&&u.independent){const T=this.getMainFwdBufferInfo(),I=(T?T.end:this.getLoadPosition())+this.config.maxBufferHole,A=u.firstKeyFramePTS?u.firstKeyFramePTS:x;if(!N&&I<A-this.config.maxBufferHole&&!R){this.backtrack(l);return}else R&&(l.gap=!0);l.setElementaryStreamInfo(u.type,l.start,P,l.start,b,!0)}l.setElementaryStreamInfo(u.type,x,P,M,b),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(u,l,o,n,N||R)}else if(N||R)l.gap=!0;else{this.backtrack(l);return}}if(E){const{startPTS:C,endPTS:N,startDTS:R,endDTS:x}=E;o&&(o.elementaryStreams[jt.AUDIO]={startPTS:C,endPTS:N,startDTS:R,endDTS:x}),l.setElementaryStreamInfo(jt.AUDIO,C,N,R,x),this.bufferFragmentData(E,l,o,n)}if(v&&p!=null&&(e=p.samples)!=null&&e.length){const C={id:i,frag:l,details:v,samples:p.samples};s.trigger(D.FRAG_PARSING_METADATA,C)}if(v&&h){const C={id:i,frag:l,details:v,samples:h.samples};s.trigger(D.FRAG_PARSING_USERDATA,C)}}_bufferInitSegment(t,e,i,s){if(this.state!==it.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;const{audio:r,video:n,audiovideo:a}=e;if(r){let l=t.audioCodec;const o=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5"),r.metadata.channelCount!==1&&o.indexOf("firefox")===-1&&(l="mp4a.40.5")),o.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),t.audioCodec&&t.audioCodec!==l&&this.log(`Swapping manifest audio codec "${t.audioCodec}" for "${l}"`),r.levelCodec=l,r.id="main",this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${l||""}/${t.audioCodec||""}/${r.codec}]`)}n&&(n.levelCodec=t.videoCodec,n.id="main",this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${t.videoCodec||""}/${n.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${t.attrs.CODECS||""}/${a.codec}]`),this.hls.trigger(D.BUFFER_CODECS,e),Object.keys(e).forEach(l=>{const c=e[l].initSegment;c!=null&&c.byteLength&&this.hls.trigger(D.BUFFER_APPENDING,{type:l,data:c,frag:i,part:null,chunkMeta:s,parent:i.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Tt.MAIN)}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=it.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const i=t.currentTime;if(Gt.isBuffered(t,i)?e=this.getAppendedFrag(i):Gt.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;const s=this.fragPlaying,r=e.level;(!s||e.sn!==s.sn||s.level!==r||e.urlId!==s.urlId)&&(this.fragPlaying=e,this.hls.trigger(D.FRAG_CHANGED,{frag:e}),(!s||s.level!==r)&&this.hls.trigger(D.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){const t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}get currentProgramDateTime(){const t=this.media;if(t){const e=t.currentTime,i=this.currentFrag;if(i&&mt(e)&&mt(i.programDateTime)){const s=i.programDateTime+(e-i.start)*1e3;return new Date(s)}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class ni{constructor(t,e=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}sample(t,e){const i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class Mc{constructor(t,e,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ni(t),this.fast_=new ni(e),this.defaultTTFB_=s,this.ttfb_=new ni(t)}update(t,e){const{slow_:i,fast_:s,ttfb_:r}=this;i.halfLife!==t&&(this.slow_=new ni(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.fast_=new ni(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.ttfb_=new ni(t,r.getEstimate(),r.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const i=8*e,s=t/1e3,r=i/s;this.fast_.sample(s,r),this.slow_.sample(s,r)}sampleTTFB(t){const e=t/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(i,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class Pc{constructor(t){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;const e=t.config;this.bwEstimator=new Mc(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(D.FRAG_LOADING,this.onFragLoading,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:t}=this;t.off(D.FRAG_LOADING,this.onFragLoading,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(t,e){var i;const s=e.frag;this.ignoreFragment(s)||(this.fragCurrent=s,this.partCurrent=(i=e.part)!=null?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(t,e){this.clearTimer()}getTimeToLoadFrag(t,e,i,s){const r=t+i/e,n=s?this.lastLevelLoadSec:0;return r+n}onLevelLoaded(t,e){const i=this.hls.config,{total:s,bwEstimate:r}=e.stats;mt(s)&&mt(r)&&(this.lastLevelLoadSec=8*s/r),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{autoLevelEnabled:s,media:r}=i;if(!t||!r)return;const n=performance.now(),a=e?e.stats:t.stats,l=e?e.duration:t.duration,o=n-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||t.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||r.paused||!r.playbackRate||!r.readyState)return;const c=i.mainForwardBufferInfo;if(c===null)return;const u=this.bwEstimator.getEstimateTTFB(),h=Math.abs(r.playbackRate);if(o<=Math.max(u,1e3*(l/(h*2))))return;const p=c.len/h;if(p>=2*l/h)return;const m=a.loading.first?a.loading.first-a.loading.start:-1,v=a.loaded&&m>-1,E=this.bwEstimator.getEstimate(),{levels:C,minAutoLevel:N}=i,R=C[t.level],x=a.total||Math.max(a.loaded,Math.round(l*R.maxBitrate/8));let P=o-m;P<1&&v&&(P=Math.min(o,a.loaded*8/E));const M=v?a.loaded*1e3/P:0,b=M?(x-a.loaded)/M:x*8/E+u/1e3;if(b<=p)return;const T=M?M*8:E;let I=Number.POSITIVE_INFINITY,A;for(A=t.level-1;A>N;A--){const U=C[A].maxBitrate;if(I=this.getTimeToLoadFrag(u/1e3,T,l*U,!C[A].details),I<p)break}I>=b||I>l*10||(i.nextLoadLevel=A,v?this.bwEstimator.sample(o-Math.min(u,m),a.loaded):this.bwEstimator.sampleTTFB(o),this.clearTimer(),H.warn(`[abr] Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${p.toFixed(3)} s
      Estimated load time for current fragment: ${b.toFixed(3)} s
      Estimated load time for down switch fragment: ${I.toFixed(3)} s
      TTFB estimate: ${m}
      Current BW estimate: ${mt(E)?(E/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${A}`),t.loader&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),i.trigger(D.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:a}))}onFragLoaded(t,{frag:e,part:i}){const s=i?i.stats:e.stats;if(e.type===Tt.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const r=i?i.duration:e.duration,n=this.hls.levels[e.level],a=(n.loaded?n.loaded.bytes:0)+s.loaded,l=(n.loaded?n.loaded.duration:0)+r;n.loaded={bytes:a,duration:l},n.realBitrate=Math.round(8*a/l)}if(e.bitrateTest){const r={stats:s,frag:e,part:i,id:e.type};this.onFragBuffered(D.FRAG_BUFFERED,r),e.bitrateTest=!1}}}onFragBuffered(t,e){const{frag:i,part:s}=e,r=s!=null&&s.stats.loaded?s.stats:i.stats;if(r.aborted||this.ignoreFragment(i))return;const n=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,r.loaded),r.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==Tt.MAIN||t.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const t=this._nextAutoLevel,e=this.bwEstimator;if(t!==-1&&!e.canEstimate())return t;let i=this.getNextABRAutoLevel();if(t!==-1){const s=this.hls.levels;if(s.length>Math.max(t,i)&&s[t].loadError<=s[i].loadError)return t}return t!==-1&&(i=Math.min(t,i)),i}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{maxAutoLevel:s,config:r,minAutoLevel:n,media:a}=i,l=e?e.duration:t?t.duration:0,o=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,u=i.mainForwardBufferInfo,h=(u?u.len:0)/o;let p=this.findBestLevel(c,n,s,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor);if(p>=0)return p;H.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let m=l?Math.min(l,r.maxStarvationDelay):r.maxStarvationDelay,v=r.abrBandWidthFactor,E=r.abrBandWidthUpFactor;if(!h){const C=this.bitrateTestDelay;C&&(m=(l?Math.min(l,r.maxLoadingDelay):r.maxLoadingDelay)-C,H.trace(`[abr] bitrate test took ${Math.round(1e3*C)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),v=E=1)}return p=this.findBestLevel(c,n,s,h+m,v,E),Math.max(p,0)}findBestLevel(t,e,i,s,r,n){var a;const{fragCurrent:l,partCurrent:o,lastLoadedFragLevel:c}=this,{levels:u}=this.hls,h=u[c],p=!!(h!=null&&(a=h.details)!=null&&a.live),m=h==null?void 0:h.codecSet,v=o?o.duration:l?l.duration:0,E=this.bwEstimator.getEstimateTTFB()/1e3;let C=e,N=-1;for(let R=i;R>=e;R--){const x=u[R];if(!x||m&&x.codecSet!==m){x&&(C=Math.min(R,C),N=Math.max(R,N));continue}N!==-1&&H.trace(`[abr] Skipped level(s) ${C}-${N} with CODECS:"${u[N].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);const P=x.details,M=(o?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||v;let b;R<=c?b=r*t:b=n*t;const T=u[R].maxBitrate,I=this.getTimeToLoadFrag(E,b,T*M,P===void 0);if(H.trace(`[abr] level:${R} adjustedbw-bitrate:${Math.round(b-T)} avgDuration:${M.toFixed(1)} maxFetchDuration:${s.toFixed(1)} fetchDuration:${I.toFixed(1)}`),b>T&&(I===0||!mt(I)||p&&!this.bitrateTestDelay||I<s))return R}return-1}set nextAutoLevel(t){this._nextAutoLevel=t}}class na{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let i;if(t.length)t.length===1?i=t[0]:i=Oc(t,e);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Oc(d,t){const e=new Uint8Array(t);let i=0;for(let s=0;s<d.length;s++){const r=d[s];e.set(r,i),i+=r.length}return e}const tn=100;class Nc extends Hr{constructor(t,e,i){super(t,e,i,"[audio-stream-controller]",Tt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(D.ERROR,this.onError,this),t.on(D.BUFFER_RESET,this.onBufferReset,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this),t.on(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(D.ERROR,this.onError,this),t.off(D.BUFFER_RESET,this.onBufferReset,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this),t.off(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:r}){if(i==="main"){const n=e.cc;this.initPTS[e.cc]={baseTime:s,timescale:r},this.log(`InitPTS for cc: ${n} found from main: ${s}`),this.videoTrackCC=n,this.state===it.WAITING_INIT_PTS&&this.tick()}}startLoad(t){if(!this.levels){this.startPosition=t,this.state=it.STOPPED;return}const e=this.lastCurrentTime;this.stopLoad(),this.setInterval(tn),e>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e,this.state=it.IDLE):(this.loadedmetadata=!1,this.state=it.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}doTick(){switch(this.state){case it.IDLE:this.doTickIdle();break;case it.WAITING_TRACK:{var t;const{levels:i,trackId:s}=this,r=i==null||(t=i[s])==null?void 0:t.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=it.WAITING_INIT_PTS}break}case it.FRAG_LOADING_WAITING_RETRY:{var e;const i=performance.now(),s=this.retryDate;(!s||i>=s||(e=this.media)!=null&&e.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=it.IDLE);break}case it.WAITING_INIT_PTS:{const i=this.waitingData;if(i){const{frag:s,part:r,cache:n,complete:a}=i;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=it.FRAG_LOADING;const l=n.flush(),o={frag:s,part:r,payload:l,networkDetails:null};this._handleFragmentLoadProgress(o),a&&super._handleFragmentLoadComplete(o)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),o=Gt.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);Mr(o.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${o.end} is needed`),this.clearWaitingFragment())}}else this.state=it.IDLE}}this.onTickEnd()}clearWaitingFragment(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=it.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:t}=this;!(t!=null&&t.readyState)||(this.lastCurrentTime=t.currentTime)}doTickIdle(){const{hls:t,levels:e,media:i,trackId:s}=this,r=t.config;if(!(e!=null&&e[s])||!i&&(this.startFragRequested||!r.startFragPrefetch))return;const n=e[s],a=n.details;if(!a||a.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(a)){this.state=it.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,jt.AUDIO,Tt.AUDIO));const o=this.getFwdBufferInfo(l,Tt.AUDIO);if(o===null)return;const{bufferedTrack:c,switchingTrack:u}=this;if(!u&&this._streamEnded(o,a)){t.trigger(D.BUFFER_EOS,{type:"audio"}),this.state=it.ENDED;return}const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Tt.MAIN),p=o.len,m=this.getMaxBufferLength(h==null?void 0:h.len);if(p>=m&&!u)return;const E=a.fragments[0].start;let C=o.end;if(u&&i){const P=this.getLoadPosition();c&&u.attrs!==c.attrs&&(C=P),a.PTSKnown&&P<E&&(o.end>E||o.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=E+.05)}let N=this.getNextFragment(C,a),R=!1;if(N&&this.isLoopLoading(N,C)&&(R=!!N.gap,N=this.getNextFragmentLoopLoading(N,a,o,Tt.MAIN,m)),!N){this.bufferFlushed=!0;return}const x=h&&N.start>h.end+a.targetduration;if(x||!(h!=null&&h.len)&&o.len){const P=this.getAppendedFrag(N.start,Tt.MAIN);if(P===null||(R||(R=!!P.gap||!!x&&h.len===0),x&&!R||R&&o.nextStart&&o.nextStart<P.end))return}this.loadFragment(N,n,C)}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.min(Math.max(e,t),this.config.maxMaxBufferLength):e}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(i=>new vi(i))}onAudioTrackSwitching(t,e){const i=!!e.url;this.trackId=e.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?this.setInterval(tn):this.resetTransmuxer(),i?(this.switchingTrack=e,this.state=it.IDLE):(this.switchingTrack=null,this.bufferedTrack=e,this.state=it.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(t,e){this.mainDetails=e.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(D.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(t,e){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=e;return}const{levels:s}=this,{details:r,id:n}=e;if(!s){this.warn(`Audio tracks were reset while loading level ${n}`);return}this.log(`Track ${n} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const a=s[n];let l=0;if(r.live||(i=a.details)!=null&&i.live){this.checkLiveUpdate(r);const o=this.mainDetails;if(r.deltaUpdateFailed||!o)return;!a.details&&r.hasProgramDateTime&&o.hasProgramDateTime?($n(r,o),l=r.fragments[0].start):l=this.alignPlaylists(r,a.details)}a.details=r,this.levelLastLoaded=n,!this.startFragRequested&&(this.mainDetails||!r.live)&&this.setStartPosition(a.details,l),this.state===it.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=it.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:s,payload:r}=t,{config:n,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=l[a];if(!o){this.warn("Audio track is undefined on fragment load progress");return}const c=o.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const u=n.defaultAudioCodec||o.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new sa(this.hls,Tt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const p=this.initPTS[i.cc],m=(e=i.initSegment)==null?void 0:e.data;if(p!==void 0){const E=s?s.index:-1,C=E!==-1,N=new Vr(i.level,i.sn,i.stats.chunkCount,r.byteLength,E,C);h.push(r,m,u,"",i,s,c.totalduration,!1,N,p)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:v}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new na,complete:!1};v.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=it.WAITING_INIT_PTS}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(t,e){const i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)}onFragBuffered(t,e){const{frag:i,part:s}=e;if(i.type!==Tt.AUDIO){if(!this.loadedmetadata&&i.type===Tt.MAIN){const r=this.videoBuffer||this.media;r&&Gt.getBuffered(r).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(i.sn!=="initSegment"){this.fragPrevious=i;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(D.AUDIO_TRACK_SWITCHED,le({},r)))}this.fragBufferedComplete(i,s)}onError(t,e){var i;if(e.fatal){this.state=it.ERROR;return}switch(e.details){case J.FRAG_GAP:case J.FRAG_PARSING_ERROR:case J.FRAG_DECRYPT_ERROR:case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Tt.AUDIO,e);break;case J.AUDIO_TRACK_LOAD_ERROR:case J.AUDIO_TRACK_LOAD_TIMEOUT:case J.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===it.WAITING_TRACK&&((i=e.context)==null?void 0:i.type)===Nt.AUDIO_TRACK&&(this.state=it.IDLE);break;case J.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case J.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushed(t,{type:e}){e===jt.AUDIO&&(this.bufferFlushed=!0,this.state===it.ENDED&&(this.state=it.IDLE))}_handleTransmuxComplete(t){var e;const i="audio",{hls:s}=this,{remuxResult:r,chunkMeta:n}=t,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:l,part:o,level:c}=a,{details:u}=c,{audio:h,text:p,id3:m,initSegment:v}=r;if(this.fragContextChanged(l)||!u){this.fragmentTracker.removeFragment(l);return}if(this.state=it.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),v!=null&&v.tracks){const E=l.initSegment||l;this._bufferInitSegment(v.tracks,E,n),s.trigger(D.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:v.tracks})}if(h){const{startPTS:E,endPTS:C,startDTS:N,endDTS:R}=h;o&&(o.elementaryStreams[jt.AUDIO]={startPTS:E,endPTS:C,startDTS:N,endDTS:R}),l.setElementaryStreamInfo(jt.AUDIO,E,C,N,R),this.bufferFragmentData(h,l,o,n)}if(m!=null&&(e=m.samples)!=null&&e.length){const E=Zt({id:i,frag:l,details:u},m);s.trigger(D.FRAG_PARSING_METADATA,E)}if(p){const E=Zt({id:i,frag:l,details:u},p);s.trigger(D.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(t,e,i){if(this.state!==it.PARSING)return;t.video&&delete t.video;const s=t.audio;if(!s)return;s.levelCodec=s.codec,s.id="audio",this.log(`Init audio buffer, container:${s.container}, codecs[parsed]=[${s.codec}]`),this.hls.trigger(D.BUFFER_CODECS,t);const r=s.initSegment;if(r!=null&&r.byteLength){const n={type:"audio",frag:e,part:null,chunkMeta:i,parent:e.type,data:r};this.hls.trigger(D.BUFFER_APPENDING,n)}this.tick()}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);if(this.fragCurrent=t,this.switchingTrack||s===ee.NOT_LOADED||s===ee.PARTIAL){var r;t.sn==="initSegment"?this._loadInitSegment(t,e):(r=e.details)!=null&&r.live&&!this.initPTS[t.cc]?(this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=it.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(t,e,i))}else this.clearTrackerIfNeeded(t)}completeAudioSwitch(t){const{hls:e,media:i,bufferedTrack:s}=this,r=s==null?void 0:s.attrs,n=t.attrs;i&&r&&(r.CHANNELS!==n.CHANNELS||r.NAME!==n.NAME||r.LANGUAGE!==n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(D.AUDIO_TRACK_SWITCHED,le({},t))}}class Fc extends Gr{constructor(t){super(t,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(D.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(D.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:i,groupId:s,details:r}=e,n=this.tracksInGroup[i];if(!n||n.groupId!==s){this.warn(`Track with id:${i} and group:${s} not found in active group ${n.groupId}`);return}const a=n.details;n.details=e.details,this.log(`audio-track ${i} "${n.name}" lang:${n.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.audioGroupIds))return;const i=e.audioGroupIds[e.urlId];if(this.groupId!==i){this.groupId=i||null;const s=this.tracks.filter(n=>!i||n.groupId===i);this.selectDefaultTrack&&!s.some(n=>n.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;const r={audioTracks:s};this.log(`Updating audio tracks, ${s.length} track(s) found in group:${i}`),this.hls.trigger(D.AUDIO_TRACKS_UPDATED,r),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(t,e){e.fatal||!e.context||e.context.type===Nt.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(e))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const i=this.currentTrack;e[this.trackId];const s=e[t],{groupId:r,name:n}=s;if(this.log(`Switching to audio-track ${t} "${n}" lang:${s.lang} group:${r}`),this.trackId=t,this.currentTrack=s,this.selectDefaultTrack=!1,this.hls.trigger(D.AUDIO_TRACK_SWITCHING,le({},s)),s.details&&!s.details.live)return;const a=this.switchParams(s.url,i==null?void 0:i.details);this.loadPlaylist(a)}selectInitialTrack(){const t=this.tracksInGroup,e=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(e!==-1)this.setAudioTrack(e);else{const i=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${t.length}`);this.warn(i.message),this.hls.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if((!this.selectDefaultTrack||s.default)&&(!t||t.attrs["STABLE-RENDITION-ID"]!==void 0&&t.attrs["STABLE-RENDITION-ID"]===s.attrs["STABLE-RENDITION-ID"]||t.name===s.name&&t.lang===s.lang))return s.id}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,s=e.groupId;let r=e.url;if(t)try{r=t.addDirectives(r)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`loading audio-track playlist ${i} "${e.name}" lang:${e.lang} group:${s}`),this.clearTimer(),this.hls.trigger(D.AUDIO_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:t||null})}}}function aa(d,t){if(d.length!==t.length)return!1;for(let e=0;e<d.length;e++)if(!Bc(d[e].attrs,t[e].attrs))return!1;return!0}function Bc(d,t){const e=d["STABLE-RENDITION-ID"];return e?e===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(i=>d[i]!==t[i])}const en=500;class Uc extends Hr{constructor(t,e,i){super(t,e,i,"[subtitle-stream-controller]",Tt.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.ERROR,this.onError,this),t.on(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(D.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.ERROR,this.onError,this),t.off(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(D.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(t){this.stopLoad(),this.state=it.IDLE,this.setInterval(en),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:i,success:s}=e;if(this.fragPrevious=i,this.state=it.IDLE,!s)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let n;const a=i.start;for(let o=0;o<r.length;o++)if(a>=r[o].start&&a<=r[o].end){n=r[o];break}const l=i.start+i.duration;n?n.end=l:(n={start:a,end:l},r.push(n)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(t,e){const{startOffset:i,endOffset:s}=e;if(i===0&&s!==Number.POSITIVE_INFINITY){const r=s-1;if(r<=0)return;e.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(n=>{for(let a=0;a<n.length;){if(n[a].end<=r){n.shift();continue}else if(n[a].start<r)n[a].start=r;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(i,r,Tt.SUBTITLE)}}onFragBuffered(t,e){if(!this.loadedmetadata&&e.frag.type===Tt.MAIN){var i;(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(t,e){const i=e.frag;(i==null?void 0:i.type)===Tt.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==it.STOPPED&&(this.state=it.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(aa(this.levels,e)){this.levels=e.map(i=>new vi(i));return}this.tracksBuffered=[],this.levels=e.map(i=>{const s=new vi(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Tt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){if(this.currentTrackId=e.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(en)}onSubtitleTrackLoaded(t,e){var i;const{details:s,id:r}=e,{currentTrackId:n,levels:a}=this;if(!a.length)return;const l=a[n];if(r>=a.length||r!==n||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let o=0;if(s.live||(i=l.details)!=null&&i.live){const c=this.mainDetails;if(s.deltaUpdateFailed||!c)return;const u=c.fragments[0];l.details?(o=this.alignPlaylists(s,l.details),o===0&&u&&(o=u.start,kr(s,o))):s.hasProgramDateTime&&c.hasProgramDateTime?($n(s,c),o=s.fragments[0].start):u&&(o=u.start,kr(s,o))}l.details=s,this.levelLastLoaded=r,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(l.details,o),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===it.IDLE&&(Ei(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(t){const{frag:e,payload:i}=t,s=e.decryptdata,r=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&s&&s.key&&s.iv&&s.method==="AES-128"){const n=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer).catch(a=>{throw r.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:e}),a}).then(a=>{const l=performance.now();r.trigger(D.FRAG_DECRYPTED,{frag:e,payload:a,stats:{tstart:n,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=it.IDLE})}}doTick(){if(!this.media){this.state=it.IDLE;return}if(this.state===it.IDLE){const{currentTrackId:t,levels:e}=this,i=e[t];if(!e.length||!i||!i.details)return;const{config:s}=this,r=this.getLoadPosition(),n=Gt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,s.maxBufferHole),{end:a,len:l}=n,o=this.getFwdBufferInfo(this.media,Tt.MAIN),c=i.details,u=this.getMaxBufferLength(o==null?void 0:o.len)+c.levelTargetDuration;if(l>u)return;const h=c.fragments,p=h.length,m=c.edge;let v=null;const E=this.fragPrevious;if(a<m){const C=s.maxFragLookUpTolerance,N=a>m-C?0:C;v=Ei(E,h,Math.max(h[0].start,a),N),!v&&E&&E.start<h[0].start&&(v=h[0])}else v=h[p-1];if(!v)return;if(v=this.mapToInitFragWhenRequired(v),v.sn!=="initSegment"){const C=v.sn-c.startSN,N=h[C-1];N&&N.cc===v.cc&&this.fragmentTracker.getState(N)===ee.NOT_LOADED&&(v=N)}this.fragmentTracker.getState(v)===ee.NOT_LOADED&&this.loadFragment(v,i,a)}}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.max(e,t):e}loadFragment(t,e,i){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t,e):(this.startFragRequested=!0,super.loadFragment(t,e,i))}get mediaBufferTimeRanges(){return new jc(this.tracksBuffered[this.currentTrackId]||[])}}class jc{constructor(t){this.buffered=void 0;const e=(i,s,r)=>{if(s=s>>>0,s>r-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${r})`);return t[s][i]};this.buffered={get length(){return t.length},end(i){return e("end",i,t.length)},start(i){return e("start",i,t.length)}}}}class Gc extends Gr{constructor(t){super(t,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),vr(this.media.textTracks).forEach(e=>{oi(e)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:i,details:s}=e,{trackId:r}=this,n=this.tracksInGroup[r];if(!n){this.warn(`Invalid subtitle track id ${i}`);return}const a=n.details;n.details=e.details,this.log(`subtitle track ${i} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.textGroupIds))return;const i=e.textGroupIds[e.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const r=this.tracks.filter(l=>!i||l.groupId===i);this.tracksInGroup=r;const n=this.findTrackId(s==null?void 0:s.name)||this.findTrackId();this.groupId=i||null;const a={subtitleTracks:r};this.log(`Updating subtitle tracks, ${r.length} track(s) found in "${i}" group-id`),this.hls.trigger(D.SUBTITLE_TRACKS_UPDATED,a),n!==-1&&this.setSubtitleTrack(n,s)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if((!this.selectDefaultTrack||s.default)&&(!t||t===s.name))return s.id}return-1}onError(t,e){e.fatal||!e.context||e.context.type===Nt.SUBTITLE_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.checkRetry(e)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1;const e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,s=e.groupId;let r=e.url;if(t)try{r=t.addDirectives(r)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(D.SUBTITLE_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:t||null})}}toggleTrackModes(t){const{media:e,trackId:i}=this;if(!e)return;const s=vr(e.textTracks),r=s.filter(a=>a.groupId===this.groupId);if(t===-1)[].slice.call(s).forEach(a=>{a.mode="disabled"});else{const a=r[i];a&&(a.mode="disabled")}const n=r[t];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(t,e){var i;const s=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(t===-1||(i=s[t])!=null&&i.details)||t<-1||t>=s.length)return;this.clearTimer();const r=s[t];if(this.log(`Switching to subtitle-track ${t}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:"")),this.trackId=t,r){const{id:n,groupId:a="",name:l,type:o,url:c}=r;this.hls.trigger(D.SUBTITLE_TRACK_SWITCH,{id:n,groupId:a,name:l,type:o,url:c});const u=this.switchParams(r.url,e==null?void 0:e.details);this.loadPlaylist(u)}else this.hls.trigger(D.SUBTITLE_TRACK_SWITCH,{id:t})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=-1;const e=vr(this.media.textTracks);for(let i=0;i<e.length;i++)if(e[i].mode==="hidden")t=i;else if(e[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}}function vr(d){const t=[];for(let e=0;e<d.length;e++){const i=d[e];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&t.push(d[e])}return t}class Vc{constructor(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}append(t,e){const i=this.queues[e];i.push(t),i.length===1&&this.buffers[e]&&this.executeNext(e)}insertAbort(t,e){this.queues[e].unshift(t),this.executeNext(e)}appendBlocker(t){let e;const i=new Promise(r=>{e=r}),s={execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,t),i}executeNext(t){const{buffers:e,queues:i}=this,s=e[t],r=i[t];if(r.length){const n=r[0];try{n.execute()}catch(a){H.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),n.onError(a),s!=null&&s.updating||(r.shift(),this.executeNext(t))}}}shiftAndExecuteNext(t){this.queues[t].shift(),this.executeNext(t)}current(t){return this.queues[t][0]}}const rn=Vi(),sn=/([ha]vc.)(?:\.[^.,]+)+/;class $c{constructor(t){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:i}=this;H.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(D.MEDIA_ATTACHED,{media:e})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{H.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{H.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:i}=this;e&&e.src!==i&&H.error(`Media element src was set while attaching MediaSource (${i} > ${e.src})`)},this.hls=t,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.BUFFER_RESET,this.onBufferReset,this),t.on(D.BUFFER_APPENDING,this.onBufferAppending,this),t.on(D.BUFFER_CODECS,this.onBufferCodecs,this),t.on(D.BUFFER_EOS,this.onBufferEos,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(D.FRAG_PARSED,this.onFragParsed,this),t.on(D.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.BUFFER_RESET,this.onBufferReset,this),t.off(D.BUFFER_APPENDING,this.onBufferAppending,this),t.off(D.BUFFER_CODECS,this.onBufferCodecs,this),t.off(D.BUFFER_EOS,this.onBufferEos,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(D.FRAG_PARSED,this.onFragParsed,this),t.off(D.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Vc(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){let i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,H.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(t,e){const i=this.media=e.media;if(i&&rn){const s=this.mediaSource=new rn;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(s),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:t,mediaSource:e,_objectUrl:i}=this;if(e){if(H.log("[buffer-controller]: media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(s){H.warn(`[buffer-controller]: onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(t.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):H.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(D.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(t=>{const e=this.sourceBuffer[t];try{e&&(this.removeBufferListeners(t),this.mediaSource&&this.mediaSource.removeSourceBuffer(e),this.sourceBuffer[t]=void 0)}catch(i){H.warn(`[buffer-controller]: Failed to reset the ${t} buffer`,i)}}),this._initSourceBuffer()}onBufferCodecs(t,e){const i=this.getSourceBufferTypes().length;Object.keys(e).forEach(s=>{if(i){const r=this.tracks[s];if(r&&typeof r.buffer.changeType=="function"){const{id:n,codec:a,levelCodec:l,container:o,metadata:c}=e[s],u=(r.levelCodec||r.codec).replace(sn,"$1"),h=(l||a).replace(sn,"$1");if(u!==h){const p=`${o};codecs=${l||a}`;this.appendChangeType(s,p),H.log(`[buffer-controller]: switching codec ${u} to ${h}`),this.tracks[s]={buffer:r.buffer,codec:a,container:o,levelCodec:l,metadata:c,id:n}}}}else this.pendingTracks[s]=e[s]}),!i&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(t,e){const{operationQueue:i}=this,s={execute:()=>{const r=this.sourceBuffer[t];r&&(H.log(`[buffer-controller]: changing ${t} sourceBuffer type to ${e}`),r.changeType(e)),i.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:r=>{H.warn(`[buffer-controller]: Failed to change ${t} SourceBuffer type`,r)}};i.append(s,t)}onBufferAppending(t,e){const{hls:i,operationQueue:s,tracks:r}=this,{data:n,type:a,frag:l,part:o,chunkMeta:c}=e,u=c.buffering[a],h=self.performance.now();u.start=h;const p=l.stats.buffering,m=o?o.stats.buffering:null;p.start===0&&(p.start=h),m&&m.start===0&&(m.start=h);const v=r.audio;let E=!1;a==="audio"&&(v==null?void 0:v.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const C=l.start,N={execute:()=>{if(u.executeStart=self.performance.now(),E){const R=this.sourceBuffer[a];if(R){const x=C-R.timestampOffset;Math.abs(x)>=.1&&(H.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${C} (delta: ${x}) sn: ${l.sn})`),R.timestampOffset=C)}}this.appendExecutor(n,a)},onStart:()=>{},onComplete:()=>{const R=self.performance.now();u.executeEnd=u.end=R,p.first===0&&(p.first=R),m&&m.first===0&&(m.first=R);const{sourceBuffer:x}=this,P={};for(const M in x)P[M]=Gt.getBuffered(x[M]);this.appendError=0,this.hls.trigger(D.BUFFER_APPENDED,{type:a,frag:l,part:o,chunkMeta:c,parent:l.type,timeRanges:P})},onError:R=>{H.error(`[buffer-controller]: Error encountered while trying to append to the ${a} SourceBuffer`,R);const x={type:xt.MEDIA_ERROR,parent:l.type,details:J.BUFFER_APPEND_ERROR,frag:l,part:o,chunkMeta:c,error:R,err:R,fatal:!1};R.code===DOMException.QUOTA_EXCEEDED_ERR?x.details=J.BUFFER_FULL_ERROR:(this.appendError++,x.details=J.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(H.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),x.fatal=!0)),i.trigger(D.ERROR,x)}};s.append(N,a)}onBufferFlushing(t,e){const{operationQueue:i}=this,s=r=>({execute:this.removeExecutor.bind(this,r,e.startOffset,e.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(D.BUFFER_FLUSHED,{type:r})},onError:n=>{H.warn(`[buffer-controller]: Failed to remove from ${r} SourceBuffer`,n)}});e.type?i.append(s(e.type),e.type):this.getSourceBufferTypes().forEach(r=>{i.append(s(r),r)})}onFragParsed(t,e){const{frag:i,part:s}=e,r=[],n=s?s.elementaryStreams:i.elementaryStreams;n[jt.AUDIOVIDEO]?r.push("audiovideo"):(n[jt.AUDIO]&&r.push("audio"),n[jt.VIDEO]&&r.push("video"));const a=()=>{const l=self.performance.now();i.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const o=s?s.stats:i.stats;this.hls.trigger(D.FRAG_BUFFERED,{frag:i,part:s,stats:o,id:i.type})};r.length===0&&H.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(a,r)}onFragChanged(t,e){this.flushBackBuffer()}onBufferEos(t,e){this.getSourceBufferTypes().reduce((s,r)=>{const n=this.sourceBuffer[r];return n&&(!e.type||e.type===r)&&(n.ending=!0,n.ended||(n.ended=!0,H.log(`[buffer-controller]: ${r} sourceBuffer now EOS`))),s&&!!(!n||n.ended)},!0)&&(H.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(r=>{const n=this.sourceBuffer[r];n&&(n.ending=!1)});const{mediaSource:s}=this;if(!s||s.readyState!=="open"){s&&H.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`);return}H.log("[buffer-controller]: Calling mediaSource.endOfStream()"),s.endOfStream()}))}onLevelUpdated(t,{details:e}){!e.fragments.length||(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:t,details:e,media:i,sourceBuffer:s}=this;if(!i||e===null)return;const r=this.getSourceBufferTypes();if(!r.length)return;const n=e.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!mt(n)||n<0)return;const a=i.currentTime,l=e.levelTargetDuration,o=Math.max(n,l),c=Math.floor(a/l)*l-o;r.forEach(u=>{const h=s[u];if(h){const p=Gt.getBuffered(h);if(p.length>0&&c>p.start(0)){if(t.trigger(D.BACK_BUFFER_REACHED,{bufferEnd:c}),e.live)t.trigger(D.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(h.ended&&p.end(p.length-1)-a<l*2){H.info(`[buffer-controller]: Cannot flush ${u} back buffer while SourceBuffer is in ended state`);return}t.trigger(D.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:u})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:t,hls:e,media:i,mediaSource:s}=this,r=t.fragments[0].start+t.totalduration,n=i.duration,a=mt(s.duration)?s.duration:0;t.live&&e.config.liveDurationInfinity?(H.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(t)):(r>a&&r>n||!mt(n))&&(H.log(`[buffer-controller]: Updating Media Source duration to ${r.toFixed(3)}`),s.duration=r)}updateSeekableRange(t){const e=this.mediaSource,i=t.fragments;if(i.length&&t.live&&e!=null&&e.setLiveSeekableRange){const r=Math.max(0,i[0].start),n=Math.max(r,r+t.totalduration);e.setLiveSeekableRange(r,n)}}checkPendingTracks(){const{bufferCodecEventsExpected:t,operationQueue:e,pendingTracks:i}=this,s=Object.keys(i).length;if(s&&!t||s===2){this.createSourceBuffers(i),this.pendingTracks={};const r=this.getSourceBufferTypes();if(r.length)this.hls.trigger(D.BUFFER_CREATED,{tracks:this.tracks}),r.forEach(n=>{e.executeNext(n)});else{const n=new Error("could not create source buffer for media codec(s)");this.hls.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:n,reason:n.message})}}}createSourceBuffers(t){const{sourceBuffer:e,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const s in t)if(!e[s]){const r=t[s];if(!r)throw Error(`source buffer exists for track ${s}, however track does not`);const n=r.levelCodec||r.codec,a=`${r.container};codecs=${n}`;H.log(`[buffer-controller]: creating sourceBuffer(${a})`);try{const l=e[s]=i.addSourceBuffer(a),o=s;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[s]={buffer:l,codec:n,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id}}catch(l){H.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:a})}}}_onSBUpdateStart(t){const{operationQueue:e}=this;e.current(t).onStart()}_onSBUpdateEnd(t){const{operationQueue:e}=this;e.current(t).onComplete(),e.shiftAndExecuteNext(t)}_onSBUpdateError(t,e){const i=new Error(`${t} SourceBuffer error`);H.error(`[buffer-controller]: ${i}`,e),this.hls.trigger(D.ERROR,{type:xt.MEDIA_ERROR,details:J.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const s=this.operationQueue.current(t);s&&s.onError(e)}removeExecutor(t,e,i){const{media:s,mediaSource:r,operationQueue:n,sourceBuffer:a}=this,l=a[t];if(!s||!r||!l){H.warn(`[buffer-controller]: Attempting to remove from the ${t} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(t);return}const o=mt(s.duration)?s.duration:1/0,c=mt(r.duration)?r.duration:1/0,u=Math.max(0,e),h=Math.min(i,o,c);h>u&&!l.ending?(l.ended=!1,H.log(`[buffer-controller]: Removing [${u},${h}] from the ${t} SourceBuffer`),l.remove(u,h)):n.shiftAndExecuteNext(t)}appendExecutor(t,e){const{operationQueue:i,sourceBuffer:s}=this,r=s[e];if(!r){H.warn(`[buffer-controller]: Attempting to append to the ${e} SourceBuffer, but it does not exist`),i.shiftAndExecuteNext(e);return}r.ended=!1,r.appendBuffer(t)}blockBuffers(t,e=this.getSourceBufferTypes()){if(!e.length){H.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}const{operationQueue:i}=this,s=e.map(r=>i.appendBlocker(r));Promise.all(s).then(()=>{t(),e.forEach(r=>{const n=this.sourceBuffer[r];n!=null&&n.updating||i.shiftAndExecuteNext(r)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(t,e,i){const s=this.sourceBuffer[t];if(!s)return;const r=i.bind(this,t);this.listeners[t].push({event:e,listener:r}),s.addEventListener(e,r)}removeBufferListeners(t){const e=this.sourceBuffer[t];!e||this.listeners[t].forEach(i=>{e.removeEventListener(i.event,i.listener)})}}const nn={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},oa=function(t){let e=t;return nn.hasOwnProperty(t)&&(e=nn[t]),String.fromCharCode(e)},Ee=15,Be=100,zc={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Hc={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Yc={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Kc={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Wc=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class qc{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const i=typeof e=="function"?e():e;H.log(`${this.time} [${t}] ${i}`)}}}const Ze=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].toString(16));return e};class la{constructor(t,e,i,s,r){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=s||"black",this.flash=r||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Qc{constructor(t,e,i,s,r,n){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new la(e,i,s,r,n)}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Xc{constructor(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<Be;e++)this.chars.push(new Qc);this.logger=t,this.pos=0,this.currPenState=new la}equals(t){let e=!0;for(let i=0;i<Be;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e}copy(t){for(let e=0;e<Be;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<Be;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Be&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Be)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=oa(t);if(this.pos>=Be){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<Be;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<Be;i++){const s=this.chars[i].uchar;s!==" "&&(e=!1),t.push(s)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class Er{constructor(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let e=0;e<Ee;e++)this.rows.push(new Xc(t));this.logger=t,this.currRow=Ee-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let t=0;t<Ee;t++)this.rows[t].clear();this.currRow=Ee-1}equals(t){let e=!0;for(let i=0;i<Ee;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let e=0;e<Ee;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<Ee;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+JSON.stringify(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let a=0;a<Ee;a++)this.rows[a].clear();const r=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const a=n.rows[r].cueStartTime,l=this.logger.time;if(a&&l!==null&&a<l)for(let o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(n.rows[r+o])}}this.currRow=e;const i=this.rows[this.currRow];if(t.indent!==null){const r=t.indent,n=Math.max(r-1,0);i.setCursor(t.indent),t.color=i.chars[n].penState.foreground}const s={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let i="",s=-1;for(let r=0;r<Ee;r++){const n=this.rows[r].getTextString();n&&(s=r+1,t?e.push("Row "+s+": '"+n+"'"):e.push(n.trim()))}return e.length>0&&(t?i="["+e.join(" | ")+"]":i=e.join(`
`)),i}getTextAndFormat(){return this.rows}}class an{constructor(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Er(i),this.nonDisplayedMemory=new Er(i),this.lastOutputScreen=new Er(i),this.currRollUpRow=this.displayedMemory.rows[Ee-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ee-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const i=Math.floor(t/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=s[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class on{constructor(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const s=new qc;this.channels=[null,new an(t,e,s),new an(t+1,i,s)],this.cmdHistory=cn(),this.logger=s}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){let i,s,r,n=!1;this.logger.time=t;for(let a=0;a<e.length;a+=2)if(s=e[a]&127,r=e[a+1]&127,!(s===0&&r===0)){if(this.logger.log(3,"["+Ze([e[a],e[a+1]])+"] -> ("+Ze([s,r])+")"),i=this.parseCmd(s,r),i||(i=this.parseMidrow(s,r)),i||(i=this.parsePAC(s,r)),i||(i=this.parseBackgroundAttributes(s,r)),!i&&(n=this.parseChars(s,r),n)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(n):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!i&&!n&&this.logger.log(2,"Couldn't parse cleaned data "+Ze([s,r])+" orig: "+Ze([e[a],e[a+1]]))}}parseCmd(t,e){const{cmdHistory:i}=this,s=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,r=(t===23||t===31)&&e>=33&&e<=35;if(!(s||r))return!1;if(ln(t,e,i))return ai(null,null,i),this.logger.log(3,"Repeated command ("+Ze([t,e])+") is dropped"),!0;const n=t===20||t===21||t===23?1:2,a=this.channels[n];return t===20||t===21||t===28||t===29?e===32?a.ccRCL():e===33?a.ccBS():e===34?a.ccAOF():e===35?a.ccAON():e===36?a.ccDER():e===37?a.ccRU(2):e===38?a.ccRU(3):e===39?a.ccRU(4):e===40?a.ccFON():e===41?a.ccRDC():e===42?a.ccTR():e===43?a.ccRTD():e===44?a.ccEDM():e===45?a.ccCR():e===46?a.ccENM():e===47&&a.ccEOC():a.ccTO(e-32),ai(t,e,i),this.currentChannel=n,!0}parseMidrow(t,e){let i=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(e),this.logger.log(3,"MIDROW ("+Ze([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let i;const s=this.cmdHistory,r=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,n=(t===16||t===24)&&e>=64&&e<=95;if(!(r||n))return!1;if(ln(t,e,s))return ai(null,null,s),!0;const a=t<=23?1:2;e>=64&&e<=95?i=a===1?zc[t]:Yc[t]:i=a===1?Hc[t]:Kc[t];const l=this.channels[a];return l?(l.setPAC(this.interpretPAC(i,e)),ai(t,e,s),this.currentChannel=a,!0):!1}interpretPAC(t,e){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?i=e-96:i=e-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(t,e){let i,s=null,r=null;if(t>=25?(i=2,r=t-8):(i=1,r=t),r>=17&&r<=19){let n;r===17?n=e+80:r===18?n=e+112:n=e+144,this.logger.log(2,"Special char '"+oa(n)+"' in channel "+i),s=[n]}else t>=32&&t<=127&&(s=e===0?[t]:[t,e]);if(s){const n=Ze(s);this.logger.log(3,"Char codes =  "+n.join(",")),ai(t,e,this.cmdHistory)}return s}parseBackgroundAttributes(t,e){const i=(t===16||t===24)&&e>=32&&e<=47,s=(t===23||t===31)&&e>=45&&e<=47;if(!(i||s))return!1;let r;const n={};t===16||t===24?(r=Math.floor((e-32)/2),n.background=Wc[r],e%2===1&&(n.background=n.background+"_semi")):e===45?n.background="transparent":(n.foreground="black",e===47&&(n.underline=!0));const a=t<=23?1:2;return this.channels[a].setBkgData(n),ai(t,e,this.cmdHistory),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}this.cmdHistory=cn()}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const i=this.channels[e];i&&i.cueSplitAtTime(t)}}}function ai(d,t,e){e.a=d,e.b=t}function ln(d,t,e){return e.a===d&&e.b===t}function cn(){return{a:null,b:null}}class Di{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,i){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Qr=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;const d=["","lr","rl"],t=["start","middle","end","left","right"];function e(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const o=l.toLowerCase();return~a.indexOf(o)?o:!1}function i(a){return e(d,a)}function s(a){return e(t,a)}function r(a,...l){let o=1;for(;o<arguments.length;o++){const c=arguments[o];for(const u in c)a[u]=c[u]}return a}function n(a,l,o){const c=this,u={enumerable:!0};c.hasBeenReset=!1;let h="",p=!1,m=a,v=l,E=o,C=null,N="",R=!0,x="auto",P="start",M=50,b="middle",T=50,I="middle";Object.defineProperty(c,"id",r({},u,{get:function(){return h},set:function(A){h=""+A}})),Object.defineProperty(c,"pauseOnExit",r({},u,{get:function(){return p},set:function(A){p=!!A}})),Object.defineProperty(c,"startTime",r({},u,{get:function(){return m},set:function(A){if(typeof A!="number")throw new TypeError("Start time must be set to a number.");m=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",r({},u,{get:function(){return v},set:function(A){if(typeof A!="number")throw new TypeError("End time must be set to a number.");v=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",r({},u,{get:function(){return E},set:function(A){E=""+A,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",r({},u,{get:function(){return C},set:function(A){C=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",r({},u,{get:function(){return N},set:function(A){const U=i(A);if(U===!1)throw new SyntaxError("An invalid or illegal string was specified.");N=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",r({},u,{get:function(){return R},set:function(A){R=!!A,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",r({},u,{get:function(){return x},set:function(A){if(typeof A!="number"&&A!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");x=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",r({},u,{get:function(){return P},set:function(A){const U=s(A);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");P=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",r({},u,{get:function(){return M},set:function(A){if(A<0||A>100)throw new Error("Position must be between 0 and 100.");M=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",r({},u,{get:function(){return b},set:function(A){const U=s(A);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");b=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",r({},u,{get:function(){return T},set:function(A){if(A<0||A>100)throw new Error("Size must be between 0 and 100.");T=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",r({},u,{get:function(){return I},set:function(A){const U=s(A);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");I=U,this.hasBeenReset=!0}})),c.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class Zc{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function ca(d){function t(i,s,r,n){return(i|0)*3600+(s|0)*60+(r|0)+parseFloat(n||0)}const e=d.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class Jc{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,i){for(let s=0;s<i.length;++s)if(e===i[s]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1}}function da(d,t,e,i){const s=i?d.split(i):[d];for(const r in s){if(typeof s[r]!="string")continue;const n=s[r].split(e);if(n.length!==2)continue;const a=n[0],l=n[1];t(a,l)}}const Or=new Qr(0,0,""),Ci=Or.align==="middle"?"middle":"center";function td(d,t,e){const i=d;function s(){const a=ca(d);if(a===null)throw new Error("Malformed timestamp: "+i);return d=d.replace(/^[^\sa-zA-Z-]+/,""),a}function r(a,l){const o=new Jc;da(a,function(h,p){let m;switch(h){case"region":for(let v=e.length-1;v>=0;v--)if(e[v].id===p){o.set(h,e[v].region);break}break;case"vertical":o.alt(h,p,["rl","lr"]);break;case"line":m=p.split(","),o.integer(h,m[0]),o.percent(h,m[0])&&o.set("snapToLines",!1),o.alt(h,m[0],["auto"]),m.length===2&&o.alt("lineAlign",m[1],["start",Ci,"end"]);break;case"position":m=p.split(","),o.percent(h,m[0]),m.length===2&&o.alt("positionAlign",m[1],["start",Ci,"end","line-left","line-right","auto"]);break;case"size":o.percent(h,p);break;case"align":o.alt(h,p,["start",Ci,"end","left","right"]);break}},/:/,/\s/),l.region=o.get("region",null),l.vertical=o.get("vertical","");let c=o.get("line","auto");c==="auto"&&Or.line===-1&&(c=-1),l.line=c,l.lineAlign=o.get("lineAlign","start"),l.snapToLines=o.get("snapToLines",!0),l.size=o.get("size",100),l.align=o.get("align",Ci);let u=o.get("position","auto");u==="auto"&&Or.position===50&&(u=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=u}function n(){d=d.replace(/^\s+/,"")}if(n(),t.startTime=s(),n(),d.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);d=d.slice(3),n(),t.endTime=s(),n(),r(d,t)}function ua(d){return d.replace(/<br(?: \/)?>/gi,`
`)}class ed{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Zc,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function i(){let r=e.buffer,n=0;for(r=ua(r);n<r.length&&r[n]!=="\r"&&r[n]!==`
`;)++n;const a=r.slice(0,n);return r[n]==="\r"&&++n,r[n]===`
`&&++n,e.buffer=r.slice(n),a}function s(r){da(r,function(n,a){},/:/)}try{let r="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;r=i();const a=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let n=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(n?n=!1:r=i(),e.state){case"HEADER":/:/.test(r)?s(r):r||(e.state="ID");continue;case"NOTE":r||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){e.state="NOTE";break}if(!r)continue;if(e.cue=new Qr(0,0,""),e.state="CUE",r.indexOf("-->")===-1){e.cue.id=r;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{td(r,e.cue,e.regionList)}catch(a){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const a=r.indexOf("-->")!==-1;if(!r||a&&(n=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=r}continue;case"BADCUE":r||(e.state="ID")}}}catch(r){e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const id=/\r\n|\n\r|\n|\r/g,Sr=function(t,e,i=0){return t.slice(i,i+e.length)===e},rd=function(t){let e=parseInt(t.slice(-3));const i=parseInt(t.slice(-6,-4)),s=parseInt(t.slice(-9,-7)),r=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!mt(e)||!mt(i)||!mt(s)||!mt(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*i,e+=60*1e3*s,e+=60*60*1e3*r,e},xr=function(t){let e=5381,i=t.length;for(;i;)e=e*33^t.charCodeAt(--i);return(e>>>0).toString()};function Xr(d,t,e){return xr(d.toString())+xr(t.toString())+xr(e)}const sd=function(t,e,i){let s=t[e],r=t[s.prevCC];if(!r||!r.new&&s.new){t.ccOffset=t.presentationOffset=s.start,s.new=!1;return}for(;(n=r)!=null&&n.new;){var n;t.ccOffset+=s.start-r.start,s.new=!1,s=r,r=t[s.prevCC]}t.presentationOffset=i};function nd(d,t,e,i,s,r,n){const a=new ed,l=Ie(new Uint8Array(d)).trim().replace(id,`
`).split(`
`),o=[],c=t?gc(t.baseTime,t.timescale):0;let u="00:00.000",h=0,p=0,m,v=!0;a.oncue=function(E){const C=e[i];let N=e.ccOffset;const R=(h-c)/9e4;if(C!=null&&C.new&&(p!==void 0?N=e.ccOffset=C.start:sd(e,i,R)),R){if(!t){m=new Error("Missing initPTS for VTT MPEGTS");return}N=R-e.presentationOffset}const x=E.endTime-E.startTime,P=ge((E.startTime+N-p)*9e4,s*9e4)/9e4;E.startTime=Math.max(P,0),E.endTime=Math.max(P+x,0);const M=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(M)),E.id||(E.id=Xr(E.startTime,E.endTime,M)),E.endTime>0&&o.push(E)},a.onparsingerror=function(E){m=E},a.onflush=function(){if(m){n(m);return}r(o)},l.forEach(E=>{if(v)if(Sr(E,"X-TIMESTAMP-MAP=")){v=!1,E.slice(16).split(",").forEach(C=>{Sr(C,"LOCAL:")?u=C.slice(6):Sr(C,"MPEGTS:")&&(h=parseInt(C.slice(7)))});try{p=rd(u)/1e3}catch(C){m=C}return}else E===""&&(v=!1);a.parse(E+`
`)}),a.flush()}const Tr="stpp.ttml.im1t",ha=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,fa=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,ad={left:"start",center:"center",right:"end",start:"start",end:"end"};function dn(d,t,e,i){const s=Pt(new Uint8Array(d),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const r=s.map(a=>Ie(a)),n=mc(t.baseTime,1,t.timescale);try{r.forEach(a=>e(od(a,n)))}catch(a){i(a)}}function od(d,t){const s=new DOMParser().parseFromString(d,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(r).reduce((u,h)=>(u[h]=s.getAttribute(`ttp:${h}`)||r[h],u),{}),a=s.getAttribute("xml:space")!=="preserve",l=un(br(s,"styling","style")),o=un(br(s,"layout","region")),c=br(s,"body","[begin]");return[].map.call(c,u=>{const h=pa(u,a);if(!h||!u.hasAttribute("begin"))return null;const p=Lr(u.getAttribute("begin"),n),m=Lr(u.getAttribute("dur"),n);let v=Lr(u.getAttribute("end"),n);if(p===null)throw hn(u);if(v===null){if(m===null)throw hn(u);v=p+m}const E=new Qr(p-t,v-t,h);E.id=Xr(E.startTime,E.endTime,E.text);const C=o[u.getAttribute("region")],N=l[u.getAttribute("style")],R=ld(C,N,l),{textAlign:x}=R;if(x){const P=ad[x];P&&(E.lineAlign=P),E.align=x}return Zt(E,R),E}).filter(u=>u!==null)}function br(d,t,e){const i=d.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(e)):[]}function un(d){return d.reduce((t,e)=>{const i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function pa(d,t){return[].slice.call(d.childNodes).reduce((e,i,s)=>{var r;return i.nodeName==="br"&&s?e+`
`:(r=i.childNodes)!=null&&r.length?pa(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent},"")}function ld(d,t,e){const i="http://www.w3.org/ns/ttml#styling";let s=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],n=d!=null&&d.hasAttribute("style")?d.getAttribute("style"):null;return n&&e.hasOwnProperty(n)&&(s=e[n]),r.reduce((a,l)=>{const o=Ar(t,i,l)||Ar(d,i,l)||Ar(s,i,l);return o&&(a[l]=o),a},{})}function Ar(d,t,e){return d&&d.hasAttributeNS(t,e)?d.getAttributeNS(t,e):null}function hn(d){return new Error(`Could not parse ttml timestamp ${d}`)}function Lr(d,t){if(!d)return null;let e=ca(d);return e===null&&(ha.test(d)?e=cd(d,t):fa.test(d)&&(e=dd(d,t))),e}function cd(d,t){const e=ha.exec(d),i=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+i/t.frameRate}function dd(d,t){const e=fa.exec(d),i=Number(e[1]);switch(e[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class ud{constructor(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=fn(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new Di(this,"textTrack1"),i=new Di(this,"textTrack2"),s=new Di(this,"textTrack3"),r=new Di(this,"textTrack4");this.cea608Parser1=new on(1,e,i),this.cea608Parser2=new on(3,s,r)}t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(D.FRAG_LOADING,this.onFragLoading,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(D.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(D.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(D.FRAG_LOADING,this.onFragLoading,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(D.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(D.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(t,e,i,s,r){let n=!1;for(let a=r.length;a--;){const l=r[a],o=fd(l[0],l[1],e,i);if(o>=0&&(l[0]=Math.min(l[0],e),l[1]=Math.max(l[1],i),n=!0,o/(i-e)>.5))return}if(n||r.push([e,i]),this.config.renderTextTracksNatively){const a=this.captionsTracks[t];this.Cues.newCue(a,e,i,s)}else{const a=this.Cues.newCue(null,e,i,s);this.hls.trigger(D.CUES_PARSED,{type:"captions",cues:a,track:t})}}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:r}){const{unparsedVttFrags:n}=this;i==="main"&&(this.initPTS[e.cc]={baseTime:s,timescale:r}),n.length&&(this.unparsedVttFrags=[],n.forEach(a=>{this.onFragLoaded(D.FRAG_LOADED,a)}))}getExistingTrack(t){const{media:e}=this;if(e)for(let i=0;i<e.textTracks.length;i++){const s=e.textTracks[i];if(s[t])return s}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:i,media:s}=this,{label:r,languageCode:n}=e[t],a=this.getExistingTrack(t);if(a)i[t]=a,oi(i[t]),Nn(i[t],s);else{const l=this.createTextTrack("captions",r,n);l&&(l[t]=!0,i[t]=l)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const i=e.label,s={_id:t,label:i,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=s,this.hls.trigger(D.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(t,e,i){const s=this.media;if(!!s)return s.addTextTrack(t,e,i)}onMediaAttaching(t,e){this.media=e.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:t}=this;Object.keys(t).forEach(e=>{oi(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=fn(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)oi(e[i])}onSubtitleTracksUpdated(t,e){const i=e.subtitleTracks||[],s=i.some(r=>r.textCodec===Tr);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(aa(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const n=this.media?this.media.textTracks:null;this.tracks.forEach((a,l)=>{let o;if(n&&l<n.length){let c=null;for(let u=0;u<n.length;u++)if(hd(n[u],a)){c=n[u];break}c&&(o=c)}if(o)oi(o);else{const c=this._captionsOrSubtitlesFromCharacteristics(a);o=this.createTextTrack(c,a.name,a.lang),o&&(o.mode="disabled")}o&&(o.groupId=a.groupId,this.textTracks.push(o))})}else if(this.tracks.length){const n=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(D.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n})}}}_captionsOrSubtitlesFromCharacteristics(t){if(t.attrs.CHARACTERISTICS){const e=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(e&&i)return"captions"}return"subtitles"}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const r=`textTrack${s[1]}`,n=this.captionsProperties[r];!n||(n.label=i.name,i.lang&&(n.languageCode=i.lang),n.media=i)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){const{cea608Parser1:i,cea608Parser2:s,lastSn:r,lastPartIndex:n}=this;if(!(!this.enabled||!(i&&s))&&e.frag.type===Tt.MAIN){var a,l;const o=e.frag.sn,c=(a=e==null||(l=e.part)==null?void 0:l.index)!=null?a:-1;o===r+1||o===r&&c===n+1||(i.reset(),s.reset()),this.lastSn=o,this.lastPartIndex=c}}onFragLoaded(t,e){const{frag:i,payload:s}=e;if(i.type===Tt.SUBTITLE)if(s.byteLength){const r=i.decryptdata,n="stats"in e;if(r==null||!r.encrypted||n){const a=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),a&&a.textCodec===Tr?this._parseIMSC1(i,s):this._parseVTTs(e)}}else this.hls.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const i=this.hls;dn(e,this.initPTS[t.cc],s=>{this._appendCues(s,t.level),i.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},s=>{H.log(`Failed to parse IMSC1: ${s}`),i.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:s})})}_parseVTTs(t){var e;const{frag:i,payload:s}=t,{initPTS:r,unparsedVttFrags:n}=this,a=r.length-1;if(!r[i.cc]&&a===-1){n.push(t);return}const l=this.hls,o=(e=i.initSegment)!=null&&e.data?ei(i.initSegment.data,new Uint8Array(s)):s;nd(o,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,c=>{this._appendCues(c,i.level),l.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},c=>{const u=c.message==="Missing initPTS for VTT MPEGTS";u?n.push(t):this._fallbackToIMSC1(i,s),H.log(`Failed to parse VTT cue: ${c}`),!(u&&a>i.cc)&&l.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})}_fallbackToIMSC1(t,e){const i=this.tracks[t.level];i.textCodec||dn(e,this.initPTS[t.cc],()=>{i.textCodec=Tr,this._parseIMSC1(t,e)},()=>{i.textCodec="wvtt"})}_appendCues(t,e){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[e];if(!s||s.mode==="disabled")return;t.forEach(r=>Fn(s,r))}else{const s=this.tracks[e];if(!s)return;const r=s.default?"default":"subtitles"+e;i.trigger(D.CUES_PARSED,{type:"subtitles",cues:t,track:r})}}onFragDecrypted(t,e){const{frag:i}=e;i.type===Tt.SUBTITLE&&this.onFragLoaded(D.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){const{cea608Parser1:i,cea608Parser2:s}=this;if(!this.enabled||!(i&&s))return;const{frag:r,samples:n}=e;if(!(r.type===Tt.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let a=0;a<n.length;a++){const l=n[a].bytes;if(l){const o=this.extractCea608Data(l);i.addData(n[a].pts,o[0]),s.addData(n[a].pts,o[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:i,endOffsetSubtitles:s,type:r}){const{media:n}=this;if(!(!n||n.currentTime<i)){if(!r||r==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Rr(a[l],e,i))}if(this.config.renderTextTracksNatively&&e===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Rr(a[l],e,s))}}}extractCea608Data(t){const e=[[],[]],i=t[0]&31;let s=2;for(let r=0;r<i;r++){const n=t[s++],a=127&t[s++],l=127&t[s++];if(a===0&&l===0)continue;if((4&n)!==0){const c=3&n;(c===0||c===1)&&(e[c].push(a),e[c].push(l))}}return e}}function hd(d,t){return!!d&&d.label===t.name&&!(d.textTrack1||d.textTrack2)}function fd(d,t,e,i){return Math.min(t,i)-Math.max(d,e)}function fn(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Zr{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(D.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.BUFFER_CODECS,this.onBufferCodecs,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(D.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.BUFFER_CODECS,this.onBufferCodecs,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const i=this.hls.levels[e.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null}onManifestParsed(t,e){const i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const t=this.hls.levels;if(t.length){const e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const i=e.filter((s,r)=>this.isLevelAllowed(s)&&r<=t);return this.clientRect=null,Zr.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,!e.width&&!e.height&&(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(e){}return t}isLevelAllowed(t){return!this.restrictedLevels.some(i=>t.bitrate===i.bitrate&&t.width===i.width&&t.height===i.height)}static getMaxLevelByMediaSize(t,e,i){if(!(t!=null&&t.length))return-1;const s=(n,a)=>a?n.width!==a.width||n.height!==a.height:!0;let r=t.length-1;for(let n=0;n<t.length;n+=1){const a=t[n];if((a.width>=e||a.height>=i)&&s(a,t[n+1])){r=n;break}}return r}}class pd{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(t,e,i){const s=performance.now();if(e){if(this.lastTime){const r=s-this.lastTime,n=i-this.lastDroppedFrames,a=e-this.lastDecodedFrames,l=1e3*n/r,o=this.hls;if(o.trigger(D.FPS_DROP,{currentDropped:n,currentDecoded:a,totalDroppedFrames:i}),l>0&&n>o.config.fpsDroppedMonitoringThreshold*a){let c=o.currentLevel;H.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(o.autoLevelCapping===-1||o.autoLevelCapping>=c)&&(c=c-1,o.trigger(D.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:o.currentLevel}),o.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}const ki="[eme]";class li{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=li.CDMCleanupPromise?[li.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=H.debug.bind(H,ki),this.log=H.log.bind(H,ki),this.warn=H.warn.bind(H,ki),this.error=H.error.bind(H,ki),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(D.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:i}=this.config,s=e[t];if(s)return s.licenseUrl;if(t===Yt.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:e}=this.config,i=e[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,i=(n,a,l)=>!!n&&l.indexOf(n)===a,s=e.map(n=>n.audioCodec).filter(i),r=e.map(n=>n.videoCodec).filter(i);return s.length+r.length===0&&r.push("avc1.42e01e"),new Promise((n,a)=>{const l=o=>{const c=o.shift();this.getMediaKeysPromise(c,s,r).then(u=>n({keySystem:c,mediaKeys:u})).catch(u=>{o.length?l(o):u instanceof pe?a(u):a(new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_ACCESS,error:u,fatal:!0},u.message))})};l(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return bn===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(t,e)}getMediaKeysPromise(t,e,i){const s=wo(t,e,i,this.config.drmSystemOptions),r=this.keySystemAccessPromises[t];let n=r==null?void 0:r.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(s)}`),n=this.requestMediaKeySystemAccess(t,s);const a=this.keySystemAccessPromises[t]={keySystemAccess:n};return n.catch(l=>{this.log(`Failed to obtain access to key-system "${t}": ${l}`)}),n.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const o=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),a.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${t}"`),o.then(u=>u?this.setMediaKeysServerCertificate(c,t,u):c))),a.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${t}"}: ${c}`)}),a.mediaKeys})}return n.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:i}){this.log(`Creating key-system session "${e}" keyId: ${Ae.hexDump(t.keyId||[])}`);const s=i.createSession(),r={decryptdata:t,keySystem:e,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const i=this.createMediaKeySessionContext(t),s=this.getKeyIdString(e),r="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,r,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return Ae.hexDump(t.keyId)}updateKeySession(t,e){var i;const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Ae.hexDump(((i=t.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${e&&e.byteLength})`),s.update(e)}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((e,i)=>{const s=nr(this.config),r=t.map(xs).filter(n=>!!n&&s.indexOf(n)!==-1);return this.getKeySystemSelectionPromise(r).then(({keySystem:n})=>{const a=Ts(n);a?e(a):i(new Error(`Unable to find format for key-system "${n}"`))}).catch(i)})}loadKey(t){const e=t.keyInfo.decryptdata,i=this.getKeyIdString(e),s=`(keyId: ${i} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${s}`);let r=this.keyIdToKeySessionPromise[i];return r||(r=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(e).then(({keySystem:n,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${s}`),this.attemptSetMediaKeys(n,a).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:n,mediaKeys:a,decryptdata:e}),o="cenc";return this.generateRequestWithPreferredKeySession(l,o,e.pssh,"playlist-key")}))),r.catch(n=>this.handleError(n))),r}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){!this.hls||(this.error(t.message),t instanceof pe?this.hls.trigger(D.ERROR,t.data):this.hls.trigger(D.ERROR,{type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[e];if(!i){const s=xs(t.keyFormat),r=s?[s]:nr(this.config);return this.attemptKeySystemAccess(r)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=nr(this.config)),t.length===0)throw new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:e,initData:i}=t;if(this.debug(`"${t.type}" event: init data type: "${e}"`),i===null)return;let s,r;if(e==="sinf"&&this.config.drmSystems[Yt.FAIRPLAY]){const c=re(new Uint8Array(i));try{const u=Br(JSON.parse(c).sinf),h=kn(new Uint8Array(u));if(!h)return;s=h.subarray(8,24),r=Yt.FAIRPLAY}catch(u){this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const c=Zo(i);if(c===null)return;c.version===0&&c.systemId===Tn.WIDEVINE&&c.data&&(s=c.data.subarray(8,24)),r=Io(c.systemId)}if(!r||!s)return;const n=Ae.hexDump(s),{keyIdToKeySessionPromise:a,mediaKeySessions:l}=this;let o=a[n];for(let c=0;c<l.length;c++){const u=l[c],h=u.decryptdata;if(h.pssh||!h.keyId)continue;const p=Ae.hexDump(h.keyId);if(n===p||h.uri.replace(/-/g,"").indexOf(n)!==-1){o=a[p],delete a[p],h.pssh=new Uint8Array(i),h.keyId=s,o=a[n]=o.then(()=>this.generateRequestWithPreferredKeySession(u,e,i,"encrypted-event-key-match"));break}}o||(o=a[n]=this.getKeySystemSelectionPromise([r]).then(({keySystem:c,mediaKeys:u})=>{var h;this.throwIfDestroyed();const p=new _i("ISO-23001-7",n,(h=Ts(c))!=null?h:"");return p.pssh=new Uint8Array(i),p.keyId=s,this.attemptSetMediaKeys(c,u).then(()=>{this.throwIfDestroyed();const m=this.createMediaKeySessionContext({decryptdata:p,keySystem:c,mediaKeys:u});return this.generateRequestWithPreferredKeySession(m,e,i,"encrypted-event-no-match")})})),o.catch(c=>this.handleError(c))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,e){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>i.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(t,e,i,s){var r,n;const a=(r=this.config.drmSystems)==null||(n=r[t.keySystem])==null?void 0:n.generateRequest;if(a)try{const h=a.call(this.hls,e,i,t);if(!h)throw new Error("Invalid response from configured generateRequest filter");e=h.initDataType,i=t.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(h){var l;if(this.warn(h.message),(l=this.hls)!=null&&l.config.debug)throw h}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);const o=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${s}": ${o} (init data type: ${e} length: ${i?i.byteLength:null})`);const c=new qr;t.mediaKeysSession.onmessage=h=>{const p=t.mediaKeysSession;if(!p){c.emit("error",new Error("invalid state"));return}const{messageType:m,message:v}=h;this.log(`"${m}" message event for session "${p.sessionId}" message size: ${v.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(t,v).catch(E=>{this.handleError(E),c.emit("error",E)}):m==="license-release"?t.keySystem===Yt.FAIRPLAY&&(this.updateKeySession(t,xn("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${m}"`)},t.mediaKeysSession.onkeystatuseschange=h=>{if(!t.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);const m=t.keyStatus;c.emit("keyStatus",m),m==="expired"&&(this.warn(`${t.keySystem} expired for key ${o}`),this.renewKeySession(t))};const u=new Promise((h,p)=>{c.on("error",p),c.on("keyStatus",m=>{m.startsWith("usable")?h():m==="output-restricted"?p(new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?p(new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?p(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return t.mediaKeysSession.generateRequest(e,i).then(()=>{var h;this.log(`Request generated for key-session "${(h=t.mediaKeysSession)==null?void 0:h.sessionId}" keyId: ${o}`)}).catch(h=>{throw new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_SESSION,error:h,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>u).catch(h=>{throw c.removeAllListeners(),this.removeSession(t),h}).then(()=>(c.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((e,i)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${Ae.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Ae.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e})}fetchServerCertificate(t){const e=this.config,i=e.loader,s=new i(e),r=this.getServerCertificateUrl(t);return r?(this.log(`Fetching serverCertificate for "${t}"`),new Promise((n,a)=>{const l={responseType:"arraybuffer",url:r},o=e.certLoadPolicy.default,c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(h,p,m,v)=>{n(h.data)},onError:(h,p,m,v)=>{a(new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:le({url:l.url,data:void 0},h)},`"${t}" certificate request failed (${r}). Status: ${h.code} (${h.text})`))},onTimeout:(h,p,m)=>{a(new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${t}" certificate request timed out (${r})`))},onAbort:(h,p,m)=>{a(new Error("aborted"))}};s.load(l,c,u)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,i){return new Promise((s,r)=>{t.setServerCertificate(i).then(n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${e}"`),s(t)}).catch(n=>{r(new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:n,fatal:!0},n.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(s=>{throw new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}setupLicenseXHR(t,e,i,s){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return r.call(this.hls,t,e,i,s)}).catch(n=>{if(!i.decryptdata)throw n;return t.open("POST",e,!0),r.call(this.hls,t,e,i,s)}).then(n=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:n||s})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,e){const i=this.config.keyLoadPolicy.default;return new Promise((s,r)=>{const n=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${n}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return r(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const o=this.config.licenseResponseCallback;if(o)try{l=o.call(this.hls,a,n,t)}catch(c){this.error(c)}s(l)}else{const l=i.errorRetry,o=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>o||a.status>=400&&a.status<500)r(new pe({type:xt.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${n}). Status: ${a.status} (${a.statusText})`));else{const c=o-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(t,e).then(s,r)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=a,this.setupLicenseXHR(a,n,t,e).then(({xhr:l,licenseChallenge:o})=>{l.send(o)})})}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const i=e.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,e=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},_i.clearKeyUriToKeyIdMap();const i=e.length;li.CDMCleanupPromise=Promise.all(e.map(s=>this.removeSession(s)).concat(t==null?void 0:t.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}. media.src: ${t==null?void 0:t.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}. media.src: ${t==null?void 0:t.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=e.reduce((s,r)=>(s.indexOf(r.keyFormat)===-1&&s.push(r.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:i}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),e.onmessage=null,e.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(t);return s>-1&&this.mediaKeySessions.splice(s,1),e.remove().catch(r=>{this.log(`Could not remove session: ${r}`)}).then(()=>e.close()).catch(r=>{this.log(`Could not close session: ${r}`)})}}}li.CDMCleanupPromise=void 0;class pe extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}const md=1;var ce={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const gd="h";class Ke{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:ce.MANIFEST,su:!this.initialized})}catch(r){H.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=s=>{try{const r=s.frag,n=this.hls.levels[r.level],a=this.getObjectType(r),l={d:r.duration*1e3,ot:a};(a===ce.VIDEO||a===ce.AUDIO||a==ce.MUXED)&&(l.br=n.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(s,l)}catch(r){H.warn("Could not generate segment CMCD data.",r)}},this.hls=t;const e=this.config=t.config,{cmcd:i}=e;i!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||Ke.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}registerListeners(){const t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHED,this.onMediaDetached,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHED,this.onMediaDetached,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var i,s;this.audioBuffer=(i=e.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=e.tracks.video)==null?void 0:s.buffer}createData(){var t;return{v:md,sf:gd,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){Zt(e,this.createData());const i=e.ot===ce.INIT||e.ot===ce.VIDEO||e.ot===ce.MUXED;if(this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering),this.useHeaders){const s=Ke.toHeaders(e);if(!Object.keys(s).length)return;t.headers||(t.headers={}),Zt(t.headers,s)}else{const s=Ke.toQuery(e);if(!s)return;t.url=Ke.appendQueryToUri(t.url,s)}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return ce.TIMED_TEXT;if(t.sn==="initSegment")return ce.INIT;if(e==="audio")return ce.AUDIO;if(e==="main")return this.hls.audioTracks.length?ce.VIDEO:ce.MUXED}getTopBandwidth(t){let e=0,i;const s=this.hls;if(t===ce.AUDIO)i=s.audioTracks;else{const r=s.maxAutoLevel,n=r>-1?r+1:s.levels.length;i=s.levels.slice(0,n)}for(const r of i)r.bitrate>e&&(e=r.bitrate);return e>0?e:NaN}getBufferLength(t){const e=this.hls.media,i=t===ce.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!e?NaN:Gt.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,i=t||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,n,a){e(r),this.loader.load(r,n,a)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,i=t||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,n,a){e(r),this.loader.load(r,n,a)}}}static uuid(){const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}static serialize(t){const e=[],i=o=>!Number.isNaN(o)&&o!=null&&o!==""&&o!==!1,s=o=>Math.round(o),r=o=>s(o/100)*100,a={br:s,d:s,bl:r,dl:r,mtp:r,nor:o=>encodeURIComponent(o),rtp:r,tb:s},l=Object.keys(t||{}).sort();for(const o of l){let c=t[o];if(!i(c)||o==="v"&&c===1||o=="pr"&&c===1)continue;const u=a[o];u&&(c=u(c));const h=typeof c;let p;o==="ot"||o==="sf"||o==="st"?p=`${o}=${c}`:h==="boolean"?p=o:h==="number"?p=`${o}=${c}`:p=`${o}=${JSON.stringify(c)}`,e.push(p)}return e.join(",")}static toHeaders(t){const e=Object.keys(t),i={},s=["Object","Request","Session","Status"],r=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const a of e){const l=n[a]!=null?n[a]:1;r[l][a]=t[a]}for(let a=0;a<r.length;a++){const l=Ke.serialize(r[a]);l&&(i[`CMCD-${s[a]}`]=l)}return i}static toQuery(t){return`CMCD=${encodeURIComponent(Ke.serialize(t))}`}static appendQueryToUri(t,e){if(!e)return t;const i=t.includes("?")?"&":"?";return`${t}${i}${e}`}}const yd=3e5;class _d{constructor(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=H.log.bind(H,"[content-steering]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;!t||(t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const t=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,t)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(i=>i!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:i}=e;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:i}=e;if((i==null?void 0:i.action)===ae.SendAlternateToPenaltyBox&&i.flags===me.MoveAllAlternatesMatchingHost){let s=this.pathwayPriority;const r=this.pathwayId;this.penalizedPathways[r]||(this.penalizedPathways[r]=performance.now()),!s&&this.levels&&(s=this.levels.reduce((n,a)=>(n.indexOf(a.pathwayId)===-1&&n.push(a.pathwayId),n),[])),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==r)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const i=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length?(this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e):t}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this.pathwayPriority=t;let e;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(r=>{s-i[r]>yd&&delete i[r]});for(let r=0;r<t.length;r++){const n=t[r];if(i[n])continue;if(n===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(e=this.getLevelsForPathway(n),e.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,this.hls.trigger(D.LEVELS_UPDATED,{levels:e});const o=this.hls.levels[a];l&&o&&this.levels&&(o.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&o.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${o.bitrate}`),this.hls.nextLoadLevel=a);break}}}clonePathways(t){const e=this.levels;if(!e)return;const i={},s={};t.forEach(r=>{const{ID:n,"BASE-ID":a,"URI-REPLACEMENT":l}=r;if(e.some(c=>c.pathwayId===n))return;const o=this.getLevelsForPathway(a).map(c=>{const u=Zt({},c);u.details=void 0,u.url=ma(c.uri,c.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);const h=new zt(c.attrs);h["PATHWAY-ID"]=n;const p=h.AUDIO&&`${h.AUDIO}_clone_${n}`,m=h.SUBTITLES&&`${h.SUBTITLES}_clone_${n}`;p&&(i[h.AUDIO]=p,h.AUDIO=p),m&&(s[h.SUBTITLES]=m,h.SUBTITLES=m),u.attrs=h;const v=new vi(u);return Bi(v,"audio",p),Bi(v,"text",m),v});e.push(...o),pn(this.audioTracks,i,l,n),pn(this.subtitleTracks,s,l,n)})}loadSteeringManifest(t){const e=this.hls.config,i=e.loader;this.loader&&this.loader.destroy(),this.loader=new i(e);let s;try{s=new self.URL(t)}catch(c){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const r={responseType:"json",url:s.href},n=e.steeringManifestLoadPolicy.default,a=n.errorRetry||n.timeoutRetry||{},l={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(c,u,h,p)=>{this.log(`Loaded steering manifest: "${s}"`);const m=c.data;if(m.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":v,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":C}=m;if(v)try{this.uri=new self.URL(v,s).href}catch(N){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${v}`);return}this.scheduleRefresh(this.uri||h.url),E&&this.clonePathways(E),C&&this.updatePathwayPriority(C)},onError:(c,u,h,p)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${u.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${u.url} no longer available`);return}let m=this.timeToLoad*1e3;if(c.code===429){const v=this.loader;if(typeof(v==null?void 0:v.getResponseHeader)=="function"){const E=v.getResponseHeader("Retry-After");E&&(m=parseFloat(E)*1e3)}this.log(`Steering manifest ${u.url} rate limited`);return}this.scheduleRefresh(this.uri||u.url,m)},onTimeout:(c,u,h)=>{this.log(`Timeout loading steering manifest (${u.url})`),this.scheduleRefresh(this.uri||u.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(r,l,o)}scheduleRefresh(t,e=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(t)},e)}}function pn(d,t,e,i){!d||Object.keys(t).forEach(s=>{const r=d.filter(n=>n.groupId===s).map(n=>{const a=Zt({},n);return a.details=void 0,a.attrs=new zt(a.attrs),a.url=a.attrs.URI=ma(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),a.groupId=a.attrs["GROUP-ID"]=t[s],a.attrs["PATHWAY-ID"]=i,a});d.push(...r)})}function ma(d,t,e,i){const{HOST:s,PARAMS:r,[e]:n}=i;let a;t&&(a=n==null?void 0:n[t],a&&(d=a));const l=new self.URL(d);return s&&!a&&(l.host=s),r&&Object.keys(r).sort().forEach(o=>{o&&l.searchParams.set(o,r[o])}),l.href}const vd=/^age:\s*[\d.]+\s*$/im;class ga{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new ji,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!this.stats.aborted)return r(i,e.url)}).catch(n=>(i.open("GET",e.url,!0),r(i,e.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(i,e,t)}).catch(n=>{this.callbacks.onError({code:i.status,text:n.message},e,i,s)}):this.openAndSendXhr(i,e,t)}openAndSendXhr(t,e,i){t.readyState||t.open("GET",e.url,!0);const s=this.context.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:n}=i.loadPolicy;if(s)for(const a in s)t.setRequestHeader(a,s[a]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),i.timeout=r&&mt(r)?r:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:i}=this;if(!t||!e)return;const s=e.readyState,r=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const n=e.status,a=e.responseType!=="text";if(n>=200&&n<300&&(a&&e.response||e.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=a?e.response:e.responseText,o=e.responseType==="arraybuffer"?l.byteLength:l.length;if(i.loaded=i.total=o,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;const c=this.callbacks.onProgress;if(c&&c(i,t,l,e),!this.callbacks)return;const u={url:e.responseURL,data:l,code:n};this.callbacks.onSuccess(u,i,t,e)}else{const l=r.loadPolicy.errorRetry,o=i.retry;Fi(l,o,!1,n)?this.retry(l):(H.error(`${n} while loading ${t.url}`),this.callbacks.onError({code:n,text:e.statusText},t,e,i))}}}loadtimeout(){var t;const e=(t=this.config)==null?void 0:t.loadPolicy.timeoutRetry,i=this.stats.retry;if(Fi(e,i,!0))this.retry(e);else{H.warn(`timeout while loading ${this.context.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:i}=this;this.retryDelay=jr(t,i.retry),i.retry++,H.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e.url}, retrying ${i.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&vd.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}function Ed(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(d){}return!1}const Sd=/(\d+)-(\d+)\/(\d+)/;class mn{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||Ad,this.controller=new self.AbortController,this.stats=new ji}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const t=this.response;t!=null&&t.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const r=xd(t,this.controller.signal),n=i.onProgress,a=t.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:c}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,r),self.clearTimeout(this.requestTimeout),e.timeout=o&&mt(o)?o:c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,t,this.response)},e.timeout),self.fetch(this.request).then(u=>{this.response=this.loader=u;const h=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,t,this.response)},c-(h-s.loading.start)),!u.ok){const{status:p,statusText:m}=u;throw new Ld(m||"fetch, bad network response",p,u)}return s.loading.first=h,s.total=bd(u.headers)||s.total,n&&mt(e.highWaterMark)?this.loadProgressively(u,s,t,e.highWaterMark,n):a?u.arrayBuffer():t.responseType==="json"?u.json():u.text()}).then(u=>{const{response:h}=this;self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const p=u[l];p&&(s.loaded=s.total=p);const m={url:h.url,data:u,code:h.status};n&&!mt(e.highWaterMark)&&n(s,t,u,h),i.onSuccess(m,s,t,h)}).catch(u=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const h=u&&u.code||0,p=u?u.message:null;i.onError({code:h,text:p},t,u?u.details:null,s)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,i,s=0,r){const n=new na,a=t.body.getReader(),l=()=>a.read().then(o=>{if(o.done)return n.dataLength&&r(e,i,n.flush(),t),Promise.resolve(new ArrayBuffer(0));const c=o.value,u=c.length;return e.loaded+=u,u<s||n.dataLength?(n.push(c),n.dataLength>=s&&r(e,i,n.flush(),t)):r(e,i,c,t),l()}).catch(()=>Promise.reject());return l()}}function xd(d,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(Zt({},d.headers))};return d.rangeEnd&&e.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),e}function Td(d){const t=Sd.exec(d);if(t)return parseInt(t[2])-parseInt(t[1])+1}function bd(d){const t=d.get("Content-Range");if(t){const i=Td(t);if(mt(i))return i}const e=d.get("Content-Length");if(e)return parseInt(e)}function Ad(d,t){return new self.Request(d.url,t)}class Ld extends Error{constructor(t,e,i){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=i}}const Id=/\s/,wd={newCue(d,t,e,i){const s=[];let r,n,a,l,o;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(r=i.rows[h],a=!0,l=0,o="",!r.isEmpty()){var u;for(let v=0;v<r.chars.length;v++)Id.test(r.chars[v].uchar)&&a?l++:(o+=r.chars[v].uchar,a=!1);r.cueStartTime=t,t===e&&(e+=1e-4),l>=16?l--:l++;const p=ua(o.trim()),m=Xr(t,e,p);d!=null&&(u=d.cues)!=null&&u.getCueById(m)||(n=new c(t,e,p),n.id=m,n.line=h+1,n.align="left",n.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(n))}return d&&s.length&&(s.sort((h,p)=>h.line==="auto"||p.line==="auto"?0:h.line>8&&p.line>8?p.line-h.line:h.line-p.line),s.forEach(h=>Fn(d,h))),s}},Rd={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Dd=le(le({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ga,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Pc,bufferController:$c,capLevelController:Zr,errorController:Ll,fpsController:pd,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:bn,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:Rd},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Cd()),{},{subtitleStreamController:Uc,subtitleTrackController:Gc,timelineController:ud,audioStreamController:Nc,audioTrackController:Fc,emeController:li,cmcdController:Ke,contentSteeringController:_d});function Cd(){return{cueHandler:wd,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function kd(d,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const e=Nr(d),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(r=>{const n=`${r==="level"?"playlist":r}LoadPolicy`,a=t[n]===void 0,l=[];s.forEach(o=>{const c=`${r}Loading${o}`,u=t[c];if(u!==void 0&&a){l.push(c);const h=e[n].default;switch(t[n]={default:h},o){case"TimeOut":h.maxLoadTimeMs=u,h.maxTimeToFirstByteMs=u;break;case"MaxRetry":h.errorRetry.maxNumRetry=u,h.timeoutRetry.maxNumRetry=u;break;case"RetryDelay":h.errorRetry.retryDelayMs=u,h.timeoutRetry.retryDelayMs=u;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=u,h.timeoutRetry.maxRetryDelayMs=u;break}}}),l.length&&H.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${n}": ${JSON.stringify(t[n])}`)}),le(le({},e),t)}function Nr(d){return d&&typeof d=="object"?Array.isArray(d)?d.map(Nr):Object.keys(d).reduce((t,e)=>(t[e]=Nr(d[e]),t),{}):d}function Md(d){const t=d.loader;t!==mn&&t!==ga?(H.log("[config]: Custom loader detected, cannot enable progressive streaming"),d.progressive=!1):Ed()&&(d.loader=mn,d.progressive=!0,d.enableSoftwareAES=!0,H.log("[config]: Progressive streaming enabled, using FetchLoader"))}class We{static get version(){return"1.4.14"}static isSupported(){return Hl()}static get Events(){return D}static get ErrorTypes(){return xt}static get ErrorDetails(){return J}static get DefaultConfig(){return We.defaultConfig?We.defaultConfig:Dd}static set DefaultConfig(t){We.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new qr,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,yo(t.debug||!1,"Hls instance");const e=this.config=kd(We.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,e.progressive&&Md(e);const{abrController:i,bufferController:s,capLevelController:r,errorController:n,fpsController:a}=e,l=new n(this),o=this.abrController=new i(this),c=this.bufferController=new s(this),u=this.capLevelController=new r(this),h=new a(this),p=new ol(this),m=new hl(this),v=e.contentSteeringController,E=v?new v(this):null,C=this.levelController=new wl(this,E),N=new Rl(this),R=new Cl(this.config),x=this.streamController=new kc(this,N,R);u.setStreamController(x),h.setStreamController(x);const P=[p,C,x];E&&P.splice(1,0,E),this.networkControllers=P;const M=[o,c,u,h,m,N];this.audioTrackController=this.createController(e.audioTrackController,P);const b=e.audioStreamController;b&&P.push(new b(this,N,R)),this.subtitleTrackController=this.createController(e.subtitleTrackController,P);const T=e.subtitleStreamController;T&&P.push(new T(this,N,R)),this.createController(e.timelineController,M),R.emeController=this.emeController=this.createController(e.emeController,M),this.cmcdController=this.createController(e.cmcdController,M),this.latencyController=this.createController(fl,M),this.coreComponents=M,P.push(l);const I=l.onErrorOut;typeof I=="function"&&this.on(D.ERROR,I,l)}createController(t,e){if(t){const i=new t(this);return e&&e.push(i),i}return null}on(t,e,i=this){this._emitter.on(t,e,i)}once(t,e,i=this){this._emitter.once(t,e,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,i=this,s){this._emitter.off(t,e,i,s)}listeners(t){return this._emitter.listeners(t)}emit(t,e,i){return this._emitter.emit(t,e,i)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(i){H.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(D.ERROR,{type:xt.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){H.log("destroy"),this.trigger(D.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){H.log("attachMedia"),this._media=t,this.trigger(D.MEDIA_ATTACHING,{media:t})}detachMedia(){H.log("detachMedia"),this.trigger(D.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const e=this.media,i=this.url,s=this.url=Fr.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});H.log(`loadSource:${s}`),e&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(D.MANIFEST_LOADING,{url:t})}startLoad(t=-1){H.log(`startLoad(${t})`),this.networkControllers.forEach(e=>{e.startLoad(t)})}stopLoad(){H.log("stopLoad"),this.networkControllers.forEach(t=>{t.stopLoad()})}swapAudioCodec(){H.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){H.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t,e=0){this.levelController.removeLevel(t,e)}get levels(){const t=this.levelController.levels;return t||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){H.log(`set currentLevel:${t}`),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){H.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){H.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){H.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){return this.levelController.startLevel}set startLevel(t){H.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(H.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){Cr.indexOf(t)>-1&&(this._maxHdcpLevel=t)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const i=t.length;for(let s=0;s<i;s++)if(t[s].maxBitrate>=e)return s;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:i}=this;let s;if(e===-1&&t&&t.length?s=t.length-1:s=e,i)for(let r=s;r--;){const n=t[r].attrs["HDCP-LEVEL"];if(n&&n<=i)return r}return s}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}We.defaultConfig=void 0;const we=d=>(Pa("data-v-5527297c"),d=d(),Oa(),d),Pd=we(()=>Ht("div",{class:"artplayer-app"},null,-1)),Od={key:0,class:"zfile-video-switch-tools"},Nd=we(()=>Ht("img",{src:Va,alt:"\u4E0B\u8F7D"},null,-1)),Fd=we(()=>Ht("img",{src:$a,alt:"\u8FC5\u96F7"},null,-1)),Bd=we(()=>Ht("img",{src:za,alt:"motrix"},null,-1)),Ud=we(()=>Ht("img",{src:Ha,alt:"PotPlayer"},null,-1)),jd=we(()=>Ht("img",{src:Ya,alt:"IINA"},null,-1)),Gd=we(()=>Ht("img",{src:Ka,alt:"VLC"},null,-1)),Vd=we(()=>Ht("img",{src:Wa,alt:"nPlayer"},null,-1)),$d=we(()=>Ht("img",{src:qa,alt:"MXPlayer(Free)"},null,-1)),zd=we(()=>Ht("img",{src:Qa,alt:"MXPlayer(Pro)"},null,-1)),Hd={__name:"VideoPlayer",setup(d){let t=ja();Ra();let{getPathPwd:e}=Ua(),{currentPath:i,storageKey:s}=Da(),r=Na(),n=Fa();const a=A=>{let U=[];return r.filterFileByType("video").forEach(B=>{U.push({default:B.name===A,html:B.name,url:B.url})}),U};let l=Ca(null);const o=A=>{switch(A){case"download":window.location=l.value.url;break;case"thunder":window.location=`thunder://${btoa("AA"+l.value.url+"ZZ")}`;break;case"motrix":window.location=`motrix://new-task?uri=${encodeURIComponent(l.value.url)}&out=${encodeURIComponent(l.value.name)}`;break;case"potplayer":window.location=`potplayer://${l.value.url}`;break;case"iina":window.location=`iina://weblink?url=${encodeURIComponent(l.value.url)}`;break;case"vlc":window.location=`vlc://${l.value.url}`;break;case"nplayer":window.location=`nplayer-${l.value.url}`;break;case"mxplayer":window.location="intent:"+l.value.url+"#Intent;package=com.mxtech.videoplayer.ad;S.title="+l.value.name+";end";break;case"mxplayer-pro":window.location="intent:"+l.value.url+"#Intent;package=com.mxtech.videoplayer.pro;S.title="+l.value.name+";end";break}},c=A=>{let U=r.filterFileByType("video");u();for(let B=0;B<U.length;B++)if(U[B].name===A)return{prev:U[B-1]||null,next:U[B+1]||null}},u=()=>{let A=JSON.parse(localStorage.getItem("_h5_player_play_progress_"));if(A){for(let U of Object.keys(A))U.endsWith(A[U].progress)&&delete A[U];localStorage.setItem("_h5_player_play_progress_",JSON.stringify(A))}},h=A=>{let U=[];return r.fileList.find(B=>{let $=A.split(".")[0],X=B.name;(X===A+".vtt"||X===A+".srt"||X===A+".ass"||X===$+".vtt"||X===$+".srt"||X===$+".ass")&&U.push({default:U.length===0,url:B.url,html:X})}),U.length>0&&U.push({url:"",html:"\u5173\u95ED\u5B57\u5E55"}),U};let p='<i class="art-icon art-icon-not-hidden"><svg t="1662978336444" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="968" width="128" height="128"><path d="M711.456 377.184c32.736 31.52 60.928 72.256 84.64 122.208a40.64 40.64 0 0 1 0 34.72c-63.776 135.04-160.48 202.528-290.112 202.528-46.752 0-89.248-8.832-127.456-26.464l37.184-37.184c27.52 10.048 57.6 15.104 90.272 15.104 108.864 0 188.48-55.168 244.608-171.296-21.088-43.584-45.44-78.56-73.44-105.28l34.304-34.336z m13.024-122.816l28.768 28.8a5.376 5.376 0 0 1 0 7.616L272.96 771.04a5.408 5.408 0 0 1-7.648 0l-28.8-28.8a5.376 5.376 0 0 1 0-7.616l71.36-71.36c-35.84-32.384-66.56-75.392-92.032-129.088a40.64 40.64 0 0 1 0-34.72C279.68 364.48 376.384 296.96 505.984 296.96c50.752 0 96.448 10.4 137.12 31.168l73.76-73.728a5.376 5.376 0 0 1 7.616 0z m-218.496 91.136c-108.8 0-188.416 55.168-244.608 171.296 22.944 47.36 49.792 84.608 80.928 112.096l56.256-56.256a118.688 118.688 0 0 1 160.576-160.576l47.424-47.424c-30.336-12.832-63.776-19.136-100.576-19.136z m-70.016 137.088a75.616 75.616 0 0 0-4.64 57.28l95.04-95.04a75.616 75.616 0 0 0-90.4 37.76z m60.416 109.504a75.456 75.456 0 0 0 82.144-82.112l35.616-35.616a118.72 118.72 0 0 1-153.376 153.344l35.616-35.616z" p-id="969"></path></svg></i>',m='<i class="art-icon art-icon-hidden"><svg t="1662978261880" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4451" width="128" height="128"><path d="M512.032 648a136.128 136.128 0 0 1-136-136c0-74.976 60.992-136 136-136s136 61.024 136 136a136.128 136.128 0 0 1-136 136z m0-224c-48.544 0-88 39.456-88 88s39.456 88 88 88 88-39.456 88-88-39.456-88-88-88z" p-id="4452"></path><path d="M512.032 743.616a327.68 327.68 0 0 1-231.872-95.616L142.88 512l137.28-136a327.68 327.68 0 0 1 231.872-95.584c87.328 0 169.664 33.952 231.872 95.584l137.28 136-137.28 136a327.52 327.52 0 0 1-231.872 95.616zM206.528 512l107.424 101.952c53.152 52.672 123.488 81.696 198.048 81.696s144.896-29.024 198.08-81.696L817.536 512l-107.424-101.952c-53.152-52.672-123.488-81.696-198.048-81.696s-144.896 29.024-198.08 81.696L206.528 512z" p-id="4453"></path></svg></i>',v='<i class="art-icon art-icon-video-list"><svg t="1650551038453" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12028" width="20" height="20"><path d="M111.395066 179.64038l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12029"></path><path d="M111.395066 468.067418l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12030"></path><path d="M111.395066 756.493433l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12031"></path></svg></i>',E=`<i class="art-icon art-icon-subtitle"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 48 48">
    <path d="M0 0h48v48H0z" fill="none"></path>
    <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
</svg></i>`,C='<i class="art-icon art-icon-next-video"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>',N='<i class="art-icon art-icon-prev-video" style="transform: scale(-1,1);"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>';const R=rr("zfile-video-auto-player-next",!1),x=rr("zfile-video-auto-player",!1),P=rr("zfile-video-hiddle-tools",!1);let M=null;const b=(A,U)=>se(this,null,function*(){var k;l.value={name:A,url:U},document.querySelector(".zfile-video-dialog .el-dialog__title").innerHTML=A,M&&M.destroy();let B="mp4";A.toLowerCase().endsWith("flv")?B="flv":A.toLowerCase().endsWith("m3u8")&&(B="m3u8"),t.removeDuplicateSeparator(`${i.value}/${A}`);let $=t.removeDuplicateSeparator(`${i.value}/__${A}__/video.m3u8`),X={storageKey:s.value,path:$,password:e()},nt=yield Ba(X);((k=nt==null?void 0:nt.data)==null?void 0:k.code)===0&&(console.log("\u68C0\u6D4B\u5230\u5F53\u524D\u4E3A h5ai_dplayer \u517C\u5BB9\u6A21\u5F0F, \u66FF\u6362\u64AD\u653E\u6587\u4EF6\u4E3A: "+$),B="m3u8");let ot={container:".artplayer-app",title:A,url:l.value.url,type:B,setting:!0,playbackRate:!0,flip:!0,fullscreen:!0,fastForward:!0,autoOrientation:!0,aspectRatio:!0,fullscreenWeb:!0,theme:"#23ade5",lock:!0,subtitleOffset:!0,miniProgressBar:!0,autoplay:x.value,whitelist:["*"],airplay:!0,moreVideoAttr:{"x5-video-player-type":"h5","x5-video-player-fullscreen":!1,"x5-video-orientation":"portraint",preload:"metadata",crossOrigin:"anonymous"},customType:{flv:function(F,G){if(vs.isSupported()){const Z=vs.createPlayer({type:"flv",url:G});Z.attachMediaElement(F),Z.load()}else M.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Aflv"},m3u8:function(F,G){if(We.isSupported()){const Z=new We({xhrSetup:(rt,ut)=>{let gt=ut.substring(ut.lastIndexOf("/")+1);if(ut!==G){let It=r.getFileUrlByName(gt);It?rt.open("GET",It,!0):rt.open("GET",ut,!0)}}});Z.loadSource(G),Z.attachMedia(F)}else{const Z=F.canPlayType("application/vnd.apple.mpegurl");Z==="probably"||Z=="maybe"?F.src=G:M.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Am3u8"}}},contextmenu:[{html:"\u4E0B\u8F7D",click:function(){window.open(U)}}],settings:[{html:"\u81EA\u52A8\u64AD\u653E",tooltip:x.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:x.value,onSwitch:function(F,G,Z){const rt=!F.switch;return x.value=rt,M.autoplay=rt,F.tooltip=rt?"\u5F00\u542F":"\u5173\u95ED",rt}},{html:"\u81EA\u52A8\u64AD\u653E\u4E0B\u4E00\u4E2A\u89C6\u9891",tooltip:R.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:R.value,onSwitch:function(F,G,Z){const rt=!F.switch;return R.value=rt,F.tooltip=rt?"\u5F00\u542F":"\u5173\u95ED",rt}}],controls:[{position:"right",html:P.value?p:m,click:function(F,G){P.value=!P.value,G.target.parentNode.parentNode.innerHTML=P.value?p:m}},{name:"video-list",position:"right",html:v,selector:a(A),onSelect:function(F,G){return b(F.html,F.url),v}}]},z=h(A);z.length>0&&z.length>1&&ot.controls.push({name:"video-subtitle",position:"right",html:E,selector:z,onSelect:F=>(F.html==="\u5173\u95ED\u5B57\u5E55"?M.subtitle.show=!1:(M.subtitle.show=!0,M.subtitle.url=F.url),E)}),M=new Xa(ot),M.on("destory",()=>{}),t.isMobile.value===!1&&M.on("ready",()=>{let F=c(M.option.title);F.prev&&M.controls.add({name:"prev-video",position:"left",index:5,tooltip:"\u64AD\u653E\u4E0A\u4E00\u4E2A",html:N,click:()=>{I()}}),F.next&&M.controls.add({name:"next-video",position:"left",index:15,tooltip:"\u64AD\u653E\u4E0B\u4E00\u4E2A",html:C,click:()=>{T()}})}),M.on("video:ended",()=>{R.value&&T()}),z.length>0&&(M.subtitle.url=z[0].url)}),T=()=>{const A=c(M.option.title).next;A&&b(A.name,A.url)},I=()=>{const A=c(M.option.title).prev;A&&b(A.name,A.url)};return ka(()=>{b(r.currentClickRow.name,r.currentClickRow.url)}),(A,U)=>{const B=Ia,$=wa;return pi(),mi("div",null,[Pd,Fe(l)&&Fe(t).isMobile.value?(pi(),mi("div",Od,[_e(B,{disabled:!c(Fe(l).name).prev,icon:Fe(io),onClick:I},{default:Xt(()=>[ve("\u4E0A\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"]),_e(B,{disabled:!c(Fe(l).name).next,icon:Fe(oo),onClick:T},{default:Xt(()=>[ve("\u4E0B\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"])])):ys("",!0),Ht("div",{class:_s(["zfile-video-tools",Fe(P)?"hidden-important":""])},[Fe(n).permission.download?(pi(),mi(Ma,{key:0},[Ht("div",{class:"zfile-video-tools-item",onClick:U[0]||(U[0]=X=>o("download"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u76F4\u63A5\u4E0B\u8F7D ")]),default:Xt(()=>[Nd]),_:1})]),Ht("div",{class:"zfile-video-tools-item",onClick:U[1]||(U[1]=X=>o("thunder"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528\u8FC5\u96F7\u4E0B\u8F7D ")]),default:Xt(()=>[Fd]),_:1})]),Ht("div",{class:"zfile-video-tools-item",onClick:U[2]||(U[2]=X=>o("motrix"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528 motrix \u4E0B\u8F7D ")]),default:Xt(()=>[Bd]),_:1})])],64)):ys("",!0),Ht("div",{class:"zfile-video-tools-item",onClick:U[3]||(U[3]=X=>o("potplayer"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528 PotPlayer \u64AD\u653E ")]),default:Xt(()=>[Ud]),_:1})]),Ht("div",{class:"zfile-video-tools-item",onClick:U[4]||(U[4]=X=>o("iina"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528 IINA \u64AD\u653E ")]),default:Xt(()=>[jd]),_:1})]),Ht("div",{class:"zfile-video-tools-item",onClick:U[5]||(U[5]=X=>o("vlc"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528 VLC \u64AD\u653E ")]),default:Xt(()=>[Gd]),_:1})]),Ht("div",{class:"zfile-video-tools-item",onClick:U[6]||(U[6]=X=>o("nplayer"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528 nPlayer \u64AD\u653E ")]),default:Xt(()=>[Vd]),_:1})]),Ht("div",{class:"zfile-video-tools-item",onClick:U[7]||(U[7]=X=>o("mxplayer"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528 MXPlayer(Free) \u64AD\u653E ")]),default:Xt(()=>[$d]),_:1})]),Ht("div",{class:"zfile-video-tools-item",onClick:U[8]||(U[8]=X=>o("mxplayer-pro"))},[_e($,{placement:"top"},{content:Xt(()=>[ve(" \u4F7F\u7528 MXPlayer(Pro) \u64AD\u653E ")]),default:Xt(()=>[zd]),_:1})])],2),Ht("div",{class:_s(["zfile-video-tools-tips",Fe(P)?"hidden-important":""])}," tips: \u53EF\u70B9\u51FB\u4E0A\u65B9\u7684\u8F6F\u4EF6\u56FE\u6807\u8FDB\u884C\u4E0B\u8F7D\u64AD\u653E, \u672C\u5730\u64AD\u653E\u5668\u89E3\u7801\u6548\u679C\u66F4\u4F73. ",2)])}}};var Su=Ga(Hd,[["__scopeId","data-v-5527297c"]]);export{Su as default};
