import{x as P}from"./base.9447ff7a.js";/* empty css                *//* empty css               *//* empty css              */import"./tag.be7f307a.js";import{E as $,a as G}from"./select.06aace55.js";import"./scrollbar.b58c5e8b.js";import"./popper.34e4046d.js";import{E as H}from"./alert.73507778.js";import{_ as J}from"./SvgIcon.bb4e9d6f.js";import{r as I,aa as K,ac as Q,o as W,Z as X,D as Y,u as l,a as c,b as x,e as a,y as h,j as r,A as ee,z,f as E,O as S,P as A,a3 as te,bg as oe,af as ae,ag as le}from"./index.a81894c3.js";import{Z as D,a as re}from"./ZFormItem.85c758c5.js";import{g as se,h as ne,i as ie}from"./admin-storage.576b99eb.js";import{u as R}from"./common.3ffdf4de.js";import{S as ue}from"./sortable.esm.d7ef5fdd.js";import{E as q}from"./request.88c6336a.js";import{E as de}from"./index.9f034646.js";import{l as me}from"./admin-user.9036c1c8.js";import{b as U}from"./route-block.89f12ae7.js";import{_ as ce}from"./plugin-vue_export-helper.21dcd24c.js";import{r as pe}from"./CheckBadgeIcon.5c38551d.js";import{v as fe}from"./directive.8a34351b.js";import"./index.9dce3cd8.js";import"./event.807e9a54.js";import"./scroll.c1d55f52.js";import"./index.3b295ed4.js";import"./_Uint8Array.25475a91.js";import"./debounce.ff28d2f1.js";import"./validator.4f1297a1.js";import"./focus-trap.c21bbfc6.js";import"./index.b1a3ab43.js";import"./index.1d04ede7.js";let o=I([]),V=I(!1);function _e(i,_){let p=_.params.storageId;const v=()=>{se(p).then(s=>{o.value=s.data,o.value.length===0&&f(),b()})},b=()=>{const s=document.querySelector(".z-form-body");ue.create(s,{draggable:".expression-item",onEnd:e=>{if(e.oldIndex===e.newIndex)return;const u=o.value.splice(e.oldIndex-1,1)[0];o.value.splice(e.newIndex-1,0,u)}})},y=()=>{let s=o.value.find(e=>{if(R.isEmpty(e.userId)||R.isEmpty(e.permission))return q.warning("\u8BF7\u68C0\u67E5\u6570\u636E\u586B\u5199\u662F\u5426\u5B8C\u6574"),!0});for(let e=0;e<o.value.length;e++){let u=0,g=o.value[e].userId;for(let d=0;d<o.value.length;d++)o.value[d].userId==g&&u++;if(u>1)return q.warning("\u540C\u4E00\u7528\u6237\u4E0D\u80FD\u51FA\u73B0\u591A\u6B21"),!0}s||(V.value=!0,ne(p,o.value).then(()=>{de.confirm("\u4FDD\u5B58\u6210\u529F, \u662F\u5426\u8FD4\u56DE\u5B58\u50A8\u6E90\u5217\u8868\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"success",callback:e=>{e==="confirm"?i.push("/admin/storage-list"):v()}})}).finally(()=>{V.value=!1}))},f=()=>{o.value.push({userId:"",permission:"",storageId:p})};return{loading:V,loadAuthData:v,authList:o,addAuthItem:f,deleteAuthItem:s=>{o.value.splice(s,1)},saveAuthData:y}}const ve=i=>(ae("data-v-684516b5"),i=i(),le(),i),ge={class:"flex justify-items-center"},he=ve(()=>h("div",{class:"rules-tips"},"\u53EF\u4EE5\u5BF9\u5B58\u50A8\u6E90\u8FDB\u884C\u8BFB\u548C\u5199\u6388\u6743\uFF0C\u5199\u5305\u542B\u8BFB\u6743\u9650",-1)),Ie={class:"sm:flex sm:space-x-2 sm:border-b-0 sm:pb-0 border-b pb-2"},Z={__name:"[storageId]",setup(i){let _=K(),p=Q(),v=_.params.storageId;const{loading:b,loadAuthData:y,authList:f,addAuthItem:w,deleteAuthItem:s,saveAuthData:e}=_e(p,_),u=["\u8BFB","\u5199"];let g=I();W(()=>{y(),C(),F()});const d=I(),C=()=>{ie(v).then(m=>{m.data.type=m.data.type.key,d.value=m.data})},F=()=>{me().then(m=>{g.value=m.data})};return(m,be)=>{const M=J,N=X("router-link"),T=H,B=$,L=G,k=P,j=fe;return Y((c(),x(re,{model:l(f),class:"zfile-admin-password-form"},{"form-title":a(()=>{var n;return[h("div",ge,[r(N,{to:"/admin/storage-list"},{default:a(()=>[r(M,{class:"inline mr-2 cursor-pointer",name:"file-type-back"})]),_:1}),h("span",null,"\u6388\u6743\u7BA1\u7406\uFF08"+ee((n=l(d))==null?void 0:n.name)+"\uFF09",1)])]}),"form-sub-title":a(()=>[r(T,{closable:!1,type:"info"},{default:a(()=>[he]),_:1})]),footer:a(()=>[r(k,{type:"primary",size:"default",icon:l(pe),onClick:l(e)},{default:a(()=>[z("\u4FDD\u5B58\u8BBE\u7F6E")]),_:1},8,["icon","onClick"])]),default:a(()=>[(c(!0),E(S,null,A(l(f),(n,O)=>(c(),x(D,{required:!0,key:n,class:"expression-item"},{default:a(()=>[h("div",Ie,[r(L,{size:"default",modelValue:n.userId,"onUpdate:modelValue":t=>n.userId=t,placeholder:"\u8BF7\u9009\u62E9\u7528\u6237"},{default:a(()=>[(c(!0),E(S,null,A(l(g),t=>(c(),x(B,{disabled:t.disabled,key:t.id,label:t.username+"("+t.usernameZh+")",value:t.id},null,8,["disabled","label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),r(L,{size:"default",modelValue:n.permission,"onUpdate:modelValue":t=>n.permission=t,placeholder:"\u8BF7\u9009\u62E9\u6743\u9650"},{default:a(()=>[(c(),E(S,null,A(u,t=>r(B,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),r(k,{type:"danger",onClick:t=>l(s)(O),icon:l(te)},null,8,["onClick","icon"])])]),_:2},1024))),128)),r(D,null,{default:a(()=>[r(k,{type:"primary",size:"default",icon:l(oe),onClick:l(w)},{default:a(()=>[z("\u6DFB\u52A0\u66F4\u591A")]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["model"])),[[j,l(b)]])}}};typeof U=="function"&&U(Z);var Ye=ce(Z,[["__scopeId","data-v-684516b5"]]);export{Ye as default};
