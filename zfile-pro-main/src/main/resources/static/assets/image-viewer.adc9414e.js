var Ce=Object.defineProperty,Ee=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var pe=(s,l,e)=>l in s?Ce(s,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[l]=e,F=(s,l)=>{for(var e in l||(l={}))xe.call(l,e)&&pe(s,e,l[e]);if(ve)for(var e of ve(l))Ne.call(l,e)&&pe(s,e,l[e]);return s},Q=(s,l)=>Ee(s,Se(l));var ge=(s,l,e)=>new Promise((o,v)=>{var _=f=>{try{R(e.next(f))}catch(h){v(h)}},i=f=>{try{R(e.throw(f))}catch(h){v(h)}},R=f=>f.done?o(f.value):Promise.resolve(f.value).then(_,i);R((e=e.apply(s,l)).next())});import{m as ye,u as V}from"./request.88c6336a.js";import{d as ne,aT as we,aU as Te,aV as Oe,r as z,aW as Re,s as $e,c as g,w as ce,W as he,o as be,a as k,b as de,j as d,e as S,y as b,g as m,u as n,n as fe,h as Ae,l as x,J as Ye,f as T,O as te,aX as Xe,B as Be,aY as Ve,a2 as Me,m as De,aZ as Pe,a_ as He,P as Fe,D as We,E as je,i as ee,T as Ke,al as Ze,a$ as Ge,A as Ue,v as qe,L as Je}from"./index.a81894c3.js";import{G as B,H as Qe,b as ke,d as me,i as ae,f as _e,a as Ie,A as et,E as O,_ as Le,m as X,a6 as tt,w as ze,R as at,u as nt}from"./base.9447ff7a.js";import{d as st}from"./debounce.ff28d2f1.js";import{u as lt}from"./index.9dce3cd8.js";import{g as ot}from"./scroll.c1d55f52.js";const rt=(s,l)=>{if(!B||!s||!l)return!1;const e=s.getBoundingClientRect();let o;return l instanceof Element?o=l.getBoundingClientRect():o={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},e.top<o.bottom&&e.bottom>o.top&&e.right>o.left&&e.left<o.right},Nt=s=>{let l,e;return s.type==="touchend"?(e=s.changedTouches[0].clientY,l=s.changedTouches[0].clientX):s.type.startsWith("touch")?(e=s.touches[0].clientY,l=s.touches[0].clientX):(e=s.clientY,l=s.clientX),{clientX:l,clientY:e}};var it="Expected a function";function ue(s,l,e){var o=!0,v=!0;if(typeof s!="function")throw new TypeError(it);return Qe(e)&&(o="leading"in e?!!e.leading:o,v="trailing"in e?!!e.trailing:v),st(s,l,{leading:o,maxWait:l,trailing:v})}const ut=ke({urlList:{type:me(Array),default:()=>ye([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),ct={close:()=>!0,switch:s=>ae(s),rotate:s=>ae(s)},dt=["src"],ft=ne({name:"ElImageViewer"}),mt=ne(Q(F({},ft),{props:ut,emits:ct,setup(s,{expose:l,emit:e}){const o=s,v={CONTAIN:{name:"contain",icon:we(Te)},ORIGINAL:{name:"original",icon:we(Oe)}},{t:_}=_e(),i=Ie("image-viewer"),{nextZIndex:R}=et(),f=z(),h=z([]),N=Re(),C=z(!0),w=z(o.initialIndex),y=$e(v.CONTAIN),c=z({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=g(()=>{const{urlList:a}=o;return a.length<=1}),A=g(()=>w.value===0),W=g(()=>w.value===o.urlList.length-1),se=g(()=>o.urlList[w.value]),le=g(()=>[i.e("btn"),i.e("prev"),i.is("disabled",!o.infinite&&A.value)]),D=g(()=>[i.e("btn"),i.e("next"),i.is("disabled",!o.infinite&&W.value)]),oe=g(()=>{const{scale:a,deg:r,offsetX:u,offsetY:I,enableTransition:E}=c.value;let p=u/a,L=I/a;switch(r%360){case 90:case-270:[p,L]=[L,-p];break;case 180:case-180:[p,L]=[-p,-L];break;case 270:case-90:[p,L]=[-L,p];break}const Y={transform:`scale(${a}) rotate(${r}deg) translate(${p}px, ${L}px)`,transition:E?"transform .3s":""};return y.value.name===v.CONTAIN.name&&(Y.maxWidth=Y.maxHeight="100%"),Y}),j=g(()=>ae(o.zIndex)?o.zIndex:R());function $(){ie(),e("close")}function re(){const a=ue(u=>{switch(u.code){case X.esc:o.closeOnPressEscape&&$();break;case X.space:U();break;case X.left:q();break;case X.up:t("zoomIn");break;case X.right:J();break;case X.down:t("zoomOut");break}}),r=ue(u=>{const I=u.deltaY||u.deltaX;t(I<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});N.run(()=>{V(document,"keydown",a),V(document,"wheel",r)})}function ie(){N.stop()}function K(){C.value=!1}function Z(a){C.value=!1,a.target.alt=_("el.image.error")}function G(a){if(C.value||a.button!==0||!f.value)return;c.value.enableTransition=!1;const{offsetX:r,offsetY:u}=c.value,I=a.pageX,E=a.pageY,p=ue(Y=>{c.value=Q(F({},c.value),{offsetX:r+Y.pageX-I,offsetY:u+Y.pageY-E})}),L=V(document,"mousemove",p);V(document,"mouseup",()=>{L()}),a.preventDefault()}function P(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function U(){if(C.value)return;const a=tt(v),r=Object.values(v),u=y.value.name,E=(r.findIndex(p=>p.name===u)+1)%a.length;y.value=v[a[E]],P()}function H(a){const r=o.urlList.length;w.value=(a+r)%r}function q(){A.value&&!o.infinite||H(w.value-1)}function J(){W.value&&!o.infinite||H(w.value+1)}function t(a,r={}){if(C.value)return;const{minScale:u,maxScale:I}=o,{zoomRate:E,rotateDeg:p,enableTransition:L}=F({zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0},r);switch(a){case"zoomOut":c.value.scale>u&&(c.value.scale=Number.parseFloat((c.value.scale/E).toFixed(3)));break;case"zoomIn":c.value.scale<I&&(c.value.scale=Number.parseFloat((c.value.scale*E).toFixed(3)));break;case"clockwise":c.value.deg+=p,e("rotate",c.value.deg);break;case"anticlockwise":c.value.deg-=p,e("rotate",c.value.deg);break}c.value.enableTransition=L}return ce(se,()=>{he(()=>{const a=h.value[0];a!=null&&a.complete||(C.value=!0)})}),ce(w,a=>{P(),e("switch",a)}),be(()=>{var a,r;re(),(r=(a=f.value)==null?void 0:a.focus)==null||r.call(a)}),l({setActiveItem:H}),(a,r)=>(k(),de(Ze,{to:"body",disabled:!a.teleported},[d(Ke,{name:"viewer-fade",appear:""},{default:S(()=>[b("div",{ref_key:"wrapper",ref:f,tabindex:-1,class:m(n(i).e("wrapper")),style:fe({zIndex:n(j)})},[b("div",{class:m(n(i).e("mask")),onClick:r[0]||(r[0]=Ae(u=>a.hideOnClickModal&&$(),["self"]))},null,2),x(" CLOSE "),b("span",{class:m([n(i).e("btn"),n(i).e("close")]),onClick:$},[d(n(O),null,{default:S(()=>[d(n(Ye))]),_:1})],2),x(" ARROW "),n(M)?x("v-if",!0):(k(),T(te,{key:0},[b("span",{class:m(n(le)),onClick:q},[d(n(O),null,{default:S(()=>[d(n(Xe))]),_:1})],2),b("span",{class:m(n(D)),onClick:J},[d(n(O),null,{default:S(()=>[d(n(Be))]),_:1})],2)],64)),x(" ACTIONS "),b("div",{class:m([n(i).e("btn"),n(i).e("actions")])},[b("div",{class:m(n(i).e("actions__inner"))},[d(n(O),{onClick:r[1]||(r[1]=u=>t("zoomOut"))},{default:S(()=>[d(n(Ve))]),_:1}),d(n(O),{onClick:r[2]||(r[2]=u=>t("zoomIn"))},{default:S(()=>[d(n(Me))]),_:1}),b("i",{class:m(n(i).e("actions__divider"))},null,2),d(n(O),{onClick:U},{default:S(()=>[(k(),de(De(n(y).icon)))]),_:1}),b("i",{class:m(n(i).e("actions__divider"))},null,2),d(n(O),{onClick:r[3]||(r[3]=u=>t("anticlockwise"))},{default:S(()=>[d(n(Pe))]),_:1}),d(n(O),{onClick:r[4]||(r[4]=u=>t("clockwise"))},{default:S(()=>[d(n(He))]),_:1})],2)],2),x(" CANVAS "),b("div",{class:m(n(i).e("canvas"))},[(k(!0),T(te,null,Fe(a.urlList,(u,I)=>We((k(),T("img",{ref_for:!0,ref:E=>h.value[I]=E,key:u,src:u,style:fe(n(oe)),class:m(n(i).e("img")),onLoad:K,onError:Z,onMousedown:G},null,46,dt)),[[je,I===w.value]])),128))],2),ee(a.$slots,"default")],6)]),_:3})],8,["disabled"]))}}));var vt=Le(mt,[["__file","image-viewer.vue"]]);const pt=ze(vt),gt=ke({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:me([String,Object])},previewSrcList:{type:me(Array),default:()=>ye([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),wt={load:s=>s instanceof Event,error:s=>s instanceof Event,switch:s=>ae(s),close:()=>!0,show:()=>!0},yt=["src","loading"],ht={key:0},bt=ne({name:"ElImage",inheritAttrs:!1}),kt=ne(Q(F({},bt),{props:gt,emits:wt,setup(s,{emit:l}){const e=s;let o="";const{t:v}=_e(),_=Ie("image"),i=Ge(),R=lt(),f=z(),h=z(!1),N=z(!0),C=z(!1),w=z(),y=z(),c=B&&"loading"in HTMLImageElement.prototype;let M,A;const W=g(()=>[_.e("inner"),D.value&&_.e("preview"),N.value&&_.is("loading")]),se=g(()=>i.style),le=g(()=>{const{fit:t}=e;return B&&t?{objectFit:t}:{}}),D=g(()=>{const{previewSrcList:t}=e;return Array.isArray(t)&&t.length>0}),oe=g(()=>{const{previewSrcList:t,initialIndex:a}=e;let r=a;return a>t.length-1&&(r=0),r}),j=g(()=>e.loading==="eager"?!1:!c&&e.loading==="lazy"||e.lazy),$=()=>{!B||(N.value=!0,h.value=!1,f.value=e.src)};function re(t){N.value=!1,h.value=!1,l("load",t)}function ie(t){N.value=!1,h.value=!0,l("error",t)}function K(){rt(w.value,y.value)&&($(),P())}const Z=nt(K,200,!0);function G(){return ge(this,null,function*(){var t;if(!B)return;yield he();const{scrollContainer:a}=e;at(a)?y.value=a:Je(a)&&a!==""?y.value=(t=document.querySelector(a))!=null?t:void 0:w.value&&(y.value=ot(w.value)),y.value&&(M=V(y,"scroll",Z),setTimeout(()=>K(),100))})}function P(){!B||!y.value||!Z||(M==null||M(),y.value=void 0)}function U(t){if(!!t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}function H(){!D.value||(A=V("wheel",U,{passive:!1}),o=document.body.style.overflow,document.body.style.overflow="hidden",C.value=!0,l("show"))}function q(){A==null||A(),document.body.style.overflow=o,C.value=!1,l("close")}function J(t){l("switch",t)}return ce(()=>e.src,()=>{j.value?(N.value=!0,h.value=!1,P(),G()):$()}),be(()=>{j.value?G():$()}),(t,a)=>(k(),T("div",{ref_key:"container",ref:w,class:m([n(_).b(),t.$attrs.class]),style:fe(n(se))},[h.value?ee(t.$slots,"error",{key:0},()=>[b("div",{class:m(n(_).e("error"))},Ue(n(v)("el.image.error")),3)]):(k(),T(te,{key:1},[f.value!==void 0?(k(),T("img",qe({key:0},n(R),{src:f.value,loading:t.loading,style:n(le),class:n(W),onClick:H,onLoad:re,onError:ie}),null,16,yt)):x("v-if",!0),N.value?(k(),T("div",{key:1,class:m(n(_).e("wrapper"))},[ee(t.$slots,"placeholder",{},()=>[b("div",{class:m(n(_).e("placeholder"))},null,2)])],2)):x("v-if",!0)],64)),n(D)?(k(),T(te,{key:2},[C.value?(k(),de(n(pt),{key:0,"z-index":t.zIndex,"initial-index":n(oe),infinite:t.infinite,"zoom-rate":t.zoomRate,"min-scale":t.minScale,"max-scale":t.maxScale,"url-list":t.previewSrcList,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:q,onSwitch:J},{default:S(()=>[t.$slots.viewer?(k(),T("div",ht,[ee(t.$slots,"viewer")])):x("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):x("v-if",!0)],64)):x("v-if",!0)],6))}}));var _t=Le(kt,[["__file","image.vue"]]);const Tt=ze(_t);export{Tt as E,Nt as g};
